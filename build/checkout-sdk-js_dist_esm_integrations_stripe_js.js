"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackJsonpCheckout"] = self["webpackJsonpCheckout"] || []).push([["checkout-sdk-js_dist_esm_integrations_stripe_js"],{

/***/ "../checkout-sdk-js/dist/esm/integrations/stripe.js":
/*!**********************************************************!*\
  !*** ../checkout-sdk-js/dist/esm/integrations/stripe.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createLinkV2ButtonStrategy: () => (/* binding */ Y),\n/* harmony export */   createStripeLinkV2CustomerStrategy: () => (/* binding */ H),\n/* harmony export */   createStripeOCSPaymentStrategy: () => (/* binding */ Se),\n/* harmony export */   createStripeUPECustomerStrategy: () => (/* binding */ O),\n/* harmony export */   createStripeUPEPaymentStrategy: () => (/* binding */ ye),\n/* harmony export */   createStripeV3PaymentStrategy: () => (/* binding */ de)\n/* harmony export */ });\n/* harmony import */ var _bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bigcommerce/script-loader */ \"../checkout-sdk-js/node_modules/@bigcommerce/script-loader/lib/index.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ \"../checkout-sdk-js/node_modules/lodash/lodash.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);\nvar s={};function a(e,t){return Object.assign(e,{resolveIds:t})}s.d=(e,t)=>{for(var i in t)s.o(t,i)&&!s.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},s.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class d extends Error{constructor(e){var t;super(e||\"An unexpected error has occurred.\"),this.name=\"StandardError\",this.type=\"standard\",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,\"function\"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class l extends d{constructor(e){super(e||\"Unable to proceed because the client library of a payment method is not loaded or ready to be used.\"),this.name=\"PaymentMethodClientUnavailableError\",this.type=\"payment_method_client_unavailable\"}}var c,u=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class h{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,i,n){return u(this,void 0,void 0,function*(){if(this.stripeWindow.bcStripeClient)return this.stripeWindow.bcStripeClient;const r=yield this.load(),{stripePublishableKey:o,stripeConnectedAccount:s}=e,a=r(o,Object.assign(Object.assign(Object.assign(Object.assign({},s?{stripeAccount:s}:{}),t?{locale:t}:{}),i?{betas:i}:{}),n?{apiVersion:n}:{}));return Object.assign(this.stripeWindow,{bcStripeClient:a}),a})}getElements(e,t){return u(this,void 0,void 0,function*(){let i=this.stripeWindow.bcStripeElements;return i?yield this.updateStripeElements(t):(i=e.elements(t),Object.assign(this.stripeWindow,{bcStripeElements:i})),i})}updateStripeElements(e){return u(this,void 0,void 0,function*(){const t=this.stripeWindow.bcStripeElements;t&&(t.update(e),yield t.fetchUpdates())})}load(){return u(this,void 0,void 0,function*(){if(!this.stripeWindow.Stripe&&(yield this.scriptLoader.loadScript(\"https://js.stripe.com/v3/\"),!this.stripeWindow.Stripe))throw new l;return this.stripeWindow.Stripe})}}class p extends d{constructor(e){super(e||\"Invalid arguments have been provided.\"),this.name=\"InvalidArgumentError\",this.type=\"invalid_argument\"}}!function(e){e[e.MissingBillingAddress=0]=\"MissingBillingAddress\",e[e.MissingCart=1]=\"MissingCart\",e[e.MissingCheckout=2]=\"MissingCheckout\",e[e.MissingConsignments=3]=\"MissingConsignments\",e[e.MissingCustomer=4]=\"MissingCustomer\",e[e.MissingCheckoutConfig=5]=\"MissingCheckoutConfig\",e[e.MissingOrder=6]=\"MissingOrder\",e[e.MissingOrderConfig=7]=\"MissingOrderConfig\",e[e.MissingOrderId=8]=\"MissingOrderId\",e[e.MissingPayment=9]=\"MissingPayment\",e[e.MissingPaymentId=10]=\"MissingPaymentId\",e[e.MissingPaymentInstrument=11]=\"MissingPaymentInstrument\",e[e.MissingPaymentMethod=12]=\"MissingPaymentMethod\",e[e.MissingPaymentRedirectUrl=13]=\"MissingPaymentRedirectUrl\",e[e.MissingPaymentStatus=14]=\"MissingPaymentStatus\",e[e.MissingPaymentToken=15]=\"MissingPaymentToken\",e[e.MissingShippingAddress=16]=\"MissingShippingAddress\"}(c||(c={}));class m extends d{constructor(e){super(function(e){switch(e){case c.MissingBillingAddress:return\"Unable to proceed because billing address data is unavailable.\";case c.MissingCart:return\"Unable to proceed because cart data is unavailable.\";case c.MissingConsignments:return\"Unable to proceed because consignments data is unavailable.\";case c.MissingCheckout:return\"Unable to proceed because checkout data is unavailable.\";case c.MissingCustomer:return\"Unable to proceed because customer data is unavailable.\";case c.MissingCheckoutConfig:case c.MissingOrderConfig:return\"Unable to proceed because configuration data is unavailable.\";case c.MissingOrder:return\"Unable to proceed because order data is unavailable.\";case c.MissingOrderId:return\"Unable to proceed because order ID is unavailable or not generated yet.\";case c.MissingPayment:return\"Unable to proceed because payment data is unavailable.\";case c.MissingPaymentToken:return\"Unable to proceed because the token required to submit a payment is missing.\";case c.MissingPaymentMethod:return\"Unable to proceed because payment method data is unavailable or not properly configured.\";case c.MissingShippingAddress:return\"Unable to proceed because shipping address data is unavailable.\";default:return\"Unable to proceed because the required data is unavailable.\"}}(e)),this.subtype=e,this.name=\"MissingDataError\",this.type=\"missing_data\"}}function y(e){return\"object\"==typeof e&&null!==e&&\"initializationData\"in e&&void 0!==e.initializationData&&null!==e.initializationData&&\"object\"==typeof e.initializationData&&\"stripePublishableKey\"in e.initializationData&&\"stripeConnectedAccount\"in e.initializationData&&\"shopperLanguage\"in e.initializationData&&void 0!==e.initializationData.stripePublishableKey&&void 0!==e.initializationData.stripeConnectedAccount&&void 0!==e.initializationData.shopperLanguage}const g=[\"payment_element_beta_2\",\"alipay_pm_beta_1\",\"link_default_integration_beta_1\",\"shipping_address_element_beta_1\",\"address_element_beta_1\"],v=\"2020-03-02;alipay_beta=v1;link_beta=v1\";var S,_,f,I,C,E,P,b;function w(e){return\"stripeLinkAuthenticationState\"in e}!function(e){e.SHIPPING=\"shipping\",e.BILLING=\"billing\"}(S||(S={})),function(e){e.SPLIT=\"split\",e.FULL=\"full\",e.ORGANIZATION=\"organization\"}(_||(_={})),function(e){e.CreditCard=\"card\",e.Link=\"link\",e.EPS=\"eps\",e.GRABPAY=\"grabpay\",e.BANCONTACT=\"bancontact\",e.IDEAL=\"ideal\",e.ALIPAY=\"alipay\",e.KLARNA=\"klarna\",e.OCS=\"optimized_checkout\"}(f||(f={})),function(e){e.NEVER=\"never\",e.AUTO=\"auto\",e.ALWAYS=\"always\",e.PAYMENT=\"payment\",e.IF_REQUIRED=\"if_required\"}(I||(I={})),function(e){e.PAYMENT=\"payment\",e.AUTHENTICATION=\"linkAuthentication\",e.SHIPPING=\"address\",e.EXPRESS_CHECKOUT=\"expressCheckout\"}(C||(C={})),function(e){e.REQUIRES_PAYMENT_METHOD=\"requires_payment_method\",e.REQUIRES_CONFIRMATION=\"requires_confirmation\",e.REQUIRES_ACTION=\"requires_action\",e.PROCESSING=\"processing\",e.SUCCEEDED=\"succeeded\",e.CANCELED=\"canceled\"}(E||(E={})),function(e){e.CLICK=\"click\",e.CHANGE=\"change\",e.READY=\"ready\",e.SHIPPING_ADDRESS_CHANGE=\"shippingaddresschange\",e.SHIPPING_RATE_CHANGE=\"shippingratechange\",e.CONFIRM=\"confirm\",e.CANCEL=\"cancel\",e.LOADER_START=\"loaderstart\"}(P||(P={})),function(e){e.ON_SESSION=\"on_session\",e.OFF_SESSION=\"off_session\"}(b||(b={}));class A{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){var t,i,n,r,o;return i=this,n=void 0,o=function*(){let i;if(!e.stripeupe)throw new p('Unable to proceed because \"options\" argument is not provided.');const{container:n,gatewayId:r,methodId:o,onEmailChange:s,getStyles:a,isLoading:d}=e.stripeupe;Object.entries(e.stripeupe).forEach(([e,t])=>{if(!t)throw new p(`Unable to proceed because \"${e}\" argument is not provided.`)}),yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:o}});const l=this.paymentIntegrationService.getState(),u=l.getPaymentMethodOrThrow(o,r),{clientToken:h}=u;if(!y(u)||!h)throw new m(c.MissingPaymentToken);const{email:_}=l.getCustomerOrThrow(),f=l.getPaymentProviderCustomerOrThrow(),I=(w(f)?f:{}).stripeLinkAuthenticationState;if(!_){let e;const r=\"function\"==typeof a&&a();e=r?{variables:{colorPrimary:r.fieldInnerShadow,colorBackground:r.fieldBackground,colorText:r.labelText,colorDanger:r.fieldErrorText,colorTextSecondary:r.labelText,colorTextPlaceholder:r.fieldPlaceholderText},rules:{\".Input\":{borderColor:r.fieldBorder,color:r.fieldText,boxShadow:r.fieldInnerShadow}}}:{},i=yield this.scriptLoader.getStripeClient(u.initializationData,l.getCartLocale(),g,v),this._stripeElements=yield this.scriptLoader.getElements(i,{clientSecret:h,appearance:e});const{getBillingAddress:o,getConsignments:p}=this.paymentIntegrationService.getState(),y=p(),_=null===(t=null==y?void 0:y[0])||void 0===t?void 0:t.id,{email:f}=o()||{},E=f?{defaultValues:{mode:S.SHIPPING,email:f}}:{},b=this._stripeElements.getElement(C.AUTHENTICATION)||this._stripeElements.create(C.AUTHENTICATION,E);b.on(P.CHANGE,e=>{if(!(\"authenticated\"in e))throw new m(c.MissingCustomer);this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:e.authenticated}),e.complete?s(e.authenticated,e.value.email):s(!1,\"\"),d&&d(!1),void 0===I&&e.authenticated&&_&&this.paymentIntegrationService.deleteConsignment(_)}),b.mount(`#${n}`)}},new((r=void 0)||(r=Promise))(function(e,t){function s(e){try{d(o.next(e))}catch(e){t(e)}}function a(e){try{d(o.throw(e))}catch(e){t(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r(function(e){e(i)})).then(s,a)}d((o=o.apply(i,n||[])).next())})}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(C.AUTHENTICATION))||void 0===t||t.unmount(),Promise.resolve()}signIn(e,t){return this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}signOut(e){return this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const O=a(t=>new A(t,new h((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{id:\"stripeupe\"}]);class M extends d{constructor(e){super(e||\"Payment process was cancelled.\"),this.name=\"PaymentMethodCancelledError\",this.type=\"payment_cancelled\"}}class T extends d{constructor(e){super(e||\"Unable to proceed because the client library of a payment method has thrown an unexpected error.\"),this.name=\"PaymentMethodFailedError\",this.type=\"payment_method_client_invalid\"}}var N;!function(e){e[e.CheckoutButtonNotInitialized=0]=\"CheckoutButtonNotInitialized\",e[e.CustomerNotInitialized=1]=\"CustomerNotInitialized\",e[e.PaymentNotInitialized=2]=\"PaymentNotInitialized\",e[e.ShippingNotInitialized=3]=\"ShippingNotInitialized\",e[e.SpamProtectionNotInitialized=4]=\"SpamProtectionNotInitialized\"}(N||(N={}));class k extends d{constructor(e){super(function(e){switch(e){case N.CustomerNotInitialized:return\"Unable to proceed because the customer step of checkout has not been initialized.\";case N.PaymentNotInitialized:return\"Unable to proceed because the payment step of checkout has not been initialized.\";case N.ShippingNotInitialized:return\"Unable to proceed because the shipping step of checkout has not been initialized.\";case N.SpamProtectionNotInitialized:return\"Unable to proceed because the checkout spam protection has not been initialized.\";default:return\"Unable to proceed because the required component has not been initialized.\"}}(e)),this.subtype=e,this.name=\"NotInitializedError\",this.type=\"not_initialized\"}}var D=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class R{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.isMounted=!1}deinitialize(){var e;null===(e=this.checkoutEventsUnsubscribe)||void 0===e||e.call(this),this.isMounted=!1}initCheckoutEventsSubscription(e,t,i,n){this.checkoutEventsUnsubscribe=this.paymentIntegrationService.subscribe(()=>D(this,void 0,void 0,function*(){var r;const o=null==n?void 0:n.getElement(C.PAYMENT);if(o){try{yield this.updateStripePaymentIntent(e,t)}catch(e){return this.isMounted&&(o.unmount(),this.isMounted=!1),void(e instanceof Error&&(null===(r=i.onError)||void 0===r||r.call(i,e)))}this.isMounted||(yield null==n?void 0:n.fetchUpdates(),this.mountElement(o,i.containerId))}}),e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.outstandingBalance},e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.coupons})}mountElement(e,t){document.getElementById(t)&&(e.mount(`#${t}`),this.isMounted=!0)}mapAppearanceVariables(e){return{colorPrimary:e.fieldInnerShadow,colorBackground:e.fieldBackground,colorText:e.labelText,colorDanger:e.fieldErrorText,colorTextSecondary:e.labelText,colorTextPlaceholder:e.fieldPlaceholderText,colorIcon:e.fieldPlaceholderText}}mapInputAppearanceRules(e){return{borderColor:e.fieldBorder,color:e.fieldText,boxShadow:e.fieldInnerShadow}}throwStripeError(e){if(\"object\"==typeof(t=e)&&null!==t&&\"type\"in t&&(this.throwDisplayableStripeError(e),this.isCancellationError(e)))throw new M;var t;throw new T}throwDisplayableStripeError(e){if((0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)([\"card_error\",\"invalid_request_error\",\"validation_error\"],e.type))throw new Error(e.message)}isCancellationError(e){var t;const i=null===(t=null==e?void 0:e.payment_intent.last_payment_error)||void 0===t?void 0:t.message;return!!i&&-1!==i.indexOf(\"canceled\")}throwPaymentConfirmationProceedMessage(){throw new T(\"We've received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it's completed. Please note, this process may take a few minutes depending on the processing times of your chosen method.\")}isPaymentCompleted(e,t){return D(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState(),n=i.getPaymentMethodOrThrow(e),{features:r}=i.getStoreConfigOrThrow().checkoutSettings;if(!n.clientToken||!t||!r[\"PI-626.Block_unnecessary_payment_confirmation_for_StripeUPE\"])return!1;const{paymentIntent:o}=yield t.retrievePaymentIntent(n.clientToken);return(null==o?void 0:o.status)===E.SUCCEEDED})}mapStripePaymentData(e,t,i=!1){const n=this.paymentIntegrationService.getState().getBillingAddress(),{firstName:r=\"\",lastName:o=\"\",email:s=\"\"}=n||{},a=this._mapStripeAddress(n);if(!e)throw new k(N.PaymentNotInitialized);if(!(s&&a&&a.city&&a.country&&r&&o))throw new m(c.MissingBillingAddress);return{elements:e,redirect:I.IF_REQUIRED,confirmParams:Object.assign({payment_method_data:Object.assign(Object.assign({},i?{allow_redisplay:\"always\"}:{}),{billing_details:{email:s,address:a,name:`${r} ${o}`}})},t&&{return_url:t})}}isAdditionalActionError(e){return (0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e,{code:\"additional_action_required\"})}isRedirectAction(e){const{type:t,data:{redirect_url:i}}=e;return\"redirect_to_url\"===t&&!!i}isOnPageAdditionalAction(e){const{type:t,data:{token:i}}=e;return\"additional_action_requires_payment_method\"===t&&!!i}updateStripePaymentIntent(e,t){return D(this,void 0,void 0,function*(){const i=yield this.paymentIntegrationService.loadPaymentMethod(e,{params:{method:t}}),{clientToken:n}=i.getPaymentMethodOrThrow(t);n&&this.scriptLoader.updateStripeElements({clientSecret:n})})}_mapStripeAddress(e){if(e){const{city:t,address1:i,address2:n,countryCode:r,postalCode:o,stateOrProvinceCode:s}=e;return Object.assign({city:t,country:r,postal_code:o,line1:i,line2:n},s?{state:s}:{})}throw new m(c.MissingBillingAddress)}}const z={size:70,color:\"#d9d9d9\",backgroundColor:\"#ffffff\"},L={position:\"fixed\",\"background-color\":\"rgba(0, 0, 0, 0.4)\",\"z-index\":\"1000\"},U=\"embedded-checkout-loading-indicator-rotation\";class x{constructor(e){this.styles=Object.assign(Object.assign({},z),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error(\"Unable to attach the loading indicator because the parent ID is not valid.\");t.appendChild(this.container)}this.container.style.visibility=\"visible\",this.container.style.opacity=\"1\"}hide(){const e=()=>{this.container.style.visibility=\"hidden\",this.container.removeEventListener(\"transitionend\",e)};this.container.addEventListener(\"transitionend\",e),this.container.style.opacity=\"0\"}buildContainer(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.bottom=\"0\",e.style.left=\"0\",e.style.height=\"100%\",e.style.width=\"100%\",e.style.position=\"absolute\",e.style.right=\"0\",e.style.top=\"0\",e.style.transition=\"all 250ms ease-out\",e.style.opacity=\"0\",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border=\"solid 1px\",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin=\"0 auto\",e.style.position=\"absolute\",e.style.left=\"0\",e.style.right=\"0\",e.style.top=\"50%\",e.style.transform=\"translateY(-50%) rotate(0deg)\",e.style.transformStyle=\"preserve-3d\",e.style.animation=`${U} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach(i=>{e.style.setProperty(i,t[i])})}defineAnimation(){var e;if(document.getElementById(U))return;const t=document.createElement(\"style\");t.id=U,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\\n                @keyframes ${U} {\\n                    0% { transform: translateY(-50%) rotate(0deg); }\\n                    100% { transform: translateY(-50%) rotate(360deg); }\\n                }\\n            `,0)}}const j=e=>\"object\"==typeof e&&null!==e&&\"body\"in e;class B{constructor(e){this._decimalPlaces=e}toInteger(e){return Math.round(e*Math.pow(10,this._decimalPlaces))}}const F=[\"AC\",\"AD\",\"AE\",\"AF\",\"AG\",\"AI\",\"AL\",\"AM\",\"AO\",\"AQ\",\"AR\",\"AT\",\"AU\",\"AW\",\"AX\",\"AZ\",\"BA\",\"BB\",\"BD\",\"BE\",\"BF\",\"BG\",\"BH\",\"BI\",\"BJ\",\"BL\",\"BM\",\"BN\",\"BO\",\"BQ\",\"BR\",\"BS\",\"BT\",\"BV\",\"BW\",\"BY\",\"BZ\",\"CA\",\"CD\",\"CF\",\"CG\",\"CH\",\"CI\",\"CK\",\"CL\",\"CM\",\"CN\",\"CO\",\"CR\",\"CV\",\"CW\",\"CY\",\"CZ\",\"DE\",\"DJ\",\"DK\",\"DM\",\"DO\",\"DZ\",\"EC\",\"EE\",\"EG\",\"EH\",\"ER\",\"ES\",\"ET\",\"FI\",\"FJ\",\"FK\",\"FO\",\"FR\",\"GA\",\"GB\",\"GD\",\"GE\",\"GF\",\"GG\",\"GH\",\"GI\",\"GL\",\"GM\",\"GN\",\"GP\",\"GQ\",\"GR\",\"GS\",\"GT\",\"GU\",\"GW\",\"GY\",\"HK\",\"HN\",\"HR\",\"HT\",\"HU\",\"ID\",\"IE\",\"IL\",\"IM\",\"IN\",\"IO\",\"IQ\",\"IS\",\"IT\",\"JE\",\"JM\",\"JO\",\"JP\",\"KE\",\"KG\",\"KH\",\"KI\",\"KM\",\"KN\",\"KR\",\"KW\",\"KY\",\"KZ\",\"LA\",\"LB\",\"LC\",\"LI\",\"LK\",\"LR\",\"LS\",\"LT\",\"LU\",\"LV\",\"LY\",\"MA\",\"MC\",\"MD\",\"ME\",\"MF\",\"MG\",\"MK\",\"ML\",\"MM\",\"MN\",\"MO\",\"MQ\",\"MR\",\"MS\",\"MT\",\"MU\",\"MV\",\"MW\",\"MX\",\"MY\",\"MZ\",\"NA\",\"NC\",\"NE\",\"NG\",\"NI\",\"NL\",\"NO\",\"NP\",\"NR\",\"NU\",\"NZ\",\"OM\",\"PA\",\"PE\",\"PF\",\"PG\",\"PH\",\"PK\",\"PL\",\"PM\",\"PN\",\"PR\",\"PS\",\"PT\",\"PY\",\"QA\",\"RE\",\"RO\",\"RS\",\"RU\",\"RW\",\"SA\",\"SB\",\"SC\",\"SD\",\"SE\",\"SG\",\"SH\",\"SI\",\"SJ\",\"SK\",\"SL\",\"SM\",\"SN\",\"SO\",\"SR\",\"SS\",\"ST\",\"SV\",\"SX\",\"SZ\",\"TA\",\"TC\",\"TD\",\"TF\",\"TG\",\"TH\",\"TJ\",\"TK\",\"TL\",\"TM\",\"TN\",\"TO\",\"TR\",\"TT\",\"TV\",\"TW\",\"TZ\",\"UA\",\"UG\",\"US\",\"UY\",\"UZ\",\"VA\",\"VC\",\"VE\",\"VG\",\"VN\",\"VU\",\"WF\",\"WS\",\"XK\",\"YE\",\"YT\",\"ZA\",\"ZM\",\"ZW\",\"ZZ\"];var V=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class G{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return V(this,void 0,void 0,function*(){const{stripeocs:t}=e||{};if(!t)throw new p('Unable to proceed because \"options\" argument is not provided.');const{methodId:i,gatewayId:n,container:r}=t;if(!r||!i||!n)throw new k(N.PaymentNotInitialized);const o=yield this.paymentIntegrationService.loadPaymentMethod(n,{params:{method:i}}),s=o.getPaymentMethodOrThrow(i,n),{loadingContainerId:a,buttonHeight:d,onComplete:l}=t;if(this._loadingIndicatorContainer=a,this._onComplete=l,!y(s))throw new m(c.MissingPaymentMethod);const{initializationData:u}=s,{captureMethod:h}=u;return this._captureMethod=h,this._stripeClient=yield this.scriptLoader.getStripeClient(u,o.getCartLocale()),yield this._mountExpressCheckoutElement(i,r,this._stripeClient,d),Promise.resolve()})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i,n=40){return V(this,void 0,void 0,function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:I.AUTO,applePay:I.NEVER,googlePay:I.NEVER,amazonPay:I.NEVER,paypal:I.NEVER,klarna:I.NEVER},buttonHeight:n}),{cartAmount:s}=this.paymentIntegrationService.getState().getCartOrThrow(),a=Object.assign({mode:\"payment\",amount:this._toCents(s),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=i.elements(a),this._linkV2Element=this._stripeElements.create(C.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)})}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(P.SHIPPING_ADDRESS_CHANGE,e=>V(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),e.on(P.SHIPPING_RATE_CHANGE,e=>V(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),e.on(P.CONFIRM,e=>V(this,void 0,void 0,function*(){return this._onConfirm(e,t)})),e.on(P.CANCEL,this._onCancel)}_onShippingAddressChange(e){return V(this,void 0,void 0,function*(){if(\"address\"in e){const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:n})}})}_onCancel(){throw new M}_onShippingRateChange(e){return V(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return V(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return V(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return V(this,void 0,void 0,function*(){if(!j(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new k(N.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return V(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:I.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new T;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return V(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:f.Link})}}}_shouldRequireShippingAddress(){const{getCartOrThrow:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e();return!!t.physicalItems.length}_updateDisplayedPrice(){return V(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){if(!this._currencyCode){const{code:e}=this.paymentIntegrationService.getState().getCartOrThrow().currency;this._currencyCode=e.toLowerCase()}return this._currencyCode}_getTotalPrice(){return V(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:e,getCartOrThrow:t}=this.paymentIntegrationService.getState(),{decimalPlaces:i}=t().currency,n=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(e().outstandingBalance,i).toFixed(i);return this._toCents(+n)})}_getAvailableCountries(){var e;return V(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>F.includes(e))})}_getAvailableShippingOptions(){var e,t;return V(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState().getConsignments();if(!(null==i?void 0:i[0]))return;const n=i[0],r=(n.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=n.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort(e=>e.id===o?-1:0):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return V(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new B(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const H=a(t=>{const i=new h((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new x({containerStyles:L});return new G(t,i,new R(t,i),n)},[{id:\"stripeocs\"}]);var q=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class W{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return q(this,void 0,void 0,function*(){const{stripeocs:t,containerId:i}=e||{};if(!t||!i)throw new k(N.PaymentNotInitialized);const{methodId:n,gatewayId:r}=t;if(!n||!r)throw new m(c.MissingPaymentMethod);const o=yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:n}}),s=o.getPaymentMethodOrThrow(n,r),{loadingContainerId:a,buttonHeight:d,onComplete:l}=t;if(this._loadingIndicatorContainer=a,this._onComplete=l,!y(s))throw new m(c.MissingPaymentMethod);const{initializationData:u}=s,{captureMethod:h}=u;return this._captureMethod=h,this._stripeClient=yield this.scriptLoader.getStripeClient(u,o.getCartLocale()),yield this.paymentIntegrationService.loadDefaultCheckout(),yield this._mountExpressCheckoutElement(n,i,this._stripeClient,d),Promise.resolve()})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i,n=40){return q(this,void 0,void 0,function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:I.AUTO,applePay:I.NEVER,googlePay:I.NEVER,amazonPay:I.NEVER,paypal:I.NEVER,klarna:I.NEVER},buttonHeight:n}),{cartAmount:s=1}=this.paymentIntegrationService.getState().getCart()||{},a=Object.assign({mode:\"payment\",amount:this._toCents(s),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=i.elements(a),this._linkV2Element=this._stripeElements.create(C.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)})}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(P.SHIPPING_ADDRESS_CHANGE,e=>q(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),e.on(P.SHIPPING_RATE_CHANGE,e=>q(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),e.on(P.CONFIRM,e=>q(this,void 0,void 0,function*(){return this._onConfirm(e,t)})),e.on(P.CANCEL,this._onCancel)}_onShippingAddressChange(e){return q(this,void 0,void 0,function*(){if(\"address\"in e){const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:n})}})}_onCancel(){throw new M}_onShippingRateChange(e){return q(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return q(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return q(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return q(this,void 0,void 0,function*(){if(!j(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new k(N.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return q(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:I.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new T;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return q(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/checkout/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:f.Link})}}}_shouldRequireShippingAddress(){const{getCart:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e()||{};return!!(null==t?void 0:t.physicalItems.length)}_updateDisplayedPrice(){return q(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){var e;if(!this._currencyCode){const t=null===(e=this.paymentIntegrationService.getState().getCart())||void 0===e?void 0:e.currency;t&&(this._currencyCode=t.code.toLowerCase())}return this._currencyCode}_getTotalPrice(){var e;return q(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:t,getCart:i}=this.paymentIntegrationService.getState(),{decimalPlaces:n}=(null===(e=i())||void 0===e?void 0:e.currency)||{},o=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(t().outstandingBalance,n).toFixed(n);return this._toCents(+o)})}_getAvailableCountries(){var e;return q(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>F.includes(e))})}_getAvailableShippingOptions(){var e,t;return q(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState().getConsignments();if(!(null==i?void 0:i[0]))return;const n=i[0],r=(n.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=n.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort(e=>e.id===o?-1:0):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return q(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new B(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const Y=a(t=>{const i=new h((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new x({containerStyles:L});return new W(t,i,new R(t,i),n)},[{id:\"stripeocs\"}]);class K extends p{constructor(e){let t=\"Unable to submit payment for the order because the payload is invalid.\";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(\", \")}.`),super(t),this.name=\"PaymentArgumentInvalidError\"}}function $(e){return!(\"object\"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&\"boolean\"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&\"boolean\"!=typeof e.shouldSetAsDefaultInstrument)}function J(e){return Boolean(e.instrumentId)}class Z extends d{constructor(){super(\"The current order does not need to be finalized at this stage.\"),this.name=\"OrderFinalizationNotRequiredError\",this.type=\"order_finalization_not_required\"}}function Q(e){return null!==e&&\"object\"==typeof e&&\"cardNumberElementOptions\"in e&&\"cardCvcElementOptions\"in e&&\"cardExpiryElementOptions\"in e&&void 0!==e.cardNumberElementOptions&&void 0!==e.cardCvcElementOptions&&void 0!==e.cardExpiryElementOptions}var X,ee,te,ie;!function(e){e.Solid=\"solid\",e.Default=\"default\"}(X||(X={})),function(e){e.Alipay=\"alipay\",e.CardCvc=\"cardCvc\",e.CardExpiry=\"cardExpiry\",e.CardNumber=\"cardNumber\",e.CreditCard=\"card\",e.IDEAL=\"idealBank\",e.Sepa=\"iban\"}(ee||(ee={})),function(e){e.Alipay=\"alipay\",e.CreditCard=\"card\",e.IDEAL=\"ideal\",e.Sepa=\"sepa_debit\"}(te||(te={})),function(e){e.AuthFailure=\"auth_failure\"}(ie||(ie={}));class ne extends d{constructor(e){super(e===ie.AuthFailure?\"User did not authenticate\":\"There was an error while processing your payment. Please try again or contact us.\"),this.type=\"stripev3_error\",this.subtype=e}}var re=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};const oe=[ee.Alipay,ee.IDEAL];class se{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){return re(this,void 0,void 0,function*(){const{stripev3:t,methodId:i,gatewayId:n}=e;if(!n)throw new p('Unable to initialize payment because \"gatewayId\" argument is not provided.');this.initializeOptions=t,this.isDeinitialize=!1;const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{initializationData:{stripePublishableKey:o,stripeConnectedAccount:s,useIndividualCardFields:a,allowRedisplayForStoredInstruments:d}}=r;this._allowRedisplayForStoredInstruments=d;const l=this.getInitializeOptions().form;this.useIndividualCardFields=a,this.stripeV3Client=yield this.loadStripeJs(o,s),this.isCreditCard(i)&&this.shouldShowTSVHostedForm(i,n)&&l?this.hostedForm=yield this.mountCardVerificationFields(l):this.stripeElement=yield this.mountCardFields(i)})}execute(e,i){var n,r;return re(this,void 0,void 0,function*(){const{payment:o}=e,s=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);let a,d;if(!o||!o.paymentData)throw new K([\"payment.paymentData\"]);const{paymentData:l,gatewayId:u,methodId:h}=o,{shouldSaveInstrument:p,shouldSetAsDefaultInstrument:y}=$(l)?l:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},g=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)(oe,h),{isStoreCreditApplied:v}=this.paymentIntegrationService.getState().getCheckoutOrThrow();v&&(yield this.paymentIntegrationService.applyStoreCredit(v));try{g&&(yield this.paymentIntegrationService.submitOrder(s,i)),u&&(yield this.paymentIntegrationService.loadPaymentMethod(u,{params:{method:h}}));const e=this.paymentIntegrationService.getState();if(J(l)){yield this.paymentIntegrationService.submitOrder(s,i);const{instrumentId:t}=l,n=e.getPaymentMethodOrThrow(o.methodId).clientToken;if(!n)throw new m(c.MissingPaymentMethod);return yield this.executeWithVaulted(o,t,y,n)}const t=e.getPaymentMethodOrThrow(h),v=yield this.confirmStripePayment(t),{clientToken:S,method:_}=t,{id:f}=null!==(r=null!==(n=v.paymentIntent)&&void 0!==n?n:v.paymentMethod)&&void 0!==r?r:{id:\"\"};d=v.error,a={credit_card_token:{token:f},vault_payment_instrument:p,confirm:!1,set_as_default_stored_instrument:y},_===ee.CreditCard&&(a.client_token=S),g||(yield this.paymentIntegrationService.submitOrder(s,i));const I=this.buildPaymentPayload(h,a,y);yield this.paymentIntegrationService.submitPayment(I)}catch(e){yield this.processAdditionalAction(this.handleEmptyPaymentIntentError(e,d),h,p,y)}})}finalize(){return Promise.reject(new Z)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.isDeinitialize=!0,this.unmountElement(),Promise.resolve()}buildPaymentPayload(e,t,i){return{methodId:e,paymentData:i?{formattedPayload:Object.assign(Object.assign({},t),{set_as_default_stored_instrument:i})}:{formattedPayload:t}}}isCancellationError(e){var t,i;return e&&-1!==(null===(i=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===i?void 0:i.indexOf(\"canceled\"))}isAuthError(e){return\"payment_intent_authentication_failure\"===(null==e?void 0:e.code)}isCreditCard(e){return e===te.CreditCard}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty);return!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(r)}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:i}=this.paymentIntegrationService.getState(),n=i(e,t);return Boolean(n.config.isHostedFormEnabled)}confirmStripePayment(e){return re(this,void 0,void 0,function*(){const{clientToken:t,method:i,returnUrl:n}=e;if(!t)throw new m(c.MissingPaymentMethod);switch(i){case ee.Alipay:return this.getStripeJs().confirmAlipayPayment(t,{return_url:n},{handleActions:!1});case ee.IDEAL:{const e=this.mapStripePaymentData(te.IDEAL,n);return this.getStripeJs().confirmIdealPayment(t,e,{handleActions:!1})}case ee.Sepa:{const e=this.mapStripePaymentData(te.Sepa);return this.getStripeJs().confirmSepaDebitPayment(t,e)}default:{const e=this.useIndividualCardFields?this.getStripeCardElements()[0]:this.getStripeElement(),t=this.mapStripeBillingDetails(this.paymentIntegrationService.getState().getBillingAddress(),this.paymentIntegrationService.getState().getCustomer()),i=this._allowRedisplayForStoredInstruments;return this.getStripeJs().createPaymentMethod(Object.assign({type:te.CreditCard,card:e,billing_details:t},i?{allow_redisplay:\"always\"}:{}))}}})}executeWithVaulted(e,t,i,n){var r;return re(this,void 0,void 0,function*(){const o={bigpay_token:{token:t},confirm:!0,client_token:n,set_as_default_stored_instrument:i};if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)&&this.hostedForm){const t=this.hostedForm;return e.paymentData&&J(e.paymentData)&&(e.paymentData=Object.assign(Object.assign({},e.paymentData),{instrumentId:JSON.stringify({token:(null===(r=e.paymentData)||void 0===r?void 0:r.instrumentId)||\"\",client_token:n})})),yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}const s=this.buildPaymentPayload(e.methodId,o,i);return this.paymentIntegrationService.submitPayment(s)})}getInitializeOptions(){if(!this.initializeOptions)throw new k(N.PaymentNotInitialized);return this.initializeOptions}getStripeCardElements(){if(!this.stripeCardElements)throw new k(N.PaymentNotInitialized);return this.stripeCardElements}getStripeElement(){if(!this.stripeElement)throw new k(N.PaymentNotInitialized);return this.stripeElement}getStripeJs(){if(!this.stripeV3Client)throw new k(N.PaymentNotInitialized);return this.stripeV3Client}handleEmptyPaymentIntentError(e,t){return j(e)&&(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"required_field\"})&&t?new Error(t.message):e}loadStripeJs(e,t){return re(this,void 0,void 0,function*(){return this.stripeV3Client?Promise.resolve(this.stripeV3Client):this.scriptLoader.load(e,t,this.paymentIntegrationService.getState().getLocale())})}mapStripeAddress(e){if(e){const{city:t,countryCode:i,address1:n,address2:r,postalCode:o,stateOrProvinceCode:s}=e;return{city:t,country:i,line1:n,line2:r,postal_code:o,state:s}}return{line1:\"\"}}mapStripeBillingDetails(e,t){const{firstName:i,lastName:n}=e||t||{firstName:\"Guest\",lastName:\"\"},r=`${i} ${n}`.trim(),{options:o}=this.getInitializeOptions();if(this.useIndividualCardFields&&Q(o)){const{zipCodeElementOptions:t}=o;if(t){const i=document.getElementById(t.containerId)?document.getElementById(t.containerId).value:\"\";i&&e&&(e=Object.assign(Object.assign({},e),{postalCode:i}))}}const s={address:this.mapStripeAddress(e)};if(t&&t.addresses[0]&&function(e){return\"object\"==typeof e&&null!==e&&\"id\"in e&&void 0!==e.id}(t.addresses[0])){const e=t.addresses[0],{email:i}=t,{phone:n}=e;return n?Object.assign(Object.assign({},s),{email:i,name:r,phone:n}):Object.assign(Object.assign({},s),{email:i,name:r})}if(e){const{email:t,phone:i}=e;return i?Object.assign(Object.assign({},s),{email:t,name:r,phone:i}):Object.assign(Object.assign({},s),{email:t,name:r})}return Object.assign(Object.assign({},s),{name:r})}mapStripePaymentData(e,t){const i=this.paymentIntegrationService.getState().getCustomer(),n=this.paymentIntegrationService.getState().getBillingAddress(),r={payment_method:{[e]:this.getStripeElement(),billing_details:this.mapStripeBillingDetails(n,i)}};return e===te.IDEAL?Object.assign(Object.assign({},r),{return_url:t}):r}mountCardFields(e){const{options:t,containerId:i}=this.getInitializeOptions();let n;return new Promise((r,o)=>{switch(this.stripeElements||(this.stripeElements=this.getStripeJs().elements()),e){case ee.CreditCard:if(this.useIndividualCardFields&&Q(t)){const{cardNumberElementOptions:e,cardExpiryElementOptions:i,cardCvcElementOptions:r}=t,s=this.stripeElements.getElement(ee.CardNumber)||this.stripeElements.create(ee.CardNumber,e),a=this.stripeElements.getElement(ee.CardExpiry)||this.stripeElements.create(ee.CardExpiry,i),d=this.stripeElements.getElement(ee.CardCvc)||this.stripeElements.create(ee.CardCvc,r);this.stripeCardElements=[s,a,d],n=this.stripeCardElements[0];try{s.mount(`#${e.containerId}`),a.mount(`#${i.containerId}`),d.mount(`#${r.containerId}`)}catch(e){this.isDeinitialize||o(new p(\"Unable to mount Stripe component without valid container ID.\"))}}else{n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new p(\"Unable to mount Stripe component without valid container ID.\"))}}break;case ee.IDEAL:case ee.Sepa:n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new p(\"Unable to mount Stripe component without valid container ID.\"))}case ee.Alipay:}r(n)})}mountCardVerificationFields(e){return re(this,void 0,void 0,function*(){const t=this.paymentIntegrationService.getState().getStoreConfig();if(!t)throw new m(c.MissingCheckoutConfig);const i=t.paymentSettings.bigpayBaseUrl,n=this.paymentIntegrationService.createHostedForm(i,e);return yield n.attach(),n})}processAdditionalAction(e,t,i=!1,n=!1){return re(this,void 0,void 0,function*(){if(!j(e))throw e;const r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"additional_action_required\"}),s=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"});if(r){const t=e.body.additional_action_required;if(t&&\"redirect_to_url\"===t.type)return new Promise(()=>{t.data.redirect_url&&window.location.replace(t.data.redirect_url)})}if(s){const r=e.body.three_ds_result.token,o=!1;let s,a=!1;try{s=yield this.getStripeJs().confirmCardPayment(r)}catch(e){a=!0}if(null==s?void 0:s.error){if(this.isCancellationError(s.error))throw new M;if(this.isAuthError(s.error))throw new ne(ie.AuthFailure);throw new Error(s.error.message)}const d={credit_card_token:{token:this.getPaymentToken(null==s?void 0:s.paymentIntent,r,a)},vault_payment_instrument:i,confirm:o},l=this.buildPaymentPayload(t,d,n);try{return yield this.paymentIntegrationService.submitPayment(l)}catch(e){throw this.handleEmptyPaymentIntentError(e,null==s?void 0:s.error)}}throw e})}getPaymentToken(e,t,i){return!e||i?t:e.id}shouldShowTSVHostedForm(e,t){return this.isHostedFieldAvailable()&&this.isHostedPaymentFormEnabled(e,t)}unmountElement(){this.stripeElement&&(this.stripeElement.unmount(),this.stripeElement=void 0)}}class ae{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}load(e,t,i){return this.scriptLoader.loadScript(\"https://js.stripe.com/v3/\").then(()=>{if(!this.stripeWindow.Stripe)throw new l;return this.stripeWindow.Stripe(e,{stripeAccount:t,locale:i,betas:[\"payment_intent_beta_3\",\"alipay_pm_beta_1\"],apiVersion:\"2020-03-02;alipay_beta=v1\"})})}}const de=a(t=>new se(t,new ae((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{gateway:\"stripev3\"}]),le={body:{},headers:{},status:0};class ce extends d{constructor(e,{message:t,errors:i}={}){const{body:n,headers:r,status:o}=e||le;super(t||\"An unexpected error has occurred.\"),this.name=\"RequestError\",this.type=\"request\",this.body=n,this.headers=r,this.status=o,this.errors=i||[]}}const ue={ar:[\"ar\"],bg:[\"bg\"],cs:[\"cs\"],da:[\"da\"],de:[\"de\"],el:[\"el\"],en:[\"en\",\"en-GB\"],es:[\"es\",\"es-419\"],et:[\"et\"],fi:[\"fi\"],fil:[\"fil\"],fr:[\"fr\",\"fr-CA\"],he:[\"he\"],hr:[\"hr\"],hu:[\"hu\"],id:[\"id\"],it:[\"it\"],ja:[\"ja\"],ko:[\"ko\"],lt:[\"lt\"],lv:[\"lv\"],ms:[\"ms\"],mt:[\"mt\"],nb:[\"nb\"],nl:[\"nl\"],pl:[\"pl\"],pt:[\"pt\",\"pt-BR\"],ro:[\"ro\"],ru:[\"ru\"],sk:[\"sk\"],sl:[\"sl\"],sv:[\"sv\"],th:[\"th\"],tr:[\"tr\"],vi:[\"vi\"],zh:[\"zh\",\"zh-HK\",\"zh-TW\"]};function he(e){const[t,i]=e.replace(/_/g,\"-\").toLowerCase().split(\"-\"),n=ue[t];if(!n)return\"auto\";const r=i?`${t}-${i.toUpperCase()}`:t;return n.indexOf(r)>-1?r:n[0]}var pe=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class me{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){return pe(this,void 0,void 0,function*(){const{stripeupe:t,methodId:i,gatewayId:n}=e;if(!(null==t?void 0:t.containerId))throw new k(N.PaymentNotInitialized);if(!n)throw new p('Unable to initialize payment because \"gatewayId\" argument is not provided.');return this._loadStripeElement(t,n,i).catch(e=>{var i;return null===(i=t.onError)||void 0===i?void 0:i.call(t,e)}),this.stripeIntegrationService.initCheckoutEventsSubscription(n,i,t,this._stripeElements),Promise.resolve()})}execute(e,t){return pe(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);if(!i||!i.paymentData)throw new K([\"payment.paymentData\"]);if(!this._stripeUPEClient)throw new k(N.PaymentNotInitialized);const{paymentData:r,methodId:o,gatewayId:s}=i,{shouldSaveInstrument:a=!1,shouldSetAsDefaultInstrument:d=!1}=$(r)?r:{},l=this.paymentIntegrationService.getState(),{isStoreCreditApplied:c}=l.getCheckoutOrThrow(),u=l.getPaymentProviderCustomerOrThrow(),h=(w(u)?u:{}).stripeLinkAuthenticationState;if(c&&(yield this.paymentIntegrationService.applyStoreCredit(c)),s){yield this.stripeIntegrationService.updateStripePaymentIntent(s,o);const{email:e}=l.getCustomerOrThrow();if(void 0!==h&&!e){const e=l.getBillingAddressOrThrow();yield this.paymentIntegrationService.updateBillingAddress(e)}}if(yield this.paymentIntegrationService.submitOrder(n,t),J(r)){const{instrumentId:e}=r;return void(yield this._executeWithVaulted(i.methodId,e,d))}yield this._executeWithStripeConfirmation(i.methodId,!h&&a,d)})}finalize(){return Promise.reject(new Z)}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(C.PAYMENT))||void 0===t||t.unmount(),this.stripeIntegrationService.deinitialize(),this._stripeElements=void 0,this._stripeUPEClient=void 0,Promise.resolve()}_executeWithStripeConfirmation(e,t,i){return pe(this,void 0,void 0,function*(){const n=this.paymentIntegrationService.getState(),{clientToken:r}=n.getPaymentMethodOrThrow(e),o=this._getPaymentPayload(e,r||\"\",t,i);try{yield this.paymentIntegrationService.submitPayment(o)}catch(n){yield this._processAdditionalActionWithStripeConfirmation(n,e,t,i)}})}_executeWithVaulted(e,t,i){var n;return pe(this,void 0,void 0,function*(){const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(e),s=null===(n=r.getCart())||void 0===n?void 0:n.id;try{const n={methodId:e,paymentData:{formattedPayload:{cart_id:s,bigpay_token:{token:t},confirm:!1,client_token:o.clientToken,set_as_default_stored_instrument:i}}};return yield this.paymentIntegrationService.submitPayment(n)}catch(t){return this._processVaultedAdditionalAction(t,e,i)}})}_loadStripeElement(e,t,i){return pe(this,void 0,void 0,function*(){const{containerId:n,style:r,render:o,initStripeElementUpdateTrigger:s}=e,a=yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}}),d=a.getPaymentMethodOrThrow(i),{checkoutSettings:l}=a.getStoreConfigOrThrow();if(!y(d))throw new m(c.MissingPaymentMethod);const{clientToken:u,initializationData:h}=d,{shopperLanguage:p,allowRedisplayForStoredInstruments:g=!1,enableLink:v}=h;if(this._allowRedisplayForStoredInstruments=g,!u)throw new m(c.MissingPaymentMethod);let S;if(this._stripeUPEClient=yield this._loadStripeJs(h),this._isStripeElementUpdateEnabled=!!l.features[\"PI-1679.trigger_update_stripe_payment_element\"]&&\"function\"==typeof s,r){const e=r;S={variables:this.stripeIntegrationService.mapAppearanceVariables(r),rules:{\".Input\":this.stripeIntegrationService.mapInputAppearanceRules(e)}}}this._stripeElements=yield this.scriptLoader.getElements(this._stripeUPEClient,{clientSecret:u,locale:he(p),appearance:S});const{getBillingAddress:_,getShippingAddress:f}=a,{postalCode:E}=f()||_()||{},b=this._stripeElements.getElement(C.PAYMENT)||this._stripeElements.create(C.PAYMENT,Object.assign({fields:{billingDetails:{email:I.NEVER,address:{country:I.NEVER,city:I.NEVER,postalCode:E?I.NEVER:I.AUTO}}},wallets:{applePay:I.NEVER,googlePay:I.NEVER,link:v?I.AUTO:I.NEVER}},this._getStripeElementTerms()));this.stripeIntegrationService.mountElement(b,n),b.on(P.READY,()=>{o()}),b.on(P.CHANGE,e=>{(null==e?void 0:e.value)&&\"type\"in e.value&&this._updateStripeLinkStateByElementType(e.value.type)}),this._isStripeElementUpdateEnabled&&(null==s||s(this._updateStripeElement.bind(this)))})}_processAdditionalActionWithStripeConfirmation(e,t,i=!1,n=!1){return pe(this,void 0,void 0,function*(){if(!j(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new k(N.PaymentNotInitialized);const{data:r}=e.body.additional_action_required,{token:o}=r,{paymentIntent:s}=yield this._confirmStripePaymentOrThrow(t,r),a=this._getPaymentPayload(t,(null==s?void 0:s.id)||o,i,n);try{yield this.paymentIntegrationService.submitPayment(a)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return pe(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,o,!!this._allowRedisplayForStoredInstruments);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this._stripeUPEClient))?yield null===(n=this._stripeUPEClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this._stripeUPEClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new T;return t}catch(e){this.stripeIntegrationService.throwStripeError(a)}})}_processVaultedAdditionalAction(e,t,i=!1){var n;return pe(this,void 0,void 0,function*(){if(!t||!j(e)||!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"}))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new k(N.PaymentNotInitialized);const r=e.body.three_ds_result.token;let s,a=!1;try{s=yield this._stripeUPEClient.confirmCardPayment(r)}catch(e){try{s=yield this._stripeUPEClient.retrievePaymentIntent(r)}catch(e){a=!0}}if((null==s?void 0:s.error)&&this.stripeIntegrationService.throwStripeError(s.error),!(null==s?void 0:s.paymentIntent)&&!a)throw new ce;const d=this._getPaymentPayload(t,a?r:null===(n=null==s?void 0:s.paymentIntent)||void 0===n?void 0:n.id,!1,i);return this.paymentIntegrationService.submitPayment(d)})}_loadStripeJs(e){return pe(this,void 0,void 0,function*(){if(this._stripeUPEClient)return this._stripeUPEClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale(),g,v)})}_getPaymentPayload(e,t,i=!1,n=!1){var r;return{methodId:e,paymentData:{formattedPayload:{cart_id:(null===(r=this.paymentIntegrationService.getState().getCart())||void 0===r?void 0:r.id)||\"\",credit_card_token:{token:t},confirm:!1,vault_payment_instrument:i,set_as_default_stored_instrument:n}}}}_updateStripeElement({shouldShowTerms:e}){var t;const i=null===(t=this._stripeElements)||void 0===t?void 0:t.getElement(C.PAYMENT);null==i||i.update(Object.assign({},this._getStripeElementTerms(e)))}_getStripeElementTerms(e){let t=I.AUTO;return this._isStripeElementUpdateEnabled&&(t=e?I.AUTO:I.NEVER),{terms:{card:t}}}_updateStripeLinkStateByElementType(e){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),i=e===f.Link;!w(t)&&i&&this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:i})}}const ye=a(t=>{const i=new h((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new me(t,i,new R(t,i))},[{gateway:\"stripeupe\"},{gateway:\"stripeupe\",id:\"klarna\"}]);var ge=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class ve{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){var t;return ge(this,void 0,void 0,function*(){const{stripeocs:i,methodId:n,gatewayId:r}=e;if(!(null==i?void 0:i.containerId))throw new k(N.PaymentNotInitialized);if(!r)throw new p('Unable to initialize payment because \"gatewayId\" argument is not provided.');try{yield this._initializeStripeElement(i,r,n)}catch(e){e instanceof Error&&(null===(t=i.onError)||void 0===t||t.call(i,e))}this.stripeIntegrationService.initCheckoutEventsSubscription(r,n,i,this.stripeElements)})}execute(e,t){return ge(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]),{methodId:r,gatewayId:o}=i||{};if(!this.stripeClient)throw new k(N.PaymentNotInitialized);if(!o||!r)throw new p('Unable to initialize payment because \"gatewayId\" or \"methodId\" argument is not provided.');const s=this.paymentIntegrationService.getState(),{isStoreCreditApplied:a}=s.getCheckoutOrThrow();a&&(yield this.paymentIntegrationService.applyStoreCredit(a)),yield this.stripeIntegrationService.updateStripePaymentIntent(o,r),yield this.paymentIntegrationService.submitOrder(n,t);const{clientToken:d}=s.getPaymentMethodOrThrow(r),l=this._getPaymentPayload(r,d||\"\");try{yield this.paymentIntegrationService.submitPayment(l)}catch(e){yield this._processAdditionalAction(e,r)}})}finalize(){return Promise.reject(new Z)}deinitialize(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(C.PAYMENT);return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeElements=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,i){return ge(this,void 0,void 0,function*(){let n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);if((null==n?void 0:n.clientToken)||(n=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}})).getPaymentMethodOrThrow(i)),!y(n))throw new m(c.MissingPaymentMethod);const{clientToken:r,initializationData:o}=n,{shopperLanguage:s,customerSessionToken:a,enableLink:d}=o;if(!r)throw new m(c.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(o);const{appearance:l,containerId:u,fonts:h,layout:p,render:g,paymentMethodSelect:v,handleClosePaymentMethod:S,togglePreloader:_}=e;this.stripeElements=yield this.scriptLoader.getElements(this.stripeClient,{clientSecret:r,customerSessionClientSecret:a,locale:he(s),appearance:l,fonts:h});const{getBillingAddress:f,getShippingAddress:E}=this.paymentIntegrationService.getState(),b=f(),{postalCode:w}=E()||b||{},A=this.stripeElements.getElement(C.PAYMENT)||this.stripeElements.create(C.PAYMENT,{fields:{billingDetails:{email:I.NEVER,address:{country:I.NEVER,city:I.NEVER,postalCode:w?I.NEVER:I.AUTO}}},wallets:{applePay:I.NEVER,googlePay:I.NEVER,link:d?I.AUTO:I.NEVER},layout:p,savePaymentMethod:{maxVisiblePaymentMethods:20},defaultValues:{billingDetails:{email:(null==b?void 0:b.email)||\"\"}}});this.stripeIntegrationService.mountElement(A,u),A.on(P.LOADER_START,()=>{null==_||_(!1)}),A.on(P.READY,()=>{g()}),A.on(P.CHANGE,e=>{this._onStripeElementChange(e,t,i,v)}),null==S||S(this._collapseStripeElement.bind(this))})}_loadStripeJs(e){return ge(this,void 0,void 0,function*(){if(this.stripeClient)return this.stripeClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale())})}_collapseStripeElement(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(C.PAYMENT);null==t||t.collapse()}_getPaymentPayload(e,t,i){var n;const r=(null===(n=this.paymentIntegrationService.getState().getCart())||void 0===n?void 0:n.id)||\"\",{card:o,us_bank_account:s}=i||{},a=this._shouldSaveInstrument(o)||this._shouldSaveInstrument(s),d=this._getTokenizedOptions(t,i);return{methodId:e,paymentData:{formattedPayload:Object.assign({cart_id:r,confirm:!1,method:this.selectedMethodId,vault_payment_instrument:a},d)}}}_processAdditionalAction(e,t){return ge(this,void 0,void 0,function*(){if(!j(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this.stripeClient||!this.stripeElements)throw new k(N.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(t,i),{client_secret:o,payment_method_options:s}=r||{},a=this._getPaymentPayload(t,o||n,s);try{return yield this.paymentIntegrationService.submitPayment(a)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return ge(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this.stripeElements,o);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this.stripeClient))?yield null===(n=this.stripeClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this.stripeClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new T;return t}catch(e){return this.stripeIntegrationService.throwStripeError(a)}})}_onStripeElementChange(e,t,i,n){(e=>\"object\"==typeof e&&null!==e&&\"value\"in e&&\"collapsed\"in e)(e)&&!e.collapsed&&(this.selectedMethodId=e.value.type,null==n||n(`${t}-${i}`))}_shouldSaveInstrument(e){const t=null==e?void 0:e.setup_future_usage;return t===b.ON_SESSION||t===b.OFF_SESSION}_getTokenizedOptions(e,t){return this._shouldSaveInstrument(null==t?void 0:t.us_bank_account)?{tokenized_ach:{token:e}}:{credit_card_token:{token:e}}}}const Se=a(t=>{const i=new h((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new ve(t,i,new R(t,i))},[{gateway:\"stripeocs\",id:\"optimized_checkout\"}]);\n//# sourceMappingURL=stripe.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vY2hlY2tvdXQtc2RrLWpzL2Rpc3QvZXNtL2ludGVncmF0aW9ucy9zdHJpcGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQTZJLFNBQVMsZ0JBQWdCLHdCQUF3QixhQUFhLEVBQUUsWUFBWSwrREFBK0QsdUJBQXVCLEVBQUUsc0RBQXNELHNCQUFzQixlQUFlLE1BQU0sdVRBQXVULGtCQUFrQixlQUFlLCtNQUErTSwwQkFBMEIseUNBQXlDLGNBQWMsSUFBSSxhQUFhLFNBQVMsTUFBTSxjQUFjLElBQUksY0FBYyxTQUFTLE1BQU0sY0FBYyxNQUFNLGdFQUFnRSxLQUFLLGFBQWEsK0JBQStCLEdBQUcsUUFBUSx3QkFBd0Isd0NBQXdDLHlCQUF5Qix3Q0FBd0MsNEVBQTRFLDJCQUEyQixnREFBZ0QsbUVBQW1FLElBQUksZ0JBQWdCLEdBQUcsS0FBSyxTQUFTLEdBQUcsS0FBSyxRQUFRLEdBQUcsS0FBSyxhQUFhLEdBQUcsR0FBRyx3Q0FBd0MsaUJBQWlCLElBQUksRUFBRSxpQkFBaUIsd0NBQXdDLHlDQUF5Qyw4RkFBOEYsbUJBQW1CLEtBQUssRUFBRSx3QkFBd0Isd0NBQXdDLDJDQUEyQyx3Q0FBd0MsRUFBRSxPQUFPLHdDQUF3QyxzSUFBc0ksZ0NBQWdDLEdBQUcsa0JBQWtCLGVBQWUsaUhBQWlILGFBQWEsc3lCQUFzeUIsU0FBUyxHQUFHLGtCQUFrQixlQUFlLGtCQUFrQixVQUFVLG9HQUFvRywrRUFBK0UsK0ZBQStGLHVGQUF1Rix1RkFBdUYsNEhBQTRILGlGQUFpRixzR0FBc0cscUZBQXFGLGdIQUFnSCw2SEFBNkgsc0dBQXNHLDZFQUE2RSwyRUFBMkUsY0FBYyxtY0FBbWMsaUtBQWlLLGVBQWUsY0FBYyxvQkFBb0IsY0FBYywwQ0FBMEMsYUFBYSwwQ0FBMEMsU0FBUyxlQUFlLDREQUE0RCxTQUFTLGVBQWUsMktBQTJLLFNBQVMsZUFBZSxnR0FBZ0csU0FBUyxlQUFlLG9IQUFvSCxTQUFTLGVBQWUsZ05BQWdOLFNBQVMsZUFBZSxtTkFBbU4sU0FB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QUF5RSxNQUFNLG1DQUFtQyxJQUFJLHNEQUFzRCxHQUFHLDBDQUEwQyw4Q0FBOEMsTUFBTSx3SEFBd0gsR0FBRywyRUFBMkUsK0VBQStFLEVBQUUsTUFBTSx5Q0FBeUMsa0RBQWtELGFBQWEsV0FBVyxvRkFBb0YsUUFBUSxnQkFBZ0IsdUJBQXVCLDJEQUEyRCxVQUFVLHlEQUF5RCw2QkFBNkIsNEJBQTRCLGdCQUFnQixnQkFBZ0IscUNBQXFDLEVBQUUseUVBQXlFLGVBQWUsb0JBQW9CLElBQUksb0JBQW9CLHFDQUFxQyxxREFBcUQsRUFBRSxpQkFBaUIseUNBQXlDLDhDQUE4QyxrREFBa0QsOERBQThELEVBQUUseUJBQXlCLE1BQU0sa0ZBQWtGLHNCQUFzQiwwQkFBMEIsTUFBTSxzR0FBc0cseUJBQXlCLE1BQU0saUdBQWlHLE9BQU8sd0JBQXdCLGdDQUFnQyw2RUFBNkUsTUFBTSw4QkFBOEIseUNBQXlDLHdGQUF3RixpRkFBaUYsTUFBTSxPQUFPLG9DQUFvQyxRQUFRLElBQUksZ0JBQWdCLCtDQUErQyx5Q0FBeUMsTUFBTSxxQ0FBcUMsSUFBSSw2REFBNkQsU0FBUyx3RUFBd0UsRUFBRSxrQ0FBa0MsUUFBUSx5Q0FBeUMsTUFBTSx1QkFBdUIsK0VBQStFLE1BQU0sSUFBSSxxUEFBcVAsNkVBQTZFLFNBQVMsU0FBUywwREFBMEQsRUFBRSxnQ0FBZ0Msb0lBQW9JLEVBQUUsR0FBRyxFQUFFLElBQUkseUJBQXlCLDRDQUE0QywyQ0FBMkMsMEJBQTBCLHFFQUFxRSxlQUFlLFNBQVMsRUFBRSxtQkFBbUIsV0FBVyxlQUFlLGNBQWMsMkVBQUMsSUFBSSw4QkFBOEIsR0FBRyw0Q0FBNEMsR0FBc087QUFDMTZrRSIsInNvdXJjZXMiOlsid2VicGFjazovL2NoZWNrb3V0Ly4uL2NoZWNrb3V0LXNkay1qcy9kaXN0L2VzbS9pbnRlZ3JhdGlvbnMvc3RyaXBlLmpzP2ExNzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0e2dldFNjcmlwdExvYWRlciBhcyBlfWZyb21cIkBiaWdjb21tZXJjZS9zY3JpcHQtbG9hZGVyXCI7aW1wb3J0e2luY2x1ZGVzIGFzIHQsaXNFbXB0eSBhcyBpLG9taXRCeSBhcyBuLHJvdW5kIGFzIHIsc29tZSBhcyBvfWZyb21cImxvZGFzaFwiO3ZhciBzPXt9O2Z1bmN0aW9uIGEoZSx0KXtyZXR1cm4gT2JqZWN0LmFzc2lnbihlLHtyZXNvbHZlSWRzOnR9KX1zLmQ9KGUsdCk9Pntmb3IodmFyIGkgaW4gdClzLm8odCxpKSYmIXMubyhlLGkpJiZPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxpLHtlbnVtZXJhYmxlOiEwLGdldDp0W2ldfSl9LHMubz0oZSx0KT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCk7Y2xhc3MgZCBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGUpe3ZhciB0O3N1cGVyKGV8fFwiQW4gdW5leHBlY3RlZCBlcnJvciBoYXMgb2NjdXJyZWQuXCIpLHRoaXMubmFtZT1cIlN0YW5kYXJkRXJyb3JcIix0aGlzLnR5cGU9XCJzdGFuZGFyZFwiLHQ9bmV3LnRhcmdldC5wcm90b3R5cGUsT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQpOnRoaXMuX19wcm90b19fPXQsXCJmdW5jdGlvblwiPT10eXBlb2YgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2U/RXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcyxuZXcudGFyZ2V0KTp0aGlzLnN0YWNrPW5ldyBFcnJvcih0aGlzLm1lc3NhZ2UpLnN0YWNrfX1jbGFzcyBsIGV4dGVuZHMgZHtjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGNsaWVudCBsaWJyYXJ5IG9mIGEgcGF5bWVudCBtZXRob2QgaXMgbm90IGxvYWRlZCBvciByZWFkeSB0byBiZSB1c2VkLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kQ2xpZW50VW5hdmFpbGFibGVFcnJvclwiLHRoaXMudHlwZT1cInBheW1lbnRfbWV0aG9kX2NsaWVudF91bmF2YWlsYWJsZVwifX12YXIgYyx1PWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIGh7Y29uc3RydWN0b3IoZSx0PXdpbmRvdyl7dGhpcy5zY3JpcHRMb2FkZXI9ZSx0aGlzLnN0cmlwZVdpbmRvdz10fWdldFN0cmlwZUNsaWVudChlLHQsaSxuKXtyZXR1cm4gdSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYodGhpcy5zdHJpcGVXaW5kb3cuYmNTdHJpcGVDbGllbnQpcmV0dXJuIHRoaXMuc3RyaXBlV2luZG93LmJjU3RyaXBlQ2xpZW50O2NvbnN0IHI9eWllbGQgdGhpcy5sb2FkKCkse3N0cmlwZVB1Ymxpc2hhYmxlS2V5Om8sc3RyaXBlQ29ubmVjdGVkQWNjb3VudDpzfT1lLGE9cihvLE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scz97c3RyaXBlQWNjb3VudDpzfTp7fSksdD97bG9jYWxlOnR9Ont9KSxpP3tiZXRhczppfTp7fSksbj97YXBpVmVyc2lvbjpufTp7fSkpO3JldHVybiBPYmplY3QuYXNzaWduKHRoaXMuc3RyaXBlV2luZG93LHtiY1N0cmlwZUNsaWVudDphfSksYX0pfWdldEVsZW1lbnRzKGUsdCl7cmV0dXJuIHUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2xldCBpPXRoaXMuc3RyaXBlV2luZG93LmJjU3RyaXBlRWxlbWVudHM7cmV0dXJuIGk/eWllbGQgdGhpcy51cGRhdGVTdHJpcGVFbGVtZW50cyh0KTooaT1lLmVsZW1lbnRzKHQpLE9iamVjdC5hc3NpZ24odGhpcy5zdHJpcGVXaW5kb3cse2JjU3RyaXBlRWxlbWVudHM6aX0pKSxpfSl9dXBkYXRlU3RyaXBlRWxlbWVudHMoZSl7cmV0dXJuIHUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHQ9dGhpcy5zdHJpcGVXaW5kb3cuYmNTdHJpcGVFbGVtZW50czt0JiYodC51cGRhdGUoZSkseWllbGQgdC5mZXRjaFVwZGF0ZXMoKSl9KX1sb2FkKCl7cmV0dXJuIHUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCF0aGlzLnN0cmlwZVdpbmRvdy5TdHJpcGUmJih5aWVsZCB0aGlzLnNjcmlwdExvYWRlci5sb2FkU2NyaXB0KFwiaHR0cHM6Ly9qcy5zdHJpcGUuY29tL3YzL1wiKSwhdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlKSl0aHJvdyBuZXcgbDtyZXR1cm4gdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlfSl9fWNsYXNzIHAgZXh0ZW5kcyBke2NvbnN0cnVjdG9yKGUpe3N1cGVyKGV8fFwiSW52YWxpZCBhcmd1bWVudHMgaGF2ZSBiZWVuIHByb3ZpZGVkLlwiKSx0aGlzLm5hbWU9XCJJbnZhbGlkQXJndW1lbnRFcnJvclwiLHRoaXMudHlwZT1cImludmFsaWRfYXJndW1lbnRcIn19IWZ1bmN0aW9uKGUpe2VbZS5NaXNzaW5nQmlsbGluZ0FkZHJlc3M9MF09XCJNaXNzaW5nQmlsbGluZ0FkZHJlc3NcIixlW2UuTWlzc2luZ0NhcnQ9MV09XCJNaXNzaW5nQ2FydFwiLGVbZS5NaXNzaW5nQ2hlY2tvdXQ9Ml09XCJNaXNzaW5nQ2hlY2tvdXRcIixlW2UuTWlzc2luZ0NvbnNpZ25tZW50cz0zXT1cIk1pc3NpbmdDb25zaWdubWVudHNcIixlW2UuTWlzc2luZ0N1c3RvbWVyPTRdPVwiTWlzc2luZ0N1c3RvbWVyXCIsZVtlLk1pc3NpbmdDaGVja291dENvbmZpZz01XT1cIk1pc3NpbmdDaGVja291dENvbmZpZ1wiLGVbZS5NaXNzaW5nT3JkZXI9Nl09XCJNaXNzaW5nT3JkZXJcIixlW2UuTWlzc2luZ09yZGVyQ29uZmlnPTddPVwiTWlzc2luZ09yZGVyQ29uZmlnXCIsZVtlLk1pc3NpbmdPcmRlcklkPThdPVwiTWlzc2luZ09yZGVySWRcIixlW2UuTWlzc2luZ1BheW1lbnQ9OV09XCJNaXNzaW5nUGF5bWVudFwiLGVbZS5NaXNzaW5nUGF5bWVudElkPTEwXT1cIk1pc3NpbmdQYXltZW50SWRcIixlW2UuTWlzc2luZ1BheW1lbnRJbnN0cnVtZW50PTExXT1cIk1pc3NpbmdQYXltZW50SW5zdHJ1bWVudFwiLGVbZS5NaXNzaW5nUGF5bWVudE1ldGhvZD0xMl09XCJNaXNzaW5nUGF5bWVudE1ldGhvZFwiLGVbZS5NaXNzaW5nUGF5bWVudFJlZGlyZWN0VXJsPTEzXT1cIk1pc3NpbmdQYXltZW50UmVkaXJlY3RVcmxcIixlW2UuTWlzc2luZ1BheW1lbnRTdGF0dXM9MTRdPVwiTWlzc2luZ1BheW1lbnRTdGF0dXNcIixlW2UuTWlzc2luZ1BheW1lbnRUb2tlbj0xNV09XCJNaXNzaW5nUGF5bWVudFRva2VuXCIsZVtlLk1pc3NpbmdTaGlwcGluZ0FkZHJlc3M9MTZdPVwiTWlzc2luZ1NoaXBwaW5nQWRkcmVzc1wifShjfHwoYz17fSkpO2NsYXNzIG0gZXh0ZW5kcyBke2NvbnN0cnVjdG9yKGUpe3N1cGVyKGZ1bmN0aW9uKGUpe3N3aXRjaChlKXtjYXNlIGMuTWlzc2luZ0JpbGxpbmdBZGRyZXNzOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBiaWxsaW5nIGFkZHJlc3MgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIGMuTWlzc2luZ0NhcnQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGNhcnQgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIGMuTWlzc2luZ0NvbnNpZ25tZW50czpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgY29uc2lnbm1lbnRzIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBjLk1pc3NpbmdDaGVja291dDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgY2hlY2tvdXQgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIGMuTWlzc2luZ0N1c3RvbWVyOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBjdXN0b21lciBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2UgYy5NaXNzaW5nQ2hlY2tvdXRDb25maWc6Y2FzZSBjLk1pc3NpbmdPcmRlckNvbmZpZzpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgY29uZmlndXJhdGlvbiBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2UgYy5NaXNzaW5nT3JkZXI6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIG9yZGVyIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBjLk1pc3NpbmdPcmRlcklkOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBvcmRlciBJRCBpcyB1bmF2YWlsYWJsZSBvciBub3QgZ2VuZXJhdGVkIHlldC5cIjtjYXNlIGMuTWlzc2luZ1BheW1lbnQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHBheW1lbnQgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIGMuTWlzc2luZ1BheW1lbnRUb2tlbjpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIHRva2VuIHJlcXVpcmVkIHRvIHN1Ym1pdCBhIHBheW1lbnQgaXMgbWlzc2luZy5cIjtjYXNlIGMuTWlzc2luZ1BheW1lbnRNZXRob2Q6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHBheW1lbnQgbWV0aG9kIGRhdGEgaXMgdW5hdmFpbGFibGUgb3Igbm90IHByb3Blcmx5IGNvbmZpZ3VyZWQuXCI7Y2FzZSBjLk1pc3NpbmdTaGlwcGluZ0FkZHJlc3M6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHNoaXBwaW5nIGFkZHJlc3MgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtkZWZhdWx0OnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgcmVxdWlyZWQgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIn19KGUpKSx0aGlzLnN1YnR5cGU9ZSx0aGlzLm5hbWU9XCJNaXNzaW5nRGF0YUVycm9yXCIsdGhpcy50eXBlPVwibWlzc2luZ19kYXRhXCJ9fWZ1bmN0aW9uIHkoZSl7cmV0dXJuXCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcImluaXRpYWxpemF0aW9uRGF0YVwiaW4gZSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEmJm51bGwhPT1lLmluaXRpYWxpemF0aW9uRGF0YSYmXCJvYmplY3RcIj09dHlwZW9mIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZcInN0cmlwZVB1Ymxpc2hhYmxlS2V5XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzdHJpcGVDb25uZWN0ZWRBY2NvdW50XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzaG9wcGVyTGFuZ3VhZ2VcImluIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZ2b2lkIDAhPT1lLmluaXRpYWxpemF0aW9uRGF0YS5zdHJpcGVQdWJsaXNoYWJsZUtleSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc3RyaXBlQ29ubmVjdGVkQWNjb3VudCYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc2hvcHBlckxhbmd1YWdlfWNvbnN0IGc9W1wicGF5bWVudF9lbGVtZW50X2JldGFfMlwiLFwiYWxpcGF5X3BtX2JldGFfMVwiLFwibGlua19kZWZhdWx0X2ludGVncmF0aW9uX2JldGFfMVwiLFwic2hpcHBpbmdfYWRkcmVzc19lbGVtZW50X2JldGFfMVwiLFwiYWRkcmVzc19lbGVtZW50X2JldGFfMVwiXSx2PVwiMjAyMC0wMy0wMjthbGlwYXlfYmV0YT12MTtsaW5rX2JldGE9djFcIjt2YXIgUyxfLGYsSSxDLEUsUCxiO2Z1bmN0aW9uIHcoZSl7cmV0dXJuXCJzdHJpcGVMaW5rQXV0aGVudGljYXRpb25TdGF0ZVwiaW4gZX0hZnVuY3Rpb24oZSl7ZS5TSElQUElORz1cInNoaXBwaW5nXCIsZS5CSUxMSU5HPVwiYmlsbGluZ1wifShTfHwoUz17fSkpLGZ1bmN0aW9uKGUpe2UuU1BMSVQ9XCJzcGxpdFwiLGUuRlVMTD1cImZ1bGxcIixlLk9SR0FOSVpBVElPTj1cIm9yZ2FuaXphdGlvblwifShffHwoXz17fSkpLGZ1bmN0aW9uKGUpe2UuQ3JlZGl0Q2FyZD1cImNhcmRcIixlLkxpbms9XCJsaW5rXCIsZS5FUFM9XCJlcHNcIixlLkdSQUJQQVk9XCJncmFicGF5XCIsZS5CQU5DT05UQUNUPVwiYmFuY29udGFjdFwiLGUuSURFQUw9XCJpZGVhbFwiLGUuQUxJUEFZPVwiYWxpcGF5XCIsZS5LTEFSTkE9XCJrbGFybmFcIixlLk9DUz1cIm9wdGltaXplZF9jaGVja291dFwifShmfHwoZj17fSkpLGZ1bmN0aW9uKGUpe2UuTkVWRVI9XCJuZXZlclwiLGUuQVVUTz1cImF1dG9cIixlLkFMV0FZUz1cImFsd2F5c1wiLGUuUEFZTUVOVD1cInBheW1lbnRcIixlLklGX1JFUVVJUkVEPVwiaWZfcmVxdWlyZWRcIn0oSXx8KEk9e30pKSxmdW5jdGlvbihlKXtlLlBBWU1FTlQ9XCJwYXltZW50XCIsZS5BVVRIRU5USUNBVElPTj1cImxpbmtBdXRoZW50aWNhdGlvblwiLGUuU0hJUFBJTkc9XCJhZGRyZXNzXCIsZS5FWFBSRVNTX0NIRUNLT1VUPVwiZXhwcmVzc0NoZWNrb3V0XCJ9KEN8fChDPXt9KSksZnVuY3Rpb24oZSl7ZS5SRVFVSVJFU19QQVlNRU5UX01FVEhPRD1cInJlcXVpcmVzX3BheW1lbnRfbWV0aG9kXCIsZS5SRVFVSVJFU19DT05GSVJNQVRJT049XCJyZXF1aXJlc19jb25maXJtYXRpb25cIixlLlJFUVVJUkVTX0FDVElPTj1cInJlcXVpcmVzX2FjdGlvblwiLGUuUFJPQ0VTU0lORz1cInByb2Nlc3NpbmdcIixlLlNVQ0NFRURFRD1cInN1Y2NlZWRlZFwiLGUuQ0FOQ0VMRUQ9XCJjYW5jZWxlZFwifShFfHwoRT17fSkpLGZ1bmN0aW9uKGUpe2UuQ0xJQ0s9XCJjbGlja1wiLGUuQ0hBTkdFPVwiY2hhbmdlXCIsZS5SRUFEWT1cInJlYWR5XCIsZS5TSElQUElOR19BRERSRVNTX0NIQU5HRT1cInNoaXBwaW5nYWRkcmVzc2NoYW5nZVwiLGUuU0hJUFBJTkdfUkFURV9DSEFOR0U9XCJzaGlwcGluZ3JhdGVjaGFuZ2VcIixlLkNPTkZJUk09XCJjb25maXJtXCIsZS5DQU5DRUw9XCJjYW5jZWxcIixlLkxPQURFUl9TVEFSVD1cImxvYWRlcnN0YXJ0XCJ9KFB8fChQPXt9KSksZnVuY3Rpb24oZSl7ZS5PTl9TRVNTSU9OPVwib25fc2Vzc2lvblwiLGUuT0ZGX1NFU1NJT049XCJvZmZfc2Vzc2lvblwifShifHwoYj17fSkpO2NsYXNzIEF7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10fWluaXRpYWxpemUoZSl7dmFyIHQsaSxuLHIsbztyZXR1cm4gaT10aGlzLG49dm9pZCAwLG89ZnVuY3Rpb24qKCl7bGV0IGk7aWYoIWUuc3RyaXBldXBlKXRocm93IG5ldyBwKCdVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIFwib3B0aW9uc1wiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTtjb25zdHtjb250YWluZXI6bixnYXRld2F5SWQ6cixtZXRob2RJZDpvLG9uRW1haWxDaGFuZ2U6cyxnZXRTdHlsZXM6YSxpc0xvYWRpbmc6ZH09ZS5zdHJpcGV1cGU7T2JqZWN0LmVudHJpZXMoZS5zdHJpcGV1cGUpLmZvckVhY2goKFtlLHRdKT0+e2lmKCF0KXRocm93IG5ldyBwKGBVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIFwiJHtlfVwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC5gKX0pLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChyLHtwYXJhbXM6e21ldGhvZDpvfX0pO2NvbnN0IGw9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksdT1sLmdldFBheW1lbnRNZXRob2RPclRocm93KG8scikse2NsaWVudFRva2VuOmh9PXU7aWYoIXkodSl8fCFoKXRocm93IG5ldyBtKGMuTWlzc2luZ1BheW1lbnRUb2tlbik7Y29uc3R7ZW1haWw6X309bC5nZXRDdXN0b21lck9yVGhyb3coKSxmPWwuZ2V0UGF5bWVudFByb3ZpZGVyQ3VzdG9tZXJPclRocm93KCksST0odyhmKT9mOnt9KS5zdHJpcGVMaW5rQXV0aGVudGljYXRpb25TdGF0ZTtpZighXyl7bGV0IGU7Y29uc3Qgcj1cImZ1bmN0aW9uXCI9PXR5cGVvZiBhJiZhKCk7ZT1yP3t2YXJpYWJsZXM6e2NvbG9yUHJpbWFyeTpyLmZpZWxkSW5uZXJTaGFkb3csY29sb3JCYWNrZ3JvdW5kOnIuZmllbGRCYWNrZ3JvdW5kLGNvbG9yVGV4dDpyLmxhYmVsVGV4dCxjb2xvckRhbmdlcjpyLmZpZWxkRXJyb3JUZXh0LGNvbG9yVGV4dFNlY29uZGFyeTpyLmxhYmVsVGV4dCxjb2xvclRleHRQbGFjZWhvbGRlcjpyLmZpZWxkUGxhY2Vob2xkZXJUZXh0fSxydWxlczp7XCIuSW5wdXRcIjp7Ym9yZGVyQ29sb3I6ci5maWVsZEJvcmRlcixjb2xvcjpyLmZpZWxkVGV4dCxib3hTaGFkb3c6ci5maWVsZElubmVyU2hhZG93fX19Ont9LGk9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KHUuaW5pdGlhbGl6YXRpb25EYXRhLGwuZ2V0Q2FydExvY2FsZSgpLGcsdiksdGhpcy5fc3RyaXBlRWxlbWVudHM9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0RWxlbWVudHMoaSx7Y2xpZW50U2VjcmV0OmgsYXBwZWFyYW5jZTplfSk7Y29uc3R7Z2V0QmlsbGluZ0FkZHJlc3M6byxnZXRDb25zaWdubWVudHM6cH09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkseT1wKCksXz1udWxsPT09KHQ9bnVsbD09eT92b2lkIDA6eVswXSl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQse2VtYWlsOmZ9PW8oKXx8e30sRT1mP3tkZWZhdWx0VmFsdWVzOnttb2RlOlMuU0hJUFBJTkcsZW1haWw6Zn19Ont9LGI9dGhpcy5fc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChDLkFVVEhFTlRJQ0FUSU9OKXx8dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKEMuQVVUSEVOVElDQVRJT04sRSk7Yi5vbihQLkNIQU5HRSxlPT57aWYoIShcImF1dGhlbnRpY2F0ZWRcImluIGUpKXRocm93IG5ldyBtKGMuTWlzc2luZ0N1c3RvbWVyKTt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlUGF5bWVudFByb3ZpZGVyQ3VzdG9tZXIoe3N0cmlwZUxpbmtBdXRoZW50aWNhdGlvblN0YXRlOmUuYXV0aGVudGljYXRlZH0pLGUuY29tcGxldGU/cyhlLmF1dGhlbnRpY2F0ZWQsZS52YWx1ZS5lbWFpbCk6cyghMSxcIlwiKSxkJiZkKCExKSx2b2lkIDA9PT1JJiZlLmF1dGhlbnRpY2F0ZWQmJl8mJnRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5kZWxldGVDb25zaWdubWVudChfKX0pLGIubW91bnQoYCMke259YCl9fSxuZXcoKHI9dm9pZCAwKXx8KHI9UHJvbWlzZSkpKGZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChvLm5leHQoZSkpfWNhdGNoKGUpe3QoZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qoby50aHJvdyhlKSl9Y2F0Y2goZSl7dChlKX19ZnVuY3Rpb24gZCh0KXt2YXIgaTt0LmRvbmU/ZSh0LnZhbHVlKTooaT10LnZhbHVlLGkgaW5zdGFuY2VvZiByP2k6bmV3IHIoZnVuY3Rpb24oZSl7ZShpKX0pKS50aGVuKHMsYSl9ZCgobz1vLmFwcGx5KGksbnx8W10pKS5uZXh0KCkpfSl9ZGVpbml0aWFsaXplKCl7dmFyIGUsdDtyZXR1cm4gbnVsbD09PSh0PW51bGw9PT0oZT10aGlzLl9zdHJpcGVFbGVtZW50cyl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZ2V0RWxlbWVudChDLkFVVEhFTlRJQ0FUSU9OKSl8fHZvaWQgMD09PXR8fHQudW5tb3VudCgpLFByb21pc2UucmVzb2x2ZSgpfXNpZ25JbihlLHQpe3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc2lnbkluQ3VzdG9tZXIoZSx0KSxQcm9taXNlLnJlc29sdmUoKX1zaWduT3V0KGUpe3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc2lnbk91dEN1c3RvbWVyKGUpLFByb21pc2UucmVzb2x2ZSgpfWV4ZWN1dGVQYXltZW50TWV0aG9kQ2hlY2tvdXQoZSl7dmFyIHQ7cmV0dXJuIG51bGw9PT0odD1udWxsPT1lP3ZvaWQgMDplLmNvbnRpbnVlV2l0aENoZWNrb3V0Q2FsbGJhY2spfHx2b2lkIDA9PT10fHx0LmNhbGwoZSksUHJvbWlzZS5yZXNvbHZlKCl9fWNvbnN0IE89YSh0PT5uZXcgQSh0LG5ldyBoKGUoKSkpLFt7aWQ6XCJzdHJpcGV1cGVcIn1dKTtjbGFzcyBNIGV4dGVuZHMgZHtjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlBheW1lbnQgcHJvY2VzcyB3YXMgY2FuY2VsbGVkLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kQ2FuY2VsbGVkRXJyb3JcIix0aGlzLnR5cGU9XCJwYXltZW50X2NhbmNlbGxlZFwifX1jbGFzcyBUIGV4dGVuZHMgZHtjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGNsaWVudCBsaWJyYXJ5IG9mIGEgcGF5bWVudCBtZXRob2QgaGFzIHRocm93biBhbiB1bmV4cGVjdGVkIGVycm9yLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kRmFpbGVkRXJyb3JcIix0aGlzLnR5cGU9XCJwYXltZW50X21ldGhvZF9jbGllbnRfaW52YWxpZFwifX12YXIgTjshZnVuY3Rpb24oZSl7ZVtlLkNoZWNrb3V0QnV0dG9uTm90SW5pdGlhbGl6ZWQ9MF09XCJDaGVja291dEJ1dHRvbk5vdEluaXRpYWxpemVkXCIsZVtlLkN1c3RvbWVyTm90SW5pdGlhbGl6ZWQ9MV09XCJDdXN0b21lck5vdEluaXRpYWxpemVkXCIsZVtlLlBheW1lbnROb3RJbml0aWFsaXplZD0yXT1cIlBheW1lbnROb3RJbml0aWFsaXplZFwiLGVbZS5TaGlwcGluZ05vdEluaXRpYWxpemVkPTNdPVwiU2hpcHBpbmdOb3RJbml0aWFsaXplZFwiLGVbZS5TcGFtUHJvdGVjdGlvbk5vdEluaXRpYWxpemVkPTRdPVwiU3BhbVByb3RlY3Rpb25Ob3RJbml0aWFsaXplZFwifShOfHwoTj17fSkpO2NsYXNzIGsgZXh0ZW5kcyBke2NvbnN0cnVjdG9yKGUpe3N1cGVyKGZ1bmN0aW9uKGUpe3N3aXRjaChlKXtjYXNlIE4uQ3VzdG9tZXJOb3RJbml0aWFsaXplZDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGN1c3RvbWVyIHN0ZXAgb2YgY2hlY2tvdXQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2Nhc2UgTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBwYXltZW50IHN0ZXAgb2YgY2hlY2tvdXQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2Nhc2UgTi5TaGlwcGluZ05vdEluaXRpYWxpemVkOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgc2hpcHBpbmcgc3RlcCBvZiBjaGVja291dCBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQuXCI7Y2FzZSBOLlNwYW1Qcm90ZWN0aW9uTm90SW5pdGlhbGl6ZWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBjaGVja291dCBzcGFtIHByb3RlY3Rpb24gaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2RlZmF1bHQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSByZXF1aXJlZCBjb21wb25lbnQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwifX0oZSkpLHRoaXMuc3VidHlwZT1lLHRoaXMubmFtZT1cIk5vdEluaXRpYWxpemVkRXJyb3JcIix0aGlzLnR5cGU9XCJub3RfaW5pdGlhbGl6ZWRcIn19dmFyIEQ9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgUntjb25zdHJ1Y3RvcihlLHQpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5pc01vdW50ZWQ9ITF9ZGVpbml0aWFsaXplKCl7dmFyIGU7bnVsbD09PShlPXRoaXMuY2hlY2tvdXRFdmVudHNVbnN1YnNjcmliZSl8fHZvaWQgMD09PWV8fGUuY2FsbCh0aGlzKSx0aGlzLmlzTW91bnRlZD0hMX1pbml0Q2hlY2tvdXRFdmVudHNTdWJzY3JpcHRpb24oZSx0LGksbil7dGhpcy5jaGVja291dEV2ZW50c1Vuc3Vic2NyaWJlPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJzY3JpYmUoKCk9PkQodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3ZhciByO2NvbnN0IG89bnVsbD09bj92b2lkIDA6bi5nZXRFbGVtZW50KEMuUEFZTUVOVCk7aWYobyl7dHJ5e3lpZWxkIHRoaXMudXBkYXRlU3RyaXBlUGF5bWVudEludGVudChlLHQpfWNhdGNoKGUpe3JldHVybiB0aGlzLmlzTW91bnRlZCYmKG8udW5tb3VudCgpLHRoaXMuaXNNb3VudGVkPSExKSx2b2lkKGUgaW5zdGFuY2VvZiBFcnJvciYmKG51bGw9PT0ocj1pLm9uRXJyb3IpfHx2b2lkIDA9PT1yfHxyLmNhbGwoaSxlKSkpfXRoaXMuaXNNb3VudGVkfHwoeWllbGQgbnVsbD09bj92b2lkIDA6bi5mZXRjaFVwZGF0ZXMoKSx0aGlzLm1vdW50RWxlbWVudChvLGkuY29udGFpbmVySWQpKX19KSxlPT57dmFyIHQ7cmV0dXJuIG51bGw9PT0odD1lLmdldENoZWNrb3V0KCkpfHx2b2lkIDA9PT10P3ZvaWQgMDp0Lm91dHN0YW5kaW5nQmFsYW5jZX0sZT0+e3ZhciB0O3JldHVybiBudWxsPT09KHQ9ZS5nZXRDaGVja291dCgpKXx8dm9pZCAwPT09dD92b2lkIDA6dC5jb3Vwb25zfSl9bW91bnRFbGVtZW50KGUsdCl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodCkmJihlLm1vdW50KGAjJHt0fWApLHRoaXMuaXNNb3VudGVkPSEwKX1tYXBBcHBlYXJhbmNlVmFyaWFibGVzKGUpe3JldHVybntjb2xvclByaW1hcnk6ZS5maWVsZElubmVyU2hhZG93LGNvbG9yQmFja2dyb3VuZDplLmZpZWxkQmFja2dyb3VuZCxjb2xvclRleHQ6ZS5sYWJlbFRleHQsY29sb3JEYW5nZXI6ZS5maWVsZEVycm9yVGV4dCxjb2xvclRleHRTZWNvbmRhcnk6ZS5sYWJlbFRleHQsY29sb3JUZXh0UGxhY2Vob2xkZXI6ZS5maWVsZFBsYWNlaG9sZGVyVGV4dCxjb2xvckljb246ZS5maWVsZFBsYWNlaG9sZGVyVGV4dH19bWFwSW5wdXRBcHBlYXJhbmNlUnVsZXMoZSl7cmV0dXJue2JvcmRlckNvbG9yOmUuZmllbGRCb3JkZXIsY29sb3I6ZS5maWVsZFRleHQsYm94U2hhZG93OmUuZmllbGRJbm5lclNoYWRvd319dGhyb3dTdHJpcGVFcnJvcihlKXtpZihcIm9iamVjdFwiPT10eXBlb2YodD1lKSYmbnVsbCE9PXQmJlwidHlwZVwiaW4gdCYmKHRoaXMudGhyb3dEaXNwbGF5YWJsZVN0cmlwZUVycm9yKGUpLHRoaXMuaXNDYW5jZWxsYXRpb25FcnJvcihlKSkpdGhyb3cgbmV3IE07dmFyIHQ7dGhyb3cgbmV3IFR9dGhyb3dEaXNwbGF5YWJsZVN0cmlwZUVycm9yKGUpe2lmKHQoW1wiY2FyZF9lcnJvclwiLFwiaW52YWxpZF9yZXF1ZXN0X2Vycm9yXCIsXCJ2YWxpZGF0aW9uX2Vycm9yXCJdLGUudHlwZSkpdGhyb3cgbmV3IEVycm9yKGUubWVzc2FnZSl9aXNDYW5jZWxsYXRpb25FcnJvcihlKXt2YXIgdDtjb25zdCBpPW51bGw9PT0odD1udWxsPT1lP3ZvaWQgMDplLnBheW1lbnRfaW50ZW50Lmxhc3RfcGF5bWVudF9lcnJvcil8fHZvaWQgMD09PXQ/dm9pZCAwOnQubWVzc2FnZTtyZXR1cm4hIWkmJi0xIT09aS5pbmRleE9mKFwiY2FuY2VsZWRcIil9dGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKXt0aHJvdyBuZXcgVChcIldlJ3ZlIHJlY2VpdmVkIHlvdXIgb3JkZXIgYW5kIGFyZSBwcm9jZXNzaW5nIHlvdXIgcGF5bWVudC4gT25jZSB0aGUgcGF5bWVudCBpcyB2ZXJpZmllZCwgeW91ciBvcmRlciB3aWxsIGJlIGNvbXBsZXRlZC4gV2Ugd2lsbCBzZW5kIHlvdSBhbiBlbWFpbCB3aGVuIGl0J3MgY29tcGxldGVkLiBQbGVhc2Ugbm90ZSwgdGhpcyBwcm9jZXNzIG1heSB0YWtlIGEgZmV3IG1pbnV0ZXMgZGVwZW5kaW5nIG9uIHRoZSBwcm9jZXNzaW5nIHRpbWVzIG9mIHlvdXIgY2hvc2VuIG1ldGhvZC5cIil9aXNQYXltZW50Q29tcGxldGVkKGUsdCl7cmV0dXJuIEQodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksbj1pLmdldFBheW1lbnRNZXRob2RPclRocm93KGUpLHtmZWF0dXJlczpyfT1pLmdldFN0b3JlQ29uZmlnT3JUaHJvdygpLmNoZWNrb3V0U2V0dGluZ3M7aWYoIW4uY2xpZW50VG9rZW58fCF0fHwhcltcIlBJLTYyNi5CbG9ja191bm5lY2Vzc2FyeV9wYXltZW50X2NvbmZpcm1hdGlvbl9mb3JfU3RyaXBlVVBFXCJdKXJldHVybiExO2NvbnN0e3BheW1lbnRJbnRlbnQ6b309eWllbGQgdC5yZXRyaWV2ZVBheW1lbnRJbnRlbnQobi5jbGllbnRUb2tlbik7cmV0dXJuKG51bGw9PW8/dm9pZCAwOm8uc3RhdHVzKT09PUUuU1VDQ0VFREVEfSl9bWFwU3RyaXBlUGF5bWVudERhdGEoZSx0LGk9ITEpe2NvbnN0IG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0QmlsbGluZ0FkZHJlc3MoKSx7Zmlyc3ROYW1lOnI9XCJcIixsYXN0TmFtZTpvPVwiXCIsZW1haWw6cz1cIlwifT1ufHx7fSxhPXRoaXMuX21hcFN0cmlwZUFkZHJlc3Mobik7aWYoIWUpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCEocyYmYSYmYS5jaXR5JiZhLmNvdW50cnkmJnImJm8pKXRocm93IG5ldyBtKGMuTWlzc2luZ0JpbGxpbmdBZGRyZXNzKTtyZXR1cm57ZWxlbWVudHM6ZSxyZWRpcmVjdDpJLklGX1JFUVVJUkVELGNvbmZpcm1QYXJhbXM6T2JqZWN0LmFzc2lnbih7cGF5bWVudF9tZXRob2RfZGF0YTpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30saT97YWxsb3dfcmVkaXNwbGF5OlwiYWx3YXlzXCJ9Ont9KSx7YmlsbGluZ19kZXRhaWxzOntlbWFpbDpzLGFkZHJlc3M6YSxuYW1lOmAke3J9ICR7b31gfX0pfSx0JiZ7cmV0dXJuX3VybDp0fSl9fWlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUpe3JldHVybiBvKGUse2NvZGU6XCJhZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZFwifSl9aXNSZWRpcmVjdEFjdGlvbihlKXtjb25zdHt0eXBlOnQsZGF0YTp7cmVkaXJlY3RfdXJsOml9fT1lO3JldHVyblwicmVkaXJlY3RfdG9fdXJsXCI9PT10JiYhIWl9aXNPblBhZ2VBZGRpdGlvbmFsQWN0aW9uKGUpe2NvbnN0e3R5cGU6dCxkYXRhOnt0b2tlbjppfX09ZTtyZXR1cm5cImFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVzX3BheW1lbnRfbWV0aG9kXCI9PT10JiYhIWl9dXBkYXRlU3RyaXBlUGF5bWVudEludGVudChlLHQpe3JldHVybiBEKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBpPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChlLHtwYXJhbXM6e21ldGhvZDp0fX0pLHtjbGllbnRUb2tlbjpufT1pLmdldFBheW1lbnRNZXRob2RPclRocm93KHQpO24mJnRoaXMuc2NyaXB0TG9hZGVyLnVwZGF0ZVN0cmlwZUVsZW1lbnRzKHtjbGllbnRTZWNyZXQ6bn0pfSl9X21hcFN0cmlwZUFkZHJlc3MoZSl7aWYoZSl7Y29uc3R7Y2l0eTp0LGFkZHJlc3MxOmksYWRkcmVzczI6bixjb3VudHJ5Q29kZTpyLHBvc3RhbENvZGU6byxzdGF0ZU9yUHJvdmluY2VDb2RlOnN9PWU7cmV0dXJuIE9iamVjdC5hc3NpZ24oe2NpdHk6dCxjb3VudHJ5OnIscG9zdGFsX2NvZGU6byxsaW5lMTppLGxpbmUyOm59LHM/e3N0YXRlOnN9Ont9KX10aHJvdyBuZXcgbShjLk1pc3NpbmdCaWxsaW5nQWRkcmVzcyl9fWNvbnN0IHo9e3NpemU6NzAsY29sb3I6XCIjZDlkOWQ5XCIsYmFja2dyb3VuZENvbG9yOlwiI2ZmZmZmZlwifSxMPXtwb3NpdGlvbjpcImZpeGVkXCIsXCJiYWNrZ3JvdW5kLWNvbG9yXCI6XCJyZ2JhKDAsIDAsIDAsIDAuNClcIixcInotaW5kZXhcIjpcIjEwMDBcIn0sVT1cImVtYmVkZGVkLWNoZWNrb3V0LWxvYWRpbmctaW5kaWNhdG9yLXJvdGF0aW9uXCI7Y2xhc3MgeHtjb25zdHJ1Y3RvcihlKXt0aGlzLnN0eWxlcz1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30seiksZSYmZS5zdHlsZXMpLHRoaXMuY29udGFpbmVyU3R5bGVzPU9iamVjdC5hc3NpZ24oe30sZSYmZS5jb250YWluZXJTdHlsZXMpLHRoaXMuZGVmaW5lQW5pbWF0aW9uKCksdGhpcy5jb250YWluZXI9dGhpcy5idWlsZENvbnRhaW5lcigpLHRoaXMuaW5kaWNhdG9yPXRoaXMuYnVpbGRJbmRpY2F0b3IoKSx0aGlzLmNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aGlzLmluZGljYXRvcil9c2hvdyhlKXtpZihlKXtjb25zdCB0PWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGUpO2lmKCF0KXRocm93IG5ldyBFcnJvcihcIlVuYWJsZSB0byBhdHRhY2ggdGhlIGxvYWRpbmcgaW5kaWNhdG9yIGJlY2F1c2UgdGhlIHBhcmVudCBJRCBpcyBub3QgdmFsaWQuXCIpO3QuYXBwZW5kQ2hpbGQodGhpcy5jb250YWluZXIpfXRoaXMuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHk9XCJ2aXNpYmxlXCIsdGhpcy5jb250YWluZXIuc3R5bGUub3BhY2l0eT1cIjFcIn1oaWRlKCl7Y29uc3QgZT0oKT0+e3RoaXMuY29udGFpbmVyLnN0eWxlLnZpc2liaWxpdHk9XCJoaWRkZW5cIix0aGlzLmNvbnRhaW5lci5yZW1vdmVFdmVudExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLGUpfTt0aGlzLmNvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKFwidHJhbnNpdGlvbmVuZFwiLGUpLHRoaXMuY29udGFpbmVyLnN0eWxlLm9wYWNpdHk9XCIwXCJ9YnVpbGRDb250YWluZXIoKXtjb25zdCBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7cmV0dXJuIGUuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsZS5zdHlsZS5ib3R0b209XCIwXCIsZS5zdHlsZS5sZWZ0PVwiMFwiLGUuc3R5bGUuaGVpZ2h0PVwiMTAwJVwiLGUuc3R5bGUud2lkdGg9XCIxMDAlXCIsZS5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsZS5zdHlsZS5yaWdodD1cIjBcIixlLnN0eWxlLnRvcD1cIjBcIixlLnN0eWxlLnRyYW5zaXRpb249XCJhbGwgMjUwbXMgZWFzZS1vdXRcIixlLnN0eWxlLm9wYWNpdHk9XCIwXCIsdGhpcy5zZXRTdHlsZUF0dHJpYnV0ZShlLHRoaXMuY29udGFpbmVyU3R5bGVzKSxlfWJ1aWxkSW5kaWNhdG9yKCl7Y29uc3QgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3JldHVybiBlLnN0eWxlLmRpc3BsYXk9XCJibG9ja1wiLGUuc3R5bGUud2lkdGg9YCR7dGhpcy5zdHlsZXMuc2l6ZX1weGAsZS5zdHlsZS5oZWlnaHQ9YCR7dGhpcy5zdHlsZXMuc2l6ZX1weGAsZS5zdHlsZS5ib3JkZXJSYWRpdXM9YCR7dGhpcy5zdHlsZXMuc2l6ZX1weGAsZS5zdHlsZS5ib3JkZXI9XCJzb2xpZCAxcHhcIixlLnN0eWxlLmJvcmRlckNvbG9yPWAke3RoaXMuc3R5bGVzLmJhY2tncm91bmRDb2xvcn0gJHt0aGlzLnN0eWxlcy5iYWNrZ3JvdW5kQ29sb3J9ICR7dGhpcy5zdHlsZXMuY29sb3J9ICR7dGhpcy5zdHlsZXMuY29sb3J9YCxlLnN0eWxlLm1hcmdpbj1cIjAgYXV0b1wiLGUuc3R5bGUucG9zaXRpb249XCJhYnNvbHV0ZVwiLGUuc3R5bGUubGVmdD1cIjBcIixlLnN0eWxlLnJpZ2h0PVwiMFwiLGUuc3R5bGUudG9wPVwiNTAlXCIsZS5zdHlsZS50cmFuc2Zvcm09XCJ0cmFuc2xhdGVZKC01MCUpIHJvdGF0ZSgwZGVnKVwiLGUuc3R5bGUudHJhbnNmb3JtU3R5bGU9XCJwcmVzZXJ2ZS0zZFwiLGUuc3R5bGUuYW5pbWF0aW9uPWAke1V9IDUwMG1zIGluZmluaXRlIGN1YmljLWJlemllcigwLjY5LCAwLjMxLCAwLjU2LCAwLjgzKWAsZX1zZXRTdHlsZUF0dHJpYnV0ZShlLHQpe09iamVjdC5rZXlzKHQpLmZvckVhY2goaT0+e2Uuc3R5bGUuc2V0UHJvcGVydHkoaSx0W2ldKX0pfWRlZmluZUFuaW1hdGlvbigpe3ZhciBlO2lmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFUpKXJldHVybjtjb25zdCB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTt0LmlkPVUsbnVsbD09PShlPWRvY3VtZW50LmhlYWQpfHx2b2lkIDA9PT1lfHxlLmFwcGVuZENoaWxkKHQpLHQuc2hlZXQgaW5zdGFuY2VvZiBDU1NTdHlsZVNoZWV0JiZ0LnNoZWV0Lmluc2VydFJ1bGUoYFxcbiAgICAgICAgICAgICAgICBAa2V5ZnJhbWVzICR7VX0ge1xcbiAgICAgICAgICAgICAgICAgICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSkgcm90YXRlKDBkZWcpOyB9XFxuICAgICAgICAgICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpIHJvdGF0ZSgzNjBkZWcpOyB9XFxuICAgICAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBgLDApfX1jb25zdCBqPWU9Plwib2JqZWN0XCI9PXR5cGVvZiBlJiZudWxsIT09ZSYmXCJib2R5XCJpbiBlO2NsYXNzIEJ7Y29uc3RydWN0b3IoZSl7dGhpcy5fZGVjaW1hbFBsYWNlcz1lfXRvSW50ZWdlcihlKXtyZXR1cm4gTWF0aC5yb3VuZChlKk1hdGgucG93KDEwLHRoaXMuX2RlY2ltYWxQbGFjZXMpKX19Y29uc3QgRj1bXCJBQ1wiLFwiQURcIixcIkFFXCIsXCJBRlwiLFwiQUdcIixcIkFJXCIsXCJBTFwiLFwiQU1cIixcIkFPXCIsXCJBUVwiLFwiQVJcIixcIkFUXCIsXCJBVVwiLFwiQVdcIixcIkFYXCIsXCJBWlwiLFwiQkFcIixcIkJCXCIsXCJCRFwiLFwiQkVcIixcIkJGXCIsXCJCR1wiLFwiQkhcIixcIkJJXCIsXCJCSlwiLFwiQkxcIixcIkJNXCIsXCJCTlwiLFwiQk9cIixcIkJRXCIsXCJCUlwiLFwiQlNcIixcIkJUXCIsXCJCVlwiLFwiQldcIixcIkJZXCIsXCJCWlwiLFwiQ0FcIixcIkNEXCIsXCJDRlwiLFwiQ0dcIixcIkNIXCIsXCJDSVwiLFwiQ0tcIixcIkNMXCIsXCJDTVwiLFwiQ05cIixcIkNPXCIsXCJDUlwiLFwiQ1ZcIixcIkNXXCIsXCJDWVwiLFwiQ1pcIixcIkRFXCIsXCJESlwiLFwiREtcIixcIkRNXCIsXCJET1wiLFwiRFpcIixcIkVDXCIsXCJFRVwiLFwiRUdcIixcIkVIXCIsXCJFUlwiLFwiRVNcIixcIkVUXCIsXCJGSVwiLFwiRkpcIixcIkZLXCIsXCJGT1wiLFwiRlJcIixcIkdBXCIsXCJHQlwiLFwiR0RcIixcIkdFXCIsXCJHRlwiLFwiR0dcIixcIkdIXCIsXCJHSVwiLFwiR0xcIixcIkdNXCIsXCJHTlwiLFwiR1BcIixcIkdRXCIsXCJHUlwiLFwiR1NcIixcIkdUXCIsXCJHVVwiLFwiR1dcIixcIkdZXCIsXCJIS1wiLFwiSE5cIixcIkhSXCIsXCJIVFwiLFwiSFVcIixcIklEXCIsXCJJRVwiLFwiSUxcIixcIklNXCIsXCJJTlwiLFwiSU9cIixcIklRXCIsXCJJU1wiLFwiSVRcIixcIkpFXCIsXCJKTVwiLFwiSk9cIixcIkpQXCIsXCJLRVwiLFwiS0dcIixcIktIXCIsXCJLSVwiLFwiS01cIixcIktOXCIsXCJLUlwiLFwiS1dcIixcIktZXCIsXCJLWlwiLFwiTEFcIixcIkxCXCIsXCJMQ1wiLFwiTElcIixcIkxLXCIsXCJMUlwiLFwiTFNcIixcIkxUXCIsXCJMVVwiLFwiTFZcIixcIkxZXCIsXCJNQVwiLFwiTUNcIixcIk1EXCIsXCJNRVwiLFwiTUZcIixcIk1HXCIsXCJNS1wiLFwiTUxcIixcIk1NXCIsXCJNTlwiLFwiTU9cIixcIk1RXCIsXCJNUlwiLFwiTVNcIixcIk1UXCIsXCJNVVwiLFwiTVZcIixcIk1XXCIsXCJNWFwiLFwiTVlcIixcIk1aXCIsXCJOQVwiLFwiTkNcIixcIk5FXCIsXCJOR1wiLFwiTklcIixcIk5MXCIsXCJOT1wiLFwiTlBcIixcIk5SXCIsXCJOVVwiLFwiTlpcIixcIk9NXCIsXCJQQVwiLFwiUEVcIixcIlBGXCIsXCJQR1wiLFwiUEhcIixcIlBLXCIsXCJQTFwiLFwiUE1cIixcIlBOXCIsXCJQUlwiLFwiUFNcIixcIlBUXCIsXCJQWVwiLFwiUUFcIixcIlJFXCIsXCJST1wiLFwiUlNcIixcIlJVXCIsXCJSV1wiLFwiU0FcIixcIlNCXCIsXCJTQ1wiLFwiU0RcIixcIlNFXCIsXCJTR1wiLFwiU0hcIixcIlNJXCIsXCJTSlwiLFwiU0tcIixcIlNMXCIsXCJTTVwiLFwiU05cIixcIlNPXCIsXCJTUlwiLFwiU1NcIixcIlNUXCIsXCJTVlwiLFwiU1hcIixcIlNaXCIsXCJUQVwiLFwiVENcIixcIlREXCIsXCJURlwiLFwiVEdcIixcIlRIXCIsXCJUSlwiLFwiVEtcIixcIlRMXCIsXCJUTVwiLFwiVE5cIixcIlRPXCIsXCJUUlwiLFwiVFRcIixcIlRWXCIsXCJUV1wiLFwiVFpcIixcIlVBXCIsXCJVR1wiLFwiVVNcIixcIlVZXCIsXCJVWlwiLFwiVkFcIixcIlZDXCIsXCJWRVwiLFwiVkdcIixcIlZOXCIsXCJWVVwiLFwiV0ZcIixcIldTXCIsXCJYS1wiLFwiWUVcIixcIllUXCIsXCJaQVwiLFwiWk1cIixcIlpXXCIsXCJaWlwiXTt2YXIgVj1mdW5jdGlvbihlLHQsaSxuKXtyZXR1cm4gbmV3KGl8fChpPVByb21pc2UpKShmdW5jdGlvbihyLG8pe2Z1bmN0aW9uIHMoZSl7dHJ5e2Qobi5uZXh0KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtkKG4udGhyb3coZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGQoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KHQ9ZS52YWx1ZSx0IGluc3RhbmNlb2YgaT90Om5ldyBpKGZ1bmN0aW9uKGUpe2UodCl9KSkudGhlbihzLGEpfWQoKG49bi5hcHBseShlLHR8fFtdKSkubmV4dCgpKX0pfTtjbGFzcyBHe2NvbnN0cnVjdG9yKGUsdCxpLG4pe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2U9aSx0aGlzLmxvYWRpbmdJbmRpY2F0b3I9bn1pbml0aWFsaXplKGUpe3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGVvY3M6dH09ZXx8e307aWYoIXQpdGhyb3cgbmV3IHAoJ1VuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgXCJvcHRpb25zXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO2NvbnN0e21ldGhvZElkOmksZ2F0ZXdheUlkOm4sY29udGFpbmVyOnJ9PXQ7aWYoIXJ8fCFpfHwhbil0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3Qgbz15aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2Qobix7cGFyYW1zOnttZXRob2Q6aX19KSxzPW8uZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSxuKSx7bG9hZGluZ0NvbnRhaW5lcklkOmEsYnV0dG9uSGVpZ2h0OmQsb25Db21wbGV0ZTpsfT10O2lmKHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI9YSx0aGlzLl9vbkNvbXBsZXRlPWwsIXkocykpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7aW5pdGlhbGl6YXRpb25EYXRhOnV9PXMse2NhcHR1cmVNZXRob2Q6aH09dTtyZXR1cm4gdGhpcy5fY2FwdHVyZU1ldGhvZD1oLHRoaXMuX3N0cmlwZUNsaWVudD15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQodSxvLmdldENhcnRMb2NhbGUoKSkseWllbGQgdGhpcy5fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGkscix0aGlzLl9zdHJpcGVDbGllbnQsZCksUHJvbWlzZS5yZXNvbHZlKCl9KX1zaWduSW4oKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9c2lnbk91dCgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1leGVjdXRlUGF5bWVudE1ldGhvZENoZWNrb3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWRlaW5pdGlhbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGUsdCxpLG49NDApe3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCByPXRoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSxvPU9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHtzaGlwcGluZ0FkZHJlc3NSZXF1aXJlZDpyfSxyP3thbGxvd2VkU2hpcHBpbmdDb3VudHJpZXM6eWllbGQgdGhpcy5fZ2V0QXZhaWxhYmxlQ291bnRyaWVzKCl9Ont9KSxyP3tzaGlwcGluZ1JhdGVzOlt7aWQ6XCJfXCIsYW1vdW50OjAsZGlzcGxheU5hbWU6XCJQZW5kaW5nIHJhdGVzXCJ9XX06e30pLHtiaWxsaW5nQWRkcmVzc1JlcXVpcmVkOiEwLGVtYWlsUmVxdWlyZWQ6ITAscGhvbmVOdW1iZXJSZXF1aXJlZDohMCxwYXltZW50TWV0aG9kczp7bGluazpJLkFVVE8sYXBwbGVQYXk6SS5ORVZFUixnb29nbGVQYXk6SS5ORVZFUixhbWF6b25QYXk6SS5ORVZFUixwYXlwYWw6SS5ORVZFUixrbGFybmE6SS5ORVZFUn0sYnV0dG9uSGVpZ2h0Om59KSx7Y2FydEFtb3VudDpzfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0T3JUaHJvdygpLGE9T2JqZWN0LmFzc2lnbih7bW9kZTpcInBheW1lbnRcIixhbW91bnQ6dGhpcy5fdG9DZW50cyhzKSxjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpfSx0aGlzLl9jYXB0dXJlTWV0aG9kP3tjYXB0dXJlTWV0aG9kOnRoaXMuX2NhcHR1cmVNZXRob2R9Ont9KTt0aGlzLl9zdHJpcGVFbGVtZW50cz1pLmVsZW1lbnRzKGEpLHRoaXMuX2xpbmtWMkVsZW1lbnQ9dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKEMuRVhQUkVTU19DSEVDS09VVCxvKSx0aGlzLl9saW5rVjJFbGVtZW50Lm1vdW50KGAjJHt0fWApLHRoaXMuX2luaXRpYWxpemVFdmVudHModGhpcy5fbGlua1YyRWxlbWVudCxlKX0pfV9pbml0aWFsaXplRXZlbnRzKGUsdCl7dGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpJiYoZS5vbihQLlNISVBQSU5HX0FERFJFU1NfQ0hBTkdFLGU9PlYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9vblNoaXBwaW5nQWRkcmVzc0NoYW5nZShlKX0pKSxlLm9uKFAuU0hJUFBJTkdfUkFURV9DSEFOR0UsZT0+Vih0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uU2hpcHBpbmdSYXRlQ2hhbmdlKGUpfSkpKSxlLm9uKFAuQ09ORklSTSxlPT5WKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25Db25maXJtKGUsdCl9KSksZS5vbihQLkNBTkNFTCx0aGlzLl9vbkNhbmNlbCl9X29uU2hpcHBpbmdBZGRyZXNzQ2hhbmdlKGUpe3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcImFkZHJlc3NcImluIGUpe2NvbnN0IHQ9ZS5hZGRyZXNzLGk9e2ZpcnN0TmFtZTpcIlwiLGxhc3ROYW1lOlwiXCIscGhvbmU6XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6XCJcIixhZGRyZXNzMjpcIlwiLGNpdHk6KG51bGw9PXQ/dm9pZCAwOnQuY2l0eSl8fFwiXCIsY291bnRyeUNvZGU6KG51bGw9PXQ/dm9pZCAwOnQuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09dD92b2lkIDA6dC5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT10P3ZvaWQgMDp0LnN0YXRlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2VDb2RlOlwiXCIsY3VzdG9tRmllbGRzOltdfTt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlU2hpcHBpbmdBZGRyZXNzKGkpO2NvbnN0IG49eWllbGQgdGhpcy5fZ2V0QXZhaWxhYmxlU2hpcHBpbmdPcHRpb25zKCk7eWllbGQgdGhpcy5fdXBkYXRlRGlzcGxheWVkUHJpY2UoKSxlLnJlc29sdmUoe3NoaXBwaW5nUmF0ZXM6bn0pfX0pfV9vbkNhbmNlbCgpe3Rocm93IG5ldyBNfV9vblNoaXBwaW5nUmF0ZUNoYW5nZShlKXtyZXR1cm4gVih0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoXCJzaGlwcGluZ1JhdGVcImluIGUpe2NvbnN0e3NoaXBwaW5nUmF0ZTp0fT1lO3lpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PXQ/dm9pZCAwOnQuaWQpLHlpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksZS5yZXNvbHZlKHt9KX19KX1fb25Db25maXJtKGUsdCl7cmV0dXJuIFYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKFwiYmlsbGluZ0RldGFpbHNcImluIGUmJlwic2hpcHBpbmdBZGRyZXNzXCJpbiBlJiZ0aGlzLl9zdHJpcGVDbGllbnQmJnRoaXMuX3N0cmlwZUVsZW1lbnRzKXt5aWVsZCB0aGlzLl91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcigpO2NvbnN0IGk9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCk7dHJ5e3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KGkpfWNhdGNoKGUpe3lpZWxkIHRoaXMuX3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl9fXJldHVybiBQcm9taXNlLnJlc29sdmUoKX0pfV91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpe3ZhciB0LGksbixyLG8scyxhLGQ7cmV0dXJuIFYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IGw9dGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpLGM9KG51bGw9PT0oaT1udWxsPT09KHQ9ZS5zaGlwcGluZ0FkZHJlc3MpfHx2b2lkIDA9PT10P3ZvaWQgMDp0Lm5hbWUpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLnNwbGl0KFwiIFwiKVswXSl8fChudWxsPT09KHI9bnVsbD09PShuPWUuYmlsbGluZ0RldGFpbHMpfHx2b2lkIDA9PT1uP3ZvaWQgMDpuLm5hbWUpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLnNwbGl0KFwiIFwiKVswXSl8fFwiXCIsdT0obnVsbD09PShzPW51bGw9PT0obz1lLnNoaXBwaW5nQWRkcmVzcyl8fHZvaWQgMD09PW8/dm9pZCAwOm8ubmFtZSl8fHZvaWQgMD09PXM/dm9pZCAwOnMuc3BsaXQoXCIgXCIpWzFdKXx8KG51bGw9PT0oZD1udWxsPT09KGE9ZS5iaWxsaW5nRGV0YWlscyl8fHZvaWQgMD09PWE/dm9pZCAwOmEubmFtZSl8fHZvaWQgMD09PWQ/dm9pZCAwOmQuc3BsaXQoXCIgXCIpWzFdKXx8XCJcIjtpZihsKXtjb25zdCB0PXRoaXMuX21hcFNoaXBwaW5nQWRkcmVzcyhlLnNoaXBwaW5nQWRkcmVzcyxlLmJpbGxpbmdEZXRhaWxzLGMsdSk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVNoaXBwaW5nQWRkcmVzcyh0KX1jb25zdCBoPXRoaXMuX21hcEJpbGxpbmdBZGRyZXNzKGUuc2hpcHBpbmdBZGRyZXNzLGUuYmlsbGluZ0RldGFpbHMsYyx1KTt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlQmlsbGluZ0FkZHJlc3MoaCl9KX1fbWFwU2hpcHBpbmdBZGRyZXNzKGUsdCxpLG4pe3ZhciByLG8scyxhLGQsbCxjO3JldHVybntmaXJzdE5hbWU6aSxsYXN0TmFtZTpuLHBob25lOihudWxsPT10P3ZvaWQgMDp0LnBob25lKXx8XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6KG51bGw9PT0ocj1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmxpbmUxKXx8XCJcIixhZGRyZXNzMjoobnVsbD09PShvPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PW8/dm9pZCAwOm8ubGluZTIpfHxcIlwiLGNpdHk6KG51bGw9PT0ocz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1zP3ZvaWQgMDpzLmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT09KGE9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT09KGQ9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT09KGw9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09bD92b2lkIDA6bC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZToobnVsbD09PShjPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWM/dm9pZCAwOmMuc3RhdGUpfHxcIlwiLGN1c3RvbUZpZWxkczpbXX19X21hcEJpbGxpbmdBZGRyZXNzKGUsdCxpLG4pe3ZhciByLG8scyxhLGQsbDtyZXR1cm57ZW1haWw6KG51bGw9PXQ/dm9pZCAwOnQuZW1haWwpfHxcIlwiLGZpcnN0TmFtZTppLGxhc3ROYW1lOm4scGhvbmU6KG51bGw9PXQ/dm9pZCAwOnQucGhvbmUpfHxcIlwiLGNvbXBhbnk6XCJcIixhZGRyZXNzMToobnVsbD09PShyPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PXI/dm9pZCAwOnIubGluZTEpfHxcIlwiLGFkZHJlc3MyOlwiXCIsY2l0eToobnVsbD09PShvPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PW8/dm9pZCAwOm8uY2l0eSl8fFwiXCIsY291bnRyeUNvZGU6KG51bGw9PT0ocz1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1zP3ZvaWQgMDpzLmNvdW50cnkpfHxcIlwiLHBvc3RhbENvZGU6KG51bGw9PT0oYT1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLnBvc3RhbF9jb2RlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2U6KG51bGw9PT0oZD1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnN0YXRlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2VDb2RlOihudWxsPT09KGw9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09bD92b2lkIDA6bC5zdGF0ZSl8fFwiXCIsY3VzdG9tRmllbGRzOltdfX1fcHJvY2Vzc0FkZGl0aW9uYWxBY3Rpb24oZSx0KXtyZXR1cm4gVih0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIWooZSl8fCF0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pc0FkZGl0aW9uYWxBY3Rpb25FcnJvcihlLmJvZHkuZXJyb3JzKSl0aHJvdyBlO2lmKCF0aGlzLl9zdHJpcGVDbGllbnR8fCF0aGlzLl9zdHJpcGVFbGVtZW50cyl0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7ZGF0YTppfT1lLmJvZHkuYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWQse3Rva2VuOm59PWkse3BheW1lbnRJbnRlbnQ6cn09eWllbGQgdGhpcy5fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGksdCksbz10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LChudWxsPT1yP3ZvaWQgMDpyLmlkKXx8bik7dHJ5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITApLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG8pLHlpZWxkIHRoaXMuX2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX1maW5hbGx5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITEpfX0pfV9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coZSx0KXt2YXIgaSxuLHI7cmV0dXJuIFYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOm8scmVkaXJlY3RfdXJsOnN9PWUsYT10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLl9zdHJpcGVFbGVtZW50cyxzKTtsZXQgZDt0cnl7Y29uc3QgZT0oeWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNQYXltZW50Q29tcGxldGVkKHQsdGhpcy5fc3RyaXBlQ2xpZW50KSk/eWllbGQgbnVsbD09PShyPXRoaXMuX3N0cmlwZUNsaWVudCl8fHZvaWQgMD09PXI/dm9pZCAwOnIucmV0cmlldmVQYXltZW50SW50ZW50KG98fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNvbmZpcm1QYXltZW50KHtlbGVtZW50czphLmVsZW1lbnRzLGNsaWVudFNlY3JldDpvLHJlZGlyZWN0OkkuSUZfUkVRVUlSRUQsY29uZmlybVBhcmFtczp7cmV0dXJuX3VybDpudWxsPT09KG49YS5jb25maXJtUGFyYW1zKXx8dm9pZCAwPT09bj92b2lkIDA6bi5yZXR1cm5fdXJsfX0pO2lmKGQ9bnVsbD09ZT92b2lkIDA6ZS5lcnJvcixkfHwhKG51bGw9PWU/dm9pZCAwOmUucGF5bWVudEludGVudCkpdGhyb3cgbmV3IFQ7cmV0dXJuIGV9Y2F0Y2goZSl7cmV0dXJuIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3IoZCl9fSl9X2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl7cmV0dXJuIFYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3JldHVyblwiZnVuY3Rpb25cIj09dHlwZW9mIHRoaXMuX29uQ29tcGxldGU/dGhpcy5fb25Db21wbGV0ZSgpOih3aW5kb3cubG9jYXRpb24ucmVwbGFjZShcIi9vcmRlci1jb25maXJtYXRpb25cIiksUHJvbWlzZS5yZXNvbHZlKCkpfSl9X2dldFBheW1lbnRQYXlsb2FkKGUsdCl7dmFyIGk7Y29uc3Qgbj0obnVsbD09PShpPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnQoKSl8fHZvaWQgMD09PWk/dm9pZCAwOmkuaWQpfHxcIlwiO3JldHVybnttZXRob2RJZDplLHBheW1lbnREYXRhOntmb3JtYXR0ZWRQYXlsb2FkOk9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7Y2FydF9pZDpufSx0P3tjcmVkaXRfY2FyZF90b2tlbjp7dG9rZW46dH19Ont9KSx7Y29uZmlybTohMSxwYXltZW50X21ldGhvZF9pZDpmLkxpbmt9KX19fV9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCl7Y29uc3R7Z2V0Q2FydE9yVGhyb3c6ZX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2xpbmVJdGVtczp0fT1lKCk7cmV0dXJuISF0LnBoeXNpY2FsSXRlbXMubGVuZ3RofV91cGRhdGVEaXNwbGF5ZWRQcmljZSgpe3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt0aGlzLl9zdHJpcGVFbGVtZW50cyYmdGhpcy5fc3RyaXBlRWxlbWVudHMudXBkYXRlKHtjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpLG1vZGU6XCJwYXltZW50XCIsYW1vdW50OnlpZWxkIHRoaXMuX2dldFRvdGFsUHJpY2UoKX0pfSl9X2dldEN1cnJlbmN5KCl7aWYoIXRoaXMuX2N1cnJlbmN5Q29kZSl7Y29uc3R7Y29kZTplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0T3JUaHJvdygpLmN1cnJlbmN5O3RoaXMuX2N1cnJlbmN5Q29kZT1lLnRvTG93ZXJDYXNlKCl9cmV0dXJuIHRoaXMuX2N1cnJlbmN5Q29kZX1fZ2V0VG90YWxQcmljZSgpe3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZENoZWNrb3V0KCk7Y29uc3R7Z2V0Q2hlY2tvdXRPclRocm93OmUsZ2V0Q2FydE9yVGhyb3c6dH09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2RlY2ltYWxQbGFjZXM6aX09dCgpLmN1cnJlbmN5LG49cihlKCkub3V0c3RhbmRpbmdCYWxhbmNlLGkpLnRvRml4ZWQoaSk7cmV0dXJuIHRoaXMuX3RvQ2VudHMoK24pfSl9X2dldEF2YWlsYWJsZUNvdW50cmllcygpe3ZhciBlO3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkU2hpcHBpbmdDb3VudHJpZXMoKTtyZXR1cm4oKG51bGw9PT0oZT10LmdldFNoaXBwaW5nQ291bnRyaWVzKCkpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLm1hcChlPT5lLmNvZGUpKXx8W10pLmZpbHRlcihlPT5GLmluY2x1ZGVzKGUpKX0pfV9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKXt2YXIgZSx0O3JldHVybiBWKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBpPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENvbnNpZ25tZW50cygpO2lmKCEobnVsbD09aT92b2lkIDA6aVswXSkpcmV0dXJuO2NvbnN0IG49aVswXSxyPShuLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9uc3x8W10pLm1hcCh0aGlzLl9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbi5iaW5kKHRoaXMpKSxvPW51bGw9PT0oZT1uLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24pfHx2b2lkIDA9PT1lP3ZvaWQgMDplLmlkO3JldHVybiBvP3Iuc29ydChlPT5lLmlkPT09bz8tMTowKTp5aWVsZCB0aGlzLl9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShudWxsPT09KHQ9clswXSl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQpLHJ9KX1fZ2V0U3RyaXBlU2hpcHBpbmdPcHRpb24oe2lkOmUsY29zdDp0LGRlc2NyaXB0aW9uOml9KXtyZXR1cm57aWQ6ZSxkaXNwbGF5TmFtZTppLGFtb3VudDp0aGlzLl90b0NlbnRzKHQpfX1faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UoZSl7cmV0dXJuIFYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKGUmJlwic2hpcHBpbmdfb3B0aW9uX3Vuc2VsZWN0ZWRcIiE9PWUpcmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zZWxlY3RTaGlwcGluZ09wdGlvbihlKX0pfV9nZXRBbW91bnRUcmFuc2Zvcm1lcigpe2lmKHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyKXJldHVybiB0aGlzLl9hbW91bnRUcmFuc2Zvcm1lcjtjb25zdHtnZXRDYXJ0OmV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjdXJyZW5jeTp0fT1lKCl8fHt9O3JldHVybiB0P25ldyBCKHQuZGVjaW1hbFBsYWNlcyk6dm9pZCAwfV90b0NlbnRzKGUpe2NvbnN0IHQ9TWF0aC5yb3VuZCgxMDAqZSksaT10aGlzLl9nZXRBbW91bnRUcmFuc2Zvcm1lcigpO3JldHVybiBpP2kudG9JbnRlZ2VyKGUpOnR9X3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoZSl7ZSYmdGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcj90aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc2hvdyh0aGlzLl9sb2FkaW5nSW5kaWNhdG9yQ29udGFpbmVyKTp0aGlzLmxvYWRpbmdJbmRpY2F0b3IuaGlkZSgpfX1jb25zdCBIPWEodD0+e2NvbnN0IGk9bmV3IGgoZSgpKSxuPW5ldyB4KHtjb250YWluZXJTdHlsZXM6TH0pO3JldHVybiBuZXcgRyh0LGksbmV3IFIodCxpKSxuKX0sW3tpZDpcInN0cmlwZW9jc1wifV0pO3ZhciBxPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIFd7Y29uc3RydWN0b3IoZSx0LGksbil7dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlPWUsdGhpcy5zY3JpcHRMb2FkZXI9dCx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZT1pLHRoaXMubG9hZGluZ0luZGljYXRvcj1ufWluaXRpYWxpemUoZSl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3N0cmlwZW9jczp0LGNvbnRhaW5lcklkOml9PWV8fHt9O2lmKCF0fHwhaSl0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7bWV0aG9kSWQ6bixnYXRld2F5SWQ6cn09dDtpZighbnx8IXIpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3Qgbz15aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2Qocix7cGFyYW1zOnttZXRob2Q6bn19KSxzPW8uZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3cobixyKSx7bG9hZGluZ0NvbnRhaW5lcklkOmEsYnV0dG9uSGVpZ2h0OmQsb25Db21wbGV0ZTpsfT10O2lmKHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI9YSx0aGlzLl9vbkNvbXBsZXRlPWwsIXkocykpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7aW5pdGlhbGl6YXRpb25EYXRhOnV9PXMse2NhcHR1cmVNZXRob2Q6aH09dTtyZXR1cm4gdGhpcy5fY2FwdHVyZU1ldGhvZD1oLHRoaXMuX3N0cmlwZUNsaWVudD15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQodSxvLmdldENhcnRMb2NhbGUoKSkseWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWREZWZhdWx0Q2hlY2tvdXQoKSx5aWVsZCB0aGlzLl9tb3VudEV4cHJlc3NDaGVja291dEVsZW1lbnQobixpLHRoaXMuX3N0cmlwZUNsaWVudCxkKSxQcm9taXNlLnJlc29sdmUoKX0pfXNpZ25Jbigpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1zaWduT3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWV4ZWN1dGVQYXltZW50TWV0aG9kQ2hlY2tvdXQoKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9ZGVpbml0aWFsaXplKCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfV9tb3VudEV4cHJlc3NDaGVja291dEVsZW1lbnQoZSx0LGksbj00MCl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHI9dGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpLG89T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe3NoaXBwaW5nQWRkcmVzc1JlcXVpcmVkOnJ9LHI/e2FsbG93ZWRTaGlwcGluZ0NvdW50cmllczp5aWVsZCB0aGlzLl9nZXRBdmFpbGFibGVDb3VudHJpZXMoKX06e30pLHI/e3NoaXBwaW5nUmF0ZXM6W3tpZDpcIl9cIixhbW91bnQ6MCxkaXNwbGF5TmFtZTpcIlBlbmRpbmcgcmF0ZXNcIn1dfTp7fSkse2JpbGxpbmdBZGRyZXNzUmVxdWlyZWQ6ITAsZW1haWxSZXF1aXJlZDohMCxwaG9uZU51bWJlclJlcXVpcmVkOiEwLHBheW1lbnRNZXRob2RzOntsaW5rOkkuQVVUTyxhcHBsZVBheTpJLk5FVkVSLGdvb2dsZVBheTpJLk5FVkVSLGFtYXpvblBheTpJLk5FVkVSLHBheXBhbDpJLk5FVkVSLGtsYXJuYTpJLk5FVkVSfSxidXR0b25IZWlnaHQ6bn0pLHtjYXJ0QW1vdW50OnM9MX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpfHx7fSxhPU9iamVjdC5hc3NpZ24oe21vZGU6XCJwYXltZW50XCIsYW1vdW50OnRoaXMuX3RvQ2VudHMocyksY3VycmVuY3k6dGhpcy5fZ2V0Q3VycmVuY3koKX0sdGhpcy5fY2FwdHVyZU1ldGhvZD97Y2FwdHVyZU1ldGhvZDp0aGlzLl9jYXB0dXJlTWV0aG9kfTp7fSk7dGhpcy5fc3RyaXBlRWxlbWVudHM9aS5lbGVtZW50cyhhKSx0aGlzLl9saW5rVjJFbGVtZW50PXRoaXMuX3N0cmlwZUVsZW1lbnRzLmNyZWF0ZShDLkVYUFJFU1NfQ0hFQ0tPVVQsbyksdGhpcy5fbGlua1YyRWxlbWVudC5tb3VudChgIyR7dH1gKSx0aGlzLl9pbml0aWFsaXplRXZlbnRzKHRoaXMuX2xpbmtWMkVsZW1lbnQsZSl9KX1faW5pdGlhbGl6ZUV2ZW50cyhlLHQpe3RoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSYmKGUub24oUC5TSElQUElOR19BRERSRVNTX0NIQU5HRSxlPT5xKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25TaGlwcGluZ0FkZHJlc3NDaGFuZ2UoZSl9KSksZS5vbihQLlNISVBQSU5HX1JBVEVfQ0hBTkdFLGU9PnEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLl9vblNoaXBwaW5nUmF0ZUNoYW5nZShlKX0pKSksZS5vbihQLkNPTkZJUk0sZT0+cSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uQ29uZmlybShlLHQpfSkpLGUub24oUC5DQU5DRUwsdGhpcy5fb25DYW5jZWwpfV9vblNoaXBwaW5nQWRkcmVzc0NoYW5nZShlKXtyZXR1cm4gcSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoXCJhZGRyZXNzXCJpbiBlKXtjb25zdCB0PWUuYWRkcmVzcyxpPXtmaXJzdE5hbWU6XCJcIixsYXN0TmFtZTpcIlwiLHBob25lOlwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOlwiXCIsYWRkcmVzczI6XCJcIixjaXR5OihudWxsPT10P3ZvaWQgMDp0LmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT10P3ZvaWQgMDp0LmNvdW50cnkpfHxcIlwiLHBvc3RhbENvZGU6KG51bGw9PXQ/dm9pZCAwOnQucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09dD92b2lkIDA6dC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZTpcIlwiLGN1c3RvbUZpZWxkczpbXX07eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVNoaXBwaW5nQWRkcmVzcyhpKTtjb25zdCBuPXlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZVNoaXBwaW5nT3B0aW9ucygpO3lpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksZS5yZXNvbHZlKHtzaGlwcGluZ1JhdGVzOm59KX19KX1fb25DYW5jZWwoKXt0aHJvdyBuZXcgTX1fb25TaGlwcGluZ1JhdGVDaGFuZ2UoZSl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKFwic2hpcHBpbmdSYXRlXCJpbiBlKXtjb25zdHtzaGlwcGluZ1JhdGU6dH09ZTt5aWVsZCB0aGlzLl9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShudWxsPT10P3ZvaWQgMDp0LmlkKSx5aWVsZCB0aGlzLl91cGRhdGVEaXNwbGF5ZWRQcmljZSgpLGUucmVzb2x2ZSh7fSl9fSl9X29uQ29uZmlybShlLHQpe3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcImJpbGxpbmdEZXRhaWxzXCJpbiBlJiZcInNoaXBwaW5nQWRkcmVzc1wiaW4gZSYmdGhpcy5fc3RyaXBlQ2xpZW50JiZ0aGlzLl9zdHJpcGVFbGVtZW50cyl7eWllbGQgdGhpcy5fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKSx5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoKTtjb25zdCBpPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChpKX1jYXRjaChlKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQpfX1yZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9KX1fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKXt2YXIgdCxpLG4scixvLHMsYSxkO3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBsPXRoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSxjPShudWxsPT09KGk9bnVsbD09PSh0PWUuc2hpcHBpbmdBZGRyZXNzKXx8dm9pZCAwPT09dD92b2lkIDA6dC5uYW1lKXx8dm9pZCAwPT09aT92b2lkIDA6aS5zcGxpdChcIiBcIilbMF0pfHwobnVsbD09PShyPW51bGw9PT0obj1lLmJpbGxpbmdEZXRhaWxzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5uYW1lKXx8dm9pZCAwPT09cj92b2lkIDA6ci5zcGxpdChcIiBcIilbMF0pfHxcIlwiLHU9KG51bGw9PT0ocz1udWxsPT09KG89ZS5zaGlwcGluZ0FkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLm5hbWUpfHx2b2lkIDA9PT1zP3ZvaWQgMDpzLnNwbGl0KFwiIFwiKVsxXSl8fChudWxsPT09KGQ9bnVsbD09PShhPWUuYmlsbGluZ0RldGFpbHMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLm5hbWUpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnNwbGl0KFwiIFwiKVsxXSl8fFwiXCI7aWYobCl7Y29uc3QgdD10aGlzLl9tYXBTaGlwcGluZ0FkZHJlc3MoZS5zaGlwcGluZ0FkZHJlc3MsZS5iaWxsaW5nRGV0YWlscyxjLHUpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVTaGlwcGluZ0FkZHJlc3ModCl9Y29uc3QgaD10aGlzLl9tYXBCaWxsaW5nQWRkcmVzcyhlLnNoaXBwaW5nQWRkcmVzcyxlLmJpbGxpbmdEZXRhaWxzLGMsdSk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZUJpbGxpbmdBZGRyZXNzKGgpfSl9X21hcFNoaXBwaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGwsYztyZXR1cm57Zmlyc3ROYW1lOmksbGFzdE5hbWU6bixwaG9uZToobnVsbD09dD92b2lkIDA6dC5waG9uZSl8fFwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOihudWxsPT09KHI9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cj92b2lkIDA6ci5saW5lMSl8fFwiXCIsYWRkcmVzczI6KG51bGw9PT0obz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmxpbmUyKXx8XCJcIixjaXR5OihudWxsPT09KHM9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09PShhPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWE/dm9pZCAwOmEuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09PShkPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWQ/dm9pZCAwOmQucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PT0oYz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1jP3ZvaWQgMDpjLnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119fV9tYXBCaWxsaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGw7cmV0dXJue2VtYWlsOihudWxsPT10P3ZvaWQgMDp0LmVtYWlsKXx8XCJcIixmaXJzdE5hbWU6aSxsYXN0TmFtZTpuLHBob25lOihudWxsPT10P3ZvaWQgMDp0LnBob25lKXx8XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6KG51bGw9PT0ocj1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmxpbmUxKXx8XCJcIixhZGRyZXNzMjpcIlwiLGNpdHk6KG51bGw9PT0obz1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT09KHM9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT09KGE9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT09KGQ9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLGN1c3RvbUZpZWxkczpbXX19X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCFqKGUpfHwhdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNBZGRpdGlvbmFsQWN0aW9uRXJyb3IoZS5ib2R5LmVycm9ycykpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e2RhdGE6aX09ZS5ib2R5LmFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkLHt0b2tlbjpufT1pLHtwYXltZW50SW50ZW50OnJ9PXlpZWxkIHRoaXMuX2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyhpLHQpLG89dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCwobnVsbD09cj92b2lkIDA6ci5pZCl8fG4pO3RyeXt0aGlzLl90b2dnbGVMb2FkaW5nSW5kaWNhdG9yKCEwKSx5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChvKSx5aWVsZCB0aGlzLl9jb21wbGV0ZUNoZWNrb3V0RmxvdygpfWNhdGNoKGUpe3RoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93UGF5bWVudENvbmZpcm1hdGlvblByb2NlZWRNZXNzYWdlKCl9ZmluYWxseXt0aGlzLl90b2dnbGVMb2FkaW5nSW5kaWNhdG9yKCExKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbixyO3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHt0b2tlbjpvLHJlZGlyZWN0X3VybDpzfT1lLGE9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubWFwU3RyaXBlUGF5bWVudERhdGEodGhpcy5fc3RyaXBlRWxlbWVudHMscyk7bGV0IGQ7dHJ5e2NvbnN0IGU9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZCh0LHRoaXMuX3N0cmlwZUNsaWVudCkpP3lpZWxkIG51bGw9PT0ocj10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLnJldHJpZXZlUGF5bWVudEludGVudChvfHxcIlwiKTp5aWVsZCBudWxsPT09KGk9dGhpcy5fc3RyaXBlQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudCh7ZWxlbWVudHM6YS5lbGVtZW50cyxjbGllbnRTZWNyZXQ6byxyZWRpcmVjdDpJLklGX1JFUVVJUkVELGNvbmZpcm1QYXJhbXM6e3JldHVybl91cmw6bnVsbD09PShuPWEuY29uZmlybVBhcmFtcyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0dXJuX3VybH19KTtpZihkPW51bGw9PWU/dm9pZCAwOmUuZXJyb3IsZHx8IShudWxsPT1lP3ZvaWQgMDplLnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBUO3JldHVybiBlfWNhdGNoKGUpe3JldHVybiB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1N0cmlwZUVycm9yKGQpfX0pfV9jb21wbGV0ZUNoZWNrb3V0Rmxvdygpe3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm5cImZ1bmN0aW9uXCI9PXR5cGVvZiB0aGlzLl9vbkNvbXBsZXRlP3RoaXMuX29uQ29tcGxldGUoKTood2luZG93LmxvY2F0aW9uLnJlcGxhY2UoXCIvY2hlY2tvdXQvb3JkZXItY29uZmlybWF0aW9uXCIpLFByb21pc2UucmVzb2x2ZSgpKX0pfV9nZXRQYXltZW50UGF5bG9hZChlLHQpe3ZhciBpO2NvbnN0IG49KG51bGw9PT0oaT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCkpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmlkKXx8XCJcIjtyZXR1cm57bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTp7Zm9ybWF0dGVkUGF5bG9hZDpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe2NhcnRfaWQ6bn0sdD97Y3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOnR9fTp7fSkse2NvbmZpcm06ITEscGF5bWVudF9tZXRob2RfaWQ6Zi5MaW5rfSl9fX1fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpe2NvbnN0e2dldENhcnQ6ZX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2xpbmVJdGVtczp0fT1lKCl8fHt9O3JldHVybiEhKG51bGw9PXQ/dm9pZCAwOnQucGh5c2ljYWxJdGVtcy5sZW5ndGgpfV91cGRhdGVEaXNwbGF5ZWRQcmljZSgpe3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt0aGlzLl9zdHJpcGVFbGVtZW50cyYmdGhpcy5fc3RyaXBlRWxlbWVudHMudXBkYXRlKHtjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpLG1vZGU6XCJwYXltZW50XCIsYW1vdW50OnlpZWxkIHRoaXMuX2dldFRvdGFsUHJpY2UoKX0pfSl9X2dldEN1cnJlbmN5KCl7dmFyIGU7aWYoIXRoaXMuX2N1cnJlbmN5Q29kZSl7Y29uc3QgdD1udWxsPT09KGU9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5jdXJyZW5jeTt0JiYodGhpcy5fY3VycmVuY3lDb2RlPXQuY29kZS50b0xvd2VyQ2FzZSgpKX1yZXR1cm4gdGhpcy5fY3VycmVuY3lDb2RlfV9nZXRUb3RhbFByaWNlKCl7dmFyIGU7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkQ2hlY2tvdXQoKTtjb25zdHtnZXRDaGVja291dE9yVGhyb3c6dCxnZXRDYXJ0Oml9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtkZWNpbWFsUGxhY2VzOm59PShudWxsPT09KGU9aSgpKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5jdXJyZW5jeSl8fHt9LG89cih0KCkub3V0c3RhbmRpbmdCYWxhbmNlLG4pLnRvRml4ZWQobik7cmV0dXJuIHRoaXMuX3RvQ2VudHMoK28pfSl9X2dldEF2YWlsYWJsZUNvdW50cmllcygpe3ZhciBlO3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkU2hpcHBpbmdDb3VudHJpZXMoKTtyZXR1cm4oKG51bGw9PT0oZT10LmdldFNoaXBwaW5nQ291bnRyaWVzKCkpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLm1hcChlPT5lLmNvZGUpKXx8W10pLmZpbHRlcihlPT5GLmluY2x1ZGVzKGUpKX0pfV9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKXt2YXIgZSx0O3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBpPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENvbnNpZ25tZW50cygpO2lmKCEobnVsbD09aT92b2lkIDA6aVswXSkpcmV0dXJuO2NvbnN0IG49aVswXSxyPShuLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9uc3x8W10pLm1hcCh0aGlzLl9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbi5iaW5kKHRoaXMpKSxvPW51bGw9PT0oZT1uLnNlbGVjdGVkU2hpcHBpbmdPcHRpb24pfHx2b2lkIDA9PT1lP3ZvaWQgMDplLmlkO3JldHVybiBvP3Iuc29ydChlPT5lLmlkPT09bz8tMTowKTp5aWVsZCB0aGlzLl9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShudWxsPT09KHQ9clswXSl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQpLHJ9KX1fZ2V0U3RyaXBlU2hpcHBpbmdPcHRpb24oe2lkOmUsY29zdDp0LGRlc2NyaXB0aW9uOml9KXtyZXR1cm57aWQ6ZSxkaXNwbGF5TmFtZTppLGFtb3VudDp0aGlzLl90b0NlbnRzKHQpfX1faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UoZSl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKGUmJlwic2hpcHBpbmdfb3B0aW9uX3Vuc2VsZWN0ZWRcIiE9PWUpcmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zZWxlY3RTaGlwcGluZ09wdGlvbihlKX0pfV9nZXRBbW91bnRUcmFuc2Zvcm1lcigpe2lmKHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyKXJldHVybiB0aGlzLl9hbW91bnRUcmFuc2Zvcm1lcjtjb25zdHtnZXRDYXJ0OmV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjdXJyZW5jeTp0fT1lKCl8fHt9O3JldHVybiB0P25ldyBCKHQuZGVjaW1hbFBsYWNlcyk6dm9pZCAwfV90b0NlbnRzKGUpe2NvbnN0IHQ9TWF0aC5yb3VuZCgxMDAqZSksaT10aGlzLl9nZXRBbW91bnRUcmFuc2Zvcm1lcigpO3JldHVybiBpP2kudG9JbnRlZ2VyKGUpOnR9X3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoZSl7ZSYmdGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcj90aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc2hvdyh0aGlzLl9sb2FkaW5nSW5kaWNhdG9yQ29udGFpbmVyKTp0aGlzLmxvYWRpbmdJbmRpY2F0b3IuaGlkZSgpfX1jb25zdCBZPWEodD0+e2NvbnN0IGk9bmV3IGgoZSgpKSxuPW5ldyB4KHtjb250YWluZXJTdHlsZXM6TH0pO3JldHVybiBuZXcgVyh0LGksbmV3IFIodCxpKSxuKX0sW3tpZDpcInN0cmlwZW9jc1wifV0pO2NsYXNzIEsgZXh0ZW5kcyBwe2NvbnN0cnVjdG9yKGUpe2xldCB0PVwiVW5hYmxlIHRvIHN1Ym1pdCBwYXltZW50IGZvciB0aGUgb3JkZXIgYmVjYXVzZSB0aGUgcGF5bG9hZCBpcyBpbnZhbGlkLlwiO2UmJih0PWAke3R9IE1ha2Ugc3VyZSB0aGUgZm9sbG93aW5nIGZpZWxkcyBhcmUgcHJvdmlkZWQgY29ycmVjdGx5OiAke2Uuam9pbihcIiwgXCIpfS5gKSxzdXBlcih0KSx0aGlzLm5hbWU9XCJQYXltZW50QXJndW1lbnRJbnZhbGlkRXJyb3JcIn19ZnVuY3Rpb24gJChlKXtyZXR1cm4hKFwib2JqZWN0XCIhPXR5cGVvZiBlfHxudWxsPT09ZXx8dm9pZCAwIT09ZS5zaG91bGRTYXZlSW5zdHJ1bWVudCYmXCJib29sZWFuXCIhPXR5cGVvZiBlLnNob3VsZFNhdmVJbnN0cnVtZW50fHx2b2lkIDAhPT1lLnNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQmJlwiYm9vbGVhblwiIT10eXBlb2YgZS5zaG91bGRTZXRBc0RlZmF1bHRJbnN0cnVtZW50KX1mdW5jdGlvbiBKKGUpe3JldHVybiBCb29sZWFuKGUuaW5zdHJ1bWVudElkKX1jbGFzcyBaIGV4dGVuZHMgZHtjb25zdHJ1Y3Rvcigpe3N1cGVyKFwiVGhlIGN1cnJlbnQgb3JkZXIgZG9lcyBub3QgbmVlZCB0byBiZSBmaW5hbGl6ZWQgYXQgdGhpcyBzdGFnZS5cIiksdGhpcy5uYW1lPVwiT3JkZXJGaW5hbGl6YXRpb25Ob3RSZXF1aXJlZEVycm9yXCIsdGhpcy50eXBlPVwib3JkZXJfZmluYWxpemF0aW9uX25vdF9yZXF1aXJlZFwifX1mdW5jdGlvbiBRKGUpe3JldHVybiBudWxsIT09ZSYmXCJvYmplY3RcIj09dHlwZW9mIGUmJlwiY2FyZE51bWJlckVsZW1lbnRPcHRpb25zXCJpbiBlJiZcImNhcmRDdmNFbGVtZW50T3B0aW9uc1wiaW4gZSYmXCJjYXJkRXhwaXJ5RWxlbWVudE9wdGlvbnNcImluIGUmJnZvaWQgMCE9PWUuY2FyZE51bWJlckVsZW1lbnRPcHRpb25zJiZ2b2lkIDAhPT1lLmNhcmRDdmNFbGVtZW50T3B0aW9ucyYmdm9pZCAwIT09ZS5jYXJkRXhwaXJ5RWxlbWVudE9wdGlvbnN9dmFyIFgsZWUsdGUsaWU7IWZ1bmN0aW9uKGUpe2UuU29saWQ9XCJzb2xpZFwiLGUuRGVmYXVsdD1cImRlZmF1bHRcIn0oWHx8KFg9e30pKSxmdW5jdGlvbihlKXtlLkFsaXBheT1cImFsaXBheVwiLGUuQ2FyZEN2Yz1cImNhcmRDdmNcIixlLkNhcmRFeHBpcnk9XCJjYXJkRXhwaXJ5XCIsZS5DYXJkTnVtYmVyPVwiY2FyZE51bWJlclwiLGUuQ3JlZGl0Q2FyZD1cImNhcmRcIixlLklERUFMPVwiaWRlYWxCYW5rXCIsZS5TZXBhPVwiaWJhblwifShlZXx8KGVlPXt9KSksZnVuY3Rpb24oZSl7ZS5BbGlwYXk9XCJhbGlwYXlcIixlLkNyZWRpdENhcmQ9XCJjYXJkXCIsZS5JREVBTD1cImlkZWFsXCIsZS5TZXBhPVwic2VwYV9kZWJpdFwifSh0ZXx8KHRlPXt9KSksZnVuY3Rpb24oZSl7ZS5BdXRoRmFpbHVyZT1cImF1dGhfZmFpbHVyZVwifShpZXx8KGllPXt9KSk7Y2xhc3MgbmUgZXh0ZW5kcyBke2NvbnN0cnVjdG9yKGUpe3N1cGVyKGU9PT1pZS5BdXRoRmFpbHVyZT9cIlVzZXIgZGlkIG5vdCBhdXRoZW50aWNhdGVcIjpcIlRoZXJlIHdhcyBhbiBlcnJvciB3aGlsZSBwcm9jZXNzaW5nIHlvdXIgcGF5bWVudC4gUGxlYXNlIHRyeSBhZ2FpbiBvciBjb250YWN0IHVzLlwiKSx0aGlzLnR5cGU9XCJzdHJpcGV2M19lcnJvclwiLHRoaXMuc3VidHlwZT1lfX12YXIgcmU9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y29uc3Qgb2U9W2VlLkFsaXBheSxlZS5JREVBTF07Y2xhc3Mgc2V7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10fWluaXRpYWxpemUoZSl7cmV0dXJuIHJlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGV2Mzp0LG1ldGhvZElkOmksZ2F0ZXdheUlkOm59PWU7aWYoIW4pdGhyb3cgbmV3IHAoJ1VuYWJsZSB0byBpbml0aWFsaXplIHBheW1lbnQgYmVjYXVzZSBcImdhdGV3YXlJZFwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTt0aGlzLmluaXRpYWxpemVPcHRpb25zPXQsdGhpcy5pc0RlaW5pdGlhbGl6ZT0hMTtjb25zdCByPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFBheW1lbnRNZXRob2RPclRocm93KGkpLHtpbml0aWFsaXphdGlvbkRhdGE6e3N0cmlwZVB1Ymxpc2hhYmxlS2V5Om8sc3RyaXBlQ29ubmVjdGVkQWNjb3VudDpzLHVzZUluZGl2aWR1YWxDYXJkRmllbGRzOmEsYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50czpkfX09cjt0aGlzLl9hbGxvd1JlZGlzcGxheUZvclN0b3JlZEluc3RydW1lbnRzPWQ7Y29uc3QgbD10aGlzLmdldEluaXRpYWxpemVPcHRpb25zKCkuZm9ybTt0aGlzLnVzZUluZGl2aWR1YWxDYXJkRmllbGRzPWEsdGhpcy5zdHJpcGVWM0NsaWVudD15aWVsZCB0aGlzLmxvYWRTdHJpcGVKcyhvLHMpLHRoaXMuaXNDcmVkaXRDYXJkKGkpJiZ0aGlzLnNob3VsZFNob3dUU1ZIb3N0ZWRGb3JtKGksbikmJmw/dGhpcy5ob3N0ZWRGb3JtPXlpZWxkIHRoaXMubW91bnRDYXJkVmVyaWZpY2F0aW9uRmllbGRzKGwpOnRoaXMuc3RyaXBlRWxlbWVudD15aWVsZCB0aGlzLm1vdW50Q2FyZEZpZWxkcyhpKX0pfWV4ZWN1dGUoZSxpKXt2YXIgbixyO3JldHVybiByZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7cGF5bWVudDpvfT1lLHM9ZnVuY3Rpb24oZSx0KXt2YXIgaT17fTtmb3IodmFyIG4gaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxuKSYmdC5pbmRleE9mKG4pPDAmJihpW25dPWVbbl0pO2lmKG51bGwhPWUmJlwiZnVuY3Rpb25cIj09dHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciByPTA7Zm9yKG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtyPG4ubGVuZ3RoO3IrKyl0LmluZGV4T2YobltyXSk8MCYmT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUsbltyXSkmJihpW25bcl1dPWVbbltyXV0pfXJldHVybiBpfShlLFtcInBheW1lbnRcIl0pO2xldCBhLGQ7aWYoIW98fCFvLnBheW1lbnREYXRhKXRocm93IG5ldyBLKFtcInBheW1lbnQucGF5bWVudERhdGFcIl0pO2NvbnN0e3BheW1lbnREYXRhOmwsZ2F0ZXdheUlkOnUsbWV0aG9kSWQ6aH09byx7c2hvdWxkU2F2ZUluc3RydW1lbnQ6cCxzaG91bGRTZXRBc0RlZmF1bHRJbnN0cnVtZW50Onl9PSQobCk/bDp7c2hvdWxkU2F2ZUluc3RydW1lbnQ6ITEsc2hvdWxkU2V0QXNEZWZhdWx0SW5zdHJ1bWVudDohMX0sZz10KG9lLGgpLHtpc1N0b3JlQ3JlZGl0QXBwbGllZDp2fT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDaGVja291dE9yVGhyb3coKTt2JiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmFwcGx5U3RvcmVDcmVkaXQodikpO3RyeXtnJiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdE9yZGVyKHMsaSkpLHUmJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2QodSx7cGFyYW1zOnttZXRob2Q6aH19KSk7Y29uc3QgZT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKTtpZihKKGwpKXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIocyxpKTtjb25zdHtpbnN0cnVtZW50SWQ6dH09bCxuPWUuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coby5tZXRob2RJZCkuY2xpZW50VG9rZW47aWYoIW4pdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7cmV0dXJuIHlpZWxkIHRoaXMuZXhlY3V0ZVdpdGhWYXVsdGVkKG8sdCx5LG4pfWNvbnN0IHQ9ZS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhoKSx2PXlpZWxkIHRoaXMuY29uZmlybVN0cmlwZVBheW1lbnQodCkse2NsaWVudFRva2VuOlMsbWV0aG9kOl99PXQse2lkOmZ9PW51bGwhPT0ocj1udWxsIT09KG49di5wYXltZW50SW50ZW50KSYmdm9pZCAwIT09bj9uOnYucGF5bWVudE1ldGhvZCkmJnZvaWQgMCE9PXI/cjp7aWQ6XCJcIn07ZD12LmVycm9yLGE9e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjpmfSx2YXVsdF9wYXltZW50X2luc3RydW1lbnQ6cCxjb25maXJtOiExLHNldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50Onl9LF89PT1lZS5DcmVkaXRDYXJkJiYoYS5jbGllbnRfdG9rZW49UyksZ3x8KHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcihzLGkpKTtjb25zdCBJPXRoaXMuYnVpbGRQYXltZW50UGF5bG9hZChoLGEseSk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoSSl9Y2F0Y2goZSl7eWllbGQgdGhpcy5wcm9jZXNzQWRkaXRpb25hbEFjdGlvbih0aGlzLmhhbmRsZUVtcHR5UGF5bWVudEludGVudEVycm9yKGUsZCksaCxwLHkpfX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBaKX1kZWluaXRpYWxpemUoKXtyZXR1cm4gdGhpcy5ob3N0ZWRGb3JtJiZ0aGlzLmhvc3RlZEZvcm0uZGV0YWNoKCksdGhpcy5pc0RlaW5pdGlhbGl6ZT0hMCx0aGlzLnVubW91bnRFbGVtZW50KCksUHJvbWlzZS5yZXNvbHZlKCl9YnVpbGRQYXltZW50UGF5bG9hZChlLHQsaSl7cmV0dXJue21ldGhvZElkOmUscGF5bWVudERhdGE6aT97Zm9ybWF0dGVkUGF5bG9hZDpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sdCkse3NldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50Oml9KX06e2Zvcm1hdHRlZFBheWxvYWQ6dH19fWlzQ2FuY2VsbGF0aW9uRXJyb3IoZSl7dmFyIHQsaTtyZXR1cm4gZSYmLTEhPT0obnVsbD09PShpPW51bGw9PT0odD1lLnBheW1lbnRfaW50ZW50Lmxhc3RfcGF5bWVudF9lcnJvcil8fHZvaWQgMD09PXQ/dm9pZCAwOnQubWVzc2FnZSl8fHZvaWQgMD09PWk/dm9pZCAwOmkuaW5kZXhPZihcImNhbmNlbGVkXCIpKX1pc0F1dGhFcnJvcihlKXtyZXR1cm5cInBheW1lbnRfaW50ZW50X2F1dGhlbnRpY2F0aW9uX2ZhaWx1cmVcIj09PShudWxsPT1lP3ZvaWQgMDplLmNvZGUpfWlzQ3JlZGl0Q2FyZChlKXtyZXR1cm4gZT09PXRlLkNyZWRpdENhcmR9aXNIb3N0ZWRGaWVsZEF2YWlsYWJsZSgpe3ZhciBlO2NvbnN0IHQ9dGhpcy5nZXRJbml0aWFsaXplT3B0aW9ucygpLHI9bihudWxsPT09KGU9dC5mb3JtKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5maWVsZHMsaSk7cmV0dXJuIWkocil9aXNIb3N0ZWRQYXltZW50Rm9ybUVuYWJsZWQoZSx0KXtjb25zdHtnZXRQYXltZW50TWV0aG9kT3JUaHJvdzppfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxuPWkoZSx0KTtyZXR1cm4gQm9vbGVhbihuLmNvbmZpZy5pc0hvc3RlZEZvcm1FbmFibGVkKX1jb25maXJtU3RyaXBlUGF5bWVudChlKXtyZXR1cm4gcmUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e2NsaWVudFRva2VuOnQsbWV0aG9kOmkscmV0dXJuVXJsOm59PWU7aWYoIXQpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7c3dpdGNoKGkpe2Nhc2UgZWUuQWxpcGF5OnJldHVybiB0aGlzLmdldFN0cmlwZUpzKCkuY29uZmlybUFsaXBheVBheW1lbnQodCx7cmV0dXJuX3VybDpufSx7aGFuZGxlQWN0aW9uczohMX0pO2Nhc2UgZWUuSURFQUw6e2NvbnN0IGU9dGhpcy5tYXBTdHJpcGVQYXltZW50RGF0YSh0ZS5JREVBTCxuKTtyZXR1cm4gdGhpcy5nZXRTdHJpcGVKcygpLmNvbmZpcm1JZGVhbFBheW1lbnQodCxlLHtoYW5kbGVBY3Rpb25zOiExfSl9Y2FzZSBlZS5TZXBhOntjb25zdCBlPXRoaXMubWFwU3RyaXBlUGF5bWVudERhdGEodGUuU2VwYSk7cmV0dXJuIHRoaXMuZ2V0U3RyaXBlSnMoKS5jb25maXJtU2VwYURlYml0UGF5bWVudCh0LGUpfWRlZmF1bHQ6e2NvbnN0IGU9dGhpcy51c2VJbmRpdmlkdWFsQ2FyZEZpZWxkcz90aGlzLmdldFN0cmlwZUNhcmRFbGVtZW50cygpWzBdOnRoaXMuZ2V0U3RyaXBlRWxlbWVudCgpLHQ9dGhpcy5tYXBTdHJpcGVCaWxsaW5nRGV0YWlscyh0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRCaWxsaW5nQWRkcmVzcygpLHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEN1c3RvbWVyKCkpLGk9dGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cztyZXR1cm4gdGhpcy5nZXRTdHJpcGVKcygpLmNyZWF0ZVBheW1lbnRNZXRob2QoT2JqZWN0LmFzc2lnbih7dHlwZTp0ZS5DcmVkaXRDYXJkLGNhcmQ6ZSxiaWxsaW5nX2RldGFpbHM6dH0saT97YWxsb3dfcmVkaXNwbGF5OlwiYWx3YXlzXCJ9Ont9KSl9fX0pfWV4ZWN1dGVXaXRoVmF1bHRlZChlLHQsaSxuKXt2YXIgcjtyZXR1cm4gcmUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IG89e2JpZ3BheV90b2tlbjp7dG9rZW46dH0sY29uZmlybTohMCxjbGllbnRfdG9rZW46bixzZXRfYXNfZGVmYXVsdF9zdG9yZWRfaW5zdHJ1bWVudDppfTtpZih0aGlzLmlzSG9zdGVkUGF5bWVudEZvcm1FbmFibGVkKGUubWV0aG9kSWQsZS5nYXRld2F5SWQpJiZ0aGlzLmhvc3RlZEZvcm0pe2NvbnN0IHQ9dGhpcy5ob3N0ZWRGb3JtO3JldHVybiBlLnBheW1lbnREYXRhJiZKKGUucGF5bWVudERhdGEpJiYoZS5wYXltZW50RGF0YT1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sZS5wYXltZW50RGF0YSkse2luc3RydW1lbnRJZDpKU09OLnN0cmluZ2lmeSh7dG9rZW46KG51bGw9PT0ocj1lLnBheW1lbnREYXRhKXx8dm9pZCAwPT09cj92b2lkIDA6ci5pbnN0cnVtZW50SWQpfHxcIlwiLGNsaWVudF90b2tlbjpufSl9KSkseWllbGQgdC52YWxpZGF0ZSgpLHlpZWxkIHQuc3VibWl0KGUpLHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkQ3VycmVudE9yZGVyKCl9Y29uc3Qgcz10aGlzLmJ1aWxkUGF5bWVudFBheWxvYWQoZS5tZXRob2RJZCxvLGkpO3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChzKX0pfWdldEluaXRpYWxpemVPcHRpb25zKCl7aWYoIXRoaXMuaW5pdGlhbGl6ZU9wdGlvbnMpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO3JldHVybiB0aGlzLmluaXRpYWxpemVPcHRpb25zfWdldFN0cmlwZUNhcmRFbGVtZW50cygpe2lmKCF0aGlzLnN0cmlwZUNhcmRFbGVtZW50cyl0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7cmV0dXJuIHRoaXMuc3RyaXBlQ2FyZEVsZW1lbnRzfWdldFN0cmlwZUVsZW1lbnQoKXtpZighdGhpcy5zdHJpcGVFbGVtZW50KXRocm93IG5ldyBrKE4uUGF5bWVudE5vdEluaXRpYWxpemVkKTtyZXR1cm4gdGhpcy5zdHJpcGVFbGVtZW50fWdldFN0cmlwZUpzKCl7aWYoIXRoaXMuc3RyaXBlVjNDbGllbnQpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO3JldHVybiB0aGlzLnN0cmlwZVYzQ2xpZW50fWhhbmRsZUVtcHR5UGF5bWVudEludGVudEVycm9yKGUsdCl7cmV0dXJuIGooZSkmJm8oZS5ib2R5LmVycm9ycyx7Y29kZTpcInJlcXVpcmVkX2ZpZWxkXCJ9KSYmdD9uZXcgRXJyb3IodC5tZXNzYWdlKTplfWxvYWRTdHJpcGVKcyhlLHQpe3JldHVybiByZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuc3RyaXBlVjNDbGllbnQ/UHJvbWlzZS5yZXNvbHZlKHRoaXMuc3RyaXBlVjNDbGllbnQpOnRoaXMuc2NyaXB0TG9hZGVyLmxvYWQoZSx0LHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldExvY2FsZSgpKX0pfW1hcFN0cmlwZUFkZHJlc3MoZSl7aWYoZSl7Y29uc3R7Y2l0eTp0LGNvdW50cnlDb2RlOmksYWRkcmVzczE6bixhZGRyZXNzMjpyLHBvc3RhbENvZGU6byxzdGF0ZU9yUHJvdmluY2VDb2RlOnN9PWU7cmV0dXJue2NpdHk6dCxjb3VudHJ5OmksbGluZTE6bixsaW5lMjpyLHBvc3RhbF9jb2RlOm8sc3RhdGU6c319cmV0dXJue2xpbmUxOlwiXCJ9fW1hcFN0cmlwZUJpbGxpbmdEZXRhaWxzKGUsdCl7Y29uc3R7Zmlyc3ROYW1lOmksbGFzdE5hbWU6bn09ZXx8dHx8e2ZpcnN0TmFtZTpcIkd1ZXN0XCIsbGFzdE5hbWU6XCJcIn0scj1gJHtpfSAke259YC50cmltKCkse29wdGlvbnM6b309dGhpcy5nZXRJbml0aWFsaXplT3B0aW9ucygpO2lmKHRoaXMudXNlSW5kaXZpZHVhbENhcmRGaWVsZHMmJlEobykpe2NvbnN0e3ppcENvZGVFbGVtZW50T3B0aW9uczp0fT1vO2lmKHQpe2NvbnN0IGk9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodC5jb250YWluZXJJZCk/ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodC5jb250YWluZXJJZCkudmFsdWU6XCJcIjtpJiZlJiYoZT1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sZSkse3Bvc3RhbENvZGU6aX0pKX19Y29uc3Qgcz17YWRkcmVzczp0aGlzLm1hcFN0cmlwZUFkZHJlc3MoZSl9O2lmKHQmJnQuYWRkcmVzc2VzWzBdJiZmdW5jdGlvbihlKXtyZXR1cm5cIm9iamVjdFwiPT10eXBlb2YgZSYmbnVsbCE9PWUmJlwiaWRcImluIGUmJnZvaWQgMCE9PWUuaWR9KHQuYWRkcmVzc2VzWzBdKSl7Y29uc3QgZT10LmFkZHJlc3Nlc1swXSx7ZW1haWw6aX09dCx7cGhvbmU6bn09ZTtyZXR1cm4gbj9PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOmksbmFtZTpyLHBob25lOm59KTpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOmksbmFtZTpyfSl9aWYoZSl7Y29uc3R7ZW1haWw6dCxwaG9uZTppfT1lO3JldHVybiBpP09iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxzKSx7ZW1haWw6dCxuYW1lOnIscGhvbmU6aX0pOk9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxzKSx7ZW1haWw6dCxuYW1lOnJ9KX1yZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHMpLHtuYW1lOnJ9KX1tYXBTdHJpcGVQYXltZW50RGF0YShlLHQpe2NvbnN0IGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q3VzdG9tZXIoKSxuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEJpbGxpbmdBZGRyZXNzKCkscj17cGF5bWVudF9tZXRob2Q6e1tlXTp0aGlzLmdldFN0cmlwZUVsZW1lbnQoKSxiaWxsaW5nX2RldGFpbHM6dGhpcy5tYXBTdHJpcGVCaWxsaW5nRGV0YWlscyhuLGkpfX07cmV0dXJuIGU9PT10ZS5JREVBTD9PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JldHVybl91cmw6dH0pOnJ9bW91bnRDYXJkRmllbGRzKGUpe2NvbnN0e29wdGlvbnM6dCxjb250YWluZXJJZDppfT10aGlzLmdldEluaXRpYWxpemVPcHRpb25zKCk7bGV0IG47cmV0dXJuIG5ldyBQcm9taXNlKChyLG8pPT57c3dpdGNoKHRoaXMuc3RyaXBlRWxlbWVudHN8fCh0aGlzLnN0cmlwZUVsZW1lbnRzPXRoaXMuZ2V0U3RyaXBlSnMoKS5lbGVtZW50cygpKSxlKXtjYXNlIGVlLkNyZWRpdENhcmQ6aWYodGhpcy51c2VJbmRpdmlkdWFsQ2FyZEZpZWxkcyYmUSh0KSl7Y29uc3R7Y2FyZE51bWJlckVsZW1lbnRPcHRpb25zOmUsY2FyZEV4cGlyeUVsZW1lbnRPcHRpb25zOmksY2FyZEN2Y0VsZW1lbnRPcHRpb25zOnJ9PXQscz10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZWUuQ2FyZE51bWJlcil8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGVlLkNhcmROdW1iZXIsZSksYT10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZWUuQ2FyZEV4cGlyeSl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGVlLkNhcmRFeHBpcnksaSksZD10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZWUuQ2FyZEN2Yyl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGVlLkNhcmRDdmMscik7dGhpcy5zdHJpcGVDYXJkRWxlbWVudHM9W3MsYSxkXSxuPXRoaXMuc3RyaXBlQ2FyZEVsZW1lbnRzWzBdO3RyeXtzLm1vdW50KGAjJHtlLmNvbnRhaW5lcklkfWApLGEubW91bnQoYCMke2kuY29udGFpbmVySWR9YCksZC5tb3VudChgIyR7ci5jb250YWluZXJJZH1gKX1jYXRjaChlKXt0aGlzLmlzRGVpbml0aWFsaXplfHxvKG5ldyBwKFwiVW5hYmxlIHRvIG1vdW50IFN0cmlwZSBjb21wb25lbnQgd2l0aG91dCB2YWxpZCBjb250YWluZXIgSUQuXCIpKX19ZWxzZXtuPXRoaXMuc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChlKXx8dGhpcy5zdHJpcGVFbGVtZW50cy5jcmVhdGUoZSx0KTt0cnl7bi5tb3VudChgIyR7aX1gKX1jYXRjaChlKXt0aGlzLmlzRGVpbml0aWFsaXplfHxvKG5ldyBwKFwiVW5hYmxlIHRvIG1vdW50IFN0cmlwZSBjb21wb25lbnQgd2l0aG91dCB2YWxpZCBjb250YWluZXIgSUQuXCIpKX19YnJlYWs7Y2FzZSBlZS5JREVBTDpjYXNlIGVlLlNlcGE6bj10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZSl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGUsdCk7dHJ5e24ubW91bnQoYCMke2l9YCl9Y2F0Y2goZSl7dGhpcy5pc0RlaW5pdGlhbGl6ZXx8byhuZXcgcChcIlVuYWJsZSB0byBtb3VudCBTdHJpcGUgY29tcG9uZW50IHdpdGhvdXQgdmFsaWQgY29udGFpbmVyIElELlwiKSl9Y2FzZSBlZS5BbGlwYXk6fXIobil9KX1tb3VudENhcmRWZXJpZmljYXRpb25GaWVsZHMoZSl7cmV0dXJuIHJlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFN0b3JlQ29uZmlnKCk7aWYoIXQpdGhyb3cgbmV3IG0oYy5NaXNzaW5nQ2hlY2tvdXRDb25maWcpO2NvbnN0IGk9dC5wYXltZW50U2V0dGluZ3MuYmlncGF5QmFzZVVybCxuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5jcmVhdGVIb3N0ZWRGb3JtKGksZSk7cmV0dXJuIHlpZWxkIG4uYXR0YWNoKCksbn0pfXByb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCxpPSExLG49ITEpe3JldHVybiByZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIWooZSkpdGhyb3cgZTtjb25zdCByPW8oZS5ib2R5LmVycm9ycyx7Y29kZTpcImFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkXCJ9KSxzPW8oZS5ib2R5LmVycm9ycyx7Y29kZTpcInRocmVlX2Rfc2VjdXJlX3JlcXVpcmVkXCJ9KTtpZihyKXtjb25zdCB0PWUuYm9keS5hZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZDtpZih0JiZcInJlZGlyZWN0X3RvX3VybFwiPT09dC50eXBlKXJldHVybiBuZXcgUHJvbWlzZSgoKT0+e3QuZGF0YS5yZWRpcmVjdF91cmwmJndpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHQuZGF0YS5yZWRpcmVjdF91cmwpfSl9aWYocyl7Y29uc3Qgcj1lLmJvZHkudGhyZWVfZHNfcmVzdWx0LnRva2VuLG89ITE7bGV0IHMsYT0hMTt0cnl7cz15aWVsZCB0aGlzLmdldFN0cmlwZUpzKCkuY29uZmlybUNhcmRQYXltZW50KHIpfWNhdGNoKGUpe2E9ITB9aWYobnVsbD09cz92b2lkIDA6cy5lcnJvcil7aWYodGhpcy5pc0NhbmNlbGxhdGlvbkVycm9yKHMuZXJyb3IpKXRocm93IG5ldyBNO2lmKHRoaXMuaXNBdXRoRXJyb3Iocy5lcnJvcikpdGhyb3cgbmV3IG5lKGllLkF1dGhGYWlsdXJlKTt0aHJvdyBuZXcgRXJyb3Iocy5lcnJvci5tZXNzYWdlKX1jb25zdCBkPXtjcmVkaXRfY2FyZF90b2tlbjp7dG9rZW46dGhpcy5nZXRQYXltZW50VG9rZW4obnVsbD09cz92b2lkIDA6cy5wYXltZW50SW50ZW50LHIsYSl9LHZhdWx0X3BheW1lbnRfaW5zdHJ1bWVudDppLGNvbmZpcm06b30sbD10aGlzLmJ1aWxkUGF5bWVudFBheWxvYWQodCxkLG4pO3RyeXtyZXR1cm4geWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobCl9Y2F0Y2goZSl7dGhyb3cgdGhpcy5oYW5kbGVFbXB0eVBheW1lbnRJbnRlbnRFcnJvcihlLG51bGw9PXM/dm9pZCAwOnMuZXJyb3IpfX10aHJvdyBlfSl9Z2V0UGF5bWVudFRva2VuKGUsdCxpKXtyZXR1cm4hZXx8aT90OmUuaWR9c2hvdWxkU2hvd1RTVkhvc3RlZEZvcm0oZSx0KXtyZXR1cm4gdGhpcy5pc0hvc3RlZEZpZWxkQXZhaWxhYmxlKCkmJnRoaXMuaXNIb3N0ZWRQYXltZW50Rm9ybUVuYWJsZWQoZSx0KX11bm1vdW50RWxlbWVudCgpe3RoaXMuc3RyaXBlRWxlbWVudCYmKHRoaXMuc3RyaXBlRWxlbWVudC51bm1vdW50KCksdGhpcy5zdHJpcGVFbGVtZW50PXZvaWQgMCl9fWNsYXNzIGFle2NvbnN0cnVjdG9yKGUsdD13aW5kb3cpe3RoaXMuc2NyaXB0TG9hZGVyPWUsdGhpcy5zdHJpcGVXaW5kb3c9dH1sb2FkKGUsdCxpKXtyZXR1cm4gdGhpcy5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdChcImh0dHBzOi8vanMuc3RyaXBlLmNvbS92My9cIikudGhlbigoKT0+e2lmKCF0aGlzLnN0cmlwZVdpbmRvdy5TdHJpcGUpdGhyb3cgbmV3IGw7cmV0dXJuIHRoaXMuc3RyaXBlV2luZG93LlN0cmlwZShlLHtzdHJpcGVBY2NvdW50OnQsbG9jYWxlOmksYmV0YXM6W1wicGF5bWVudF9pbnRlbnRfYmV0YV8zXCIsXCJhbGlwYXlfcG1fYmV0YV8xXCJdLGFwaVZlcnNpb246XCIyMDIwLTAzLTAyO2FsaXBheV9iZXRhPXYxXCJ9KX0pfX1jb25zdCBkZT1hKHQ9Pm5ldyBzZSh0LG5ldyBhZShlKCkpKSxbe2dhdGV3YXk6XCJzdHJpcGV2M1wifV0pLGxlPXtib2R5Ont9LGhlYWRlcnM6e30sc3RhdHVzOjB9O2NsYXNzIGNlIGV4dGVuZHMgZHtjb25zdHJ1Y3RvcihlLHttZXNzYWdlOnQsZXJyb3JzOml9PXt9KXtjb25zdHtib2R5Om4saGVhZGVyczpyLHN0YXR1czpvfT1lfHxsZTtzdXBlcih0fHxcIkFuIHVuZXhwZWN0ZWQgZXJyb3IgaGFzIG9jY3VycmVkLlwiKSx0aGlzLm5hbWU9XCJSZXF1ZXN0RXJyb3JcIix0aGlzLnR5cGU9XCJyZXF1ZXN0XCIsdGhpcy5ib2R5PW4sdGhpcy5oZWFkZXJzPXIsdGhpcy5zdGF0dXM9byx0aGlzLmVycm9ycz1pfHxbXX19Y29uc3QgdWU9e2FyOltcImFyXCJdLGJnOltcImJnXCJdLGNzOltcImNzXCJdLGRhOltcImRhXCJdLGRlOltcImRlXCJdLGVsOltcImVsXCJdLGVuOltcImVuXCIsXCJlbi1HQlwiXSxlczpbXCJlc1wiLFwiZXMtNDE5XCJdLGV0OltcImV0XCJdLGZpOltcImZpXCJdLGZpbDpbXCJmaWxcIl0sZnI6W1wiZnJcIixcImZyLUNBXCJdLGhlOltcImhlXCJdLGhyOltcImhyXCJdLGh1OltcImh1XCJdLGlkOltcImlkXCJdLGl0OltcIml0XCJdLGphOltcImphXCJdLGtvOltcImtvXCJdLGx0OltcImx0XCJdLGx2OltcImx2XCJdLG1zOltcIm1zXCJdLG10OltcIm10XCJdLG5iOltcIm5iXCJdLG5sOltcIm5sXCJdLHBsOltcInBsXCJdLHB0OltcInB0XCIsXCJwdC1CUlwiXSxybzpbXCJyb1wiXSxydTpbXCJydVwiXSxzazpbXCJza1wiXSxzbDpbXCJzbFwiXSxzdjpbXCJzdlwiXSx0aDpbXCJ0aFwiXSx0cjpbXCJ0clwiXSx2aTpbXCJ2aVwiXSx6aDpbXCJ6aFwiLFwiemgtSEtcIixcInpoLVRXXCJdfTtmdW5jdGlvbiBoZShlKXtjb25zdFt0LGldPWUucmVwbGFjZSgvXy9nLFwiLVwiKS50b0xvd2VyQ2FzZSgpLnNwbGl0KFwiLVwiKSxuPXVlW3RdO2lmKCFuKXJldHVyblwiYXV0b1wiO2NvbnN0IHI9aT9gJHt0fS0ke2kudG9VcHBlckNhc2UoKX1gOnQ7cmV0dXJuIG4uaW5kZXhPZihyKT4tMT9yOm5bMF19dmFyIHBlPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIG1le2NvbnN0cnVjdG9yKGUsdCxpKXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10LHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlPWl9aW5pdGlhbGl6ZShlKXtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3N0cmlwZXVwZTp0LG1ldGhvZElkOmksZ2F0ZXdheUlkOm59PWU7aWYoIShudWxsPT10P3ZvaWQgMDp0LmNvbnRhaW5lcklkKSl0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7aWYoIW4pdGhyb3cgbmV3IHAoJ1VuYWJsZSB0byBpbml0aWFsaXplIHBheW1lbnQgYmVjYXVzZSBcImdhdGV3YXlJZFwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTtyZXR1cm4gdGhpcy5fbG9hZFN0cmlwZUVsZW1lbnQodCxuLGkpLmNhdGNoKGU9Pnt2YXIgaTtyZXR1cm4gbnVsbD09PShpPXQub25FcnJvcil8fHZvaWQgMD09PWk/dm9pZCAwOmkuY2FsbCh0LGUpfSksdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaW5pdENoZWNrb3V0RXZlbnRzU3Vic2NyaXB0aW9uKG4saSx0LHRoaXMuX3N0cmlwZUVsZW1lbnRzKSxQcm9taXNlLnJlc29sdmUoKX0pfWV4ZWN1dGUoZSx0KXtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3BheW1lbnQ6aX09ZSxuPWZ1bmN0aW9uKGUsdCl7dmFyIGk9e307Zm9yKHZhciBuIGluIGUpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbikmJnQuaW5kZXhPZihuKTwwJiYoaVtuXT1lW25dKTtpZihudWxsIT1lJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgcj0wO2ZvcihuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7cjxuLmxlbmd0aDtyKyspdC5pbmRleE9mKG5bcl0pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLG5bcl0pJiYoaVtuW3JdXT1lW25bcl1dKX1yZXR1cm4gaX0oZSxbXCJwYXltZW50XCJdKTtpZighaXx8IWkucGF5bWVudERhdGEpdGhyb3cgbmV3IEsoW1wicGF5bWVudC5wYXltZW50RGF0YVwiXSk7aWYoIXRoaXMuX3N0cmlwZVVQRUNsaWVudCl0aHJvdyBuZXcgayhOLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7cGF5bWVudERhdGE6cixtZXRob2RJZDpvLGdhdGV3YXlJZDpzfT1pLHtzaG91bGRTYXZlSW5zdHJ1bWVudDphPSExLHNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQ6ZD0hMX09JChyKT9yOnt9LGw9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2lzU3RvcmVDcmVkaXRBcHBsaWVkOmN9PWwuZ2V0Q2hlY2tvdXRPclRocm93KCksdT1sLmdldFBheW1lbnRQcm92aWRlckN1c3RvbWVyT3JUaHJvdygpLGg9KHcodSk/dTp7fSkuc3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGU7aWYoYyYmKHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5hcHBseVN0b3JlQ3JlZGl0KGMpKSxzKXt5aWVsZCB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS51cGRhdGVTdHJpcGVQYXltZW50SW50ZW50KHMsbyk7Y29uc3R7ZW1haWw6ZX09bC5nZXRDdXN0b21lck9yVGhyb3coKTtpZih2b2lkIDAhPT1oJiYhZSl7Y29uc3QgZT1sLmdldEJpbGxpbmdBZGRyZXNzT3JUaHJvdygpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVCaWxsaW5nQWRkcmVzcyhlKX19aWYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdE9yZGVyKG4sdCksSihyKSl7Y29uc3R7aW5zdHJ1bWVudElkOmV9PXI7cmV0dXJuIHZvaWQoeWllbGQgdGhpcy5fZXhlY3V0ZVdpdGhWYXVsdGVkKGkubWV0aG9kSWQsZSxkKSl9eWllbGQgdGhpcy5fZXhlY3V0ZVdpdGhTdHJpcGVDb25maXJtYXRpb24oaS5tZXRob2RJZCwhaCYmYSxkKX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBaKX1kZWluaXRpYWxpemUoKXt2YXIgZSx0O3JldHVybiBudWxsPT09KHQ9bnVsbD09PShlPXRoaXMuX3N0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KEMuUEFZTUVOVCkpfHx2b2lkIDA9PT10fHx0LnVubW91bnQoKSx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5kZWluaXRpYWxpemUoKSx0aGlzLl9zdHJpcGVFbGVtZW50cz12b2lkIDAsdGhpcy5fc3RyaXBlVVBFQ2xpZW50PXZvaWQgMCxQcm9taXNlLnJlc29sdmUoKX1fZXhlY3V0ZVdpdGhTdHJpcGVDb25maXJtYXRpb24oZSx0LGkpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgbj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7Y2xpZW50VG9rZW46cn09bi5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhlKSxvPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKGUscnx8XCJcIix0LGkpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChvKX1jYXRjaChuKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbldpdGhTdHJpcGVDb25maXJtYXRpb24obixlLHQsaSl9fSl9X2V4ZWN1dGVXaXRoVmF1bHRlZChlLHQsaSl7dmFyIG47cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCByPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLG89ci5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhlKSxzPW51bGw9PT0obj1yLmdldENhcnQoKSl8fHZvaWQgMD09PW4/dm9pZCAwOm4uaWQ7dHJ5e2NvbnN0IG49e21ldGhvZElkOmUscGF5bWVudERhdGE6e2Zvcm1hdHRlZFBheWxvYWQ6e2NhcnRfaWQ6cyxiaWdwYXlfdG9rZW46e3Rva2VuOnR9LGNvbmZpcm06ITEsY2xpZW50X3Rva2VuOm8uY2xpZW50VG9rZW4sc2V0X2FzX2RlZmF1bHRfc3RvcmVkX2luc3RydW1lbnQ6aX19fTtyZXR1cm4geWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobil9Y2F0Y2godCl7cmV0dXJuIHRoaXMuX3Byb2Nlc3NWYXVsdGVkQWRkaXRpb25hbEFjdGlvbih0LGUsaSl9fSl9X2xvYWRTdHJpcGVFbGVtZW50KGUsdCxpKXtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e2NvbnRhaW5lcklkOm4sc3R5bGU6cixyZW5kZXI6byxpbml0U3RyaXBlRWxlbWVudFVwZGF0ZVRyaWdnZXI6c309ZSxhPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZCh0LHtwYXJhbXM6e21ldGhvZDppfX0pLGQ9YS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhpKSx7Y2hlY2tvdXRTZXR0aW5nczpsfT1hLmdldFN0b3JlQ29uZmlnT3JUaHJvdygpO2lmKCF5KGQpKXRocm93IG5ldyBtKGMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2NvbnN0e2NsaWVudFRva2VuOnUsaW5pdGlhbGl6YXRpb25EYXRhOmh9PWQse3Nob3BwZXJMYW5ndWFnZTpwLGFsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM6Zz0hMSxlbmFibGVMaW5rOnZ9PWg7aWYodGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cz1nLCF1KXRocm93IG5ldyBtKGMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2xldCBTO2lmKHRoaXMuX3N0cmlwZVVQRUNsaWVudD15aWVsZCB0aGlzLl9sb2FkU3RyaXBlSnMoaCksdGhpcy5faXNTdHJpcGVFbGVtZW50VXBkYXRlRW5hYmxlZD0hIWwuZmVhdHVyZXNbXCJQSS0xNjc5LnRyaWdnZXJfdXBkYXRlX3N0cmlwZV9wYXltZW50X2VsZW1lbnRcIl0mJlwiZnVuY3Rpb25cIj09dHlwZW9mIHMscil7Y29uc3QgZT1yO1M9e3ZhcmlhYmxlczp0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBBcHBlYXJhbmNlVmFyaWFibGVzKHIpLHJ1bGVzOntcIi5JbnB1dFwiOnRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1hcElucHV0QXBwZWFyYW5jZVJ1bGVzKGUpfX19dGhpcy5fc3RyaXBlRWxlbWVudHM9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0RWxlbWVudHModGhpcy5fc3RyaXBlVVBFQ2xpZW50LHtjbGllbnRTZWNyZXQ6dSxsb2NhbGU6aGUocCksYXBwZWFyYW5jZTpTfSk7Y29uc3R7Z2V0QmlsbGluZ0FkZHJlc3M6XyxnZXRTaGlwcGluZ0FkZHJlc3M6Zn09YSx7cG9zdGFsQ29kZTpFfT1mKCl8fF8oKXx8e30sYj10aGlzLl9zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KEMuUEFZTUVOVCl8fHRoaXMuX3N0cmlwZUVsZW1lbnRzLmNyZWF0ZShDLlBBWU1FTlQsT2JqZWN0LmFzc2lnbih7ZmllbGRzOntiaWxsaW5nRGV0YWlsczp7ZW1haWw6SS5ORVZFUixhZGRyZXNzOntjb3VudHJ5OkkuTkVWRVIsY2l0eTpJLk5FVkVSLHBvc3RhbENvZGU6RT9JLk5FVkVSOkkuQVVUT319fSx3YWxsZXRzOnthcHBsZVBheTpJLk5FVkVSLGdvb2dsZVBheTpJLk5FVkVSLGxpbms6dj9JLkFVVE86SS5ORVZFUn19LHRoaXMuX2dldFN0cmlwZUVsZW1lbnRUZXJtcygpKSk7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubW91bnRFbGVtZW50KGIsbiksYi5vbihQLlJFQURZLCgpPT57bygpfSksYi5vbihQLkNIQU5HRSxlPT57KG51bGw9PWU/dm9pZCAwOmUudmFsdWUpJiZcInR5cGVcImluIGUudmFsdWUmJnRoaXMuX3VwZGF0ZVN0cmlwZUxpbmtTdGF0ZUJ5RWxlbWVudFR5cGUoZS52YWx1ZS50eXBlKX0pLHRoaXMuX2lzU3RyaXBlRWxlbWVudFVwZGF0ZUVuYWJsZWQmJihudWxsPT1zfHxzKHRoaXMuX3VwZGF0ZVN0cmlwZUVsZW1lbnQuYmluZCh0aGlzKSkpfSl9X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihlLHQsaT0hMSxuPSExKXtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCFqKGUpfHwhdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNBZGRpdGlvbmFsQWN0aW9uRXJyb3IoZS5ib2R5LmVycm9ycykpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlVVBFQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e2RhdGE6cn09ZS5ib2R5LmFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkLHt0b2tlbjpvfT1yLHtwYXltZW50SW50ZW50OnN9PXlpZWxkIHRoaXMuX2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyh0LHIpLGE9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCwobnVsbD09cz92b2lkIDA6cy5pZCl8fG8saSxuKTt0cnl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoYSl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbjtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOnIscmVkaXJlY3RfdXJsOm99PXQscz10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLl9zdHJpcGVFbGVtZW50cyxvLCEhdGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cyk7bGV0IGE7dHJ5e2NvbnN0IHQ9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZChlLHRoaXMuX3N0cmlwZVVQRUNsaWVudCkpP3lpZWxkIG51bGw9PT0obj10aGlzLl9zdHJpcGVVUEVDbGllbnQpfHx2b2lkIDA9PT1uP3ZvaWQgMDpuLnJldHJpZXZlUGF5bWVudEludGVudChyfHxcIlwiKTp5aWVsZCBudWxsPT09KGk9dGhpcy5fc3RyaXBlVVBFQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudChzKTtpZihhPW51bGw9PXQ/dm9pZCAwOnQuZXJyb3IsYXx8IShudWxsPT10P3ZvaWQgMDp0LnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBUO3JldHVybiB0fWNhdGNoKGUpe3RoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3IoYSl9fSl9X3Byb2Nlc3NWYXVsdGVkQWRkaXRpb25hbEFjdGlvbihlLHQsaT0hMSl7dmFyIG47cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighdHx8IWooZSl8fCFvKGUuYm9keS5lcnJvcnMse2NvZGU6XCJ0aHJlZV9kX3NlY3VyZV9yZXF1aXJlZFwifSkpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlVVBFQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0IHI9ZS5ib2R5LnRocmVlX2RzX3Jlc3VsdC50b2tlbjtsZXQgcyxhPSExO3RyeXtzPXlpZWxkIHRoaXMuX3N0cmlwZVVQRUNsaWVudC5jb25maXJtQ2FyZFBheW1lbnQocil9Y2F0Y2goZSl7dHJ5e3M9eWllbGQgdGhpcy5fc3RyaXBlVVBFQ2xpZW50LnJldHJpZXZlUGF5bWVudEludGVudChyKX1jYXRjaChlKXthPSEwfX1pZigobnVsbD09cz92b2lkIDA6cy5lcnJvcikmJnRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3Iocy5lcnJvciksIShudWxsPT1zP3ZvaWQgMDpzLnBheW1lbnRJbnRlbnQpJiYhYSl0aHJvdyBuZXcgY2U7Y29uc3QgZD10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LGE/cjpudWxsPT09KG49bnVsbD09cz92b2lkIDA6cy5wYXltZW50SW50ZW50KXx8dm9pZCAwPT09bj92b2lkIDA6bi5pZCwhMSxpKTtyZXR1cm4gdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoZCl9KX1fbG9hZFN0cmlwZUpzKGUpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYodGhpcy5fc3RyaXBlVVBFQ2xpZW50KXJldHVybiB0aGlzLl9zdHJpcGVVUEVDbGllbnQ7Y29uc3QgdD10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKTtyZXR1cm4gdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGUsdC5nZXRDYXJ0TG9jYWxlKCksZyx2KX0pfV9nZXRQYXltZW50UGF5bG9hZChlLHQsaT0hMSxuPSExKXt2YXIgcjtyZXR1cm57bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTp7Zm9ybWF0dGVkUGF5bG9hZDp7Y2FydF9pZDoobnVsbD09PShyPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnQoKSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuaWQpfHxcIlwiLGNyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjp0fSxjb25maXJtOiExLHZhdWx0X3BheW1lbnRfaW5zdHJ1bWVudDppLHNldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50Om59fX19X3VwZGF0ZVN0cmlwZUVsZW1lbnQoe3Nob3VsZFNob3dUZXJtczplfSl7dmFyIHQ7Y29uc3QgaT1udWxsPT09KHQ9dGhpcy5fc3RyaXBlRWxlbWVudHMpfHx2b2lkIDA9PT10P3ZvaWQgMDp0LmdldEVsZW1lbnQoQy5QQVlNRU5UKTtudWxsPT1pfHxpLnVwZGF0ZShPYmplY3QuYXNzaWduKHt9LHRoaXMuX2dldFN0cmlwZUVsZW1lbnRUZXJtcyhlKSkpfV9nZXRTdHJpcGVFbGVtZW50VGVybXMoZSl7bGV0IHQ9SS5BVVRPO3JldHVybiB0aGlzLl9pc1N0cmlwZUVsZW1lbnRVcGRhdGVFbmFibGVkJiYodD1lP0kuQVVUTzpJLk5FVkVSKSx7dGVybXM6e2NhcmQ6dH19fV91cGRhdGVTdHJpcGVMaW5rU3RhdGVCeUVsZW1lbnRUeXBlKGUpe2NvbnN0IHQ9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0UGF5bWVudFByb3ZpZGVyQ3VzdG9tZXJPclRocm93KCksaT1lPT09Zi5MaW5rOyF3KHQpJiZpJiZ0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlUGF5bWVudFByb3ZpZGVyQ3VzdG9tZXIoe3N0cmlwZUxpbmtBdXRoZW50aWNhdGlvblN0YXRlOml9KX19Y29uc3QgeWU9YSh0PT57Y29uc3QgaT1uZXcgaChlKCkpO3JldHVybiBuZXcgbWUodCxpLG5ldyBSKHQsaSkpfSxbe2dhdGV3YXk6XCJzdHJpcGV1cGVcIn0se2dhdGV3YXk6XCJzdHJpcGV1cGVcIixpZDpcImtsYXJuYVwifV0pO3ZhciBnZT1mdW5jdGlvbihlLHQsaSxuKXtyZXR1cm4gbmV3KGl8fChpPVByb21pc2UpKShmdW5jdGlvbihyLG8pe2Z1bmN0aW9uIHMoZSl7dHJ5e2Qobi5uZXh0KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtkKG4udGhyb3coZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGQoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KHQ9ZS52YWx1ZSx0IGluc3RhbmNlb2YgaT90Om5ldyBpKGZ1bmN0aW9uKGUpe2UodCl9KSkudGhlbihzLGEpfWQoKG49bi5hcHBseShlLHR8fFtdKSkubmV4dCgpKX0pfTtjbGFzcyB2ZXtjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlPWUsdGhpcy5zY3JpcHRMb2FkZXI9dCx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZT1pfWluaXRpYWxpemUoZSl7dmFyIHQ7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGVvY3M6aSxtZXRob2RJZDpuLGdhdGV3YXlJZDpyfT1lO2lmKCEobnVsbD09aT92b2lkIDA6aS5jb250YWluZXJJZCkpdGhyb3cgbmV3IGsoTi5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCFyKXRocm93IG5ldyBwKCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBwYXltZW50IGJlY2F1c2UgXCJnYXRld2F5SWRcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7dHJ5e3lpZWxkIHRoaXMuX2luaXRpYWxpemVTdHJpcGVFbGVtZW50KGkscixuKX1jYXRjaChlKXtlIGluc3RhbmNlb2YgRXJyb3ImJihudWxsPT09KHQ9aS5vbkVycm9yKXx8dm9pZCAwPT09dHx8dC5jYWxsKGksZSkpfXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmluaXRDaGVja291dEV2ZW50c1N1YnNjcmlwdGlvbihyLG4saSx0aGlzLnN0cmlwZUVsZW1lbnRzKX0pfWV4ZWN1dGUoZSx0KXtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3BheW1lbnQ6aX09ZSxuPWZ1bmN0aW9uKGUsdCl7dmFyIGk9e307Zm9yKHZhciBuIGluIGUpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbikmJnQuaW5kZXhPZihuKTwwJiYoaVtuXT1lW25dKTtpZihudWxsIT1lJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgcj0wO2ZvcihuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7cjxuLmxlbmd0aDtyKyspdC5pbmRleE9mKG5bcl0pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLG5bcl0pJiYoaVtuW3JdXT1lW25bcl1dKX1yZXR1cm4gaX0oZSxbXCJwYXltZW50XCJdKSx7bWV0aG9kSWQ6cixnYXRld2F5SWQ6b309aXx8e307aWYoIXRoaXMuc3RyaXBlQ2xpZW50KXRocm93IG5ldyBrKE4uUGF5bWVudE5vdEluaXRpYWxpemVkKTtpZighb3x8IXIpdGhyb3cgbmV3IHAoJ1VuYWJsZSB0byBpbml0aWFsaXplIHBheW1lbnQgYmVjYXVzZSBcImdhdGV3YXlJZFwiIG9yIFwibWV0aG9kSWRcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7Y29uc3Qgcz10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7aXNTdG9yZUNyZWRpdEFwcGxpZWQ6YX09cy5nZXRDaGVja291dE9yVGhyb3coKTthJiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmFwcGx5U3RvcmVDcmVkaXQoYSkpLHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVN0cmlwZVBheW1lbnRJbnRlbnQobyxyKSx5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIobix0KTtjb25zdHtjbGllbnRUb2tlbjpkfT1zLmdldFBheW1lbnRNZXRob2RPclRocm93KHIpLGw9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQocixkfHxcIlwiKTt0cnl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobCl9Y2F0Y2goZSl7eWllbGQgdGhpcy5fcHJvY2Vzc0FkZGl0aW9uYWxBY3Rpb24oZSxyKX19KX1maW5hbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlamVjdChuZXcgWil9ZGVpbml0aWFsaXplKCl7dmFyIGU7Y29uc3QgdD1udWxsPT09KGU9dGhpcy5zdHJpcGVFbGVtZW50cyl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZ2V0RWxlbWVudChDLlBBWU1FTlQpO3JldHVybiBudWxsPT10fHx0LnVubW91bnQoKSxudWxsPT10fHx0LmRlc3Ryb3koKSx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5kZWluaXRpYWxpemUoKSx0aGlzLnN0cmlwZUVsZW1lbnRzPXZvaWQgMCx0aGlzLnN0cmlwZUNsaWVudD12b2lkIDAsUHJvbWlzZS5yZXNvbHZlKCl9X2luaXRpYWxpemVTdHJpcGVFbGVtZW50KGUsdCxpKXtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2xldCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFBheW1lbnRNZXRob2RPclRocm93KGkpO2lmKChudWxsPT1uP3ZvaWQgMDpuLmNsaWVudFRva2VuKXx8KG49KHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZCh0LHtwYXJhbXM6e21ldGhvZDppfX0pKS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhpKSksIXkobikpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7Y2xpZW50VG9rZW46cixpbml0aWFsaXphdGlvbkRhdGE6b309bix7c2hvcHBlckxhbmd1YWdlOnMsY3VzdG9tZXJTZXNzaW9uVG9rZW46YSxlbmFibGVMaW5rOmR9PW87aWYoIXIpdGhyb3cgbmV3IG0oYy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7dGhpcy5zdHJpcGVDbGllbnQ9eWllbGQgdGhpcy5fbG9hZFN0cmlwZUpzKG8pO2NvbnN0e2FwcGVhcmFuY2U6bCxjb250YWluZXJJZDp1LGZvbnRzOmgsbGF5b3V0OnAscmVuZGVyOmcscGF5bWVudE1ldGhvZFNlbGVjdDp2LGhhbmRsZUNsb3NlUGF5bWVudE1ldGhvZDpTLHRvZ2dsZVByZWxvYWRlcjpffT1lO3RoaXMuc3RyaXBlRWxlbWVudHM9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0RWxlbWVudHModGhpcy5zdHJpcGVDbGllbnQse2NsaWVudFNlY3JldDpyLGN1c3RvbWVyU2Vzc2lvbkNsaWVudFNlY3JldDphLGxvY2FsZTpoZShzKSxhcHBlYXJhbmNlOmwsZm9udHM6aH0pO2NvbnN0e2dldEJpbGxpbmdBZGRyZXNzOmYsZ2V0U2hpcHBpbmdBZGRyZXNzOkV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLGI9ZigpLHtwb3N0YWxDb2RlOnd9PUUoKXx8Ynx8e30sQT10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoQy5QQVlNRU5UKXx8dGhpcy5zdHJpcGVFbGVtZW50cy5jcmVhdGUoQy5QQVlNRU5ULHtmaWVsZHM6e2JpbGxpbmdEZXRhaWxzOntlbWFpbDpJLk5FVkVSLGFkZHJlc3M6e2NvdW50cnk6SS5ORVZFUixjaXR5OkkuTkVWRVIscG9zdGFsQ29kZTp3P0kuTkVWRVI6SS5BVVRPfX19LHdhbGxldHM6e2FwcGxlUGF5OkkuTkVWRVIsZ29vZ2xlUGF5OkkuTkVWRVIsbGluazpkP0kuQVVUTzpJLk5FVkVSfSxsYXlvdXQ6cCxzYXZlUGF5bWVudE1ldGhvZDp7bWF4VmlzaWJsZVBheW1lbnRNZXRob2RzOjIwfSxkZWZhdWx0VmFsdWVzOntiaWxsaW5nRGV0YWlsczp7ZW1haWw6KG51bGw9PWI/dm9pZCAwOmIuZW1haWwpfHxcIlwifX19KTt0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tb3VudEVsZW1lbnQoQSx1KSxBLm9uKFAuTE9BREVSX1NUQVJULCgpPT57bnVsbD09X3x8XyghMSl9KSxBLm9uKFAuUkVBRFksKCk9PntnKCl9KSxBLm9uKFAuQ0hBTkdFLGU9Pnt0aGlzLl9vblN0cmlwZUVsZW1lbnRDaGFuZ2UoZSx0LGksdil9KSxudWxsPT1TfHxTKHRoaXMuX2NvbGxhcHNlU3RyaXBlRWxlbWVudC5iaW5kKHRoaXMpKX0pfV9sb2FkU3RyaXBlSnMoZSl7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZih0aGlzLnN0cmlwZUNsaWVudClyZXR1cm4gdGhpcy5zdHJpcGVDbGllbnQ7Y29uc3QgdD10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKTtyZXR1cm4gdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGUsdC5nZXRDYXJ0TG9jYWxlKCkpfSl9X2NvbGxhcHNlU3RyaXBlRWxlbWVudCgpe3ZhciBlO2NvbnN0IHQ9bnVsbD09PShlPXRoaXMuc3RyaXBlRWxlbWVudHMpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLmdldEVsZW1lbnQoQy5QQVlNRU5UKTtudWxsPT10fHx0LmNvbGxhcHNlKCl9X2dldFBheW1lbnRQYXlsb2FkKGUsdCxpKXt2YXIgbjtjb25zdCByPShudWxsPT09KG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09bj92b2lkIDA6bi5pZCl8fFwiXCIse2NhcmQ6byx1c19iYW5rX2FjY291bnQ6c309aXx8e30sYT10aGlzLl9zaG91bGRTYXZlSW5zdHJ1bWVudChvKXx8dGhpcy5fc2hvdWxkU2F2ZUluc3RydW1lbnQocyksZD10aGlzLl9nZXRUb2tlbml6ZWRPcHRpb25zKHQsaSk7cmV0dXJue21ldGhvZElkOmUscGF5bWVudERhdGE6e2Zvcm1hdHRlZFBheWxvYWQ6T2JqZWN0LmFzc2lnbih7Y2FydF9pZDpyLGNvbmZpcm06ITEsbWV0aG9kOnRoaXMuc2VsZWN0ZWRNZXRob2RJZCx2YXVsdF9wYXltZW50X2luc3RydW1lbnQ6YX0sZCl9fX1fcHJvY2Vzc0FkZGl0aW9uYWxBY3Rpb24oZSx0KXtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCFqKGUpfHwhdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNBZGRpdGlvbmFsQWN0aW9uRXJyb3IoZS5ib2R5LmVycm9ycykpdGhyb3cgZTtpZighdGhpcy5zdHJpcGVDbGllbnR8fCF0aGlzLnN0cmlwZUVsZW1lbnRzKXRocm93IG5ldyBrKE4uUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdHtkYXRhOml9PWUuYm9keS5hZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZCx7dG9rZW46bn09aSx7cGF5bWVudEludGVudDpyfT15aWVsZCB0aGlzLl9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3codCxpKSx7Y2xpZW50X3NlY3JldDpvLHBheW1lbnRfbWV0aG9kX29wdGlvbnM6c309cnx8e30sYT10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LG98fG4scyk7dHJ5e3JldHVybiB5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChhKX1jYXRjaChlKXt0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1BheW1lbnRDb25maXJtYXRpb25Qcm9jZWVkTWVzc2FnZSgpfX0pfV9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coZSx0KXt2YXIgaSxuO3JldHVybiBnZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7dG9rZW46cixyZWRpcmVjdF91cmw6b309dCxzPXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1hcFN0cmlwZVBheW1lbnREYXRhKHRoaXMuc3RyaXBlRWxlbWVudHMsbyk7bGV0IGE7dHJ5e2NvbnN0IHQ9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZChlLHRoaXMuc3RyaXBlQ2xpZW50KSk/eWllbGQgbnVsbD09PShuPXRoaXMuc3RyaXBlQ2xpZW50KXx8dm9pZCAwPT09bj92b2lkIDA6bi5yZXRyaWV2ZVBheW1lbnRJbnRlbnQocnx8XCJcIik6eWllbGQgbnVsbD09PShpPXRoaXMuc3RyaXBlQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudChzKTtpZihhPW51bGw9PXQ/dm9pZCAwOnQuZXJyb3IsYXx8IShudWxsPT10P3ZvaWQgMDp0LnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBUO3JldHVybiB0fWNhdGNoKGUpe3JldHVybiB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1N0cmlwZUVycm9yKGEpfX0pfV9vblN0cmlwZUVsZW1lbnRDaGFuZ2UoZSx0LGksbil7KGU9Plwib2JqZWN0XCI9PXR5cGVvZiBlJiZudWxsIT09ZSYmXCJ2YWx1ZVwiaW4gZSYmXCJjb2xsYXBzZWRcImluIGUpKGUpJiYhZS5jb2xsYXBzZWQmJih0aGlzLnNlbGVjdGVkTWV0aG9kSWQ9ZS52YWx1ZS50eXBlLG51bGw9PW58fG4oYCR7dH0tJHtpfWApKX1fc2hvdWxkU2F2ZUluc3RydW1lbnQoZSl7Y29uc3QgdD1udWxsPT1lP3ZvaWQgMDplLnNldHVwX2Z1dHVyZV91c2FnZTtyZXR1cm4gdD09PWIuT05fU0VTU0lPTnx8dD09PWIuT0ZGX1NFU1NJT059X2dldFRva2VuaXplZE9wdGlvbnMoZSx0KXtyZXR1cm4gdGhpcy5fc2hvdWxkU2F2ZUluc3RydW1lbnQobnVsbD09dD92b2lkIDA6dC51c19iYW5rX2FjY291bnQpP3t0b2tlbml6ZWRfYWNoOnt0b2tlbjplfX06e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjplfX19fWNvbnN0IFNlPWEodD0+e2NvbnN0IGk9bmV3IGgoZSgpKTtyZXR1cm4gbmV3IHZlKHQsaSxuZXcgUih0LGkpKX0sW3tnYXRld2F5Olwic3RyaXBlb2NzXCIsaWQ6XCJvcHRpbWl6ZWRfY2hlY2tvdXRcIn1dKTtleHBvcnR7WSBhcyBjcmVhdGVMaW5rVjJCdXR0b25TdHJhdGVneSxIIGFzIGNyZWF0ZVN0cmlwZUxpbmtWMkN1c3RvbWVyU3RyYXRlZ3ksU2UgYXMgY3JlYXRlU3RyaXBlT0NTUGF5bWVudFN0cmF0ZWd5LE8gYXMgY3JlYXRlU3RyaXBlVVBFQ3VzdG9tZXJTdHJhdGVneSx5ZSBhcyBjcmVhdGVTdHJpcGVVUEVQYXltZW50U3RyYXRlZ3ksZGUgYXMgY3JlYXRlU3RyaXBlVjNQYXltZW50U3RyYXRlZ3l9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RyaXBlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../checkout-sdk-js/dist/esm/integrations/stripe.js\n\n}");

/***/ })

}]);