"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackJsonpCheckout"] = self["webpackJsonpCheckout"] || []).push([["checkout-sdk-js_dist_esm_integrations_stripe_js"],{

/***/ "../checkout-sdk-js/dist/esm/integrations/stripe.js":
/*!**********************************************************!*\
  !*** ../checkout-sdk-js/dist/esm/integrations/stripe.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createLinkV2ButtonStrategy: () => (/* binding */ Se),\n/* harmony export */   createStripeLinkV2CustomerStrategy: () => (/* binding */ ye),\n/* harmony export */   createStripeOCSPaymentStrategy: () => (/* binding */ re),\n/* harmony export */   createStripeUPECustomerStrategy: () => (/* binding */ se),\n/* harmony export */   createStripeUPEPaymentStrategy: () => (/* binding */ te),\n/* harmony export */   createStripeV3PaymentStrategy: () => (/* binding */ N)\n/* harmony export */ });\n/* harmony import */ var _bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bigcommerce/script-loader */ \"../checkout-sdk-js/node_modules/@bigcommerce/script-loader/lib/index.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ \"../checkout-sdk-js/node_modules/lodash/lodash.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);\nvar s,a,d={};function l(e,t){return Object.assign(e,{resolveIds:t})}d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class c extends Error{constructor(e){var t;super(e||\"An unexpected error has occurred.\"),this.name=\"StandardError\",this.type=\"standard\",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,\"function\"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class u extends c{constructor(e){super(e||\"Invalid arguments have been provided.\"),this.name=\"InvalidArgumentError\",this.type=\"invalid_argument\"}}class h extends u{constructor(e){let t=\"Unable to submit payment for the order because the payload is invalid.\";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(\", \")}.`),super(t),this.name=\"PaymentArgumentInvalidError\"}}function p(e){return!(\"object\"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&\"boolean\"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&\"boolean\"!=typeof e.shouldSetAsDefaultInstrument)}function m(e){return Boolean(e.instrumentId)}!function(e){e[e.MissingBillingAddress=0]=\"MissingBillingAddress\",e[e.MissingCart=1]=\"MissingCart\",e[e.MissingCheckout=2]=\"MissingCheckout\",e[e.MissingConsignments=3]=\"MissingConsignments\",e[e.MissingCustomer=4]=\"MissingCustomer\",e[e.MissingCheckoutConfig=5]=\"MissingCheckoutConfig\",e[e.MissingOrder=6]=\"MissingOrder\",e[e.MissingOrderConfig=7]=\"MissingOrderConfig\",e[e.MissingOrderId=8]=\"MissingOrderId\",e[e.MissingPayment=9]=\"MissingPayment\",e[e.MissingPaymentId=10]=\"MissingPaymentId\",e[e.MissingPaymentInstrument=11]=\"MissingPaymentInstrument\",e[e.MissingPaymentMethod=12]=\"MissingPaymentMethod\",e[e.MissingPaymentRedirectUrl=13]=\"MissingPaymentRedirectUrl\",e[e.MissingPaymentStatus=14]=\"MissingPaymentStatus\",e[e.MissingPaymentToken=15]=\"MissingPaymentToken\",e[e.MissingShippingAddress=16]=\"MissingShippingAddress\"}(s||(s={}));class y extends c{constructor(e){super(function(e){switch(e){case s.MissingBillingAddress:return\"Unable to proceed because billing address data is unavailable.\";case s.MissingCart:return\"Unable to proceed because cart data is unavailable.\";case s.MissingConsignments:return\"Unable to proceed because consignments data is unavailable.\";case s.MissingCheckout:return\"Unable to proceed because checkout data is unavailable.\";case s.MissingCustomer:return\"Unable to proceed because customer data is unavailable.\";case s.MissingCheckoutConfig:case s.MissingOrderConfig:return\"Unable to proceed because configuration data is unavailable.\";case s.MissingOrder:return\"Unable to proceed because order data is unavailable.\";case s.MissingOrderId:return\"Unable to proceed because order ID is unavailable or not generated yet.\";case s.MissingPayment:return\"Unable to proceed because payment data is unavailable.\";case s.MissingPaymentToken:return\"Unable to proceed because the token required to submit a payment is missing.\";case s.MissingPaymentMethod:return\"Unable to proceed because payment method data is unavailable or not properly configured.\";case s.MissingShippingAddress:return\"Unable to proceed because shipping address data is unavailable.\";default:return\"Unable to proceed because the required data is unavailable.\"}}(e)),this.subtype=e,this.name=\"MissingDataError\",this.type=\"missing_data\"}}class g extends c{constructor(){super(\"The current order does not need to be finalized at this stage.\"),this.name=\"OrderFinalizationNotRequiredError\",this.type=\"order_finalization_not_required\"}}!function(e){e[e.CheckoutButtonNotInitialized=0]=\"CheckoutButtonNotInitialized\",e[e.CustomerNotInitialized=1]=\"CustomerNotInitialized\",e[e.PaymentNotInitialized=2]=\"PaymentNotInitialized\",e[e.ShippingNotInitialized=3]=\"ShippingNotInitialized\",e[e.SpamProtectionNotInitialized=4]=\"SpamProtectionNotInitialized\"}(a||(a={}));class v extends c{constructor(e){super(function(e){switch(e){case a.CustomerNotInitialized:return\"Unable to proceed because the customer step of checkout has not been initialized.\";case a.PaymentNotInitialized:return\"Unable to proceed because the payment step of checkout has not been initialized.\";case a.ShippingNotInitialized:return\"Unable to proceed because the shipping step of checkout has not been initialized.\";case a.SpamProtectionNotInitialized:return\"Unable to proceed because the checkout spam protection has not been initialized.\";default:return\"Unable to proceed because the required component has not been initialized.\"}}(e)),this.subtype=e,this.name=\"NotInitializedError\",this.type=\"not_initialized\"}}const S=e=>\"object\"==typeof e&&null!==e&&\"body\"in e;class _ extends c{constructor(e){super(e||\"Payment process was cancelled.\"),this.name=\"PaymentMethodCancelledError\",this.type=\"payment_cancelled\"}}function f(e){return null!==e&&\"object\"==typeof e&&\"cardNumberElementOptions\"in e&&\"cardCvcElementOptions\"in e&&\"cardExpiryElementOptions\"in e&&void 0!==e.cardNumberElementOptions&&void 0!==e.cardCvcElementOptions&&void 0!==e.cardExpiryElementOptions}var I,C,E,P;!function(e){e.Solid=\"solid\",e.Default=\"default\"}(I||(I={})),function(e){e.Alipay=\"alipay\",e.CardCvc=\"cardCvc\",e.CardExpiry=\"cardExpiry\",e.CardNumber=\"cardNumber\",e.CreditCard=\"card\",e.IDEAL=\"idealBank\",e.Sepa=\"iban\"}(C||(C={})),function(e){e.Alipay=\"alipay\",e.CreditCard=\"card\",e.IDEAL=\"ideal\",e.Sepa=\"sepa_debit\"}(E||(E={})),function(e){e.AuthFailure=\"auth_failure\"}(P||(P={}));class b extends c{constructor(e){super(e===P.AuthFailure?\"User did not authenticate\":\"There was an error while processing your payment. Please try again or contact us.\"),this.type=\"stripev3_error\",this.subtype=e}}var w=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};const A=[C.Alipay,C.IDEAL];class O{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){return w(this,void 0,void 0,function*(){const{stripev3:t,methodId:i,gatewayId:n}=e;if(!n)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');this.initializeOptions=t,this.isDeinitialize=!1;const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{initializationData:{stripePublishableKey:o,stripeConnectedAccount:s,useIndividualCardFields:a,allowRedisplayForStoredInstruments:d}}=r;this._allowRedisplayForStoredInstruments=d;const l=this.getInitializeOptions().form;this.useIndividualCardFields=a,this.stripeV3Client=yield this.loadStripeJs(o,s),this.isCreditCard(i)&&this.shouldShowTSVHostedForm(i,n)&&l?this.hostedForm=yield this.mountCardVerificationFields(l):this.stripeElement=yield this.mountCardFields(i)})}execute(e,i){var n,r;return w(this,void 0,void 0,function*(){const{payment:o}=e,a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);let d,l;if(!o||!o.paymentData)throw new h([\"payment.paymentData\"]);const{paymentData:c,gatewayId:u,methodId:g}=o,{shouldSaveInstrument:v,shouldSetAsDefaultInstrument:S}=p(c)?c:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},_=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)(A,g),{isStoreCreditApplied:f}=this.paymentIntegrationService.getState().getCheckoutOrThrow();f&&(yield this.paymentIntegrationService.applyStoreCredit(f));try{_&&(yield this.paymentIntegrationService.submitOrder(a,i)),u&&(yield this.paymentIntegrationService.loadPaymentMethod(u,{params:{method:g}}));const e=this.paymentIntegrationService.getState();if(m(c)){yield this.paymentIntegrationService.submitOrder(a,i);const{instrumentId:t}=c,n=e.getPaymentMethodOrThrow(o.methodId).clientToken;if(!n)throw new y(s.MissingPaymentMethod);return yield this.executeWithVaulted(o,t,S,n)}const t=e.getPaymentMethodOrThrow(g),h=yield this.confirmStripePayment(t),{clientToken:p,method:f}=t,{id:I}=null!==(r=null!==(n=h.paymentIntent)&&void 0!==n?n:h.paymentMethod)&&void 0!==r?r:{id:\"\"};l=h.error,d={credit_card_token:{token:I},vault_payment_instrument:v,confirm:!1,set_as_default_stored_instrument:S},f===C.CreditCard&&(d.client_token=p),_||(yield this.paymentIntegrationService.submitOrder(a,i));const E=this.buildPaymentPayload(g,d,S);yield this.paymentIntegrationService.submitPayment(E)}catch(e){yield this.processAdditionalAction(this.handleEmptyPaymentIntentError(e,l),g,v,S)}})}finalize(){return Promise.reject(new g)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.isDeinitialize=!0,this.unmountElement(),Promise.resolve()}buildPaymentPayload(e,t,i){return{methodId:e,paymentData:i?{formattedPayload:Object.assign(Object.assign({},t),{set_as_default_stored_instrument:i})}:{formattedPayload:t}}}isCancellationError(e){var t,i;return e&&-1!==(null===(i=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===i?void 0:i.indexOf(\"canceled\"))}isAuthError(e){return\"payment_intent_authentication_failure\"===(null==e?void 0:e.code)}isCreditCard(e){return e===E.CreditCard}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty);return!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(r)}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:i}=this.paymentIntegrationService.getState(),n=i(e,t);return Boolean(n.config.isHostedFormEnabled)}confirmStripePayment(e){return w(this,void 0,void 0,function*(){const{clientToken:t,method:i,returnUrl:n}=e;if(!t)throw new y(s.MissingPaymentMethod);switch(i){case C.Alipay:return this.getStripeJs().confirmAlipayPayment(t,{return_url:n},{handleActions:!1});case C.IDEAL:{const e=this.mapStripePaymentData(E.IDEAL,n);return this.getStripeJs().confirmIdealPayment(t,e,{handleActions:!1})}case C.Sepa:{const e=this.mapStripePaymentData(E.Sepa);return this.getStripeJs().confirmSepaDebitPayment(t,e)}default:{const e=this.useIndividualCardFields?this.getStripeCardElements()[0]:this.getStripeElement(),t=this.mapStripeBillingDetails(this.paymentIntegrationService.getState().getBillingAddress(),this.paymentIntegrationService.getState().getCustomer()),i=this._allowRedisplayForStoredInstruments;return this.getStripeJs().createPaymentMethod(Object.assign({type:E.CreditCard,card:e,billing_details:t},i?{allow_redisplay:\"always\"}:{}))}}})}executeWithVaulted(e,t,i,n){var r;return w(this,void 0,void 0,function*(){const o={bigpay_token:{token:t},confirm:!0,client_token:n,set_as_default_stored_instrument:i};if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)&&this.hostedForm){const t=this.hostedForm;return e.paymentData&&m(e.paymentData)&&(e.paymentData=Object.assign(Object.assign({},e.paymentData),{instrumentId:JSON.stringify({token:(null===(r=e.paymentData)||void 0===r?void 0:r.instrumentId)||\"\",client_token:n})})),yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}const s=this.buildPaymentPayload(e.methodId,o,i);return this.paymentIntegrationService.submitPayment(s)})}getInitializeOptions(){if(!this.initializeOptions)throw new v(a.PaymentNotInitialized);return this.initializeOptions}getStripeCardElements(){if(!this.stripeCardElements)throw new v(a.PaymentNotInitialized);return this.stripeCardElements}getStripeElement(){if(!this.stripeElement)throw new v(a.PaymentNotInitialized);return this.stripeElement}getStripeJs(){if(!this.stripeV3Client)throw new v(a.PaymentNotInitialized);return this.stripeV3Client}handleEmptyPaymentIntentError(e,t){return S(e)&&(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"required_field\"})&&t?new Error(t.message):e}loadStripeJs(e,t){return w(this,void 0,void 0,function*(){return this.stripeV3Client?Promise.resolve(this.stripeV3Client):this.scriptLoader.load(e,t,this.paymentIntegrationService.getState().getLocale())})}mapStripeAddress(e){if(e){const{city:t,countryCode:i,address1:n,address2:r,postalCode:o,stateOrProvinceCode:s}=e;return{city:t,country:i,line1:n,line2:r,postal_code:o,state:s}}return{line1:\"\"}}mapStripeBillingDetails(e,t){const{firstName:i,lastName:n}=e||t||{firstName:\"Guest\",lastName:\"\"},r=`${i} ${n}`.trim(),{options:o}=this.getInitializeOptions();if(this.useIndividualCardFields&&f(o)){const{zipCodeElementOptions:t}=o;if(t){const i=document.getElementById(t.containerId)?document.getElementById(t.containerId).value:\"\";i&&e&&(e=Object.assign(Object.assign({},e),{postalCode:i}))}}const s={address:this.mapStripeAddress(e)};if(t&&t.addresses[0]&&function(e){return\"object\"==typeof e&&null!==e&&\"id\"in e&&void 0!==e.id}(t.addresses[0])){const e=t.addresses[0],{email:i}=t,{phone:n}=e;return n?Object.assign(Object.assign({},s),{email:i,name:r,phone:n}):Object.assign(Object.assign({},s),{email:i,name:r})}if(e){const{email:t,phone:i}=e;return i?Object.assign(Object.assign({},s),{email:t,name:r,phone:i}):Object.assign(Object.assign({},s),{email:t,name:r})}return Object.assign(Object.assign({},s),{name:r})}mapStripePaymentData(e,t){const i=this.paymentIntegrationService.getState().getCustomer(),n=this.paymentIntegrationService.getState().getBillingAddress(),r={payment_method:{[e]:this.getStripeElement(),billing_details:this.mapStripeBillingDetails(n,i)}};return e===E.IDEAL?Object.assign(Object.assign({},r),{return_url:t}):r}mountCardFields(e){const{options:t,containerId:i}=this.getInitializeOptions();let n;return new Promise((r,o)=>{switch(this.stripeElements||(this.stripeElements=this.getStripeJs().elements()),e){case C.CreditCard:if(this.useIndividualCardFields&&f(t)){const{cardNumberElementOptions:e,cardExpiryElementOptions:i,cardCvcElementOptions:r}=t,s=this.stripeElements.getElement(C.CardNumber)||this.stripeElements.create(C.CardNumber,e),a=this.stripeElements.getElement(C.CardExpiry)||this.stripeElements.create(C.CardExpiry,i),d=this.stripeElements.getElement(C.CardCvc)||this.stripeElements.create(C.CardCvc,r);this.stripeCardElements=[s,a,d],n=this.stripeCardElements[0];try{s.mount(`#${e.containerId}`),a.mount(`#${i.containerId}`),d.mount(`#${r.containerId}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}}else{n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}}break;case C.IDEAL:case C.Sepa:n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}case C.Alipay:}r(n)})}mountCardVerificationFields(e){return w(this,void 0,void 0,function*(){const t=this.paymentIntegrationService.getState().getStoreConfig();if(!t)throw new y(s.MissingCheckoutConfig);const i=t.paymentSettings.bigpayBaseUrl,n=this.paymentIntegrationService.createHostedForm(i,e);return yield n.attach(),n})}processAdditionalAction(e,t,i=!1,n=!1){return w(this,void 0,void 0,function*(){if(!S(e))throw e;const r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"additional_action_required\"}),s=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"});if(r){const t=e.body.additional_action_required;if(t&&\"redirect_to_url\"===t.type)return new Promise(()=>{t.data.redirect_url&&window.location.replace(t.data.redirect_url)})}if(s){const r=e.body.three_ds_result.token,o=!1;let s,a=!1;try{s=yield this.getStripeJs().confirmCardPayment(r)}catch(e){a=!0}if(null==s?void 0:s.error){if(this.isCancellationError(s.error))throw new _;if(this.isAuthError(s.error))throw new b(P.AuthFailure);throw new Error(s.error.message)}const d={credit_card_token:{token:this.getPaymentToken(null==s?void 0:s.paymentIntent,r,a)},vault_payment_instrument:i,confirm:o},l=this.buildPaymentPayload(t,d,n);try{return yield this.paymentIntegrationService.submitPayment(l)}catch(e){throw this.handleEmptyPaymentIntentError(e,null==s?void 0:s.error)}}throw e})}getPaymentToken(e,t,i){return!e||i?t:e.id}shouldShowTSVHostedForm(e,t){return this.isHostedFieldAvailable()&&this.isHostedPaymentFormEnabled(e,t)}unmountElement(){this.stripeElement&&(this.stripeElement.unmount(),this.stripeElement=void 0)}}class M extends c{constructor(e){super(e||\"Unable to proceed because the client library of a payment method is not loaded or ready to be used.\"),this.name=\"PaymentMethodClientUnavailableError\",this.type=\"payment_method_client_unavailable\"}}class T{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}load(e,t,i){return this.scriptLoader.loadScript(\"https://js.stripe.com/v3/\").then(()=>{if(!this.stripeWindow.Stripe)throw new M;return this.stripeWindow.Stripe(e,{stripeAccount:t,locale:i,betas:[\"payment_intent_beta_3\",\"alipay_pm_beta_1\"],apiVersion:\"2020-03-02;alipay_beta=v1\"})})}}const N=l(t=>new O(t,new T((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{gateway:\"stripev3\"}]);var k,D,R,z,L,U,x,j,B=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class F{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,i,n){return B(this,void 0,void 0,function*(){if(this.stripeWindow.bcStripeClient)return this.stripeWindow.bcStripeClient;const r=yield this.load(),{stripePublishableKey:o,stripeConnectedAccount:s}=e,a=r(o,Object.assign(Object.assign(Object.assign(Object.assign({},s?{stripeAccount:s}:{}),t?{locale:t}:{}),i?{betas:i}:{}),n?{apiVersion:n}:{}));return Object.assign(this.stripeWindow,{bcStripeClient:a}),a})}getElements(e,t){return B(this,void 0,void 0,function*(){let i=this.stripeWindow.bcStripeElements;return i?yield this.updateStripeElements(t):(i=e.elements(t),Object.assign(this.stripeWindow,{bcStripeElements:i})),i})}updateStripeElements(e){return B(this,void 0,void 0,function*(){const t=this.stripeWindow.bcStripeElements;t&&(t.update(e),yield t.fetchUpdates())})}load(){return B(this,void 0,void 0,function*(){if(!this.stripeWindow.Stripe&&(yield this.scriptLoader.loadScript(\"https://js.stripe.com/v3/\"),!this.stripeWindow.Stripe))throw new M;return this.stripeWindow.Stripe})}}class V extends c{constructor(e){super(e||\"Unable to proceed because the client library of a payment method has thrown an unexpected error.\"),this.name=\"PaymentMethodFailedError\",this.type=\"payment_method_client_invalid\"}}!function(e){e.SHIPPING=\"shipping\",e.BILLING=\"billing\"}(k||(k={})),function(e){e.SPLIT=\"split\",e.FULL=\"full\",e.ORGANIZATION=\"organization\"}(D||(D={})),function(e){e.CreditCard=\"card\",e.Link=\"link\",e.EPS=\"eps\",e.GRABPAY=\"grabpay\",e.BANCONTACT=\"bancontact\",e.IDEAL=\"ideal\",e.ALIPAY=\"alipay\",e.KLARNA=\"klarna\",e.OCS=\"optimized_checkout\"}(R||(R={})),function(e){e.NEVER=\"never\",e.AUTO=\"auto\",e.ALWAYS=\"always\",e.PAYMENT=\"payment\",e.IF_REQUIRED=\"if_required\"}(z||(z={})),function(e){e.PAYMENT=\"payment\",e.AUTHENTICATION=\"linkAuthentication\",e.SHIPPING=\"address\",e.EXPRESS_CHECKOUT=\"expressCheckout\"}(L||(L={})),function(e){e.REQUIRES_PAYMENT_METHOD=\"requires_payment_method\",e.REQUIRES_CONFIRMATION=\"requires_confirmation\",e.REQUIRES_ACTION=\"requires_action\",e.PROCESSING=\"processing\",e.SUCCEEDED=\"succeeded\",e.CANCELED=\"canceled\"}(U||(U={})),function(e){e.CLICK=\"click\",e.CHANGE=\"change\",e.READY=\"ready\",e.SHIPPING_ADDRESS_CHANGE=\"shippingaddresschange\",e.SHIPPING_RATE_CHANGE=\"shippingratechange\",e.CONFIRM=\"confirm\",e.CANCEL=\"cancel\",e.LOADER_START=\"loaderstart\"}(x||(x={})),function(e){e.ON_SESSION=\"on_session\",e.OFF_SESSION=\"off_session\"}(j||(j={}));var G=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class H{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.isMounted=!1}deinitialize(){var e;null===(e=this.checkoutEventsUnsubscribe)||void 0===e||e.call(this),this.isMounted=!1}initCheckoutEventsSubscription(e,t,i,n){this.checkoutEventsUnsubscribe=this.paymentIntegrationService.subscribe(()=>G(this,void 0,void 0,function*(){var r;const o=null==n?void 0:n.getElement(L.PAYMENT);if(o){try{yield this.updateStripePaymentIntent(e,t)}catch(e){return this.isMounted&&(o.unmount(),this.isMounted=!1),void(e instanceof Error&&(null===(r=i.onError)||void 0===r||r.call(i,e)))}this.isMounted||(yield null==n?void 0:n.fetchUpdates(),this.mountElement(o,i.containerId))}}),e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.outstandingBalance},e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.coupons})}mountElement(e,t){document.getElementById(t)&&(e.mount(`#${t}`),this.isMounted=!0)}mapAppearanceVariables(e){return{colorPrimary:e.fieldInnerShadow,colorBackground:e.fieldBackground,colorText:e.labelText,colorDanger:e.fieldErrorText,colorTextSecondary:e.labelText,colorTextPlaceholder:e.fieldPlaceholderText,colorIcon:e.fieldPlaceholderText}}mapInputAppearanceRules(e){return{borderColor:e.fieldBorder,color:e.fieldText,boxShadow:e.fieldInnerShadow}}throwStripeError(e){if(\"object\"==typeof(t=e)&&null!==t&&\"type\"in t&&(this.throwDisplayableStripeError(e),this.isCancellationError(e)))throw new _;var t;throw new V}throwDisplayableStripeError(e){if((0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)([\"card_error\",\"invalid_request_error\",\"validation_error\"],e.type))throw new Error(e.message)}isCancellationError(e){var t;const i=null===(t=null==e?void 0:e.payment_intent.last_payment_error)||void 0===t?void 0:t.message;return!!i&&-1!==i.indexOf(\"canceled\")}throwPaymentConfirmationProceedMessage(){throw new V(\"We've received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it's completed. Please note, this process may take a few minutes depending on the processing times of your chosen method.\")}isPaymentCompleted(e,t){return G(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState(),n=i.getPaymentMethodOrThrow(e),{features:r}=i.getStoreConfigOrThrow().checkoutSettings;if(!n.clientToken||!t||!r[\"PI-626.Block_unnecessary_payment_confirmation_for_StripeUPE\"])return!1;const{paymentIntent:o}=yield t.retrievePaymentIntent(n.clientToken);return(null==o?void 0:o.status)===U.SUCCEEDED})}mapStripePaymentData(e,t,i=!1){const n=this.paymentIntegrationService.getState().getBillingAddress(),{firstName:r=\"\",lastName:o=\"\",email:d=\"\"}=n||{},l=this._mapStripeAddress(n);if(!e)throw new v(a.PaymentNotInitialized);if(!(d&&l&&l.city&&l.country&&r&&o))throw new y(s.MissingBillingAddress);return{elements:e,redirect:z.IF_REQUIRED,confirmParams:Object.assign({payment_method_data:Object.assign(Object.assign({},i?{allow_redisplay:\"always\"}:{}),{billing_details:{email:d,address:l,name:`${r} ${o}`}})},t&&{return_url:t})}}isAdditionalActionError(e){return (0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e,{code:\"additional_action_required\"})}isRedirectAction(e){const{type:t,data:{redirect_url:i}}=e;return\"redirect_to_url\"===t&&!!i}isOnPageAdditionalAction(e){const{type:t,data:{token:i}}=e;return\"additional_action_requires_payment_method\"===t&&!!i}updateStripePaymentIntent(e,t){return G(this,void 0,void 0,function*(){const i=yield this.paymentIntegrationService.loadPaymentMethod(e,{params:{method:t}}),{clientToken:n}=i.getPaymentMethodOrThrow(t);n&&this.scriptLoader.updateStripeElements({clientSecret:n})})}_mapStripeAddress(e){if(e){const{city:t,address1:i,address2:n,countryCode:r,postalCode:o,stateOrProvinceCode:s}=e;return Object.assign({city:t,country:r,postal_code:o,line1:i,line2:n},s?{state:s}:{})}throw new y(s.MissingBillingAddress)}}const q={body:{},headers:{},status:0};class W extends c{constructor(e,{message:t,errors:i}={}){const{body:n,headers:r,status:o}=e||q;super(t||\"An unexpected error has occurred.\"),this.name=\"RequestError\",this.type=\"request\",this.body=n,this.headers=r,this.status=o,this.errors=i||[]}}function Y(e){return\"object\"==typeof e&&null!==e&&\"initializationData\"in e&&void 0!==e.initializationData&&null!==e.initializationData&&\"object\"==typeof e.initializationData&&\"stripePublishableKey\"in e.initializationData&&\"stripeConnectedAccount\"in e.initializationData&&\"shopperLanguage\"in e.initializationData&&void 0!==e.initializationData.stripePublishableKey&&void 0!==e.initializationData.stripeConnectedAccount&&void 0!==e.initializationData.shopperLanguage}const K={ar:[\"ar\"],bg:[\"bg\"],cs:[\"cs\"],da:[\"da\"],de:[\"de\"],el:[\"el\"],en:[\"en\",\"en-GB\"],es:[\"es\",\"es-419\"],et:[\"et\"],fi:[\"fi\"],fil:[\"fil\"],fr:[\"fr\",\"fr-CA\"],he:[\"he\"],hr:[\"hr\"],hu:[\"hu\"],id:[\"id\"],it:[\"it\"],ja:[\"ja\"],ko:[\"ko\"],lt:[\"lt\"],lv:[\"lv\"],ms:[\"ms\"],mt:[\"mt\"],nb:[\"nb\"],nl:[\"nl\"],pl:[\"pl\"],pt:[\"pt\",\"pt-BR\"],ro:[\"ro\"],ru:[\"ru\"],sk:[\"sk\"],sl:[\"sl\"],sv:[\"sv\"],th:[\"th\"],tr:[\"tr\"],vi:[\"vi\"],zh:[\"zh\",\"zh-HK\",\"zh-TW\"]};function $(e){const[t,i]=e.replace(/_/g,\"-\").toLowerCase().split(\"-\"),n=K[t];if(!n)return\"auto\";const r=i?`${t}-${i.toUpperCase()}`:t;return n.indexOf(r)>-1?r:n[0]}const J=[\"payment_element_beta_2\",\"alipay_pm_beta_1\",\"link_default_integration_beta_1\",\"shipping_address_element_beta_1\",\"address_element_beta_1\"],Z=\"2020-03-02;alipay_beta=v1;link_beta=v1\";function Q(e){return\"stripeLinkAuthenticationState\"in e}var X=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class ee{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){return X(this,void 0,void 0,function*(){const{stripeupe:t,methodId:i,gatewayId:n}=e;if(!(null==t?void 0:t.containerId))throw new v(a.PaymentNotInitialized);if(!n)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');return this._loadStripeElement(t,n,i).catch(e=>{var i;return null===(i=t.onError)||void 0===i?void 0:i.call(t,e)}),this.stripeIntegrationService.initCheckoutEventsSubscription(n,i,t,this._stripeElements),Promise.resolve()})}execute(e,t){return X(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);if(!i||!i.paymentData)throw new h([\"payment.paymentData\"]);if(!this._stripeUPEClient)throw new v(a.PaymentNotInitialized);const{paymentData:r,methodId:o,gatewayId:s}=i,{shouldSaveInstrument:d=!1,shouldSetAsDefaultInstrument:l=!1}=p(r)?r:{},c=this.paymentIntegrationService.getState(),{isStoreCreditApplied:u}=c.getCheckoutOrThrow(),y=c.getPaymentProviderCustomerOrThrow(),g=(Q(y)?y:{}).stripeLinkAuthenticationState;if(u&&(yield this.paymentIntegrationService.applyStoreCredit(u)),s){yield this.stripeIntegrationService.updateStripePaymentIntent(s,o);const{email:e}=c.getCustomerOrThrow();if(void 0!==g&&!e){const e=c.getBillingAddressOrThrow();yield this.paymentIntegrationService.updateBillingAddress(e)}}if(yield this.paymentIntegrationService.submitOrder(n,t),m(r)){const{instrumentId:e}=r;return void(yield this._executeWithVaulted(i.methodId,e,l))}yield this._executeWithStripeConfirmation(i.methodId,!g&&d,l)})}finalize(){return Promise.reject(new g)}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(L.PAYMENT))||void 0===t||t.unmount(),this.stripeIntegrationService.deinitialize(),this._stripeElements=void 0,this._stripeUPEClient=void 0,Promise.resolve()}_executeWithStripeConfirmation(e,t,i){return X(this,void 0,void 0,function*(){const n=this.paymentIntegrationService.getState(),{clientToken:r}=n.getPaymentMethodOrThrow(e),o=this._getPaymentPayload(e,r||\"\",t,i);try{yield this.paymentIntegrationService.submitPayment(o)}catch(n){yield this._processAdditionalActionWithStripeConfirmation(n,e,t,i)}})}_executeWithVaulted(e,t,i){var n;return X(this,void 0,void 0,function*(){const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(e),s=null===(n=r.getCart())||void 0===n?void 0:n.id;try{const n={methodId:e,paymentData:{formattedPayload:{cart_id:s,bigpay_token:{token:t},confirm:!1,client_token:o.clientToken,set_as_default_stored_instrument:i}}};return yield this.paymentIntegrationService.submitPayment(n)}catch(t){return this._processVaultedAdditionalAction(t,e,i)}})}_loadStripeElement(e,t,i){return X(this,void 0,void 0,function*(){const{containerId:n,style:r,render:o,initStripeElementUpdateTrigger:a}=e,d=yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}}),l=d.getPaymentMethodOrThrow(i);if(!Y(l))throw new y(s.MissingPaymentMethod);const{clientToken:c,initializationData:u}=l,{shopperLanguage:h,allowRedisplayForStoredInstruments:p=!1,enableLink:m}=u;if(this._allowRedisplayForStoredInstruments=p,!c)throw new y(s.MissingPaymentMethod);let g;if(this._stripeUPEClient=yield this._loadStripeJs(u),this._isStripeElementUpdateEnabled=\"function\"==typeof a,r){const e=r;g={variables:this.stripeIntegrationService.mapAppearanceVariables(r),rules:{\".Input\":this.stripeIntegrationService.mapInputAppearanceRules(e)}}}this._stripeElements=yield this.scriptLoader.getElements(this._stripeUPEClient,{clientSecret:c,locale:$(h),appearance:g});const{getBillingAddress:v,getShippingAddress:S}=d,{postalCode:_}=S()||v()||{},f=this._stripeElements.getElement(L.PAYMENT)||this._stripeElements.create(L.PAYMENT,Object.assign({fields:{billingDetails:{email:z.NEVER,address:{country:z.NEVER,city:z.NEVER,postalCode:_?z.NEVER:z.AUTO}}},wallets:{applePay:z.NEVER,googlePay:z.NEVER,link:m?z.AUTO:z.NEVER}},this._getStripeElementTerms()));this.stripeIntegrationService.mountElement(f,n),f.on(x.READY,()=>{o()}),f.on(x.CHANGE,e=>{(null==e?void 0:e.value)&&\"type\"in e.value&&this._updateStripeLinkStateByElementType(e.value.type)}),this._isStripeElementUpdateEnabled&&(null==a||a(this._updateStripeElement.bind(this)))})}_processAdditionalActionWithStripeConfirmation(e,t,i=!1,n=!1){return X(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:r}=e.body.additional_action_required,{token:o}=r,{paymentIntent:s}=yield this._confirmStripePaymentOrThrow(t,r),d=this._getPaymentPayload(t,(null==s?void 0:s.id)||o,i,n);try{yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return X(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,o,!!this._allowRedisplayForStoredInstruments);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this._stripeUPEClient))?yield null===(n=this._stripeUPEClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this._stripeUPEClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new V;return t}catch(e){this.stripeIntegrationService.throwStripeError(a)}})}_processVaultedAdditionalAction(e,t,i=!1){var n;return X(this,void 0,void 0,function*(){if(!t||!S(e)||!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"}))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const r=e.body.three_ds_result.token;let s,d=!1;try{s=yield this._stripeUPEClient.confirmCardPayment(r)}catch(e){try{s=yield this._stripeUPEClient.retrievePaymentIntent(r)}catch(e){d=!0}}if((null==s?void 0:s.error)&&this.stripeIntegrationService.throwStripeError(s.error),!(null==s?void 0:s.paymentIntent)&&!d)throw new W;const l=this._getPaymentPayload(t,d?r:null===(n=null==s?void 0:s.paymentIntent)||void 0===n?void 0:n.id,!1,i);return this.paymentIntegrationService.submitPayment(l)})}_loadStripeJs(e){return X(this,void 0,void 0,function*(){if(this._stripeUPEClient)return this._stripeUPEClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale(),J,Z)})}_getPaymentPayload(e,t,i=!1,n=!1){var r;return{methodId:e,paymentData:{formattedPayload:{cart_id:(null===(r=this.paymentIntegrationService.getState().getCart())||void 0===r?void 0:r.id)||\"\",credit_card_token:{token:t},confirm:!1,vault_payment_instrument:i,set_as_default_stored_instrument:n}}}}_updateStripeElement({shouldShowTerms:e}){var t;const i=null===(t=this._stripeElements)||void 0===t?void 0:t.getElement(L.PAYMENT);null==i||i.update(Object.assign({},this._getStripeElementTerms(e)))}_getStripeElementTerms(e){let t=z.AUTO;return this._isStripeElementUpdateEnabled&&(t=e?z.AUTO:z.NEVER),{terms:{card:t}}}_updateStripeLinkStateByElementType(e){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),i=e===R.Link;!Q(t)&&i&&this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:i})}}const te=l(t=>{const i=new F((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new ee(t,i,new H(t,i))},[{gateway:\"stripeupe\"},{gateway:\"stripeupe\",id:\"klarna\"}]);var ie=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class ne{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){var t;return ie(this,void 0,void 0,function*(){const{stripeocs:i,methodId:n,gatewayId:r}=e;if(!(null==i?void 0:i.containerId))throw new v(a.PaymentNotInitialized);if(!r)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');try{yield this._initializeStripeElement(i,r,n)}catch(e){e instanceof Error&&(null===(t=i.onError)||void 0===t||t.call(i,e))}this.stripeIntegrationService.initCheckoutEventsSubscription(r,n,i,this.stripeElements)})}execute(e,t){return ie(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]),{methodId:r,gatewayId:o}=i||{};if(!this.stripeClient)throw new v(a.PaymentNotInitialized);if(!o||!r)throw new u('Unable to initialize payment because \"gatewayId\" or \"methodId\" argument is not provided.');const s=this.paymentIntegrationService.getState(),{isStoreCreditApplied:d}=s.getCheckoutOrThrow();d&&(yield this.paymentIntegrationService.applyStoreCredit(d)),yield this.stripeIntegrationService.updateStripePaymentIntent(o,r),yield this.paymentIntegrationService.submitOrder(n,t);const{clientToken:l}=s.getPaymentMethodOrThrow(r),c=this._getPaymentPayload(r,l||\"\");try{yield this.paymentIntegrationService.submitPayment(c)}catch(e){yield this._processAdditionalAction(e,r)}})}finalize(){return Promise.reject(new g)}deinitialize(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(L.PAYMENT);return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeElements=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,i){return ie(this,void 0,void 0,function*(){let n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i);if((null==n?void 0:n.clientToken)||(n=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}})).getPaymentMethodOrThrow(i)),!Y(n))throw new y(s.MissingPaymentMethod);const{clientToken:r,initializationData:o}=n,{shopperLanguage:a,customerSessionToken:d,enableLink:l}=o;if(!r)throw new y(s.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(o);const{appearance:c,containerId:u,fonts:h,layout:p,render:m,paymentMethodSelect:g,handleClosePaymentMethod:v,togglePreloader:S}=e;this.stripeElements=yield this.scriptLoader.getElements(this.stripeClient,{clientSecret:r,customerSessionClientSecret:d,locale:$(a),appearance:c,fonts:h});const{getBillingAddress:_,getShippingAddress:f}=this.paymentIntegrationService.getState(),I=_(),{postalCode:C}=f()||I||{},E=this.stripeElements.getElement(L.PAYMENT)||this.stripeElements.create(L.PAYMENT,{fields:{billingDetails:{email:z.NEVER,address:{country:z.NEVER,city:z.NEVER,postalCode:C?z.NEVER:z.AUTO}}},wallets:{applePay:z.NEVER,googlePay:z.NEVER,link:l?z.AUTO:z.NEVER},layout:p,savePaymentMethod:{maxVisiblePaymentMethods:20},defaultValues:{billingDetails:{email:(null==I?void 0:I.email)||\"\"}}});this.stripeIntegrationService.mountElement(E,u),E.on(x.LOADER_START,()=>{null==S||S(!1)}),E.on(x.READY,()=>{m()}),E.on(x.CHANGE,e=>{this._onStripeElementChange(e,t,i,g)}),null==v||v(this._collapseStripeElement.bind(this))})}_loadStripeJs(e){return ie(this,void 0,void 0,function*(){if(this.stripeClient)return this.stripeClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale())})}_collapseStripeElement(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(L.PAYMENT);null==t||t.collapse()}_getPaymentPayload(e,t,i){var n;const r=(null===(n=this.paymentIntegrationService.getState().getCart())||void 0===n?void 0:n.id)||\"\",{card:o,us_bank_account:s}=i||{},a=this._shouldSaveInstrument(o)||this._shouldSaveInstrument(s),d=this._getTokenizedOptions(t,i);return{methodId:e,paymentData:{formattedPayload:Object.assign({cart_id:r,confirm:!1,method:this.selectedMethodId,vault_payment_instrument:a},d)}}}_processAdditionalAction(e,t){return ie(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this.stripeClient||!this.stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(t,i),{client_secret:o,payment_method_options:s}=r||{},d=this._getPaymentPayload(t,o||n,s);try{return yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return ie(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this.stripeElements,o);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this.stripeClient))?yield null===(n=this.stripeClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this.stripeClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new V;return t}catch(e){return this.stripeIntegrationService.throwStripeError(a)}})}_onStripeElementChange(e,t,i,n){(e=>\"object\"==typeof e&&null!==e&&\"value\"in e&&\"collapsed\"in e)(e)&&!e.collapsed&&(this.selectedMethodId=e.value.type,null==n||n(`${t}-${i}`))}_shouldSaveInstrument(e){const t=null==e?void 0:e.setup_future_usage;return t===j.ON_SESSION||t===j.OFF_SESSION}_getTokenizedOptions(e,t){return this._shouldSaveInstrument(null==t?void 0:t.us_bank_account)?{tokenized_ach:{token:e}}:{credit_card_token:{token:e}}}}const re=l(t=>{const i=new F((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new ne(t,i,new H(t,i))},[{gateway:\"stripeocs\",id:\"optimized_checkout\"}]);class oe{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){var t,i,n,r,o;return i=this,n=void 0,o=function*(){let i;if(!e.stripeupe)throw new u('Unable to proceed because \"options\" argument is not provided.');const{container:n,gatewayId:r,methodId:o,onEmailChange:a,getStyles:d,isLoading:l}=e.stripeupe;Object.entries(e.stripeupe).forEach(([e,t])=>{if(!t)throw new u(`Unable to proceed because \"${e}\" argument is not provided.`)}),yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:o}});const c=this.paymentIntegrationService.getState(),h=c.getPaymentMethodOrThrow(o,r),{clientToken:p}=h;if(!Y(h)||!p)throw new y(s.MissingPaymentToken);const{email:m}=c.getCustomerOrThrow(),g=c.getPaymentProviderCustomerOrThrow(),v=(Q(g)?g:{}).stripeLinkAuthenticationState;if(!m){let e;const r=\"function\"==typeof d&&d();e=r?{variables:{colorPrimary:r.fieldInnerShadow,colorBackground:r.fieldBackground,colorText:r.labelText,colorDanger:r.fieldErrorText,colorTextSecondary:r.labelText,colorTextPlaceholder:r.fieldPlaceholderText},rules:{\".Input\":{borderColor:r.fieldBorder,color:r.fieldText,boxShadow:r.fieldInnerShadow}}}:{},i=yield this.scriptLoader.getStripeClient(h.initializationData,c.getCartLocale(),J,Z),this._stripeElements=yield this.scriptLoader.getElements(i,{clientSecret:p,appearance:e});const{getBillingAddress:o,getConsignments:u}=this.paymentIntegrationService.getState(),m=u(),g=null===(t=null==m?void 0:m[0])||void 0===t?void 0:t.id,{email:S}=o()||{},_=S?{defaultValues:{mode:k.SHIPPING,email:S}}:{},f=this._stripeElements.getElement(L.AUTHENTICATION)||this._stripeElements.create(L.AUTHENTICATION,_);f.on(x.CHANGE,e=>{if(!(\"authenticated\"in e))throw new y(s.MissingCustomer);this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:e.authenticated}),e.complete?a(e.authenticated,e.value.email):a(!1,\"\"),l&&l(!1),void 0===v&&e.authenticated&&g&&this.paymentIntegrationService.deleteConsignment(g)}),f.mount(`#${n}`)}},new((r=void 0)||(r=Promise))(function(e,t){function s(e){try{d(o.next(e))}catch(e){t(e)}}function a(e){try{d(o.throw(e))}catch(e){t(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r(function(e){e(i)})).then(s,a)}d((o=o.apply(i,n||[])).next())})}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(L.AUTHENTICATION))||void 0===t||t.unmount(),Promise.resolve()}signIn(e,t){return this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}signOut(e){return this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const se=l(t=>new oe(t,new F((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{id:\"stripeupe\"}]),ae={size:70,color:\"#d9d9d9\",backgroundColor:\"#ffffff\"},de={position:\"fixed\",\"background-color\":\"rgba(0, 0, 0, 0.4)\",\"z-index\":\"1000\"},le=\"embedded-checkout-loading-indicator-rotation\";class ce{constructor(e){this.styles=Object.assign(Object.assign({},ae),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error(\"Unable to attach the loading indicator because the parent ID is not valid.\");t.appendChild(this.container)}this.container.style.visibility=\"visible\",this.container.style.opacity=\"1\"}hide(){const e=()=>{this.container.style.visibility=\"hidden\",this.container.removeEventListener(\"transitionend\",e)};this.container.addEventListener(\"transitionend\",e),this.container.style.opacity=\"0\"}buildContainer(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.bottom=\"0\",e.style.left=\"0\",e.style.height=\"100%\",e.style.width=\"100%\",e.style.position=\"absolute\",e.style.right=\"0\",e.style.top=\"0\",e.style.transition=\"all 250ms ease-out\",e.style.opacity=\"0\",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border=\"solid 1px\",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin=\"0 auto\",e.style.position=\"absolute\",e.style.left=\"0\",e.style.right=\"0\",e.style.top=\"50%\",e.style.transform=\"translateY(-50%) rotate(0deg)\",e.style.transformStyle=\"preserve-3d\",e.style.animation=`${le} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach(i=>{e.style.setProperty(i,t[i])})}defineAnimation(){var e;if(document.getElementById(le))return;const t=document.createElement(\"style\");t.id=le,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\\n                @keyframes ${le} {\\n                    0% { transform: translateY(-50%) rotate(0deg); }\\n                    100% { transform: translateY(-50%) rotate(360deg); }\\n                }\\n            `,0)}}class ue{constructor(e){this._decimalPlaces=e}toInteger(e){return Math.round(e*Math.pow(10,this._decimalPlaces))}}const he=[\"AC\",\"AD\",\"AE\",\"AF\",\"AG\",\"AI\",\"AL\",\"AM\",\"AO\",\"AQ\",\"AR\",\"AT\",\"AU\",\"AW\",\"AX\",\"AZ\",\"BA\",\"BB\",\"BD\",\"BE\",\"BF\",\"BG\",\"BH\",\"BI\",\"BJ\",\"BL\",\"BM\",\"BN\",\"BO\",\"BQ\",\"BR\",\"BS\",\"BT\",\"BV\",\"BW\",\"BY\",\"BZ\",\"CA\",\"CD\",\"CF\",\"CG\",\"CH\",\"CI\",\"CK\",\"CL\",\"CM\",\"CN\",\"CO\",\"CR\",\"CV\",\"CW\",\"CY\",\"CZ\",\"DE\",\"DJ\",\"DK\",\"DM\",\"DO\",\"DZ\",\"EC\",\"EE\",\"EG\",\"EH\",\"ER\",\"ES\",\"ET\",\"FI\",\"FJ\",\"FK\",\"FO\",\"FR\",\"GA\",\"GB\",\"GD\",\"GE\",\"GF\",\"GG\",\"GH\",\"GI\",\"GL\",\"GM\",\"GN\",\"GP\",\"GQ\",\"GR\",\"GS\",\"GT\",\"GU\",\"GW\",\"GY\",\"HK\",\"HN\",\"HR\",\"HT\",\"HU\",\"ID\",\"IE\",\"IL\",\"IM\",\"IN\",\"IO\",\"IQ\",\"IS\",\"IT\",\"JE\",\"JM\",\"JO\",\"JP\",\"KE\",\"KG\",\"KH\",\"KI\",\"KM\",\"KN\",\"KR\",\"KW\",\"KY\",\"KZ\",\"LA\",\"LB\",\"LC\",\"LI\",\"LK\",\"LR\",\"LS\",\"LT\",\"LU\",\"LV\",\"LY\",\"MA\",\"MC\",\"MD\",\"ME\",\"MF\",\"MG\",\"MK\",\"ML\",\"MM\",\"MN\",\"MO\",\"MQ\",\"MR\",\"MS\",\"MT\",\"MU\",\"MV\",\"MW\",\"MX\",\"MY\",\"MZ\",\"NA\",\"NC\",\"NE\",\"NG\",\"NI\",\"NL\",\"NO\",\"NP\",\"NR\",\"NU\",\"NZ\",\"OM\",\"PA\",\"PE\",\"PF\",\"PG\",\"PH\",\"PK\",\"PL\",\"PM\",\"PN\",\"PR\",\"PS\",\"PT\",\"PY\",\"QA\",\"RE\",\"RO\",\"RS\",\"RU\",\"RW\",\"SA\",\"SB\",\"SC\",\"SD\",\"SE\",\"SG\",\"SH\",\"SI\",\"SJ\",\"SK\",\"SL\",\"SM\",\"SN\",\"SO\",\"SR\",\"SS\",\"ST\",\"SV\",\"SX\",\"SZ\",\"TA\",\"TC\",\"TD\",\"TF\",\"TG\",\"TH\",\"TJ\",\"TK\",\"TL\",\"TM\",\"TN\",\"TO\",\"TR\",\"TT\",\"TV\",\"TW\",\"TZ\",\"UA\",\"UG\",\"US\",\"UY\",\"UZ\",\"VA\",\"VC\",\"VE\",\"VG\",\"VN\",\"VU\",\"WF\",\"WS\",\"XK\",\"YE\",\"YT\",\"ZA\",\"ZM\",\"ZW\",\"ZZ\"];var pe=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class me{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return pe(this,void 0,void 0,function*(){const{stripeocs:t}=e||{};if(!t)throw new u('Unable to proceed because \"options\" argument is not provided.');const{methodId:i,gatewayId:n,container:r}=t;if(!r||!i||!n)throw new v(a.PaymentNotInitialized);const o=yield this.paymentIntegrationService.loadPaymentMethod(n,{params:{method:i}}),d=o.getPaymentMethodOrThrow(i,n),{loadingContainerId:l,buttonHeight:c,onComplete:h}=t;if(this._loadingIndicatorContainer=l,this._onComplete=h,!Y(d))throw new y(s.MissingPaymentMethod);const{initializationData:p}=d,{captureMethod:m}=p;return this._captureMethod=m,this._stripeClient=yield this.scriptLoader.getStripeClient(p,o.getCartLocale()),yield this._mountExpressCheckoutElement(i,r,this._stripeClient,c),Promise.resolve()})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i,n=40){return pe(this,void 0,void 0,function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:z.AUTO,applePay:z.NEVER,googlePay:z.NEVER,amazonPay:z.NEVER,paypal:z.NEVER,klarna:z.NEVER},buttonHeight:n}),{cartAmount:s}=this.paymentIntegrationService.getState().getCartOrThrow(),a=Object.assign({mode:\"payment\",amount:this._toCents(s),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=i.elements(a),this._linkV2Element=this._stripeElements.create(L.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)})}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(x.SHIPPING_ADDRESS_CHANGE,e=>pe(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),e.on(x.SHIPPING_RATE_CHANGE,e=>pe(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),e.on(x.CONFIRM,e=>pe(this,void 0,void 0,function*(){return this._onConfirm(e,t)})),e.on(x.CANCEL,this._onCancel)}_onShippingAddressChange(e){return pe(this,void 0,void 0,function*(){if(\"address\"in e){const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:n})}})}_onCancel(){throw new _}_onShippingRateChange(e){return pe(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return pe(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return pe(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return pe(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return pe(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:z.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new V;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return pe(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:R.Link})}}}_shouldRequireShippingAddress(){const{getCartOrThrow:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e();return!!t.physicalItems.length}_updateDisplayedPrice(){return pe(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){if(!this._currencyCode){const{code:e}=this.paymentIntegrationService.getState().getCartOrThrow().currency;this._currencyCode=e.toLowerCase()}return this._currencyCode}_getTotalPrice(){return pe(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:e,getCartOrThrow:t}=this.paymentIntegrationService.getState(),{decimalPlaces:i}=t().currency,n=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(e().outstandingBalance,i).toFixed(i);return this._toCents(+n)})}_getAvailableCountries(){var e;return pe(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>he.includes(e))})}_getAvailableShippingOptions(){var e,t;return pe(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState().getConsignments();if(!(null==i?void 0:i[0]))return;const n=i[0],r=(n.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=n.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort(e=>e.id===o?-1:0):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return pe(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new ue(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const ye=l(t=>{const i=new F((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new ce({containerStyles:de});return new me(t,i,new H(t,i),n)},[{id:\"stripeocs\"}]);var ge=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class ve{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return ge(this,void 0,void 0,function*(){const{stripeocs:t,containerId:i}=e||{};if(!t||!i)throw new v(a.PaymentNotInitialized);const{methodId:n,gatewayId:r}=t;if(!n||!r)throw new y(s.MissingPaymentMethod);const o=yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:n}}),d=o.getPaymentMethodOrThrow(n,r),{loadingContainerId:l,buttonHeight:c,onComplete:u}=t;if(this._loadingIndicatorContainer=l,this._onComplete=u,!Y(d))throw new y(s.MissingPaymentMethod);const{initializationData:h}=d,{captureMethod:p}=h;return this._captureMethod=p,this._stripeClient=yield this.scriptLoader.getStripeClient(h,o.getCartLocale()),yield this.paymentIntegrationService.loadDefaultCheckout(),yield this._mountExpressCheckoutElement(n,i,this._stripeClient,c),Promise.resolve()})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i,n=40){return ge(this,void 0,void 0,function*(){const r=this._shouldRequireShippingAddress(),o=Object.assign(Object.assign(Object.assign({shippingAddressRequired:r},r?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),r?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:z.AUTO,applePay:z.NEVER,googlePay:z.NEVER,amazonPay:z.NEVER,paypal:z.NEVER,klarna:z.NEVER},buttonHeight:n}),{cartAmount:s=1}=this.paymentIntegrationService.getState().getCart()||{},a=Object.assign({mode:\"payment\",amount:this._toCents(s),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=i.elements(a),this._linkV2Element=this._stripeElements.create(L.EXPRESS_CHECKOUT,o),this._linkV2Element.mount(`#${t}`),this._initializeEvents(this._linkV2Element,e)})}_initializeEvents(e,t){this._shouldRequireShippingAddress()&&(e.on(x.SHIPPING_ADDRESS_CHANGE,e=>ge(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),e.on(x.SHIPPING_RATE_CHANGE,e=>ge(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),e.on(x.CONFIRM,e=>ge(this,void 0,void 0,function*(){return this._onConfirm(e,t)})),e.on(x.CANCEL,this._onCancel)}_onShippingAddressChange(e){return ge(this,void 0,void 0,function*(){if(\"address\"in e){const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),e.resolve({shippingRates:n})}})}_onCancel(){throw new _}_onShippingRateChange(e){return ge(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return ge(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return ge(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return ge(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return ge(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:z.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new V;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return ge(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/checkout/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,payment_method_id:R.Link})}}}_shouldRequireShippingAddress(){const{getCart:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e()||{};return!!(null==t?void 0:t.physicalItems.length)}_updateDisplayedPrice(){return ge(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){var e;if(!this._currencyCode){const t=null===(e=this.paymentIntegrationService.getState().getCart())||void 0===e?void 0:e.currency;t&&(this._currencyCode=t.code.toLowerCase())}return this._currencyCode}_getTotalPrice(){var e;return ge(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:t,getCart:i}=this.paymentIntegrationService.getState(),{decimalPlaces:n}=(null===(e=i())||void 0===e?void 0:e.currency)||{},o=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(t().outstandingBalance,n).toFixed(n);return this._toCents(+o)})}_getAvailableCountries(){var e;return ge(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>he.includes(e))})}_getAvailableShippingOptions(){var e,t;return ge(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState().getConsignments();if(!(null==i?void 0:i[0]))return;const n=i[0],r=(n.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),o=null===(e=n.selectedShippingOption)||void 0===e?void 0:e.id;return o?r.sort(e=>e.id===o?-1:0):yield this._handleShippingOptionChange(null===(t=r[0])||void 0===t?void 0:t.id),r})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return ge(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new ue(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const Se=l(t=>{const i=new F((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new ce({containerStyles:de});return new ve(t,i,new H(t,i),n)},[{id:\"stripeocs\"}]);\n//# sourceMappingURL=stripe.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vY2hlY2tvdXQtc2RrLWpzL2Rpc3QvZXNtL2ludGVncmF0aW9ucy9zdHJpcGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7O0FBQTZJLGFBQWEsZ0JBQWdCLHdCQUF3QixhQUFhLEVBQUUsWUFBWSwrREFBK0QsdUJBQXVCLEVBQUUsc0RBQXNELHNCQUFzQixlQUFlLE1BQU0sdVRBQXVULGtCQUFrQixlQUFlLGlIQUFpSCxrQkFBa0IsZUFBZSwrRUFBK0UsU0FBUyxHQUFHLHlEQUF5RCxhQUFhLHNEQUFzRCxjQUFjLDRNQUE0TSxjQUFjLCtCQUErQixhQUFhLHN5QkFBc3lCLFNBQVMsR0FBRyxrQkFBa0IsZUFBZSxrQkFBa0IsVUFBVSxvR0FBb0csK0VBQStFLCtGQUErRix1RkFBdUYsdUZBQXVGLDRIQUE0SCxpRkFBaUYsc0dBQXNHLHFGQUFxRixnSEFBZ0gsNkhBQTZILHNHQUFzRyw2RUFBNkUsMkVBQTJFLGtCQUFrQixjQUFjLG1LQUFtSyxhQUFhLHlTQUF5UyxTQUFTLEdBQUcsa0JBQWtCLGVBQWUsa0JBQWtCLFVBQVUsd0hBQXdILHNIQUFzSCx3SEFBd0gsNkhBQTZILDRGQUE0RixpRkFBaUYsb0RBQW9ELGtCQUFrQixlQUFlLGtIQUFrSCxjQUFjLDZPQUE2TyxZQUFZLGFBQWEsb0NBQW9DLFNBQVMsZUFBZSxnSkFBZ0osU0FBUyxlQUFlLDBFQUEwRSxTQUFTLGVBQWUsNkJBQTZCLFNBQVMsR0FBRyxrQkFBa0IsZUFBZSxvTEFBb0wsd0JBQXdCLHlDQUF5QyxjQUFjLElBQUksYUFBYSxTQUFTLE1BQU0sY0FBYyxJQUFJLGNBQWMsU0FBUyxNQUFNLGNBQWMsTUFBTSxnRUFBZ0UsS0FBSyxhQUFhLCtCQUErQixHQUFHLDJCQUEyQixRQUFRLGlCQUFpQixxREFBcUQsY0FBYyx3Q0FBd0MsTUFBTSxrQ0FBa0MsR0FBRyxnR0FBZ0csZ0RBQWdELDhFQUE4RSxvQkFBb0IsZ0hBQWdILEdBQUcsMkNBQTJDLHlDQUF5QyxzUEFBc1AsRUFBRSxhQUFhLFFBQVEs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QWtDLFVBQVUseUNBQXlDLE1BQU0sdUJBQXVCLGdGQUFnRixNQUFNLElBQUksc1BBQXNQLHlFQUF5RSx1RUFBdUUsRUFBRSw2RUFBNkUsU0FBUyxTQUFTLDBEQUEwRCxFQUFFLHdCQUF3Qix5Q0FBeUMseUlBQXlJLEVBQUUsd0JBQXdCLE1BQU0scUdBQXFHLE9BQU8sd0JBQXdCLDhDQUE4QyxVQUFVLElBQUksbUJBQW1CLFNBQVMsR0FBRyxHQUFHLG9DQUFvQyxJQUFJLGdDQUFnQyxNQUFNLFVBQVUsNENBQTRDLFlBQVksU0FBUyxnREFBZ0Qsd0JBQXdCLHlDQUF5QyxtREFBbUQsK0VBQStFLEVBQUUsRUFBRSxlQUFlLE1BQU0sd0JBQXdCLHFHQUFxRyw2Q0FBNkMsMEJBQTBCLGlCQUFpQixNQUFNLHlDQUF5QyxvREFBb0QsTUFBTSwrQkFBK0IsNENBQTRDLGdCQUFnQixtREFBbUQsR0FBRyw2Q0FBQyxzQ0FBc0MseUJBQXlCLEVBQUUseUJBQXlCLE1BQU0seUNBQXlDLHFFQUFxRSxnSEFBZ0gsRUFBRSwrQkFBK0IsUUFBUSx5Q0FBeUMsb0VBQW9FLGlDQUFpQyw0SkFBNEosb0hBQW9ILEVBQUUsMEJBQTBCLDBCQUEwQixFQUFFLE9BQU8sNENBQTRDLCtCQUErQix5Q0FBeUMscUdBQXFHLEVBQUUsd0JBQXdCLDBEQUEwRCxNQUFNLFVBQVUsNENBQTRDLFdBQVcsU0FBUyx3Q0FBd0MsWUFBWSx5REFBeUQsMEJBQTBCLDJCQUEyQiw2SEFBNkgsZUFBZSxjQUFjLDJFQUFDLGNBQWMsbUJBQW1CLEVBQUUsZ0NBQWdDLEdBQUcsZUFBZSxHQUF3TztBQUNsemtFIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vY2hlY2tvdXQvLi4vY2hlY2tvdXQtc2RrLWpzL2Rpc3QvZXNtL2ludGVncmF0aW9ucy9zdHJpcGUuanM/YTE3NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnR7Z2V0U2NyaXB0TG9hZGVyIGFzIGV9ZnJvbVwiQGJpZ2NvbW1lcmNlL3NjcmlwdC1sb2FkZXJcIjtpbXBvcnR7aW5jbHVkZXMgYXMgdCxpc0VtcHR5IGFzIGksb21pdEJ5IGFzIG4scm91bmQgYXMgcixzb21lIGFzIG99ZnJvbVwibG9kYXNoXCI7dmFyIHMsYSxkPXt9O2Z1bmN0aW9uIGwoZSx0KXtyZXR1cm4gT2JqZWN0LmFzc2lnbihlLHtyZXNvbHZlSWRzOnR9KX1kLmQ9KGUsdCk9Pntmb3IodmFyIGkgaW4gdClkLm8odCxpKSYmIWQubyhlLGkpJiZPYmplY3QuZGVmaW5lUHJvcGVydHkoZSxpLHtlbnVtZXJhYmxlOiEwLGdldDp0W2ldfSl9LGQubz0oZSx0KT0+T2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsdCk7Y2xhc3MgYyBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGUpe3ZhciB0O3N1cGVyKGV8fFwiQW4gdW5leHBlY3RlZCBlcnJvciBoYXMgb2NjdXJyZWQuXCIpLHRoaXMubmFtZT1cIlN0YW5kYXJkRXJyb3JcIix0aGlzLnR5cGU9XCJzdGFuZGFyZFwiLHQ9bmV3LnRhcmdldC5wcm90b3R5cGUsT2JqZWN0LnNldFByb3RvdHlwZU9mP09iamVjdC5zZXRQcm90b3R5cGVPZih0aGlzLHQpOnRoaXMuX19wcm90b19fPXQsXCJmdW5jdGlvblwiPT10eXBlb2YgRXJyb3IuY2FwdHVyZVN0YWNrVHJhY2U/RXJyb3IuY2FwdHVyZVN0YWNrVHJhY2UodGhpcyxuZXcudGFyZ2V0KTp0aGlzLnN0YWNrPW5ldyBFcnJvcih0aGlzLm1lc3NhZ2UpLnN0YWNrfX1jbGFzcyB1IGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIkludmFsaWQgYXJndW1lbnRzIGhhdmUgYmVlbiBwcm92aWRlZC5cIiksdGhpcy5uYW1lPVwiSW52YWxpZEFyZ3VtZW50RXJyb3JcIix0aGlzLnR5cGU9XCJpbnZhbGlkX2FyZ3VtZW50XCJ9fWNsYXNzIGggZXh0ZW5kcyB1e2NvbnN0cnVjdG9yKGUpe2xldCB0PVwiVW5hYmxlIHRvIHN1Ym1pdCBwYXltZW50IGZvciB0aGUgb3JkZXIgYmVjYXVzZSB0aGUgcGF5bG9hZCBpcyBpbnZhbGlkLlwiO2UmJih0PWAke3R9IE1ha2Ugc3VyZSB0aGUgZm9sbG93aW5nIGZpZWxkcyBhcmUgcHJvdmlkZWQgY29ycmVjdGx5OiAke2Uuam9pbihcIiwgXCIpfS5gKSxzdXBlcih0KSx0aGlzLm5hbWU9XCJQYXltZW50QXJndW1lbnRJbnZhbGlkRXJyb3JcIn19ZnVuY3Rpb24gcChlKXtyZXR1cm4hKFwib2JqZWN0XCIhPXR5cGVvZiBlfHxudWxsPT09ZXx8dm9pZCAwIT09ZS5zaG91bGRTYXZlSW5zdHJ1bWVudCYmXCJib29sZWFuXCIhPXR5cGVvZiBlLnNob3VsZFNhdmVJbnN0cnVtZW50fHx2b2lkIDAhPT1lLnNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQmJlwiYm9vbGVhblwiIT10eXBlb2YgZS5zaG91bGRTZXRBc0RlZmF1bHRJbnN0cnVtZW50KX1mdW5jdGlvbiBtKGUpe3JldHVybiBCb29sZWFuKGUuaW5zdHJ1bWVudElkKX0hZnVuY3Rpb24oZSl7ZVtlLk1pc3NpbmdCaWxsaW5nQWRkcmVzcz0wXT1cIk1pc3NpbmdCaWxsaW5nQWRkcmVzc1wiLGVbZS5NaXNzaW5nQ2FydD0xXT1cIk1pc3NpbmdDYXJ0XCIsZVtlLk1pc3NpbmdDaGVja291dD0yXT1cIk1pc3NpbmdDaGVja291dFwiLGVbZS5NaXNzaW5nQ29uc2lnbm1lbnRzPTNdPVwiTWlzc2luZ0NvbnNpZ25tZW50c1wiLGVbZS5NaXNzaW5nQ3VzdG9tZXI9NF09XCJNaXNzaW5nQ3VzdG9tZXJcIixlW2UuTWlzc2luZ0NoZWNrb3V0Q29uZmlnPTVdPVwiTWlzc2luZ0NoZWNrb3V0Q29uZmlnXCIsZVtlLk1pc3NpbmdPcmRlcj02XT1cIk1pc3NpbmdPcmRlclwiLGVbZS5NaXNzaW5nT3JkZXJDb25maWc9N109XCJNaXNzaW5nT3JkZXJDb25maWdcIixlW2UuTWlzc2luZ09yZGVySWQ9OF09XCJNaXNzaW5nT3JkZXJJZFwiLGVbZS5NaXNzaW5nUGF5bWVudD05XT1cIk1pc3NpbmdQYXltZW50XCIsZVtlLk1pc3NpbmdQYXltZW50SWQ9MTBdPVwiTWlzc2luZ1BheW1lbnRJZFwiLGVbZS5NaXNzaW5nUGF5bWVudEluc3RydW1lbnQ9MTFdPVwiTWlzc2luZ1BheW1lbnRJbnN0cnVtZW50XCIsZVtlLk1pc3NpbmdQYXltZW50TWV0aG9kPTEyXT1cIk1pc3NpbmdQYXltZW50TWV0aG9kXCIsZVtlLk1pc3NpbmdQYXltZW50UmVkaXJlY3RVcmw9MTNdPVwiTWlzc2luZ1BheW1lbnRSZWRpcmVjdFVybFwiLGVbZS5NaXNzaW5nUGF5bWVudFN0YXR1cz0xNF09XCJNaXNzaW5nUGF5bWVudFN0YXR1c1wiLGVbZS5NaXNzaW5nUGF5bWVudFRva2VuPTE1XT1cIk1pc3NpbmdQYXltZW50VG9rZW5cIixlW2UuTWlzc2luZ1NoaXBwaW5nQWRkcmVzcz0xNl09XCJNaXNzaW5nU2hpcHBpbmdBZGRyZXNzXCJ9KHN8fChzPXt9KSk7Y2xhc3MgeSBleHRlbmRzIGN7Y29uc3RydWN0b3IoZSl7c3VwZXIoZnVuY3Rpb24oZSl7c3dpdGNoKGUpe2Nhc2Ugcy5NaXNzaW5nQmlsbGluZ0FkZHJlc3M6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGJpbGxpbmcgYWRkcmVzcyBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nQ2FydDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgY2FydCBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nQ29uc2lnbm1lbnRzOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBjb25zaWdubWVudHMgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIHMuTWlzc2luZ0NoZWNrb3V0OnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBjaGVja291dCBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nQ3VzdG9tZXI6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGN1c3RvbWVyIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdDaGVja291dENvbmZpZzpjYXNlIHMuTWlzc2luZ09yZGVyQ29uZmlnOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBjb25maWd1cmF0aW9uIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdPcmRlcjpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2Ugb3JkZXIgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIHMuTWlzc2luZ09yZGVySWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIG9yZGVyIElEIGlzIHVuYXZhaWxhYmxlIG9yIG5vdCBnZW5lcmF0ZWQgeWV0LlwiO2Nhc2Ugcy5NaXNzaW5nUGF5bWVudDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgcGF5bWVudCBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nUGF5bWVudFRva2VuOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgdG9rZW4gcmVxdWlyZWQgdG8gc3VibWl0IGEgcGF5bWVudCBpcyBtaXNzaW5nLlwiO2Nhc2Ugcy5NaXNzaW5nUGF5bWVudE1ldGhvZDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgcGF5bWVudCBtZXRob2QgZGF0YSBpcyB1bmF2YWlsYWJsZSBvciBub3QgcHJvcGVybHkgY29uZmlndXJlZC5cIjtjYXNlIHMuTWlzc2luZ1NoaXBwaW5nQWRkcmVzczpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2Ugc2hpcHBpbmcgYWRkcmVzcyBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2RlZmF1bHQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSByZXF1aXJlZCBkYXRhIGlzIHVuYXZhaWxhYmxlLlwifX0oZSkpLHRoaXMuc3VidHlwZT1lLHRoaXMubmFtZT1cIk1pc3NpbmdEYXRhRXJyb3JcIix0aGlzLnR5cGU9XCJtaXNzaW5nX2RhdGFcIn19Y2xhc3MgZyBleHRlbmRzIGN7Y29uc3RydWN0b3IoKXtzdXBlcihcIlRoZSBjdXJyZW50IG9yZGVyIGRvZXMgbm90IG5lZWQgdG8gYmUgZmluYWxpemVkIGF0IHRoaXMgc3RhZ2UuXCIpLHRoaXMubmFtZT1cIk9yZGVyRmluYWxpemF0aW9uTm90UmVxdWlyZWRFcnJvclwiLHRoaXMudHlwZT1cIm9yZGVyX2ZpbmFsaXphdGlvbl9ub3RfcmVxdWlyZWRcIn19IWZ1bmN0aW9uKGUpe2VbZS5DaGVja291dEJ1dHRvbk5vdEluaXRpYWxpemVkPTBdPVwiQ2hlY2tvdXRCdXR0b25Ob3RJbml0aWFsaXplZFwiLGVbZS5DdXN0b21lck5vdEluaXRpYWxpemVkPTFdPVwiQ3VzdG9tZXJOb3RJbml0aWFsaXplZFwiLGVbZS5QYXltZW50Tm90SW5pdGlhbGl6ZWQ9Ml09XCJQYXltZW50Tm90SW5pdGlhbGl6ZWRcIixlW2UuU2hpcHBpbmdOb3RJbml0aWFsaXplZD0zXT1cIlNoaXBwaW5nTm90SW5pdGlhbGl6ZWRcIixlW2UuU3BhbVByb3RlY3Rpb25Ob3RJbml0aWFsaXplZD00XT1cIlNwYW1Qcm90ZWN0aW9uTm90SW5pdGlhbGl6ZWRcIn0oYXx8KGE9e30pKTtjbGFzcyB2IGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihmdW5jdGlvbihlKXtzd2l0Y2goZSl7Y2FzZSBhLkN1c3RvbWVyTm90SW5pdGlhbGl6ZWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBjdXN0b21lciBzdGVwIG9mIGNoZWNrb3V0IGhhcyBub3QgYmVlbiBpbml0aWFsaXplZC5cIjtjYXNlIGEuUGF5bWVudE5vdEluaXRpYWxpemVkOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgcGF5bWVudCBzdGVwIG9mIGNoZWNrb3V0IGhhcyBub3QgYmVlbiBpbml0aWFsaXplZC5cIjtjYXNlIGEuU2hpcHBpbmdOb3RJbml0aWFsaXplZDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIHNoaXBwaW5nIHN0ZXAgb2YgY2hlY2tvdXQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2Nhc2UgYS5TcGFtUHJvdGVjdGlvbk5vdEluaXRpYWxpemVkOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgY2hlY2tvdXQgc3BhbSBwcm90ZWN0aW9uIGhhcyBub3QgYmVlbiBpbml0aWFsaXplZC5cIjtkZWZhdWx0OnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgcmVxdWlyZWQgY29tcG9uZW50IGhhcyBub3QgYmVlbiBpbml0aWFsaXplZC5cIn19KGUpKSx0aGlzLnN1YnR5cGU9ZSx0aGlzLm5hbWU9XCJOb3RJbml0aWFsaXplZEVycm9yXCIsdGhpcy50eXBlPVwibm90X2luaXRpYWxpemVkXCJ9fWNvbnN0IFM9ZT0+XCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcImJvZHlcImluIGU7Y2xhc3MgXyBleHRlbmRzIGN7Y29uc3RydWN0b3IoZSl7c3VwZXIoZXx8XCJQYXltZW50IHByb2Nlc3Mgd2FzIGNhbmNlbGxlZC5cIiksdGhpcy5uYW1lPVwiUGF5bWVudE1ldGhvZENhbmNlbGxlZEVycm9yXCIsdGhpcy50eXBlPVwicGF5bWVudF9jYW5jZWxsZWRcIn19ZnVuY3Rpb24gZihlKXtyZXR1cm4gbnVsbCE9PWUmJlwib2JqZWN0XCI9PXR5cGVvZiBlJiZcImNhcmROdW1iZXJFbGVtZW50T3B0aW9uc1wiaW4gZSYmXCJjYXJkQ3ZjRWxlbWVudE9wdGlvbnNcImluIGUmJlwiY2FyZEV4cGlyeUVsZW1lbnRPcHRpb25zXCJpbiBlJiZ2b2lkIDAhPT1lLmNhcmROdW1iZXJFbGVtZW50T3B0aW9ucyYmdm9pZCAwIT09ZS5jYXJkQ3ZjRWxlbWVudE9wdGlvbnMmJnZvaWQgMCE9PWUuY2FyZEV4cGlyeUVsZW1lbnRPcHRpb25zfXZhciBJLEMsRSxQOyFmdW5jdGlvbihlKXtlLlNvbGlkPVwic29saWRcIixlLkRlZmF1bHQ9XCJkZWZhdWx0XCJ9KEl8fChJPXt9KSksZnVuY3Rpb24oZSl7ZS5BbGlwYXk9XCJhbGlwYXlcIixlLkNhcmRDdmM9XCJjYXJkQ3ZjXCIsZS5DYXJkRXhwaXJ5PVwiY2FyZEV4cGlyeVwiLGUuQ2FyZE51bWJlcj1cImNhcmROdW1iZXJcIixlLkNyZWRpdENhcmQ9XCJjYXJkXCIsZS5JREVBTD1cImlkZWFsQmFua1wiLGUuU2VwYT1cImliYW5cIn0oQ3x8KEM9e30pKSxmdW5jdGlvbihlKXtlLkFsaXBheT1cImFsaXBheVwiLGUuQ3JlZGl0Q2FyZD1cImNhcmRcIixlLklERUFMPVwiaWRlYWxcIixlLlNlcGE9XCJzZXBhX2RlYml0XCJ9KEV8fChFPXt9KSksZnVuY3Rpb24oZSl7ZS5BdXRoRmFpbHVyZT1cImF1dGhfZmFpbHVyZVwifShQfHwoUD17fSkpO2NsYXNzIGIgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUpe3N1cGVyKGU9PT1QLkF1dGhGYWlsdXJlP1wiVXNlciBkaWQgbm90IGF1dGhlbnRpY2F0ZVwiOlwiVGhlcmUgd2FzIGFuIGVycm9yIHdoaWxlIHByb2Nlc3NpbmcgeW91ciBwYXltZW50LiBQbGVhc2UgdHJ5IGFnYWluIG9yIGNvbnRhY3QgdXMuXCIpLHRoaXMudHlwZT1cInN0cmlwZXYzX2Vycm9yXCIsdGhpcy5zdWJ0eXBlPWV9fXZhciB3PWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NvbnN0IEE9W0MuQWxpcGF5LEMuSURFQUxdO2NsYXNzIE97Y29uc3RydWN0b3IoZSx0KXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10fWluaXRpYWxpemUoZSl7cmV0dXJuIHcodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3N0cmlwZXYzOnQsbWV0aG9kSWQ6aSxnYXRld2F5SWQ6bn09ZTtpZighbil0aHJvdyBuZXcgdSgnVW5hYmxlIHRvIGluaXRpYWxpemUgcGF5bWVudCBiZWNhdXNlIFwiZ2F0ZXdheUlkXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO3RoaXMuaW5pdGlhbGl6ZU9wdGlvbnM9dCx0aGlzLmlzRGVpbml0aWFsaXplPSExO2NvbnN0IHI9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSkse2luaXRpYWxpemF0aW9uRGF0YTp7c3RyaXBlUHVibGlzaGFibGVLZXk6byxzdHJpcGVDb25uZWN0ZWRBY2NvdW50OnMsdXNlSW5kaXZpZHVhbENhcmRGaWVsZHM6YSxhbGxvd1JlZGlzcGxheUZvclN0b3JlZEluc3RydW1lbnRzOmR9fT1yO3RoaXMuX2FsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM9ZDtjb25zdCBsPXRoaXMuZ2V0SW5pdGlhbGl6ZU9wdGlvbnMoKS5mb3JtO3RoaXMudXNlSW5kaXZpZHVhbENhcmRGaWVsZHM9YSx0aGlzLnN0cmlwZVYzQ2xpZW50PXlpZWxkIHRoaXMubG9hZFN0cmlwZUpzKG8scyksdGhpcy5pc0NyZWRpdENhcmQoaSkmJnRoaXMuc2hvdWxkU2hvd1RTVkhvc3RlZEZvcm0oaSxuKSYmbD90aGlzLmhvc3RlZEZvcm09eWllbGQgdGhpcy5tb3VudENhcmRWZXJpZmljYXRpb25GaWVsZHMobCk6dGhpcy5zdHJpcGVFbGVtZW50PXlpZWxkIHRoaXMubW91bnRDYXJkRmllbGRzKGkpfSl9ZXhlY3V0ZShlLGkpe3ZhciBuLHI7cmV0dXJuIHcodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3BheW1lbnQ6b309ZSxhPWZ1bmN0aW9uKGUsdCl7dmFyIGk9e307Zm9yKHZhciBuIGluIGUpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbikmJnQuaW5kZXhPZihuKTwwJiYoaVtuXT1lW25dKTtpZihudWxsIT1lJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgcj0wO2ZvcihuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7cjxuLmxlbmd0aDtyKyspdC5pbmRleE9mKG5bcl0pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLG5bcl0pJiYoaVtuW3JdXT1lW25bcl1dKX1yZXR1cm4gaX0oZSxbXCJwYXltZW50XCJdKTtsZXQgZCxsO2lmKCFvfHwhby5wYXltZW50RGF0YSl0aHJvdyBuZXcgaChbXCJwYXltZW50LnBheW1lbnREYXRhXCJdKTtjb25zdHtwYXltZW50RGF0YTpjLGdhdGV3YXlJZDp1LG1ldGhvZElkOmd9PW8se3Nob3VsZFNhdmVJbnN0cnVtZW50OnYsc2hvdWxkU2V0QXNEZWZhdWx0SW5zdHJ1bWVudDpTfT1wKGMpP2M6e3Nob3VsZFNhdmVJbnN0cnVtZW50OiExLHNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQ6ITF9LF89dChBLGcpLHtpc1N0b3JlQ3JlZGl0QXBwbGllZDpmfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDaGVja291dE9yVGhyb3coKTtmJiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmFwcGx5U3RvcmVDcmVkaXQoZikpO3RyeXtfJiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdE9yZGVyKGEsaSkpLHUmJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2QodSx7cGFyYW1zOnttZXRob2Q6Z319KSk7Y29uc3QgZT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKTtpZihtKGMpKXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoYSxpKTtjb25zdHtpbnN0cnVtZW50SWQ6dH09YyxuPWUuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coby5tZXRob2RJZCkuY2xpZW50VG9rZW47aWYoIW4pdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7cmV0dXJuIHlpZWxkIHRoaXMuZXhlY3V0ZVdpdGhWYXVsdGVkKG8sdCxTLG4pfWNvbnN0IHQ9ZS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhnKSxoPXlpZWxkIHRoaXMuY29uZmlybVN0cmlwZVBheW1lbnQodCkse2NsaWVudFRva2VuOnAsbWV0aG9kOmZ9PXQse2lkOkl9PW51bGwhPT0ocj1udWxsIT09KG49aC5wYXltZW50SW50ZW50KSYmdm9pZCAwIT09bj9uOmgucGF5bWVudE1ldGhvZCkmJnZvaWQgMCE9PXI/cjp7aWQ6XCJcIn07bD1oLmVycm9yLGQ9e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjpJfSx2YXVsdF9wYXltZW50X2luc3RydW1lbnQ6dixjb25maXJtOiExLHNldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50OlN9LGY9PT1DLkNyZWRpdENhcmQmJihkLmNsaWVudF90b2tlbj1wKSxffHwoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdE9yZGVyKGEsaSkpO2NvbnN0IEU9dGhpcy5idWlsZFBheW1lbnRQYXlsb2FkKGcsZCxTKTt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChFKX1jYXRjaChlKXt5aWVsZCB0aGlzLnByb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKHRoaXMuaGFuZGxlRW1wdHlQYXltZW50SW50ZW50RXJyb3IoZSxsKSxnLHYsUyl9fSl9ZmluYWxpemUoKXtyZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IGcpfWRlaW5pdGlhbGl6ZSgpe3JldHVybiB0aGlzLmhvc3RlZEZvcm0mJnRoaXMuaG9zdGVkRm9ybS5kZXRhY2goKSx0aGlzLmlzRGVpbml0aWFsaXplPSEwLHRoaXMudW5tb3VudEVsZW1lbnQoKSxQcm9taXNlLnJlc29sdmUoKX1idWlsZFBheW1lbnRQYXlsb2FkKGUsdCxpKXtyZXR1cm57bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTppP3tmb3JtYXR0ZWRQYXlsb2FkOk9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSx0KSx7c2V0X2FzX2RlZmF1bHRfc3RvcmVkX2luc3RydW1lbnQ6aX0pfTp7Zm9ybWF0dGVkUGF5bG9hZDp0fX19aXNDYW5jZWxsYXRpb25FcnJvcihlKXt2YXIgdCxpO3JldHVybiBlJiYtMSE9PShudWxsPT09KGk9bnVsbD09PSh0PWUucGF5bWVudF9pbnRlbnQubGFzdF9wYXltZW50X2Vycm9yKXx8dm9pZCAwPT09dD92b2lkIDA6dC5tZXNzYWdlKXx8dm9pZCAwPT09aT92b2lkIDA6aS5pbmRleE9mKFwiY2FuY2VsZWRcIikpfWlzQXV0aEVycm9yKGUpe3JldHVyblwicGF5bWVudF9pbnRlbnRfYXV0aGVudGljYXRpb25fZmFpbHVyZVwiPT09KG51bGw9PWU/dm9pZCAwOmUuY29kZSl9aXNDcmVkaXRDYXJkKGUpe3JldHVybiBlPT09RS5DcmVkaXRDYXJkfWlzSG9zdGVkRmllbGRBdmFpbGFibGUoKXt2YXIgZTtjb25zdCB0PXRoaXMuZ2V0SW5pdGlhbGl6ZU9wdGlvbnMoKSxyPW4obnVsbD09PShlPXQuZm9ybSl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZmllbGRzLGkpO3JldHVybiFpKHIpfWlzSG9zdGVkUGF5bWVudEZvcm1FbmFibGVkKGUsdCl7Y29uc3R7Z2V0UGF5bWVudE1ldGhvZE9yVGhyb3c6aX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksbj1pKGUsdCk7cmV0dXJuIEJvb2xlYW4obi5jb25maWcuaXNIb3N0ZWRGb3JtRW5hYmxlZCl9Y29uZmlybVN0cmlwZVBheW1lbnQoZSl7cmV0dXJuIHcodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e2NsaWVudFRva2VuOnQsbWV0aG9kOmkscmV0dXJuVXJsOm59PWU7aWYoIXQpdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7c3dpdGNoKGkpe2Nhc2UgQy5BbGlwYXk6cmV0dXJuIHRoaXMuZ2V0U3RyaXBlSnMoKS5jb25maXJtQWxpcGF5UGF5bWVudCh0LHtyZXR1cm5fdXJsOm59LHtoYW5kbGVBY3Rpb25zOiExfSk7Y2FzZSBDLklERUFMOntjb25zdCBlPXRoaXMubWFwU3RyaXBlUGF5bWVudERhdGEoRS5JREVBTCxuKTtyZXR1cm4gdGhpcy5nZXRTdHJpcGVKcygpLmNvbmZpcm1JZGVhbFBheW1lbnQodCxlLHtoYW5kbGVBY3Rpb25zOiExfSl9Y2FzZSBDLlNlcGE6e2NvbnN0IGU9dGhpcy5tYXBTdHJpcGVQYXltZW50RGF0YShFLlNlcGEpO3JldHVybiB0aGlzLmdldFN0cmlwZUpzKCkuY29uZmlybVNlcGFEZWJpdFBheW1lbnQodCxlKX1kZWZhdWx0Ontjb25zdCBlPXRoaXMudXNlSW5kaXZpZHVhbENhcmRGaWVsZHM/dGhpcy5nZXRTdHJpcGVDYXJkRWxlbWVudHMoKVswXTp0aGlzLmdldFN0cmlwZUVsZW1lbnQoKSx0PXRoaXMubWFwU3RyaXBlQmlsbGluZ0RldGFpbHModGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0QmlsbGluZ0FkZHJlc3MoKSx0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDdXN0b21lcigpKSxpPXRoaXMuX2FsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM7cmV0dXJuIHRoaXMuZ2V0U3RyaXBlSnMoKS5jcmVhdGVQYXltZW50TWV0aG9kKE9iamVjdC5hc3NpZ24oe3R5cGU6RS5DcmVkaXRDYXJkLGNhcmQ6ZSxiaWxsaW5nX2RldGFpbHM6dH0saT97YWxsb3dfcmVkaXNwbGF5OlwiYWx3YXlzXCJ9Ont9KSl9fX0pfWV4ZWN1dGVXaXRoVmF1bHRlZChlLHQsaSxuKXt2YXIgcjtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgbz17YmlncGF5X3Rva2VuOnt0b2tlbjp0fSxjb25maXJtOiEwLGNsaWVudF90b2tlbjpuLHNldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50Oml9O2lmKHRoaXMuaXNIb3N0ZWRQYXltZW50Rm9ybUVuYWJsZWQoZS5tZXRob2RJZCxlLmdhdGV3YXlJZCkmJnRoaXMuaG9zdGVkRm9ybSl7Y29uc3QgdD10aGlzLmhvc3RlZEZvcm07cmV0dXJuIGUucGF5bWVudERhdGEmJm0oZS5wYXltZW50RGF0YSkmJihlLnBheW1lbnREYXRhPU9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxlLnBheW1lbnREYXRhKSx7aW5zdHJ1bWVudElkOkpTT04uc3RyaW5naWZ5KHt0b2tlbjoobnVsbD09PShyPWUucGF5bWVudERhdGEpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmluc3RydW1lbnRJZCl8fFwiXCIsY2xpZW50X3Rva2VuOm59KX0pKSx5aWVsZCB0LnZhbGlkYXRlKCkseWllbGQgdC5zdWJtaXQoZSksdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRDdXJyZW50T3JkZXIoKX1jb25zdCBzPXRoaXMuYnVpbGRQYXltZW50UGF5bG9hZChlLm1ldGhvZElkLG8saSk7cmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KHMpfSl9Z2V0SW5pdGlhbGl6ZU9wdGlvbnMoKXtpZighdGhpcy5pbml0aWFsaXplT3B0aW9ucyl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7cmV0dXJuIHRoaXMuaW5pdGlhbGl6ZU9wdGlvbnN9Z2V0U3RyaXBlQ2FyZEVsZW1lbnRzKCl7aWYoIXRoaXMuc3RyaXBlQ2FyZEVsZW1lbnRzKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtyZXR1cm4gdGhpcy5zdHJpcGVDYXJkRWxlbWVudHN9Z2V0U3RyaXBlRWxlbWVudCgpe2lmKCF0aGlzLnN0cmlwZUVsZW1lbnQpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO3JldHVybiB0aGlzLnN0cmlwZUVsZW1lbnR9Z2V0U3RyaXBlSnMoKXtpZighdGhpcy5zdHJpcGVWM0NsaWVudCl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7cmV0dXJuIHRoaXMuc3RyaXBlVjNDbGllbnR9aGFuZGxlRW1wdHlQYXltZW50SW50ZW50RXJyb3IoZSx0KXtyZXR1cm4gUyhlKSYmbyhlLmJvZHkuZXJyb3JzLHtjb2RlOlwicmVxdWlyZWRfZmllbGRcIn0pJiZ0P25ldyBFcnJvcih0Lm1lc3NhZ2UpOmV9bG9hZFN0cmlwZUpzKGUsdCl7cmV0dXJuIHcodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3JldHVybiB0aGlzLnN0cmlwZVYzQ2xpZW50P1Byb21pc2UucmVzb2x2ZSh0aGlzLnN0cmlwZVYzQ2xpZW50KTp0aGlzLnNjcmlwdExvYWRlci5sb2FkKGUsdCx0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRMb2NhbGUoKSl9KX1tYXBTdHJpcGVBZGRyZXNzKGUpe2lmKGUpe2NvbnN0e2NpdHk6dCxjb3VudHJ5Q29kZTppLGFkZHJlc3MxOm4sYWRkcmVzczI6cixwb3N0YWxDb2RlOm8sc3RhdGVPclByb3ZpbmNlQ29kZTpzfT1lO3JldHVybntjaXR5OnQsY291bnRyeTppLGxpbmUxOm4sbGluZTI6cixwb3N0YWxfY29kZTpvLHN0YXRlOnN9fXJldHVybntsaW5lMTpcIlwifX1tYXBTdHJpcGVCaWxsaW5nRGV0YWlscyhlLHQpe2NvbnN0e2ZpcnN0TmFtZTppLGxhc3ROYW1lOm59PWV8fHR8fHtmaXJzdE5hbWU6XCJHdWVzdFwiLGxhc3ROYW1lOlwiXCJ9LHI9YCR7aX0gJHtufWAudHJpbSgpLHtvcHRpb25zOm99PXRoaXMuZ2V0SW5pdGlhbGl6ZU9wdGlvbnMoKTtpZih0aGlzLnVzZUluZGl2aWR1YWxDYXJkRmllbGRzJiZmKG8pKXtjb25zdHt6aXBDb2RlRWxlbWVudE9wdGlvbnM6dH09bztpZih0KXtjb25zdCBpPWRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHQuY29udGFpbmVySWQpP2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKHQuY29udGFpbmVySWQpLnZhbHVlOlwiXCI7aSYmZSYmKGU9T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LGUpLHtwb3N0YWxDb2RlOml9KSl9fWNvbnN0IHM9e2FkZHJlc3M6dGhpcy5tYXBTdHJpcGVBZGRyZXNzKGUpfTtpZih0JiZ0LmFkZHJlc3Nlc1swXSYmZnVuY3Rpb24oZSl7cmV0dXJuXCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcImlkXCJpbiBlJiZ2b2lkIDAhPT1lLmlkfSh0LmFkZHJlc3Nlc1swXSkpe2NvbnN0IGU9dC5hZGRyZXNzZXNbMF0se2VtYWlsOml9PXQse3Bob25lOm59PWU7cmV0dXJuIG4/T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHMpLHtlbWFpbDppLG5hbWU6cixwaG9uZTpufSk6T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHMpLHtlbWFpbDppLG5hbWU6cn0pfWlmKGUpe2NvbnN0e2VtYWlsOnQscGhvbmU6aX09ZTtyZXR1cm4gaT9PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOnQsbmFtZTpyLHBob25lOml9KTpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOnQsbmFtZTpyfSl9cmV0dXJuIE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxzKSx7bmFtZTpyfSl9bWFwU3RyaXBlUGF5bWVudERhdGEoZSx0KXtjb25zdCBpPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEN1c3RvbWVyKCksbj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRCaWxsaW5nQWRkcmVzcygpLHI9e3BheW1lbnRfbWV0aG9kOntbZV06dGhpcy5nZXRTdHJpcGVFbGVtZW50KCksYmlsbGluZ19kZXRhaWxzOnRoaXMubWFwU3RyaXBlQmlsbGluZ0RldGFpbHMobixpKX19O3JldHVybiBlPT09RS5JREVBTD9PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scikse3JldHVybl91cmw6dH0pOnJ9bW91bnRDYXJkRmllbGRzKGUpe2NvbnN0e29wdGlvbnM6dCxjb250YWluZXJJZDppfT10aGlzLmdldEluaXRpYWxpemVPcHRpb25zKCk7bGV0IG47cmV0dXJuIG5ldyBQcm9taXNlKChyLG8pPT57c3dpdGNoKHRoaXMuc3RyaXBlRWxlbWVudHN8fCh0aGlzLnN0cmlwZUVsZW1lbnRzPXRoaXMuZ2V0U3RyaXBlSnMoKS5lbGVtZW50cygpKSxlKXtjYXNlIEMuQ3JlZGl0Q2FyZDppZih0aGlzLnVzZUluZGl2aWR1YWxDYXJkRmllbGRzJiZmKHQpKXtjb25zdHtjYXJkTnVtYmVyRWxlbWVudE9wdGlvbnM6ZSxjYXJkRXhwaXJ5RWxlbWVudE9wdGlvbnM6aSxjYXJkQ3ZjRWxlbWVudE9wdGlvbnM6cn09dCxzPXRoaXMuc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChDLkNhcmROdW1iZXIpfHx0aGlzLnN0cmlwZUVsZW1lbnRzLmNyZWF0ZShDLkNhcmROdW1iZXIsZSksYT10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoQy5DYXJkRXhwaXJ5KXx8dGhpcy5zdHJpcGVFbGVtZW50cy5jcmVhdGUoQy5DYXJkRXhwaXJ5LGkpLGQ9dGhpcy5zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KEMuQ2FyZEN2Yyl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKEMuQ2FyZEN2YyxyKTt0aGlzLnN0cmlwZUNhcmRFbGVtZW50cz1bcyxhLGRdLG49dGhpcy5zdHJpcGVDYXJkRWxlbWVudHNbMF07dHJ5e3MubW91bnQoYCMke2UuY29udGFpbmVySWR9YCksYS5tb3VudChgIyR7aS5jb250YWluZXJJZH1gKSxkLm1vdW50KGAjJHtyLmNvbnRhaW5lcklkfWApfWNhdGNoKGUpe3RoaXMuaXNEZWluaXRpYWxpemV8fG8obmV3IHUoXCJVbmFibGUgdG8gbW91bnQgU3RyaXBlIGNvbXBvbmVudCB3aXRob3V0IHZhbGlkIGNvbnRhaW5lciBJRC5cIikpfX1lbHNle249dGhpcy5zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KGUpfHx0aGlzLnN0cmlwZUVsZW1lbnRzLmNyZWF0ZShlLHQpO3RyeXtuLm1vdW50KGAjJHtpfWApfWNhdGNoKGUpe3RoaXMuaXNEZWluaXRpYWxpemV8fG8obmV3IHUoXCJVbmFibGUgdG8gbW91bnQgU3RyaXBlIGNvbXBvbmVudCB3aXRob3V0IHZhbGlkIGNvbnRhaW5lciBJRC5cIikpfX1icmVhaztjYXNlIEMuSURFQUw6Y2FzZSBDLlNlcGE6bj10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZSl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGUsdCk7dHJ5e24ubW91bnQoYCMke2l9YCl9Y2F0Y2goZSl7dGhpcy5pc0RlaW5pdGlhbGl6ZXx8byhuZXcgdShcIlVuYWJsZSB0byBtb3VudCBTdHJpcGUgY29tcG9uZW50IHdpdGhvdXQgdmFsaWQgY29udGFpbmVyIElELlwiKSl9Y2FzZSBDLkFsaXBheTp9cihuKX0pfW1vdW50Q2FyZFZlcmlmaWNhdGlvbkZpZWxkcyhlKXtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3QgdD10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRTdG9yZUNvbmZpZygpO2lmKCF0KXRocm93IG5ldyB5KHMuTWlzc2luZ0NoZWNrb3V0Q29uZmlnKTtjb25zdCBpPXQucGF5bWVudFNldHRpbmdzLmJpZ3BheUJhc2VVcmwsbj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuY3JlYXRlSG9zdGVkRm9ybShpLGUpO3JldHVybiB5aWVsZCBuLmF0dGFjaCgpLG59KX1wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQsaT0hMSxuPSExKXtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIVMoZSkpdGhyb3cgZTtjb25zdCByPW8oZS5ib2R5LmVycm9ycyx7Y29kZTpcImFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkXCJ9KSxzPW8oZS5ib2R5LmVycm9ycyx7Y29kZTpcInRocmVlX2Rfc2VjdXJlX3JlcXVpcmVkXCJ9KTtpZihyKXtjb25zdCB0PWUuYm9keS5hZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZDtpZih0JiZcInJlZGlyZWN0X3RvX3VybFwiPT09dC50eXBlKXJldHVybiBuZXcgUHJvbWlzZSgoKT0+e3QuZGF0YS5yZWRpcmVjdF91cmwmJndpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKHQuZGF0YS5yZWRpcmVjdF91cmwpfSl9aWYocyl7Y29uc3Qgcj1lLmJvZHkudGhyZWVfZHNfcmVzdWx0LnRva2VuLG89ITE7bGV0IHMsYT0hMTt0cnl7cz15aWVsZCB0aGlzLmdldFN0cmlwZUpzKCkuY29uZmlybUNhcmRQYXltZW50KHIpfWNhdGNoKGUpe2E9ITB9aWYobnVsbD09cz92b2lkIDA6cy5lcnJvcil7aWYodGhpcy5pc0NhbmNlbGxhdGlvbkVycm9yKHMuZXJyb3IpKXRocm93IG5ldyBfO2lmKHRoaXMuaXNBdXRoRXJyb3Iocy5lcnJvcikpdGhyb3cgbmV3IGIoUC5BdXRoRmFpbHVyZSk7dGhyb3cgbmV3IEVycm9yKHMuZXJyb3IubWVzc2FnZSl9Y29uc3QgZD17Y3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOnRoaXMuZ2V0UGF5bWVudFRva2VuKG51bGw9PXM/dm9pZCAwOnMucGF5bWVudEludGVudCxyLGEpfSx2YXVsdF9wYXltZW50X2luc3RydW1lbnQ6aSxjb25maXJtOm99LGw9dGhpcy5idWlsZFBheW1lbnRQYXlsb2FkKHQsZCxuKTt0cnl7cmV0dXJuIHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KGwpfWNhdGNoKGUpe3Rocm93IHRoaXMuaGFuZGxlRW1wdHlQYXltZW50SW50ZW50RXJyb3IoZSxudWxsPT1zP3ZvaWQgMDpzLmVycm9yKX19dGhyb3cgZX0pfWdldFBheW1lbnRUb2tlbihlLHQsaSl7cmV0dXJuIWV8fGk/dDplLmlkfXNob3VsZFNob3dUU1ZIb3N0ZWRGb3JtKGUsdCl7cmV0dXJuIHRoaXMuaXNIb3N0ZWRGaWVsZEF2YWlsYWJsZSgpJiZ0aGlzLmlzSG9zdGVkUGF5bWVudEZvcm1FbmFibGVkKGUsdCl9dW5tb3VudEVsZW1lbnQoKXt0aGlzLnN0cmlwZUVsZW1lbnQmJih0aGlzLnN0cmlwZUVsZW1lbnQudW5tb3VudCgpLHRoaXMuc3RyaXBlRWxlbWVudD12b2lkIDApfX1jbGFzcyBNIGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGNsaWVudCBsaWJyYXJ5IG9mIGEgcGF5bWVudCBtZXRob2QgaXMgbm90IGxvYWRlZCBvciByZWFkeSB0byBiZSB1c2VkLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kQ2xpZW50VW5hdmFpbGFibGVFcnJvclwiLHRoaXMudHlwZT1cInBheW1lbnRfbWV0aG9kX2NsaWVudF91bmF2YWlsYWJsZVwifX1jbGFzcyBUe2NvbnN0cnVjdG9yKGUsdD13aW5kb3cpe3RoaXMuc2NyaXB0TG9hZGVyPWUsdGhpcy5zdHJpcGVXaW5kb3c9dH1sb2FkKGUsdCxpKXtyZXR1cm4gdGhpcy5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdChcImh0dHBzOi8vanMuc3RyaXBlLmNvbS92My9cIikudGhlbigoKT0+e2lmKCF0aGlzLnN0cmlwZVdpbmRvdy5TdHJpcGUpdGhyb3cgbmV3IE07cmV0dXJuIHRoaXMuc3RyaXBlV2luZG93LlN0cmlwZShlLHtzdHJpcGVBY2NvdW50OnQsbG9jYWxlOmksYmV0YXM6W1wicGF5bWVudF9pbnRlbnRfYmV0YV8zXCIsXCJhbGlwYXlfcG1fYmV0YV8xXCJdLGFwaVZlcnNpb246XCIyMDIwLTAzLTAyO2FsaXBheV9iZXRhPXYxXCJ9KX0pfX1jb25zdCBOPWwodD0+bmV3IE8odCxuZXcgVChlKCkpKSxbe2dhdGV3YXk6XCJzdHJpcGV2M1wifV0pO3ZhciBrLEQsUix6LEwsVSx4LGosQj1mdW5jdGlvbihlLHQsaSxuKXtyZXR1cm4gbmV3KGl8fChpPVByb21pc2UpKShmdW5jdGlvbihyLG8pe2Z1bmN0aW9uIHMoZSl7dHJ5e2Qobi5uZXh0KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtkKG4udGhyb3coZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGQoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KHQ9ZS52YWx1ZSx0IGluc3RhbmNlb2YgaT90Om5ldyBpKGZ1bmN0aW9uKGUpe2UodCl9KSkudGhlbihzLGEpfWQoKG49bi5hcHBseShlLHR8fFtdKSkubmV4dCgpKX0pfTtjbGFzcyBGe2NvbnN0cnVjdG9yKGUsdD13aW5kb3cpe3RoaXMuc2NyaXB0TG9hZGVyPWUsdGhpcy5zdHJpcGVXaW5kb3c9dH1nZXRTdHJpcGVDbGllbnQoZSx0LGksbil7cmV0dXJuIEIodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKHRoaXMuc3RyaXBlV2luZG93LmJjU3RyaXBlQ2xpZW50KXJldHVybiB0aGlzLnN0cmlwZVdpbmRvdy5iY1N0cmlwZUNsaWVudDtjb25zdCByPXlpZWxkIHRoaXMubG9hZCgpLHtzdHJpcGVQdWJsaXNoYWJsZUtleTpvLHN0cmlwZUNvbm5lY3RlZEFjY291bnQ6c309ZSxhPXIobyxPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHM/e3N0cmlwZUFjY291bnQ6c306e30pLHQ/e2xvY2FsZTp0fTp7fSksaT97YmV0YXM6aX06e30pLG4/e2FwaVZlcnNpb246bn06e30pKTtyZXR1cm4gT2JqZWN0LmFzc2lnbih0aGlzLnN0cmlwZVdpbmRvdyx7YmNTdHJpcGVDbGllbnQ6YX0pLGF9KX1nZXRFbGVtZW50cyhlLHQpe3JldHVybiBCKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtsZXQgaT10aGlzLnN0cmlwZVdpbmRvdy5iY1N0cmlwZUVsZW1lbnRzO3JldHVybiBpP3lpZWxkIHRoaXMudXBkYXRlU3RyaXBlRWxlbWVudHModCk6KGk9ZS5lbGVtZW50cyh0KSxPYmplY3QuYXNzaWduKHRoaXMuc3RyaXBlV2luZG93LHtiY1N0cmlwZUVsZW1lbnRzOml9KSksaX0pfXVwZGF0ZVN0cmlwZUVsZW1lbnRzKGUpe3JldHVybiBCKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXRoaXMuc3RyaXBlV2luZG93LmJjU3RyaXBlRWxlbWVudHM7dCYmKHQudXBkYXRlKGUpLHlpZWxkIHQuZmV0Y2hVcGRhdGVzKCkpfSl9bG9hZCgpe3JldHVybiBCKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlJiYoeWllbGQgdGhpcy5zY3JpcHRMb2FkZXIubG9hZFNjcmlwdChcImh0dHBzOi8vanMuc3RyaXBlLmNvbS92My9cIiksIXRoaXMuc3RyaXBlV2luZG93LlN0cmlwZSkpdGhyb3cgbmV3IE07cmV0dXJuIHRoaXMuc3RyaXBlV2luZG93LlN0cmlwZX0pfX1jbGFzcyBWIGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGNsaWVudCBsaWJyYXJ5IG9mIGEgcGF5bWVudCBtZXRob2QgaGFzIHRocm93biBhbiB1bmV4cGVjdGVkIGVycm9yLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kRmFpbGVkRXJyb3JcIix0aGlzLnR5cGU9XCJwYXltZW50X21ldGhvZF9jbGllbnRfaW52YWxpZFwifX0hZnVuY3Rpb24oZSl7ZS5TSElQUElORz1cInNoaXBwaW5nXCIsZS5CSUxMSU5HPVwiYmlsbGluZ1wifShrfHwoaz17fSkpLGZ1bmN0aW9uKGUpe2UuU1BMSVQ9XCJzcGxpdFwiLGUuRlVMTD1cImZ1bGxcIixlLk9SR0FOSVpBVElPTj1cIm9yZ2FuaXphdGlvblwifShEfHwoRD17fSkpLGZ1bmN0aW9uKGUpe2UuQ3JlZGl0Q2FyZD1cImNhcmRcIixlLkxpbms9XCJsaW5rXCIsZS5FUFM9XCJlcHNcIixlLkdSQUJQQVk9XCJncmFicGF5XCIsZS5CQU5DT05UQUNUPVwiYmFuY29udGFjdFwiLGUuSURFQUw9XCJpZGVhbFwiLGUuQUxJUEFZPVwiYWxpcGF5XCIsZS5LTEFSTkE9XCJrbGFybmFcIixlLk9DUz1cIm9wdGltaXplZF9jaGVja291dFwifShSfHwoUj17fSkpLGZ1bmN0aW9uKGUpe2UuTkVWRVI9XCJuZXZlclwiLGUuQVVUTz1cImF1dG9cIixlLkFMV0FZUz1cImFsd2F5c1wiLGUuUEFZTUVOVD1cInBheW1lbnRcIixlLklGX1JFUVVJUkVEPVwiaWZfcmVxdWlyZWRcIn0oenx8KHo9e30pKSxmdW5jdGlvbihlKXtlLlBBWU1FTlQ9XCJwYXltZW50XCIsZS5BVVRIRU5USUNBVElPTj1cImxpbmtBdXRoZW50aWNhdGlvblwiLGUuU0hJUFBJTkc9XCJhZGRyZXNzXCIsZS5FWFBSRVNTX0NIRUNLT1VUPVwiZXhwcmVzc0NoZWNrb3V0XCJ9KEx8fChMPXt9KSksZnVuY3Rpb24oZSl7ZS5SRVFVSVJFU19QQVlNRU5UX01FVEhPRD1cInJlcXVpcmVzX3BheW1lbnRfbWV0aG9kXCIsZS5SRVFVSVJFU19DT05GSVJNQVRJT049XCJyZXF1aXJlc19jb25maXJtYXRpb25cIixlLlJFUVVJUkVTX0FDVElPTj1cInJlcXVpcmVzX2FjdGlvblwiLGUuUFJPQ0VTU0lORz1cInByb2Nlc3NpbmdcIixlLlNVQ0NFRURFRD1cInN1Y2NlZWRlZFwiLGUuQ0FOQ0VMRUQ9XCJjYW5jZWxlZFwifShVfHwoVT17fSkpLGZ1bmN0aW9uKGUpe2UuQ0xJQ0s9XCJjbGlja1wiLGUuQ0hBTkdFPVwiY2hhbmdlXCIsZS5SRUFEWT1cInJlYWR5XCIsZS5TSElQUElOR19BRERSRVNTX0NIQU5HRT1cInNoaXBwaW5nYWRkcmVzc2NoYW5nZVwiLGUuU0hJUFBJTkdfUkFURV9DSEFOR0U9XCJzaGlwcGluZ3JhdGVjaGFuZ2VcIixlLkNPTkZJUk09XCJjb25maXJtXCIsZS5DQU5DRUw9XCJjYW5jZWxcIixlLkxPQURFUl9TVEFSVD1cImxvYWRlcnN0YXJ0XCJ9KHh8fCh4PXt9KSksZnVuY3Rpb24oZSl7ZS5PTl9TRVNTSU9OPVwib25fc2Vzc2lvblwiLGUuT0ZGX1NFU1NJT049XCJvZmZfc2Vzc2lvblwifShqfHwoaj17fSkpO3ZhciBHPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIEh7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10LHRoaXMuaXNNb3VudGVkPSExfWRlaW5pdGlhbGl6ZSgpe3ZhciBlO251bGw9PT0oZT10aGlzLmNoZWNrb3V0RXZlbnRzVW5zdWJzY3JpYmUpfHx2b2lkIDA9PT1lfHxlLmNhbGwodGhpcyksdGhpcy5pc01vdW50ZWQ9ITF9aW5pdENoZWNrb3V0RXZlbnRzU3Vic2NyaXB0aW9uKGUsdCxpLG4pe3RoaXMuY2hlY2tvdXRFdmVudHNVbnN1YnNjcmliZT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3Vic2NyaWJlKCgpPT5HKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt2YXIgcjtjb25zdCBvPW51bGw9PW4/dm9pZCAwOm4uZ2V0RWxlbWVudChMLlBBWU1FTlQpO2lmKG8pe3RyeXt5aWVsZCB0aGlzLnVwZGF0ZVN0cmlwZVBheW1lbnRJbnRlbnQoZSx0KX1jYXRjaChlKXtyZXR1cm4gdGhpcy5pc01vdW50ZWQmJihvLnVubW91bnQoKSx0aGlzLmlzTW91bnRlZD0hMSksdm9pZChlIGluc3RhbmNlb2YgRXJyb3ImJihudWxsPT09KHI9aS5vbkVycm9yKXx8dm9pZCAwPT09cnx8ci5jYWxsKGksZSkpKX10aGlzLmlzTW91bnRlZHx8KHlpZWxkIG51bGw9PW4/dm9pZCAwOm4uZmV0Y2hVcGRhdGVzKCksdGhpcy5tb3VudEVsZW1lbnQobyxpLmNvbnRhaW5lcklkKSl9fSksZT0+e3ZhciB0O3JldHVybiBudWxsPT09KHQ9ZS5nZXRDaGVja291dCgpKXx8dm9pZCAwPT09dD92b2lkIDA6dC5vdXRzdGFuZGluZ0JhbGFuY2V9LGU9Pnt2YXIgdDtyZXR1cm4gbnVsbD09PSh0PWUuZ2V0Q2hlY2tvdXQoKSl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuY291cG9uc30pfW1vdW50RWxlbWVudChlLHQpe2RvY3VtZW50LmdldEVsZW1lbnRCeUlkKHQpJiYoZS5tb3VudChgIyR7dH1gKSx0aGlzLmlzTW91bnRlZD0hMCl9bWFwQXBwZWFyYW5jZVZhcmlhYmxlcyhlKXtyZXR1cm57Y29sb3JQcmltYXJ5OmUuZmllbGRJbm5lclNoYWRvdyxjb2xvckJhY2tncm91bmQ6ZS5maWVsZEJhY2tncm91bmQsY29sb3JUZXh0OmUubGFiZWxUZXh0LGNvbG9yRGFuZ2VyOmUuZmllbGRFcnJvclRleHQsY29sb3JUZXh0U2Vjb25kYXJ5OmUubGFiZWxUZXh0LGNvbG9yVGV4dFBsYWNlaG9sZGVyOmUuZmllbGRQbGFjZWhvbGRlclRleHQsY29sb3JJY29uOmUuZmllbGRQbGFjZWhvbGRlclRleHR9fW1hcElucHV0QXBwZWFyYW5jZVJ1bGVzKGUpe3JldHVybntib3JkZXJDb2xvcjplLmZpZWxkQm9yZGVyLGNvbG9yOmUuZmllbGRUZXh0LGJveFNoYWRvdzplLmZpZWxkSW5uZXJTaGFkb3d9fXRocm93U3RyaXBlRXJyb3IoZSl7aWYoXCJvYmplY3RcIj09dHlwZW9mKHQ9ZSkmJm51bGwhPT10JiZcInR5cGVcImluIHQmJih0aGlzLnRocm93RGlzcGxheWFibGVTdHJpcGVFcnJvcihlKSx0aGlzLmlzQ2FuY2VsbGF0aW9uRXJyb3IoZSkpKXRocm93IG5ldyBfO3ZhciB0O3Rocm93IG5ldyBWfXRocm93RGlzcGxheWFibGVTdHJpcGVFcnJvcihlKXtpZih0KFtcImNhcmRfZXJyb3JcIixcImludmFsaWRfcmVxdWVzdF9lcnJvclwiLFwidmFsaWRhdGlvbl9lcnJvclwiXSxlLnR5cGUpKXRocm93IG5ldyBFcnJvcihlLm1lc3NhZ2UpfWlzQ2FuY2VsbGF0aW9uRXJyb3IoZSl7dmFyIHQ7Y29uc3QgaT1udWxsPT09KHQ9bnVsbD09ZT92b2lkIDA6ZS5wYXltZW50X2ludGVudC5sYXN0X3BheW1lbnRfZXJyb3IpfHx2b2lkIDA9PT10P3ZvaWQgMDp0Lm1lc3NhZ2U7cmV0dXJuISFpJiYtMSE9PWkuaW5kZXhPZihcImNhbmNlbGVkXCIpfXRocm93UGF5bWVudENvbmZpcm1hdGlvblByb2NlZWRNZXNzYWdlKCl7dGhyb3cgbmV3IFYoXCJXZSd2ZSByZWNlaXZlZCB5b3VyIG9yZGVyIGFuZCBhcmUgcHJvY2Vzc2luZyB5b3VyIHBheW1lbnQuIE9uY2UgdGhlIHBheW1lbnQgaXMgdmVyaWZpZWQsIHlvdXIgb3JkZXIgd2lsbCBiZSBjb21wbGV0ZWQuIFdlIHdpbGwgc2VuZCB5b3UgYW4gZW1haWwgd2hlbiBpdCdzIGNvbXBsZXRlZC4gUGxlYXNlIG5vdGUsIHRoaXMgcHJvY2VzcyBtYXkgdGFrZSBhIGZldyBtaW51dGVzIGRlcGVuZGluZyBvbiB0aGUgcHJvY2Vzc2luZyB0aW1lcyBvZiB5b3VyIGNob3NlbiBtZXRob2QuXCIpfWlzUGF5bWVudENvbXBsZXRlZChlLHQpe3JldHVybiBHKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBpPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLG49aS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhlKSx7ZmVhdHVyZXM6cn09aS5nZXRTdG9yZUNvbmZpZ09yVGhyb3coKS5jaGVja291dFNldHRpbmdzO2lmKCFuLmNsaWVudFRva2VufHwhdHx8IXJbXCJQSS02MjYuQmxvY2tfdW5uZWNlc3NhcnlfcGF5bWVudF9jb25maXJtYXRpb25fZm9yX1N0cmlwZVVQRVwiXSlyZXR1cm4hMTtjb25zdHtwYXltZW50SW50ZW50Om99PXlpZWxkIHQucmV0cmlldmVQYXltZW50SW50ZW50KG4uY2xpZW50VG9rZW4pO3JldHVybihudWxsPT1vP3ZvaWQgMDpvLnN0YXR1cyk9PT1VLlNVQ0NFRURFRH0pfW1hcFN0cmlwZVBheW1lbnREYXRhKGUsdCxpPSExKXtjb25zdCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEJpbGxpbmdBZGRyZXNzKCkse2ZpcnN0TmFtZTpyPVwiXCIsbGFzdE5hbWU6bz1cIlwiLGVtYWlsOmQ9XCJcIn09bnx8e30sbD10aGlzLl9tYXBTdHJpcGVBZGRyZXNzKG4pO2lmKCFlKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtpZighKGQmJmwmJmwuY2l0eSYmbC5jb3VudHJ5JiZyJiZvKSl0aHJvdyBuZXcgeShzLk1pc3NpbmdCaWxsaW5nQWRkcmVzcyk7cmV0dXJue2VsZW1lbnRzOmUscmVkaXJlY3Q6ei5JRl9SRVFVSVJFRCxjb25maXJtUGFyYW1zOk9iamVjdC5hc3NpZ24oe3BheW1lbnRfbWV0aG9kX2RhdGE6T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LGk/e2FsbG93X3JlZGlzcGxheTpcImFsd2F5c1wifTp7fSkse2JpbGxpbmdfZGV0YWlsczp7ZW1haWw6ZCxhZGRyZXNzOmwsbmFtZTpgJHtyfSAke299YH19KX0sdCYme3JldHVybl91cmw6dH0pfX1pc0FkZGl0aW9uYWxBY3Rpb25FcnJvcihlKXtyZXR1cm4gbyhlLHtjb2RlOlwiYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWRcIn0pfWlzUmVkaXJlY3RBY3Rpb24oZSl7Y29uc3R7dHlwZTp0LGRhdGE6e3JlZGlyZWN0X3VybDppfX09ZTtyZXR1cm5cInJlZGlyZWN0X3RvX3VybFwiPT09dCYmISFpfWlzT25QYWdlQWRkaXRpb25hbEFjdGlvbihlKXtjb25zdHt0eXBlOnQsZGF0YTp7dG9rZW46aX19PWU7cmV0dXJuXCJhZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlc19wYXltZW50X21ldGhvZFwiPT09dCYmISFpfXVwZGF0ZVN0cmlwZVBheW1lbnRJbnRlbnQoZSx0KXtyZXR1cm4gRyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3QgaT15aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2QoZSx7cGFyYW1zOnttZXRob2Q6dH19KSx7Y2xpZW50VG9rZW46bn09aS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyh0KTtuJiZ0aGlzLnNjcmlwdExvYWRlci51cGRhdGVTdHJpcGVFbGVtZW50cyh7Y2xpZW50U2VjcmV0Om59KX0pfV9tYXBTdHJpcGVBZGRyZXNzKGUpe2lmKGUpe2NvbnN0e2NpdHk6dCxhZGRyZXNzMTppLGFkZHJlc3MyOm4sY291bnRyeUNvZGU6cixwb3N0YWxDb2RlOm8sc3RhdGVPclByb3ZpbmNlQ29kZTpzfT1lO3JldHVybiBPYmplY3QuYXNzaWduKHtjaXR5OnQsY291bnRyeTpyLHBvc3RhbF9jb2RlOm8sbGluZTE6aSxsaW5lMjpufSxzP3tzdGF0ZTpzfTp7fSl9dGhyb3cgbmV3IHkocy5NaXNzaW5nQmlsbGluZ0FkZHJlc3MpfX1jb25zdCBxPXtib2R5Ont9LGhlYWRlcnM6e30sc3RhdHVzOjB9O2NsYXNzIFcgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUse21lc3NhZ2U6dCxlcnJvcnM6aX09e30pe2NvbnN0e2JvZHk6bixoZWFkZXJzOnIsc3RhdHVzOm99PWV8fHE7c3VwZXIodHx8XCJBbiB1bmV4cGVjdGVkIGVycm9yIGhhcyBvY2N1cnJlZC5cIiksdGhpcy5uYW1lPVwiUmVxdWVzdEVycm9yXCIsdGhpcy50eXBlPVwicmVxdWVzdFwiLHRoaXMuYm9keT1uLHRoaXMuaGVhZGVycz1yLHRoaXMuc3RhdHVzPW8sdGhpcy5lcnJvcnM9aXx8W119fWZ1bmN0aW9uIFkoZSl7cmV0dXJuXCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcImluaXRpYWxpemF0aW9uRGF0YVwiaW4gZSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEmJm51bGwhPT1lLmluaXRpYWxpemF0aW9uRGF0YSYmXCJvYmplY3RcIj09dHlwZW9mIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZcInN0cmlwZVB1Ymxpc2hhYmxlS2V5XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzdHJpcGVDb25uZWN0ZWRBY2NvdW50XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzaG9wcGVyTGFuZ3VhZ2VcImluIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZ2b2lkIDAhPT1lLmluaXRpYWxpemF0aW9uRGF0YS5zdHJpcGVQdWJsaXNoYWJsZUtleSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc3RyaXBlQ29ubmVjdGVkQWNjb3VudCYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc2hvcHBlckxhbmd1YWdlfWNvbnN0IEs9e2FyOltcImFyXCJdLGJnOltcImJnXCJdLGNzOltcImNzXCJdLGRhOltcImRhXCJdLGRlOltcImRlXCJdLGVsOltcImVsXCJdLGVuOltcImVuXCIsXCJlbi1HQlwiXSxlczpbXCJlc1wiLFwiZXMtNDE5XCJdLGV0OltcImV0XCJdLGZpOltcImZpXCJdLGZpbDpbXCJmaWxcIl0sZnI6W1wiZnJcIixcImZyLUNBXCJdLGhlOltcImhlXCJdLGhyOltcImhyXCJdLGh1OltcImh1XCJdLGlkOltcImlkXCJdLGl0OltcIml0XCJdLGphOltcImphXCJdLGtvOltcImtvXCJdLGx0OltcImx0XCJdLGx2OltcImx2XCJdLG1zOltcIm1zXCJdLG10OltcIm10XCJdLG5iOltcIm5iXCJdLG5sOltcIm5sXCJdLHBsOltcInBsXCJdLHB0OltcInB0XCIsXCJwdC1CUlwiXSxybzpbXCJyb1wiXSxydTpbXCJydVwiXSxzazpbXCJza1wiXSxzbDpbXCJzbFwiXSxzdjpbXCJzdlwiXSx0aDpbXCJ0aFwiXSx0cjpbXCJ0clwiXSx2aTpbXCJ2aVwiXSx6aDpbXCJ6aFwiLFwiemgtSEtcIixcInpoLVRXXCJdfTtmdW5jdGlvbiAkKGUpe2NvbnN0W3QsaV09ZS5yZXBsYWNlKC9fL2csXCItXCIpLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCItXCIpLG49S1t0XTtpZighbilyZXR1cm5cImF1dG9cIjtjb25zdCByPWk/YCR7dH0tJHtpLnRvVXBwZXJDYXNlKCl9YDp0O3JldHVybiBuLmluZGV4T2Yocik+LTE/cjpuWzBdfWNvbnN0IEo9W1wicGF5bWVudF9lbGVtZW50X2JldGFfMlwiLFwiYWxpcGF5X3BtX2JldGFfMVwiLFwibGlua19kZWZhdWx0X2ludGVncmF0aW9uX2JldGFfMVwiLFwic2hpcHBpbmdfYWRkcmVzc19lbGVtZW50X2JldGFfMVwiLFwiYWRkcmVzc19lbGVtZW50X2JldGFfMVwiXSxaPVwiMjAyMC0wMy0wMjthbGlwYXlfYmV0YT12MTtsaW5rX2JldGE9djFcIjtmdW5jdGlvbiBRKGUpe3JldHVyblwic3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGVcImluIGV9dmFyIFg9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgZWV7Y29uc3RydWN0b3IoZSx0LGkpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2U9aX1pbml0aWFsaXplKGUpe3JldHVybiBYKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGV1cGU6dCxtZXRob2RJZDppLGdhdGV3YXlJZDpufT1lO2lmKCEobnVsbD09dD92b2lkIDA6dC5jb250YWluZXJJZCkpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCFuKXRocm93IG5ldyB1KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBwYXltZW50IGJlY2F1c2UgXCJnYXRld2F5SWRcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7cmV0dXJuIHRoaXMuX2xvYWRTdHJpcGVFbGVtZW50KHQsbixpKS5jYXRjaChlPT57dmFyIGk7cmV0dXJuIG51bGw9PT0oaT10Lm9uRXJyb3IpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNhbGwodCxlKX0pLHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmluaXRDaGVja291dEV2ZW50c1N1YnNjcmlwdGlvbihuLGksdCx0aGlzLl9zdHJpcGVFbGVtZW50cyksUHJvbWlzZS5yZXNvbHZlKCl9KX1leGVjdXRlKGUsdCl7cmV0dXJuIFgodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3BheW1lbnQ6aX09ZSxuPWZ1bmN0aW9uKGUsdCl7dmFyIGk9e307Zm9yKHZhciBuIGluIGUpT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eS5jYWxsKGUsbikmJnQuaW5kZXhPZihuKTwwJiYoaVtuXT1lW25dKTtpZihudWxsIT1lJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBPYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKXt2YXIgcj0wO2ZvcihuPU9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMoZSk7cjxuLmxlbmd0aDtyKyspdC5pbmRleE9mKG5bcl0pPDAmJk9iamVjdC5wcm90b3R5cGUucHJvcGVydHlJc0VudW1lcmFibGUuY2FsbChlLG5bcl0pJiYoaVtuW3JdXT1lW25bcl1dKX1yZXR1cm4gaX0oZSxbXCJwYXltZW50XCJdKTtpZighaXx8IWkucGF5bWVudERhdGEpdGhyb3cgbmV3IGgoW1wicGF5bWVudC5wYXltZW50RGF0YVwiXSk7aWYoIXRoaXMuX3N0cmlwZVVQRUNsaWVudCl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7cGF5bWVudERhdGE6cixtZXRob2RJZDpvLGdhdGV3YXlJZDpzfT1pLHtzaG91bGRTYXZlSW5zdHJ1bWVudDpkPSExLHNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQ6bD0hMX09cChyKT9yOnt9LGM9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2lzU3RvcmVDcmVkaXRBcHBsaWVkOnV9PWMuZ2V0Q2hlY2tvdXRPclRocm93KCkseT1jLmdldFBheW1lbnRQcm92aWRlckN1c3RvbWVyT3JUaHJvdygpLGc9KFEoeSk/eTp7fSkuc3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGU7aWYodSYmKHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5hcHBseVN0b3JlQ3JlZGl0KHUpKSxzKXt5aWVsZCB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS51cGRhdGVTdHJpcGVQYXltZW50SW50ZW50KHMsbyk7Y29uc3R7ZW1haWw6ZX09Yy5nZXRDdXN0b21lck9yVGhyb3coKTtpZih2b2lkIDAhPT1nJiYhZSl7Y29uc3QgZT1jLmdldEJpbGxpbmdBZGRyZXNzT3JUaHJvdygpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVCaWxsaW5nQWRkcmVzcyhlKX19aWYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdE9yZGVyKG4sdCksbShyKSl7Y29uc3R7aW5zdHJ1bWVudElkOmV9PXI7cmV0dXJuIHZvaWQoeWllbGQgdGhpcy5fZXhlY3V0ZVdpdGhWYXVsdGVkKGkubWV0aG9kSWQsZSxsKSl9eWllbGQgdGhpcy5fZXhlY3V0ZVdpdGhTdHJpcGVDb25maXJtYXRpb24oaS5tZXRob2RJZCwhZyYmZCxsKX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBnKX1kZWluaXRpYWxpemUoKXt2YXIgZSx0O3JldHVybiBudWxsPT09KHQ9bnVsbD09PShlPXRoaXMuX3N0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KEwuUEFZTUVOVCkpfHx2b2lkIDA9PT10fHx0LnVubW91bnQoKSx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5kZWluaXRpYWxpemUoKSx0aGlzLl9zdHJpcGVFbGVtZW50cz12b2lkIDAsdGhpcy5fc3RyaXBlVVBFQ2xpZW50PXZvaWQgMCxQcm9taXNlLnJlc29sdmUoKX1fZXhlY3V0ZVdpdGhTdHJpcGVDb25maXJtYXRpb24oZSx0LGkpe3JldHVybiBYKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjbGllbnRUb2tlbjpyfT1uLmdldFBheW1lbnRNZXRob2RPclRocm93KGUpLG89dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQoZSxyfHxcIlwiLHQsaSk7dHJ5e3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG8pfWNhdGNoKG4pe3lpZWxkIHRoaXMuX3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihuLGUsdCxpKX19KX1fZXhlY3V0ZVdpdGhWYXVsdGVkKGUsdCxpKXt2YXIgbjtyZXR1cm4gWCh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgcj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxvPXIuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coZSkscz1udWxsPT09KG49ci5nZXRDYXJ0KCkpfHx2b2lkIDA9PT1uP3ZvaWQgMDpuLmlkO3RyeXtjb25zdCBuPXttZXRob2RJZDplLHBheW1lbnREYXRhOntmb3JtYXR0ZWRQYXlsb2FkOntjYXJ0X2lkOnMsYmlncGF5X3Rva2VuOnt0b2tlbjp0fSxjb25maXJtOiExLGNsaWVudF90b2tlbjpvLmNsaWVudFRva2VuLHNldF9hc19kZWZhdWx0X3N0b3JlZF9pbnN0cnVtZW50Oml9fX07cmV0dXJuIHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG4pfWNhdGNoKHQpe3JldHVybiB0aGlzLl9wcm9jZXNzVmF1bHRlZEFkZGl0aW9uYWxBY3Rpb24odCxlLGkpfX0pfV9sb2FkU3RyaXBlRWxlbWVudChlLHQsaSl7cmV0dXJuIFgodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e2NvbnRhaW5lcklkOm4sc3R5bGU6cixyZW5kZXI6byxpbml0U3RyaXBlRWxlbWVudFVwZGF0ZVRyaWdnZXI6YX09ZSxkPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZCh0LHtwYXJhbXM6e21ldGhvZDppfX0pLGw9ZC5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhpKTtpZighWShsKSl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtjb25zdHtjbGllbnRUb2tlbjpjLGluaXRpYWxpemF0aW9uRGF0YTp1fT1sLHtzaG9wcGVyTGFuZ3VhZ2U6aCxhbGxvd1JlZGlzcGxheUZvclN0b3JlZEluc3RydW1lbnRzOnA9ITEsZW5hYmxlTGluazptfT11O2lmKHRoaXMuX2FsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM9cCwhYyl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtsZXQgZztpZih0aGlzLl9zdHJpcGVVUEVDbGllbnQ9eWllbGQgdGhpcy5fbG9hZFN0cmlwZUpzKHUpLHRoaXMuX2lzU3RyaXBlRWxlbWVudFVwZGF0ZUVuYWJsZWQ9XCJmdW5jdGlvblwiPT10eXBlb2YgYSxyKXtjb25zdCBlPXI7Zz17dmFyaWFibGVzOnRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1hcEFwcGVhcmFuY2VWYXJpYWJsZXMocikscnVsZXM6e1wiLklucHV0XCI6dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubWFwSW5wdXRBcHBlYXJhbmNlUnVsZXMoZSl9fX10aGlzLl9zdHJpcGVFbGVtZW50cz15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRFbGVtZW50cyh0aGlzLl9zdHJpcGVVUEVDbGllbnQse2NsaWVudFNlY3JldDpjLGxvY2FsZTokKGgpLGFwcGVhcmFuY2U6Z30pO2NvbnN0e2dldEJpbGxpbmdBZGRyZXNzOnYsZ2V0U2hpcHBpbmdBZGRyZXNzOlN9PWQse3Bvc3RhbENvZGU6X309UygpfHx2KCl8fHt9LGY9dGhpcy5fc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChMLlBBWU1FTlQpfHx0aGlzLl9zdHJpcGVFbGVtZW50cy5jcmVhdGUoTC5QQVlNRU5ULE9iamVjdC5hc3NpZ24oe2ZpZWxkczp7YmlsbGluZ0RldGFpbHM6e2VtYWlsOnouTkVWRVIsYWRkcmVzczp7Y291bnRyeTp6Lk5FVkVSLGNpdHk6ei5ORVZFUixwb3N0YWxDb2RlOl8/ei5ORVZFUjp6LkFVVE99fX0sd2FsbGV0czp7YXBwbGVQYXk6ei5ORVZFUixnb29nbGVQYXk6ei5ORVZFUixsaW5rOm0/ei5BVVRPOnouTkVWRVJ9fSx0aGlzLl9nZXRTdHJpcGVFbGVtZW50VGVybXMoKSkpO3RoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1vdW50RWxlbWVudChmLG4pLGYub24oeC5SRUFEWSwoKT0+e28oKX0pLGYub24oeC5DSEFOR0UsZT0+eyhudWxsPT1lP3ZvaWQgMDplLnZhbHVlKSYmXCJ0eXBlXCJpbiBlLnZhbHVlJiZ0aGlzLl91cGRhdGVTdHJpcGVMaW5rU3RhdGVCeUVsZW1lbnRUeXBlKGUudmFsdWUudHlwZSl9KSx0aGlzLl9pc1N0cmlwZUVsZW1lbnRVcGRhdGVFbmFibGVkJiYobnVsbD09YXx8YSh0aGlzLl91cGRhdGVTdHJpcGVFbGVtZW50LmJpbmQodGhpcykpKX0pfV9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbldpdGhTdHJpcGVDb25maXJtYXRpb24oZSx0LGk9ITEsbj0hMSl7cmV0dXJuIFgodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCFTKGUpfHwhdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNBZGRpdGlvbmFsQWN0aW9uRXJyb3IoZS5ib2R5LmVycm9ycykpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlVVBFQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e2RhdGE6cn09ZS5ib2R5LmFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkLHt0b2tlbjpvfT1yLHtwYXltZW50SW50ZW50OnN9PXlpZWxkIHRoaXMuX2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyh0LHIpLGQ9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCwobnVsbD09cz92b2lkIDA6cy5pZCl8fG8saSxuKTt0cnl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoZCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbjtyZXR1cm4gWCh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7dG9rZW46cixyZWRpcmVjdF91cmw6b309dCxzPXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1hcFN0cmlwZVBheW1lbnREYXRhKHRoaXMuX3N0cmlwZUVsZW1lbnRzLG8sISF0aGlzLl9hbGxvd1JlZGlzcGxheUZvclN0b3JlZEluc3RydW1lbnRzKTtsZXQgYTt0cnl7Y29uc3QgdD0oeWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNQYXltZW50Q29tcGxldGVkKGUsdGhpcy5fc3RyaXBlVVBFQ2xpZW50KSk/eWllbGQgbnVsbD09PShuPXRoaXMuX3N0cmlwZVVQRUNsaWVudCl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0cmlldmVQYXltZW50SW50ZW50KHJ8fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLl9zdHJpcGVVUEVDbGllbnQpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNvbmZpcm1QYXltZW50KHMpO2lmKGE9bnVsbD09dD92b2lkIDA6dC5lcnJvcixhfHwhKG51bGw9PXQ/dm9pZCAwOnQucGF5bWVudEludGVudCkpdGhyb3cgbmV3IFY7cmV0dXJuIHR9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dTdHJpcGVFcnJvcihhKX19KX1fcHJvY2Vzc1ZhdWx0ZWRBZGRpdGlvbmFsQWN0aW9uKGUsdCxpPSExKXt2YXIgbjtyZXR1cm4gWCh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIXR8fCFTKGUpfHwhbyhlLmJvZHkuZXJyb3JzLHtjb2RlOlwidGhyZWVfZF9zZWN1cmVfcmVxdWlyZWRcIn0pKXRocm93IGU7aWYoIXRoaXMuX3N0cmlwZVVQRUNsaWVudHx8IXRoaXMuX3N0cmlwZUVsZW1lbnRzKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdCByPWUuYm9keS50aHJlZV9kc19yZXN1bHQudG9rZW47bGV0IHMsZD0hMTt0cnl7cz15aWVsZCB0aGlzLl9zdHJpcGVVUEVDbGllbnQuY29uZmlybUNhcmRQYXltZW50KHIpfWNhdGNoKGUpe3RyeXtzPXlpZWxkIHRoaXMuX3N0cmlwZVVQRUNsaWVudC5yZXRyaWV2ZVBheW1lbnRJbnRlbnQocil9Y2F0Y2goZSl7ZD0hMH19aWYoKG51bGw9PXM/dm9pZCAwOnMuZXJyb3IpJiZ0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1N0cmlwZUVycm9yKHMuZXJyb3IpLCEobnVsbD09cz92b2lkIDA6cy5wYXltZW50SW50ZW50KSYmIWQpdGhyb3cgbmV3IFc7Y29uc3QgbD10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LGQ/cjpudWxsPT09KG49bnVsbD09cz92b2lkIDA6cy5wYXltZW50SW50ZW50KXx8dm9pZCAwPT09bj92b2lkIDA6bi5pZCwhMSxpKTtyZXR1cm4gdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobCl9KX1fbG9hZFN0cmlwZUpzKGUpe3JldHVybiBYKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZih0aGlzLl9zdHJpcGVVUEVDbGllbnQpcmV0dXJuIHRoaXMuX3N0cmlwZVVQRUNsaWVudDtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpO3JldHVybiB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQoZSx0LmdldENhcnRMb2NhbGUoKSxKLFopfSl9X2dldFBheW1lbnRQYXlsb2FkKGUsdCxpPSExLG49ITEpe3ZhciByO3JldHVybnttZXRob2RJZDplLHBheW1lbnREYXRhOntmb3JtYXR0ZWRQYXlsb2FkOntjYXJ0X2lkOihudWxsPT09KHI9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09cj92b2lkIDA6ci5pZCl8fFwiXCIsY3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOnR9LGNvbmZpcm06ITEsdmF1bHRfcGF5bWVudF9pbnN0cnVtZW50Omksc2V0X2FzX2RlZmF1bHRfc3RvcmVkX2luc3RydW1lbnQ6bn19fX1fdXBkYXRlU3RyaXBlRWxlbWVudCh7c2hvdWxkU2hvd1Rlcm1zOmV9KXt2YXIgdDtjb25zdCBpPW51bGw9PT0odD10aGlzLl9zdHJpcGVFbGVtZW50cyl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuZ2V0RWxlbWVudChMLlBBWU1FTlQpO251bGw9PWl8fGkudXBkYXRlKE9iamVjdC5hc3NpZ24oe30sdGhpcy5fZ2V0U3RyaXBlRWxlbWVudFRlcm1zKGUpKSl9X2dldFN0cmlwZUVsZW1lbnRUZXJtcyhlKXtsZXQgdD16LkFVVE87cmV0dXJuIHRoaXMuX2lzU3RyaXBlRWxlbWVudFVwZGF0ZUVuYWJsZWQmJih0PWU/ei5BVVRPOnouTkVWRVIpLHt0ZXJtczp7Y2FyZDp0fX19X3VwZGF0ZVN0cmlwZUxpbmtTdGF0ZUJ5RWxlbWVudFR5cGUoZSl7Y29uc3QgdD10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRQYXltZW50UHJvdmlkZXJDdXN0b21lck9yVGhyb3coKSxpPWU9PT1SLkxpbms7IVEodCkmJmkmJnRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVQYXltZW50UHJvdmlkZXJDdXN0b21lcih7c3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGU6aX0pfX1jb25zdCB0ZT1sKHQ9Pntjb25zdCBpPW5ldyBGKGUoKSk7cmV0dXJuIG5ldyBlZSh0LGksbmV3IEgodCxpKSl9LFt7Z2F0ZXdheTpcInN0cmlwZXVwZVwifSx7Z2F0ZXdheTpcInN0cmlwZXVwZVwiLGlkOlwia2xhcm5hXCJ9XSk7dmFyIGllPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIG5le2NvbnN0cnVjdG9yKGUsdCxpKXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10LHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlPWl9aW5pdGlhbGl6ZShlKXt2YXIgdDtyZXR1cm4gaWUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3N0cmlwZW9jczppLG1ldGhvZElkOm4sZ2F0ZXdheUlkOnJ9PWU7aWYoIShudWxsPT1pP3ZvaWQgMDppLmNvbnRhaW5lcklkKSl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7aWYoIXIpdGhyb3cgbmV3IHUoJ1VuYWJsZSB0byBpbml0aWFsaXplIHBheW1lbnQgYmVjYXVzZSBcImdhdGV3YXlJZFwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTt0cnl7eWllbGQgdGhpcy5faW5pdGlhbGl6ZVN0cmlwZUVsZW1lbnQoaSxyLG4pfWNhdGNoKGUpe2UgaW5zdGFuY2VvZiBFcnJvciYmKG51bGw9PT0odD1pLm9uRXJyb3IpfHx2b2lkIDA9PT10fHx0LmNhbGwoaSxlKSl9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaW5pdENoZWNrb3V0RXZlbnRzU3Vic2NyaXB0aW9uKHIsbixpLHRoaXMuc3RyaXBlRWxlbWVudHMpfSl9ZXhlY3V0ZShlLHQpe3JldHVybiBpZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7cGF5bWVudDppfT1lLG49ZnVuY3Rpb24oZSx0KXt2YXIgaT17fTtmb3IodmFyIG4gaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxuKSYmdC5pbmRleE9mKG4pPDAmJihpW25dPWVbbl0pO2lmKG51bGwhPWUmJlwiZnVuY3Rpb25cIj09dHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciByPTA7Zm9yKG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtyPG4ubGVuZ3RoO3IrKyl0LmluZGV4T2YobltyXSk8MCYmT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUsbltyXSkmJihpW25bcl1dPWVbbltyXV0pfXJldHVybiBpfShlLFtcInBheW1lbnRcIl0pLHttZXRob2RJZDpyLGdhdGV3YXlJZDpvfT1pfHx7fTtpZighdGhpcy5zdHJpcGVDbGllbnQpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCFvfHwhcil0aHJvdyBuZXcgdSgnVW5hYmxlIHRvIGluaXRpYWxpemUgcGF5bWVudCBiZWNhdXNlIFwiZ2F0ZXdheUlkXCIgb3IgXCJtZXRob2RJZFwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTtjb25zdCBzPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtpc1N0b3JlQ3JlZGl0QXBwbGllZDpkfT1zLmdldENoZWNrb3V0T3JUaHJvdygpO2QmJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuYXBwbHlTdG9yZUNyZWRpdChkKSkseWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlU3RyaXBlUGF5bWVudEludGVudChvLHIpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcihuLHQpO2NvbnN0e2NsaWVudFRva2VuOmx9PXMuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3cociksYz10aGlzLl9nZXRQYXltZW50UGF5bG9hZChyLGx8fFwiXCIpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChjKX1jYXRjaChlKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHIpfX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBnKX1kZWluaXRpYWxpemUoKXt2YXIgZTtjb25zdCB0PW51bGw9PT0oZT10aGlzLnN0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KEwuUEFZTUVOVCk7cmV0dXJuIG51bGw9PXR8fHQudW5tb3VudCgpLG51bGw9PXR8fHQuZGVzdHJveSgpLHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmRlaW5pdGlhbGl6ZSgpLHRoaXMuc3RyaXBlRWxlbWVudHM9dm9pZCAwLHRoaXMuc3RyaXBlQ2xpZW50PXZvaWQgMCxQcm9taXNlLnJlc29sdmUoKX1faW5pdGlhbGl6ZVN0cmlwZUVsZW1lbnQoZSx0LGkpe3JldHVybiBpZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7bGV0IG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSk7aWYoKG51bGw9PW4/dm9pZCAwOm4uY2xpZW50VG9rZW4pfHwobj0oeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRQYXltZW50TWV0aG9kKHQse3BhcmFtczp7bWV0aG9kOml9fSkpLmdldFBheW1lbnRNZXRob2RPclRocm93KGkpKSwhWShuKSl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtjb25zdHtjbGllbnRUb2tlbjpyLGluaXRpYWxpemF0aW9uRGF0YTpvfT1uLHtzaG9wcGVyTGFuZ3VhZ2U6YSxjdXN0b21lclNlc3Npb25Ub2tlbjpkLGVuYWJsZUxpbms6bH09bztpZighcil0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTt0aGlzLnN0cmlwZUNsaWVudD15aWVsZCB0aGlzLl9sb2FkU3RyaXBlSnMobyk7Y29uc3R7YXBwZWFyYW5jZTpjLGNvbnRhaW5lcklkOnUsZm9udHM6aCxsYXlvdXQ6cCxyZW5kZXI6bSxwYXltZW50TWV0aG9kU2VsZWN0OmcsaGFuZGxlQ2xvc2VQYXltZW50TWV0aG9kOnYsdG9nZ2xlUHJlbG9hZGVyOlN9PWU7dGhpcy5zdHJpcGVFbGVtZW50cz15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRFbGVtZW50cyh0aGlzLnN0cmlwZUNsaWVudCx7Y2xpZW50U2VjcmV0OnIsY3VzdG9tZXJTZXNzaW9uQ2xpZW50U2VjcmV0OmQsbG9jYWxlOiQoYSksYXBwZWFyYW5jZTpjLGZvbnRzOmh9KTtjb25zdHtnZXRCaWxsaW5nQWRkcmVzczpfLGdldFNoaXBwaW5nQWRkcmVzczpmfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxJPV8oKSx7cG9zdGFsQ29kZTpDfT1mKCl8fEl8fHt9LEU9dGhpcy5zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KEwuUEFZTUVOVCl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKEwuUEFZTUVOVCx7ZmllbGRzOntiaWxsaW5nRGV0YWlsczp7ZW1haWw6ei5ORVZFUixhZGRyZXNzOntjb3VudHJ5OnouTkVWRVIsY2l0eTp6Lk5FVkVSLHBvc3RhbENvZGU6Qz96Lk5FVkVSOnouQVVUT319fSx3YWxsZXRzOnthcHBsZVBheTp6Lk5FVkVSLGdvb2dsZVBheTp6Lk5FVkVSLGxpbms6bD96LkFVVE86ei5ORVZFUn0sbGF5b3V0OnAsc2F2ZVBheW1lbnRNZXRob2Q6e21heFZpc2libGVQYXltZW50TWV0aG9kczoyMH0sZGVmYXVsdFZhbHVlczp7YmlsbGluZ0RldGFpbHM6e2VtYWlsOihudWxsPT1JP3ZvaWQgMDpJLmVtYWlsKXx8XCJcIn19fSk7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubW91bnRFbGVtZW50KEUsdSksRS5vbih4LkxPQURFUl9TVEFSVCwoKT0+e251bGw9PVN8fFMoITEpfSksRS5vbih4LlJFQURZLCgpPT57bSgpfSksRS5vbih4LkNIQU5HRSxlPT57dGhpcy5fb25TdHJpcGVFbGVtZW50Q2hhbmdlKGUsdCxpLGcpfSksbnVsbD09dnx8dih0aGlzLl9jb2xsYXBzZVN0cmlwZUVsZW1lbnQuYmluZCh0aGlzKSl9KX1fbG9hZFN0cmlwZUpzKGUpe3JldHVybiBpZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYodGhpcy5zdHJpcGVDbGllbnQpcmV0dXJuIHRoaXMuc3RyaXBlQ2xpZW50O2NvbnN0IHQ9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCk7cmV0dXJuIHRoaXMuc2NyaXB0TG9hZGVyLmdldFN0cmlwZUNsaWVudChlLHQuZ2V0Q2FydExvY2FsZSgpKX0pfV9jb2xsYXBzZVN0cmlwZUVsZW1lbnQoKXt2YXIgZTtjb25zdCB0PW51bGw9PT0oZT10aGlzLnN0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KEwuUEFZTUVOVCk7bnVsbD09dHx8dC5jb2xsYXBzZSgpfV9nZXRQYXltZW50UGF5bG9hZChlLHQsaSl7dmFyIG47Y29uc3Qgcj0obnVsbD09PShuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnQoKSl8fHZvaWQgMD09PW4/dm9pZCAwOm4uaWQpfHxcIlwiLHtjYXJkOm8sdXNfYmFua19hY2NvdW50OnN9PWl8fHt9LGE9dGhpcy5fc2hvdWxkU2F2ZUluc3RydW1lbnQobyl8fHRoaXMuX3Nob3VsZFNhdmVJbnN0cnVtZW50KHMpLGQ9dGhpcy5fZ2V0VG9rZW5pemVkT3B0aW9ucyh0LGkpO3JldHVybnttZXRob2RJZDplLHBheW1lbnREYXRhOntmb3JtYXR0ZWRQYXlsb2FkOk9iamVjdC5hc3NpZ24oe2NhcnRfaWQ6cixjb25maXJtOiExLG1ldGhvZDp0aGlzLnNlbGVjdGVkTWV0aG9kSWQsdmF1bHRfcGF5bWVudF9pbnN0cnVtZW50OmF9LGQpfX19X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl7cmV0dXJuIGllKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighUyhlKXx8IXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUuYm9keS5lcnJvcnMpKXRocm93IGU7aWYoIXRoaXMuc3RyaXBlQ2xpZW50fHwhdGhpcy5zdHJpcGVFbGVtZW50cyl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7ZGF0YTppfT1lLmJvZHkuYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWQse3Rva2VuOm59PWkse3BheW1lbnRJbnRlbnQ6cn09eWllbGQgdGhpcy5fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KHQsaSkse2NsaWVudF9zZWNyZXQ6byxwYXltZW50X21ldGhvZF9vcHRpb25zOnN9PXJ8fHt9LGQ9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCxvfHxuLHMpO3RyeXtyZXR1cm4geWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoZCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbjtyZXR1cm4gaWUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOnIscmVkaXJlY3RfdXJsOm99PXQscz10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLnN0cmlwZUVsZW1lbnRzLG8pO2xldCBhO3RyeXtjb25zdCB0PSh5aWVsZCB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pc1BheW1lbnRDb21wbGV0ZWQoZSx0aGlzLnN0cmlwZUNsaWVudCkpP3lpZWxkIG51bGw9PT0obj10aGlzLnN0cmlwZUNsaWVudCl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0cmlldmVQYXltZW50SW50ZW50KHJ8fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLnN0cmlwZUNsaWVudCl8fHZvaWQgMD09PWk/dm9pZCAwOmkuY29uZmlybVBheW1lbnQocyk7aWYoYT1udWxsPT10P3ZvaWQgMDp0LmVycm9yLGF8fCEobnVsbD09dD92b2lkIDA6dC5wYXltZW50SW50ZW50KSl0aHJvdyBuZXcgVjtyZXR1cm4gdH1jYXRjaChlKXtyZXR1cm4gdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dTdHJpcGVFcnJvcihhKX19KX1fb25TdHJpcGVFbGVtZW50Q2hhbmdlKGUsdCxpLG4peyhlPT5cIm9iamVjdFwiPT10eXBlb2YgZSYmbnVsbCE9PWUmJlwidmFsdWVcImluIGUmJlwiY29sbGFwc2VkXCJpbiBlKShlKSYmIWUuY29sbGFwc2VkJiYodGhpcy5zZWxlY3RlZE1ldGhvZElkPWUudmFsdWUudHlwZSxudWxsPT1ufHxuKGAke3R9LSR7aX1gKSl9X3Nob3VsZFNhdmVJbnN0cnVtZW50KGUpe2NvbnN0IHQ9bnVsbD09ZT92b2lkIDA6ZS5zZXR1cF9mdXR1cmVfdXNhZ2U7cmV0dXJuIHQ9PT1qLk9OX1NFU1NJT058fHQ9PT1qLk9GRl9TRVNTSU9OfV9nZXRUb2tlbml6ZWRPcHRpb25zKGUsdCl7cmV0dXJuIHRoaXMuX3Nob3VsZFNhdmVJbnN0cnVtZW50KG51bGw9PXQ/dm9pZCAwOnQudXNfYmFua19hY2NvdW50KT97dG9rZW5pemVkX2FjaDp7dG9rZW46ZX19OntjcmVkaXRfY2FyZF90b2tlbjp7dG9rZW46ZX19fX1jb25zdCByZT1sKHQ9Pntjb25zdCBpPW5ldyBGKGUoKSk7cmV0dXJuIG5ldyBuZSh0LGksbmV3IEgodCxpKSl9LFt7Z2F0ZXdheTpcInN0cmlwZW9jc1wiLGlkOlwib3B0aW1pemVkX2NoZWNrb3V0XCJ9XSk7Y2xhc3Mgb2V7Y29uc3RydWN0b3IoZSx0KXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10fWluaXRpYWxpemUoZSl7dmFyIHQsaSxuLHIsbztyZXR1cm4gaT10aGlzLG49dm9pZCAwLG89ZnVuY3Rpb24qKCl7bGV0IGk7aWYoIWUuc3RyaXBldXBlKXRocm93IG5ldyB1KCdVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIFwib3B0aW9uc1wiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC4nKTtjb25zdHtjb250YWluZXI6bixnYXRld2F5SWQ6cixtZXRob2RJZDpvLG9uRW1haWxDaGFuZ2U6YSxnZXRTdHlsZXM6ZCxpc0xvYWRpbmc6bH09ZS5zdHJpcGV1cGU7T2JqZWN0LmVudHJpZXMoZS5zdHJpcGV1cGUpLmZvckVhY2goKFtlLHRdKT0+e2lmKCF0KXRocm93IG5ldyB1KGBVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIFwiJHtlfVwiIGFyZ3VtZW50IGlzIG5vdCBwcm92aWRlZC5gKX0pLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChyLHtwYXJhbXM6e21ldGhvZDpvfX0pO2NvbnN0IGM9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksaD1jLmdldFBheW1lbnRNZXRob2RPclRocm93KG8scikse2NsaWVudFRva2VuOnB9PWg7aWYoIVkoaCl8fCFwKXRocm93IG5ldyB5KHMuTWlzc2luZ1BheW1lbnRUb2tlbik7Y29uc3R7ZW1haWw6bX09Yy5nZXRDdXN0b21lck9yVGhyb3coKSxnPWMuZ2V0UGF5bWVudFByb3ZpZGVyQ3VzdG9tZXJPclRocm93KCksdj0oUShnKT9nOnt9KS5zdHJpcGVMaW5rQXV0aGVudGljYXRpb25TdGF0ZTtpZighbSl7bGV0IGU7Y29uc3Qgcj1cImZ1bmN0aW9uXCI9PXR5cGVvZiBkJiZkKCk7ZT1yP3t2YXJpYWJsZXM6e2NvbG9yUHJpbWFyeTpyLmZpZWxkSW5uZXJTaGFkb3csY29sb3JCYWNrZ3JvdW5kOnIuZmllbGRCYWNrZ3JvdW5kLGNvbG9yVGV4dDpyLmxhYmVsVGV4dCxjb2xvckRhbmdlcjpyLmZpZWxkRXJyb3JUZXh0LGNvbG9yVGV4dFNlY29uZGFyeTpyLmxhYmVsVGV4dCxjb2xvclRleHRQbGFjZWhvbGRlcjpyLmZpZWxkUGxhY2Vob2xkZXJUZXh0fSxydWxlczp7XCIuSW5wdXRcIjp7Ym9yZGVyQ29sb3I6ci5maWVsZEJvcmRlcixjb2xvcjpyLmZpZWxkVGV4dCxib3hTaGFkb3c6ci5maWVsZElubmVyU2hhZG93fX19Ont9LGk9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGguaW5pdGlhbGl6YXRpb25EYXRhLGMuZ2V0Q2FydExvY2FsZSgpLEosWiksdGhpcy5fc3RyaXBlRWxlbWVudHM9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0RWxlbWVudHMoaSx7Y2xpZW50U2VjcmV0OnAsYXBwZWFyYW5jZTplfSk7Y29uc3R7Z2V0QmlsbGluZ0FkZHJlc3M6byxnZXRDb25zaWdubWVudHM6dX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksbT11KCksZz1udWxsPT09KHQ9bnVsbD09bT92b2lkIDA6bVswXSl8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQse2VtYWlsOlN9PW8oKXx8e30sXz1TP3tkZWZhdWx0VmFsdWVzOnttb2RlOmsuU0hJUFBJTkcsZW1haWw6U319Ont9LGY9dGhpcy5fc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChMLkFVVEhFTlRJQ0FUSU9OKXx8dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKEwuQVVUSEVOVElDQVRJT04sXyk7Zi5vbih4LkNIQU5HRSxlPT57aWYoIShcImF1dGhlbnRpY2F0ZWRcImluIGUpKXRocm93IG5ldyB5KHMuTWlzc2luZ0N1c3RvbWVyKTt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlUGF5bWVudFByb3ZpZGVyQ3VzdG9tZXIoe3N0cmlwZUxpbmtBdXRoZW50aWNhdGlvblN0YXRlOmUuYXV0aGVudGljYXRlZH0pLGUuY29tcGxldGU/YShlLmF1dGhlbnRpY2F0ZWQsZS52YWx1ZS5lbWFpbCk6YSghMSxcIlwiKSxsJiZsKCExKSx2b2lkIDA9PT12JiZlLmF1dGhlbnRpY2F0ZWQmJmcmJnRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5kZWxldGVDb25zaWdubWVudChnKX0pLGYubW91bnQoYCMke259YCl9fSxuZXcoKHI9dm9pZCAwKXx8KHI9UHJvbWlzZSkpKGZ1bmN0aW9uKGUsdCl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChvLm5leHQoZSkpfWNhdGNoKGUpe3QoZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qoby50aHJvdyhlKSl9Y2F0Y2goZSl7dChlKX19ZnVuY3Rpb24gZCh0KXt2YXIgaTt0LmRvbmU/ZSh0LnZhbHVlKTooaT10LnZhbHVlLGkgaW5zdGFuY2VvZiByP2k6bmV3IHIoZnVuY3Rpb24oZSl7ZShpKX0pKS50aGVuKHMsYSl9ZCgobz1vLmFwcGx5KGksbnx8W10pKS5uZXh0KCkpfSl9ZGVpbml0aWFsaXplKCl7dmFyIGUsdDtyZXR1cm4gbnVsbD09PSh0PW51bGw9PT0oZT10aGlzLl9zdHJpcGVFbGVtZW50cyl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZ2V0RWxlbWVudChMLkFVVEhFTlRJQ0FUSU9OKSl8fHZvaWQgMD09PXR8fHQudW5tb3VudCgpLFByb21pc2UucmVzb2x2ZSgpfXNpZ25JbihlLHQpe3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc2lnbkluQ3VzdG9tZXIoZSx0KSxQcm9taXNlLnJlc29sdmUoKX1zaWduT3V0KGUpe3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc2lnbk91dEN1c3RvbWVyKGUpLFByb21pc2UucmVzb2x2ZSgpfWV4ZWN1dGVQYXltZW50TWV0aG9kQ2hlY2tvdXQoZSl7dmFyIHQ7cmV0dXJuIG51bGw9PT0odD1udWxsPT1lP3ZvaWQgMDplLmNvbnRpbnVlV2l0aENoZWNrb3V0Q2FsbGJhY2spfHx2b2lkIDA9PT10fHx0LmNhbGwoZSksUHJvbWlzZS5yZXNvbHZlKCl9fWNvbnN0IHNlPWwodD0+bmV3IG9lKHQsbmV3IEYoZSgpKSksW3tpZDpcInN0cmlwZXVwZVwifV0pLGFlPXtzaXplOjcwLGNvbG9yOlwiI2Q5ZDlkOVwiLGJhY2tncm91bmRDb2xvcjpcIiNmZmZmZmZcIn0sZGU9e3Bvc2l0aW9uOlwiZml4ZWRcIixcImJhY2tncm91bmQtY29sb3JcIjpcInJnYmEoMCwgMCwgMCwgMC40KVwiLFwiei1pbmRleFwiOlwiMTAwMFwifSxsZT1cImVtYmVkZGVkLWNoZWNrb3V0LWxvYWRpbmctaW5kaWNhdG9yLXJvdGF0aW9uXCI7Y2xhc3MgY2V7Y29uc3RydWN0b3IoZSl7dGhpcy5zdHlsZXM9T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LGFlKSxlJiZlLnN0eWxlcyksdGhpcy5jb250YWluZXJTdHlsZXM9T2JqZWN0LmFzc2lnbih7fSxlJiZlLmNvbnRhaW5lclN0eWxlcyksdGhpcy5kZWZpbmVBbmltYXRpb24oKSx0aGlzLmNvbnRhaW5lcj10aGlzLmJ1aWxkQ29udGFpbmVyKCksdGhpcy5pbmRpY2F0b3I9dGhpcy5idWlsZEluZGljYXRvcigpLHRoaXMuY29udGFpbmVyLmFwcGVuZENoaWxkKHRoaXMuaW5kaWNhdG9yKX1zaG93KGUpe2lmKGUpe2NvbnN0IHQ9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZSk7aWYoIXQpdGhyb3cgbmV3IEVycm9yKFwiVW5hYmxlIHRvIGF0dGFjaCB0aGUgbG9hZGluZyBpbmRpY2F0b3IgYmVjYXVzZSB0aGUgcGFyZW50IElEIGlzIG5vdCB2YWxpZC5cIik7dC5hcHBlbmRDaGlsZCh0aGlzLmNvbnRhaW5lcil9dGhpcy5jb250YWluZXIuc3R5bGUudmlzaWJpbGl0eT1cInZpc2libGVcIix0aGlzLmNvbnRhaW5lci5zdHlsZS5vcGFjaXR5PVwiMVwifWhpZGUoKXtjb25zdCBlPSgpPT57dGhpcy5jb250YWluZXIuc3R5bGUudmlzaWJpbGl0eT1cImhpZGRlblwiLHRoaXMuY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJ0cmFuc2l0aW9uZW5kXCIsZSl9O3RoaXMuY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoXCJ0cmFuc2l0aW9uZW5kXCIsZSksdGhpcy5jb250YWluZXIuc3R5bGUub3BhY2l0eT1cIjBcIn1idWlsZENvbnRhaW5lcigpe2NvbnN0IGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtyZXR1cm4gZS5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIixlLnN0eWxlLmJvdHRvbT1cIjBcIixlLnN0eWxlLmxlZnQ9XCIwXCIsZS5zdHlsZS5oZWlnaHQ9XCIxMDAlXCIsZS5zdHlsZS53aWR0aD1cIjEwMCVcIixlLnN0eWxlLnBvc2l0aW9uPVwiYWJzb2x1dGVcIixlLnN0eWxlLnJpZ2h0PVwiMFwiLGUuc3R5bGUudG9wPVwiMFwiLGUuc3R5bGUudHJhbnNpdGlvbj1cImFsbCAyNTBtcyBlYXNlLW91dFwiLGUuc3R5bGUub3BhY2l0eT1cIjBcIix0aGlzLnNldFN0eWxlQXR0cmlidXRlKGUsdGhpcy5jb250YWluZXJTdHlsZXMpLGV9YnVpbGRJbmRpY2F0b3IoKXtjb25zdCBlPWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7cmV0dXJuIGUuc3R5bGUuZGlzcGxheT1cImJsb2NrXCIsZS5zdHlsZS53aWR0aD1gJHt0aGlzLnN0eWxlcy5zaXplfXB4YCxlLnN0eWxlLmhlaWdodD1gJHt0aGlzLnN0eWxlcy5zaXplfXB4YCxlLnN0eWxlLmJvcmRlclJhZGl1cz1gJHt0aGlzLnN0eWxlcy5zaXplfXB4YCxlLnN0eWxlLmJvcmRlcj1cInNvbGlkIDFweFwiLGUuc3R5bGUuYm9yZGVyQ29sb3I9YCR7dGhpcy5zdHlsZXMuYmFja2dyb3VuZENvbG9yfSAke3RoaXMuc3R5bGVzLmJhY2tncm91bmRDb2xvcn0gJHt0aGlzLnN0eWxlcy5jb2xvcn0gJHt0aGlzLnN0eWxlcy5jb2xvcn1gLGUuc3R5bGUubWFyZ2luPVwiMCBhdXRvXCIsZS5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsZS5zdHlsZS5sZWZ0PVwiMFwiLGUuc3R5bGUucmlnaHQ9XCIwXCIsZS5zdHlsZS50b3A9XCI1MCVcIixlLnN0eWxlLnRyYW5zZm9ybT1cInRyYW5zbGF0ZVkoLTUwJSkgcm90YXRlKDBkZWcpXCIsZS5zdHlsZS50cmFuc2Zvcm1TdHlsZT1cInByZXNlcnZlLTNkXCIsZS5zdHlsZS5hbmltYXRpb249YCR7bGV9IDUwMG1zIGluZmluaXRlIGN1YmljLWJlemllcigwLjY5LCAwLjMxLCAwLjU2LCAwLjgzKWAsZX1zZXRTdHlsZUF0dHJpYnV0ZShlLHQpe09iamVjdC5rZXlzKHQpLmZvckVhY2goaT0+e2Uuc3R5bGUuc2V0UHJvcGVydHkoaSx0W2ldKX0pfWRlZmluZUFuaW1hdGlvbigpe3ZhciBlO2lmKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGxlKSlyZXR1cm47Y29uc3QgdD1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwic3R5bGVcIik7dC5pZD1sZSxudWxsPT09KGU9ZG9jdW1lbnQuaGVhZCl8fHZvaWQgMD09PWV8fGUuYXBwZW5kQ2hpbGQodCksdC5zaGVldCBpbnN0YW5jZW9mIENTU1N0eWxlU2hlZXQmJnQuc2hlZXQuaW5zZXJ0UnVsZShgXFxuICAgICAgICAgICAgICAgIEBrZXlmcmFtZXMgJHtsZX0ge1xcbiAgICAgICAgICAgICAgICAgICAgMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSkgcm90YXRlKDBkZWcpOyB9XFxuICAgICAgICAgICAgICAgICAgICAxMDAlIHsgdHJhbnNmb3JtOiB0cmFuc2xhdGVZKC01MCUpIHJvdGF0ZSgzNjBkZWcpOyB9XFxuICAgICAgICAgICAgICAgIH1cXG4gICAgICAgICAgICBgLDApfX1jbGFzcyB1ZXtjb25zdHJ1Y3RvcihlKXt0aGlzLl9kZWNpbWFsUGxhY2VzPWV9dG9JbnRlZ2VyKGUpe3JldHVybiBNYXRoLnJvdW5kKGUqTWF0aC5wb3coMTAsdGhpcy5fZGVjaW1hbFBsYWNlcykpfX1jb25zdCBoZT1bXCJBQ1wiLFwiQURcIixcIkFFXCIsXCJBRlwiLFwiQUdcIixcIkFJXCIsXCJBTFwiLFwiQU1cIixcIkFPXCIsXCJBUVwiLFwiQVJcIixcIkFUXCIsXCJBVVwiLFwiQVdcIixcIkFYXCIsXCJBWlwiLFwiQkFcIixcIkJCXCIsXCJCRFwiLFwiQkVcIixcIkJGXCIsXCJCR1wiLFwiQkhcIixcIkJJXCIsXCJCSlwiLFwiQkxcIixcIkJNXCIsXCJCTlwiLFwiQk9cIixcIkJRXCIsXCJCUlwiLFwiQlNcIixcIkJUXCIsXCJCVlwiLFwiQldcIixcIkJZXCIsXCJCWlwiLFwiQ0FcIixcIkNEXCIsXCJDRlwiLFwiQ0dcIixcIkNIXCIsXCJDSVwiLFwiQ0tcIixcIkNMXCIsXCJDTVwiLFwiQ05cIixcIkNPXCIsXCJDUlwiLFwiQ1ZcIixcIkNXXCIsXCJDWVwiLFwiQ1pcIixcIkRFXCIsXCJESlwiLFwiREtcIixcIkRNXCIsXCJET1wiLFwiRFpcIixcIkVDXCIsXCJFRVwiLFwiRUdcIixcIkVIXCIsXCJFUlwiLFwiRVNcIixcIkVUXCIsXCJGSVwiLFwiRkpcIixcIkZLXCIsXCJGT1wiLFwiRlJcIixcIkdBXCIsXCJHQlwiLFwiR0RcIixcIkdFXCIsXCJHRlwiLFwiR0dcIixcIkdIXCIsXCJHSVwiLFwiR0xcIixcIkdNXCIsXCJHTlwiLFwiR1BcIixcIkdRXCIsXCJHUlwiLFwiR1NcIixcIkdUXCIsXCJHVVwiLFwiR1dcIixcIkdZXCIsXCJIS1wiLFwiSE5cIixcIkhSXCIsXCJIVFwiLFwiSFVcIixcIklEXCIsXCJJRVwiLFwiSUxcIixcIklNXCIsXCJJTlwiLFwiSU9cIixcIklRXCIsXCJJU1wiLFwiSVRcIixcIkpFXCIsXCJKTVwiLFwiSk9cIixcIkpQXCIsXCJLRVwiLFwiS0dcIixcIktIXCIsXCJLSVwiLFwiS01cIixcIktOXCIsXCJLUlwiLFwiS1dcIixcIktZXCIsXCJLWlwiLFwiTEFcIixcIkxCXCIsXCJMQ1wiLFwiTElcIixcIkxLXCIsXCJMUlwiLFwiTFNcIixcIkxUXCIsXCJMVVwiLFwiTFZcIixcIkxZXCIsXCJNQVwiLFwiTUNcIixcIk1EXCIsXCJNRVwiLFwiTUZcIixcIk1HXCIsXCJNS1wiLFwiTUxcIixcIk1NXCIsXCJNTlwiLFwiTU9cIixcIk1RXCIsXCJNUlwiLFwiTVNcIixcIk1UXCIsXCJNVVwiLFwiTVZcIixcIk1XXCIsXCJNWFwiLFwiTVlcIixcIk1aXCIsXCJOQVwiLFwiTkNcIixcIk5FXCIsXCJOR1wiLFwiTklcIixcIk5MXCIsXCJOT1wiLFwiTlBcIixcIk5SXCIsXCJOVVwiLFwiTlpcIixcIk9NXCIsXCJQQVwiLFwiUEVcIixcIlBGXCIsXCJQR1wiLFwiUEhcIixcIlBLXCIsXCJQTFwiLFwiUE1cIixcIlBOXCIsXCJQUlwiLFwiUFNcIixcIlBUXCIsXCJQWVwiLFwiUUFcIixcIlJFXCIsXCJST1wiLFwiUlNcIixcIlJVXCIsXCJSV1wiLFwiU0FcIixcIlNCXCIsXCJTQ1wiLFwiU0RcIixcIlNFXCIsXCJTR1wiLFwiU0hcIixcIlNJXCIsXCJTSlwiLFwiU0tcIixcIlNMXCIsXCJTTVwiLFwiU05cIixcIlNPXCIsXCJTUlwiLFwiU1NcIixcIlNUXCIsXCJTVlwiLFwiU1hcIixcIlNaXCIsXCJUQVwiLFwiVENcIixcIlREXCIsXCJURlwiLFwiVEdcIixcIlRIXCIsXCJUSlwiLFwiVEtcIixcIlRMXCIsXCJUTVwiLFwiVE5cIixcIlRPXCIsXCJUUlwiLFwiVFRcIixcIlRWXCIsXCJUV1wiLFwiVFpcIixcIlVBXCIsXCJVR1wiLFwiVVNcIixcIlVZXCIsXCJVWlwiLFwiVkFcIixcIlZDXCIsXCJWRVwiLFwiVkdcIixcIlZOXCIsXCJWVVwiLFwiV0ZcIixcIldTXCIsXCJYS1wiLFwiWUVcIixcIllUXCIsXCJaQVwiLFwiWk1cIixcIlpXXCIsXCJaWlwiXTt2YXIgcGU9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgbWV7Y29uc3RydWN0b3IoZSx0LGksbil7dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlPWUsdGhpcy5zY3JpcHRMb2FkZXI9dCx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZT1pLHRoaXMubG9hZGluZ0luZGljYXRvcj1ufWluaXRpYWxpemUoZSl7cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGVvY3M6dH09ZXx8e307aWYoIXQpdGhyb3cgbmV3IHUoJ1VuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgXCJvcHRpb25zXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO2NvbnN0e21ldGhvZElkOmksZ2F0ZXdheUlkOm4sY29udGFpbmVyOnJ9PXQ7aWYoIXJ8fCFpfHwhbil0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3Qgbz15aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2Qobix7cGFyYW1zOnttZXRob2Q6aX19KSxkPW8uZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSxuKSx7bG9hZGluZ0NvbnRhaW5lcklkOmwsYnV0dG9uSGVpZ2h0OmMsb25Db21wbGV0ZTpofT10O2lmKHRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI9bCx0aGlzLl9vbkNvbXBsZXRlPWgsIVkoZCkpdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7aW5pdGlhbGl6YXRpb25EYXRhOnB9PWQse2NhcHR1cmVNZXRob2Q6bX09cDtyZXR1cm4gdGhpcy5fY2FwdHVyZU1ldGhvZD1tLHRoaXMuX3N0cmlwZUNsaWVudD15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQocCxvLmdldENhcnRMb2NhbGUoKSkseWllbGQgdGhpcy5fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGkscix0aGlzLl9zdHJpcGVDbGllbnQsYyksUHJvbWlzZS5yZXNvbHZlKCl9KX1zaWduSW4oKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9c2lnbk91dCgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1leGVjdXRlUGF5bWVudE1ldGhvZENoZWNrb3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWRlaW5pdGlhbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGUsdCxpLG49NDApe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgcj10aGlzLl9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCksbz1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7c2hpcHBpbmdBZGRyZXNzUmVxdWlyZWQ6cn0scj97YWxsb3dlZFNoaXBwaW5nQ291bnRyaWVzOnlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZUNvdW50cmllcygpfTp7fSkscj97c2hpcHBpbmdSYXRlczpbe2lkOlwiX1wiLGFtb3VudDowLGRpc3BsYXlOYW1lOlwiUGVuZGluZyByYXRlc1wifV19Ont9KSx7YmlsbGluZ0FkZHJlc3NSZXF1aXJlZDohMCxlbWFpbFJlcXVpcmVkOiEwLHBob25lTnVtYmVyUmVxdWlyZWQ6ITAscGF5bWVudE1ldGhvZHM6e2xpbms6ei5BVVRPLGFwcGxlUGF5OnouTkVWRVIsZ29vZ2xlUGF5OnouTkVWRVIsYW1hem9uUGF5OnouTkVWRVIscGF5cGFsOnouTkVWRVIsa2xhcm5hOnouTkVWRVJ9LGJ1dHRvbkhlaWdodDpufSkse2NhcnRBbW91bnQ6c309dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydE9yVGhyb3coKSxhPU9iamVjdC5hc3NpZ24oe21vZGU6XCJwYXltZW50XCIsYW1vdW50OnRoaXMuX3RvQ2VudHMocyksY3VycmVuY3k6dGhpcy5fZ2V0Q3VycmVuY3koKX0sdGhpcy5fY2FwdHVyZU1ldGhvZD97Y2FwdHVyZU1ldGhvZDp0aGlzLl9jYXB0dXJlTWV0aG9kfTp7fSk7dGhpcy5fc3RyaXBlRWxlbWVudHM9aS5lbGVtZW50cyhhKSx0aGlzLl9saW5rVjJFbGVtZW50PXRoaXMuX3N0cmlwZUVsZW1lbnRzLmNyZWF0ZShMLkVYUFJFU1NfQ0hFQ0tPVVQsbyksdGhpcy5fbGlua1YyRWxlbWVudC5tb3VudChgIyR7dH1gKSx0aGlzLl9pbml0aWFsaXplRXZlbnRzKHRoaXMuX2xpbmtWMkVsZW1lbnQsZSl9KX1faW5pdGlhbGl6ZUV2ZW50cyhlLHQpe3RoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSYmKGUub24oeC5TSElQUElOR19BRERSRVNTX0NIQU5HRSxlPT5wZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uU2hpcHBpbmdBZGRyZXNzQ2hhbmdlKGUpfSkpLGUub24oeC5TSElQUElOR19SQVRFX0NIQU5HRSxlPT5wZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uU2hpcHBpbmdSYXRlQ2hhbmdlKGUpfSkpKSxlLm9uKHguQ09ORklSTSxlPT5wZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uQ29uZmlybShlLHQpfSkpLGUub24oeC5DQU5DRUwsdGhpcy5fb25DYW5jZWwpfV9vblNoaXBwaW5nQWRkcmVzc0NoYW5nZShlKXtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKFwiYWRkcmVzc1wiaW4gZSl7Y29uc3QgdD1lLmFkZHJlc3MsaT17Zmlyc3ROYW1lOlwiXCIsbGFzdE5hbWU6XCJcIixwaG9uZTpcIlwiLGNvbXBhbnk6XCJcIixhZGRyZXNzMTpcIlwiLGFkZHJlc3MyOlwiXCIsY2l0eToobnVsbD09dD92b2lkIDA6dC5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09dD92b2lkIDA6dC5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT10P3ZvaWQgMDp0LnBvc3RhbF9jb2RlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2U6KG51bGw9PXQ/dm9pZCAwOnQuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6XCJcIixjdXN0b21GaWVsZHM6W119O3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVTaGlwcGluZ0FkZHJlc3MoaSk7Y29uc3Qgbj15aWVsZCB0aGlzLl9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKTt5aWVsZCB0aGlzLl91cGRhdGVEaXNwbGF5ZWRQcmljZSgpLGUucmVzb2x2ZSh7c2hpcHBpbmdSYXRlczpufSl9fSl9X29uQ2FuY2VsKCl7dGhyb3cgbmV3IF99X29uU2hpcHBpbmdSYXRlQ2hhbmdlKGUpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoXCJzaGlwcGluZ1JhdGVcImluIGUpe2NvbnN0e3NoaXBwaW5nUmF0ZTp0fT1lO3lpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PXQ/dm9pZCAwOnQuaWQpLHlpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksZS5yZXNvbHZlKHt9KX19KX1fb25Db25maXJtKGUsdCl7cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcImJpbGxpbmdEZXRhaWxzXCJpbiBlJiZcInNoaXBwaW5nQWRkcmVzc1wiaW4gZSYmdGhpcy5fc3RyaXBlQ2xpZW50JiZ0aGlzLl9zdHJpcGVFbGVtZW50cyl7eWllbGQgdGhpcy5fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKSx5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoKTtjb25zdCBpPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChpKX1jYXRjaChlKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQpfX1yZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9KX1fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKXt2YXIgdCxpLG4scixvLHMsYSxkO3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3QgbD10aGlzLl9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCksYz0obnVsbD09PShpPW51bGw9PT0odD1lLnNoaXBwaW5nQWRkcmVzcyl8fHZvaWQgMD09PXQ/dm9pZCAwOnQubmFtZSl8fHZvaWQgMD09PWk/dm9pZCAwOmkuc3BsaXQoXCIgXCIpWzBdKXx8KG51bGw9PT0ocj1udWxsPT09KG49ZS5iaWxsaW5nRGV0YWlscyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ubmFtZSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuc3BsaXQoXCIgXCIpWzBdKXx8XCJcIix1PShudWxsPT09KHM9bnVsbD09PShvPWUuc2hpcHBpbmdBZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5uYW1lKXx8dm9pZCAwPT09cz92b2lkIDA6cy5zcGxpdChcIiBcIilbMV0pfHwobnVsbD09PShkPW51bGw9PT0oYT1lLmJpbGxpbmdEZXRhaWxzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5uYW1lKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5zcGxpdChcIiBcIilbMV0pfHxcIlwiO2lmKGwpe2NvbnN0IHQ9dGhpcy5fbWFwU2hpcHBpbmdBZGRyZXNzKGUuc2hpcHBpbmdBZGRyZXNzLGUuYmlsbGluZ0RldGFpbHMsYyx1KTt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlU2hpcHBpbmdBZGRyZXNzKHQpfWNvbnN0IGg9dGhpcy5fbWFwQmlsbGluZ0FkZHJlc3MoZS5zaGlwcGluZ0FkZHJlc3MsZS5iaWxsaW5nRGV0YWlscyxjLHUpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVCaWxsaW5nQWRkcmVzcyhoKX0pfV9tYXBTaGlwcGluZ0FkZHJlc3MoZSx0LGksbil7dmFyIHIsbyxzLGEsZCxsLGM7cmV0dXJue2ZpcnN0TmFtZTppLGxhc3ROYW1lOm4scGhvbmU6KG51bGw9PXQ/dm9pZCAwOnQucGhvbmUpfHxcIlwiLGNvbXBhbnk6XCJcIixhZGRyZXNzMToobnVsbD09PShyPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PXI/dm9pZCAwOnIubGluZTEpfHxcIlwiLGFkZHJlc3MyOihudWxsPT09KG89bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5saW5lMil8fFwiXCIsY2l0eToobnVsbD09PShzPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PXM/dm9pZCAwOnMuY2l0eSl8fFwiXCIsY291bnRyeUNvZGU6KG51bGw9PT0oYT1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLmNvdW50cnkpfHxcIlwiLHBvc3RhbENvZGU6KG51bGw9PT0oZD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnBvc3RhbF9jb2RlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2U6KG51bGw9PT0obD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1sP3ZvaWQgMDpsLnN0YXRlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2VDb2RlOihudWxsPT09KGM9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09Yz92b2lkIDA6Yy5zdGF0ZSl8fFwiXCIsY3VzdG9tRmllbGRzOltdfX1fbWFwQmlsbGluZ0FkZHJlc3MoZSx0LGksbil7dmFyIHIsbyxzLGEsZCxsO3JldHVybntlbWFpbDoobnVsbD09dD92b2lkIDA6dC5lbWFpbCl8fFwiXCIsZmlyc3ROYW1lOmksbGFzdE5hbWU6bixwaG9uZToobnVsbD09dD92b2lkIDA6dC5waG9uZSl8fFwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOihudWxsPT09KHI9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09cj92b2lkIDA6ci5saW5lMSl8fFwiXCIsYWRkcmVzczI6XCJcIixjaXR5OihudWxsPT09KG89bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09PShzPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PXM/dm9pZCAwOnMuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09PShhPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PWE/dm9pZCAwOmEucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09PShkPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PWQ/dm9pZCAwOmQuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PT0obD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1sP3ZvaWQgMDpsLnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119fV9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIVMoZSl8fCF0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pc0FkZGl0aW9uYWxBY3Rpb25FcnJvcihlLmJvZHkuZXJyb3JzKSl0aHJvdyBlO2lmKCF0aGlzLl9zdHJpcGVDbGllbnR8fCF0aGlzLl9zdHJpcGVFbGVtZW50cyl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7ZGF0YTppfT1lLmJvZHkuYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWQse3Rva2VuOm59PWkse3BheW1lbnRJbnRlbnQ6cn09eWllbGQgdGhpcy5fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGksdCksbz10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LChudWxsPT1yP3ZvaWQgMDpyLmlkKXx8bik7dHJ5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITApLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG8pLHlpZWxkIHRoaXMuX2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX1maW5hbGx5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITEpfX0pfV9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coZSx0KXt2YXIgaSxuLHI7cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHt0b2tlbjpvLHJlZGlyZWN0X3VybDpzfT1lLGE9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubWFwU3RyaXBlUGF5bWVudERhdGEodGhpcy5fc3RyaXBlRWxlbWVudHMscyk7bGV0IGQ7dHJ5e2NvbnN0IGU9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZCh0LHRoaXMuX3N0cmlwZUNsaWVudCkpP3lpZWxkIG51bGw9PT0ocj10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLnJldHJpZXZlUGF5bWVudEludGVudChvfHxcIlwiKTp5aWVsZCBudWxsPT09KGk9dGhpcy5fc3RyaXBlQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudCh7ZWxlbWVudHM6YS5lbGVtZW50cyxjbGllbnRTZWNyZXQ6byxyZWRpcmVjdDp6LklGX1JFUVVJUkVELGNvbmZpcm1QYXJhbXM6e3JldHVybl91cmw6bnVsbD09PShuPWEuY29uZmlybVBhcmFtcyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0dXJuX3VybH19KTtpZihkPW51bGw9PWU/dm9pZCAwOmUuZXJyb3IsZHx8IShudWxsPT1lP3ZvaWQgMDplLnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBWO3JldHVybiBlfWNhdGNoKGUpe3JldHVybiB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1N0cmlwZUVycm9yKGQpfX0pfV9jb21wbGV0ZUNoZWNrb3V0Rmxvdygpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuXCJmdW5jdGlvblwiPT10eXBlb2YgdGhpcy5fb25Db21wbGV0ZT90aGlzLl9vbkNvbXBsZXRlKCk6KHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKFwiL29yZGVyLWNvbmZpcm1hdGlvblwiKSxQcm9taXNlLnJlc29sdmUoKSl9KX1fZ2V0UGF5bWVudFBheWxvYWQoZSx0KXt2YXIgaTtjb25zdCBuPShudWxsPT09KGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09aT92b2lkIDA6aS5pZCl8fFwiXCI7cmV0dXJue21ldGhvZElkOmUscGF5bWVudERhdGE6e2Zvcm1hdHRlZFBheWxvYWQ6T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHtjYXJ0X2lkOm59LHQ/e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjp0fX06e30pLHtjb25maXJtOiExLHBheW1lbnRfbWV0aG9kX2lkOlIuTGlua30pfX19X3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKXtjb25zdHtnZXRDYXJ0T3JUaHJvdzplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7bGluZUl0ZW1zOnR9PWUoKTtyZXR1cm4hIXQucGh5c2ljYWxJdGVtcy5sZW5ndGh9X3VwZGF0ZURpc3BsYXllZFByaWNlKCl7cmV0dXJuIHBlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt0aGlzLl9zdHJpcGVFbGVtZW50cyYmdGhpcy5fc3RyaXBlRWxlbWVudHMudXBkYXRlKHtjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpLG1vZGU6XCJwYXltZW50XCIsYW1vdW50OnlpZWxkIHRoaXMuX2dldFRvdGFsUHJpY2UoKX0pfSl9X2dldEN1cnJlbmN5KCl7aWYoIXRoaXMuX2N1cnJlbmN5Q29kZSl7Y29uc3R7Y29kZTplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0T3JUaHJvdygpLmN1cnJlbmN5O3RoaXMuX2N1cnJlbmN5Q29kZT1lLnRvTG93ZXJDYXNlKCl9cmV0dXJuIHRoaXMuX2N1cnJlbmN5Q29kZX1fZ2V0VG90YWxQcmljZSgpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRDaGVja291dCgpO2NvbnN0e2dldENoZWNrb3V0T3JUaHJvdzplLGdldENhcnRPclRocm93OnR9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtkZWNpbWFsUGxhY2VzOml9PXQoKS5jdXJyZW5jeSxuPXIoZSgpLm91dHN0YW5kaW5nQmFsYW5jZSxpKS50b0ZpeGVkKGkpO3JldHVybiB0aGlzLl90b0NlbnRzKCtuKX0pfV9nZXRBdmFpbGFibGVDb3VudHJpZXMoKXt2YXIgZTtyZXR1cm4gcGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHQ9eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRTaGlwcGluZ0NvdW50cmllcygpO3JldHVybigobnVsbD09PShlPXQuZ2V0U2hpcHBpbmdDb3VudHJpZXMoKSl8fHZvaWQgMD09PWU/dm9pZCAwOmUubWFwKGU9PmUuY29kZSkpfHxbXSkuZmlsdGVyKGU9PmhlLmluY2x1ZGVzKGUpKX0pfV9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKXt2YXIgZSx0O3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3QgaT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDb25zaWdubWVudHMoKTtpZighKG51bGw9PWk/dm9pZCAwOmlbMF0pKXJldHVybjtjb25zdCBuPWlbMF0scj0obi5hdmFpbGFibGVTaGlwcGluZ09wdGlvbnN8fFtdKS5tYXAodGhpcy5fZ2V0U3RyaXBlU2hpcHBpbmdPcHRpb24uYmluZCh0aGlzKSksbz1udWxsPT09KGU9bi5zZWxlY3RlZFNoaXBwaW5nT3B0aW9uKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5pZDtyZXR1cm4gbz9yLnNvcnQoZT0+ZS5pZD09PW8/LTE6MCk6eWllbGQgdGhpcy5faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UobnVsbD09PSh0PXJbMF0pfHx2b2lkIDA9PT10P3ZvaWQgMDp0LmlkKSxyfSl9X2dldFN0cmlwZVNoaXBwaW5nT3B0aW9uKHtpZDplLGNvc3Q6dCxkZXNjcmlwdGlvbjppfSl7cmV0dXJue2lkOmUsZGlzcGxheU5hbWU6aSxhbW91bnQ6dGhpcy5fdG9DZW50cyh0KX19X2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKGUpe3JldHVybiBwZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoZSYmXCJzaGlwcGluZ19vcHRpb25fdW5zZWxlY3RlZFwiIT09ZSlyZXR1cm4gdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnNlbGVjdFNoaXBwaW5nT3B0aW9uKGUpfSl9X2dldEFtb3VudFRyYW5zZm9ybWVyKCl7aWYodGhpcy5fYW1vdW50VHJhbnNmb3JtZXIpcmV0dXJuIHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyO2NvbnN0e2dldENhcnQ6ZX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2N1cnJlbmN5OnR9PWUoKXx8e307cmV0dXJuIHQ/bmV3IHVlKHQuZGVjaW1hbFBsYWNlcyk6dm9pZCAwfV90b0NlbnRzKGUpe2NvbnN0IHQ9TWF0aC5yb3VuZCgxMDAqZSksaT10aGlzLl9nZXRBbW91bnRUcmFuc2Zvcm1lcigpO3JldHVybiBpP2kudG9JbnRlZ2VyKGUpOnR9X3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoZSl7ZSYmdGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcj90aGlzLmxvYWRpbmdJbmRpY2F0b3Iuc2hvdyh0aGlzLl9sb2FkaW5nSW5kaWNhdG9yQ29udGFpbmVyKTp0aGlzLmxvYWRpbmdJbmRpY2F0b3IuaGlkZSgpfX1jb25zdCB5ZT1sKHQ9Pntjb25zdCBpPW5ldyBGKGUoKSksbj1uZXcgY2Uoe2NvbnRhaW5lclN0eWxlczpkZX0pO3JldHVybiBuZXcgbWUodCxpLG5ldyBIKHQsaSksbil9LFt7aWQ6XCJzdHJpcGVvY3NcIn1dKTt2YXIgZ2U9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgdmV7Y29uc3RydWN0b3IoZSx0LGksbil7dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlPWUsdGhpcy5zY3JpcHRMb2FkZXI9dCx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZT1pLHRoaXMubG9hZGluZ0luZGljYXRvcj1ufWluaXRpYWxpemUoZSl7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGVvY3M6dCxjb250YWluZXJJZDppfT1lfHx7fTtpZighdHx8IWkpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e21ldGhvZElkOm4sZ2F0ZXdheUlkOnJ9PXQ7aWYoIW58fCFyKXRocm93IG5ldyB5KHMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2NvbnN0IG89eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRQYXltZW50TWV0aG9kKHIse3BhcmFtczp7bWV0aG9kOm59fSksZD1vLmdldFBheW1lbnRNZXRob2RPclRocm93KG4scikse2xvYWRpbmdDb250YWluZXJJZDpsLGJ1dHRvbkhlaWdodDpjLG9uQ29tcGxldGU6dX09dDtpZih0aGlzLl9sb2FkaW5nSW5kaWNhdG9yQ29udGFpbmVyPWwsdGhpcy5fb25Db21wbGV0ZT11LCFZKGQpKXRocm93IG5ldyB5KHMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2NvbnN0e2luaXRpYWxpemF0aW9uRGF0YTpofT1kLHtjYXB0dXJlTWV0aG9kOnB9PWg7cmV0dXJuIHRoaXMuX2NhcHR1cmVNZXRob2Q9cCx0aGlzLl9zdHJpcGVDbGllbnQ9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGgsby5nZXRDYXJ0TG9jYWxlKCkpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkRGVmYXVsdENoZWNrb3V0KCkseWllbGQgdGhpcy5fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KG4saSx0aGlzLl9zdHJpcGVDbGllbnQsYyksUHJvbWlzZS5yZXNvbHZlKCl9KX1zaWduSW4oKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9c2lnbk91dCgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1leGVjdXRlUGF5bWVudE1ldGhvZENoZWNrb3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWRlaW5pdGlhbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGUsdCxpLG49NDApe3JldHVybiBnZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgcj10aGlzLl9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCksbz1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7c2hpcHBpbmdBZGRyZXNzUmVxdWlyZWQ6cn0scj97YWxsb3dlZFNoaXBwaW5nQ291bnRyaWVzOnlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZUNvdW50cmllcygpfTp7fSkscj97c2hpcHBpbmdSYXRlczpbe2lkOlwiX1wiLGFtb3VudDowLGRpc3BsYXlOYW1lOlwiUGVuZGluZyByYXRlc1wifV19Ont9KSx7YmlsbGluZ0FkZHJlc3NSZXF1aXJlZDohMCxlbWFpbFJlcXVpcmVkOiEwLHBob25lTnVtYmVyUmVxdWlyZWQ6ITAscGF5bWVudE1ldGhvZHM6e2xpbms6ei5BVVRPLGFwcGxlUGF5OnouTkVWRVIsZ29vZ2xlUGF5OnouTkVWRVIsYW1hem9uUGF5OnouTkVWRVIscGF5cGFsOnouTkVWRVIsa2xhcm5hOnouTkVWRVJ9LGJ1dHRvbkhlaWdodDpufSkse2NhcnRBbW91bnQ6cz0xfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCl8fHt9LGE9T2JqZWN0LmFzc2lnbih7bW9kZTpcInBheW1lbnRcIixhbW91bnQ6dGhpcy5fdG9DZW50cyhzKSxjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpfSx0aGlzLl9jYXB0dXJlTWV0aG9kP3tjYXB0dXJlTWV0aG9kOnRoaXMuX2NhcHR1cmVNZXRob2R9Ont9KTt0aGlzLl9zdHJpcGVFbGVtZW50cz1pLmVsZW1lbnRzKGEpLHRoaXMuX2xpbmtWMkVsZW1lbnQ9dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKEwuRVhQUkVTU19DSEVDS09VVCxvKSx0aGlzLl9saW5rVjJFbGVtZW50Lm1vdW50KGAjJHt0fWApLHRoaXMuX2luaXRpYWxpemVFdmVudHModGhpcy5fbGlua1YyRWxlbWVudCxlKX0pfV9pbml0aWFsaXplRXZlbnRzKGUsdCl7dGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpJiYoZS5vbih4LlNISVBQSU5HX0FERFJFU1NfQ0hBTkdFLGU9PmdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25TaGlwcGluZ0FkZHJlc3NDaGFuZ2UoZSl9KSksZS5vbih4LlNISVBQSU5HX1JBVEVfQ0hBTkdFLGU9PmdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25TaGlwcGluZ1JhdGVDaGFuZ2UoZSl9KSkpLGUub24oeC5DT05GSVJNLGU9PmdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25Db25maXJtKGUsdCl9KSksZS5vbih4LkNBTkNFTCx0aGlzLl9vbkNhbmNlbCl9X29uU2hpcHBpbmdBZGRyZXNzQ2hhbmdlKGUpe3JldHVybiBnZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoXCJhZGRyZXNzXCJpbiBlKXtjb25zdCB0PWUuYWRkcmVzcyxpPXtmaXJzdE5hbWU6XCJcIixsYXN0TmFtZTpcIlwiLHBob25lOlwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOlwiXCIsYWRkcmVzczI6XCJcIixjaXR5OihudWxsPT10P3ZvaWQgMDp0LmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT10P3ZvaWQgMDp0LmNvdW50cnkpfHxcIlwiLHBvc3RhbENvZGU6KG51bGw9PXQ/dm9pZCAwOnQucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09dD92b2lkIDA6dC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZTpcIlwiLGN1c3RvbUZpZWxkczpbXX07eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVNoaXBwaW5nQWRkcmVzcyhpKTtjb25zdCBuPXlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZVNoaXBwaW5nT3B0aW9ucygpO3lpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksZS5yZXNvbHZlKHtzaGlwcGluZ1JhdGVzOm59KX19KX1fb25DYW5jZWwoKXt0aHJvdyBuZXcgX31fb25TaGlwcGluZ1JhdGVDaGFuZ2UoZSl7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcInNoaXBwaW5nUmF0ZVwiaW4gZSl7Y29uc3R7c2hpcHBpbmdSYXRlOnR9PWU7eWllbGQgdGhpcy5faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UobnVsbD09dD92b2lkIDA6dC5pZCkseWllbGQgdGhpcy5fdXBkYXRlRGlzcGxheWVkUHJpY2UoKSxlLnJlc29sdmUoe30pfX0pfV9vbkNvbmZpcm0oZSx0KXtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKFwiYmlsbGluZ0RldGFpbHNcImluIGUmJlwic2hpcHBpbmdBZGRyZXNzXCJpbiBlJiZ0aGlzLl9zdHJpcGVDbGllbnQmJnRoaXMuX3N0cmlwZUVsZW1lbnRzKXt5aWVsZCB0aGlzLl91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcigpO2NvbnN0IGk9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCk7dHJ5e3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KGkpfWNhdGNoKGUpe3lpZWxkIHRoaXMuX3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl9fXJldHVybiBQcm9taXNlLnJlc29sdmUoKX0pfV91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpe3ZhciB0LGksbixyLG8scyxhLGQ7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBsPXRoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSxjPShudWxsPT09KGk9bnVsbD09PSh0PWUuc2hpcHBpbmdBZGRyZXNzKXx8dm9pZCAwPT09dD92b2lkIDA6dC5uYW1lKXx8dm9pZCAwPT09aT92b2lkIDA6aS5zcGxpdChcIiBcIilbMF0pfHwobnVsbD09PShyPW51bGw9PT0obj1lLmJpbGxpbmdEZXRhaWxzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5uYW1lKXx8dm9pZCAwPT09cj92b2lkIDA6ci5zcGxpdChcIiBcIilbMF0pfHxcIlwiLHU9KG51bGw9PT0ocz1udWxsPT09KG89ZS5zaGlwcGluZ0FkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLm5hbWUpfHx2b2lkIDA9PT1zP3ZvaWQgMDpzLnNwbGl0KFwiIFwiKVsxXSl8fChudWxsPT09KGQ9bnVsbD09PShhPWUuYmlsbGluZ0RldGFpbHMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLm5hbWUpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnNwbGl0KFwiIFwiKVsxXSl8fFwiXCI7aWYobCl7Y29uc3QgdD10aGlzLl9tYXBTaGlwcGluZ0FkZHJlc3MoZS5zaGlwcGluZ0FkZHJlc3MsZS5iaWxsaW5nRGV0YWlscyxjLHUpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVTaGlwcGluZ0FkZHJlc3ModCl9Y29uc3QgaD10aGlzLl9tYXBCaWxsaW5nQWRkcmVzcyhlLnNoaXBwaW5nQWRkcmVzcyxlLmJpbGxpbmdEZXRhaWxzLGMsdSk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZUJpbGxpbmdBZGRyZXNzKGgpfSl9X21hcFNoaXBwaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGwsYztyZXR1cm57Zmlyc3ROYW1lOmksbGFzdE5hbWU6bixwaG9uZToobnVsbD09dD92b2lkIDA6dC5waG9uZSl8fFwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOihudWxsPT09KHI9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cj92b2lkIDA6ci5saW5lMSl8fFwiXCIsYWRkcmVzczI6KG51bGw9PT0obz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmxpbmUyKXx8XCJcIixjaXR5OihudWxsPT09KHM9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09PShhPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWE/dm9pZCAwOmEuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09PShkPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWQ/dm9pZCAwOmQucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PT0oYz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1jP3ZvaWQgMDpjLnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119fV9tYXBCaWxsaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGw7cmV0dXJue2VtYWlsOihudWxsPT10P3ZvaWQgMDp0LmVtYWlsKXx8XCJcIixmaXJzdE5hbWU6aSxsYXN0TmFtZTpuLHBob25lOihudWxsPT10P3ZvaWQgMDp0LnBob25lKXx8XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6KG51bGw9PT0ocj1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmxpbmUxKXx8XCJcIixhZGRyZXNzMjpcIlwiLGNpdHk6KG51bGw9PT0obz1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT09KHM9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT09KGE9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT09KGQ9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLGN1c3RvbUZpZWxkczpbXX19X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighUyhlKXx8IXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUuYm9keS5lcnJvcnMpKXRocm93IGU7aWYoIXRoaXMuX3N0cmlwZUNsaWVudHx8IXRoaXMuX3N0cmlwZUVsZW1lbnRzKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdHtkYXRhOml9PWUuYm9keS5hZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZCx7dG9rZW46bn09aSx7cGF5bWVudEludGVudDpyfT15aWVsZCB0aGlzLl9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coaSx0KSxvPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQsKG51bGw9PXI/dm9pZCAwOnIuaWQpfHxuKTt0cnl7dGhpcy5fdG9nZ2xlTG9hZGluZ0luZGljYXRvcighMCkseWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobykseWllbGQgdGhpcy5fY29tcGxldGVDaGVja291dEZsb3coKX1jYXRjaChlKXt0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1BheW1lbnRDb25maXJtYXRpb25Qcm9jZWVkTWVzc2FnZSgpfWZpbmFsbHl7dGhpcy5fdG9nZ2xlTG9hZGluZ0luZGljYXRvcighMSl9fSl9X2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyhlLHQpe3ZhciBpLG4scjtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOm8scmVkaXJlY3RfdXJsOnN9PWUsYT10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLl9zdHJpcGVFbGVtZW50cyxzKTtsZXQgZDt0cnl7Y29uc3QgZT0oeWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNQYXltZW50Q29tcGxldGVkKHQsdGhpcy5fc3RyaXBlQ2xpZW50KSk/eWllbGQgbnVsbD09PShyPXRoaXMuX3N0cmlwZUNsaWVudCl8fHZvaWQgMD09PXI/dm9pZCAwOnIucmV0cmlldmVQYXltZW50SW50ZW50KG98fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNvbmZpcm1QYXltZW50KHtlbGVtZW50czphLmVsZW1lbnRzLGNsaWVudFNlY3JldDpvLHJlZGlyZWN0OnouSUZfUkVRVUlSRUQsY29uZmlybVBhcmFtczp7cmV0dXJuX3VybDpudWxsPT09KG49YS5jb25maXJtUGFyYW1zKXx8dm9pZCAwPT09bj92b2lkIDA6bi5yZXR1cm5fdXJsfX0pO2lmKGQ9bnVsbD09ZT92b2lkIDA6ZS5lcnJvcixkfHwhKG51bGw9PWU/dm9pZCAwOmUucGF5bWVudEludGVudCkpdGhyb3cgbmV3IFY7cmV0dXJuIGV9Y2F0Y2goZSl7cmV0dXJuIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3IoZCl9fSl9X2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm5cImZ1bmN0aW9uXCI9PXR5cGVvZiB0aGlzLl9vbkNvbXBsZXRlP3RoaXMuX29uQ29tcGxldGUoKTood2luZG93LmxvY2F0aW9uLnJlcGxhY2UoXCIvY2hlY2tvdXQvb3JkZXItY29uZmlybWF0aW9uXCIpLFByb21pc2UucmVzb2x2ZSgpKX0pfV9nZXRQYXltZW50UGF5bG9hZChlLHQpe3ZhciBpO2NvbnN0IG49KG51bGw9PT0oaT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCkpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmlkKXx8XCJcIjtyZXR1cm57bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTp7Zm9ybWF0dGVkUGF5bG9hZDpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe2NhcnRfaWQ6bn0sdD97Y3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOnR9fTp7fSkse2NvbmZpcm06ITEscGF5bWVudF9tZXRob2RfaWQ6Ui5MaW5rfSl9fX1fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpe2NvbnN0e2dldENhcnQ6ZX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2xpbmVJdGVtczp0fT1lKCl8fHt9O3JldHVybiEhKG51bGw9PXQ/dm9pZCAwOnQucGh5c2ljYWxJdGVtcy5sZW5ndGgpfV91cGRhdGVEaXNwbGF5ZWRQcmljZSgpe3JldHVybiBnZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7dGhpcy5fc3RyaXBlRWxlbWVudHMmJnRoaXMuX3N0cmlwZUVsZW1lbnRzLnVwZGF0ZSh7Y3VycmVuY3k6dGhpcy5fZ2V0Q3VycmVuY3koKSxtb2RlOlwicGF5bWVudFwiLGFtb3VudDp5aWVsZCB0aGlzLl9nZXRUb3RhbFByaWNlKCl9KX0pfV9nZXRDdXJyZW5jeSgpe3ZhciBlO2lmKCF0aGlzLl9jdXJyZW5jeUNvZGUpe2NvbnN0IHQ9bnVsbD09PShlPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnQoKSl8fHZvaWQgMD09PWU/dm9pZCAwOmUuY3VycmVuY3k7dCYmKHRoaXMuX2N1cnJlbmN5Q29kZT10LmNvZGUudG9Mb3dlckNhc2UoKSl9cmV0dXJuIHRoaXMuX2N1cnJlbmN5Q29kZX1fZ2V0VG90YWxQcmljZSgpe3ZhciBlO3JldHVybiBnZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRDaGVja291dCgpO2NvbnN0e2dldENoZWNrb3V0T3JUaHJvdzp0LGdldENhcnQ6aX09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkse2RlY2ltYWxQbGFjZXM6bn09KG51bGw9PT0oZT1pKCkpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLmN1cnJlbmN5KXx8e30sbz1yKHQoKS5vdXRzdGFuZGluZ0JhbGFuY2UsbikudG9GaXhlZChuKTtyZXR1cm4gdGhpcy5fdG9DZW50cygrbyl9KX1fZ2V0QXZhaWxhYmxlQ291bnRyaWVzKCl7dmFyIGU7cmV0dXJuIGdlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkU2hpcHBpbmdDb3VudHJpZXMoKTtyZXR1cm4oKG51bGw9PT0oZT10LmdldFNoaXBwaW5nQ291bnRyaWVzKCkpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLm1hcChlPT5lLmNvZGUpKXx8W10pLmZpbHRlcihlPT5oZS5pbmNsdWRlcyhlKSl9KX1fZ2V0QXZhaWxhYmxlU2hpcHBpbmdPcHRpb25zKCl7dmFyIGUsdDtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q29uc2lnbm1lbnRzKCk7aWYoIShudWxsPT1pP3ZvaWQgMDppWzBdKSlyZXR1cm47Y29uc3Qgbj1pWzBdLHI9KG4uYXZhaWxhYmxlU2hpcHBpbmdPcHRpb25zfHxbXSkubWFwKHRoaXMuX2dldFN0cmlwZVNoaXBwaW5nT3B0aW9uLmJpbmQodGhpcykpLG89bnVsbD09PShlPW4uc2VsZWN0ZWRTaGlwcGluZ09wdGlvbil8fHZvaWQgMD09PWU/dm9pZCAwOmUuaWQ7cmV0dXJuIG8/ci5zb3J0KGU9PmUuaWQ9PT1vPy0xOjApOnlpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PT0odD1yWzBdKXx8dm9pZCAwPT09dD92b2lkIDA6dC5pZCkscn0pfV9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbih7aWQ6ZSxjb3N0OnQsZGVzY3JpcHRpb246aX0pe3JldHVybntpZDplLGRpc3BsYXlOYW1lOmksYW1vdW50OnRoaXMuX3RvQ2VudHModCl9fV9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShlKXtyZXR1cm4gZ2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKGUmJlwic2hpcHBpbmdfb3B0aW9uX3Vuc2VsZWN0ZWRcIiE9PWUpcmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zZWxlY3RTaGlwcGluZ09wdGlvbihlKX0pfV9nZXRBbW91bnRUcmFuc2Zvcm1lcigpe2lmKHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyKXJldHVybiB0aGlzLl9hbW91bnRUcmFuc2Zvcm1lcjtjb25zdHtnZXRDYXJ0OmV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjdXJyZW5jeTp0fT1lKCl8fHt9O3JldHVybiB0P25ldyB1ZSh0LmRlY2ltYWxQbGFjZXMpOnZvaWQgMH1fdG9DZW50cyhlKXtjb25zdCB0PU1hdGgucm91bmQoMTAwKmUpLGk9dGhpcy5fZ2V0QW1vdW50VHJhbnNmb3JtZXIoKTtyZXR1cm4gaT9pLnRvSW50ZWdlcihlKTp0fV90b2dnbGVMb2FkaW5nSW5kaWNhdG9yKGUpe2UmJnRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI/dGhpcy5sb2FkaW5nSW5kaWNhdG9yLnNob3codGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcik6dGhpcy5sb2FkaW5nSW5kaWNhdG9yLmhpZGUoKX19Y29uc3QgU2U9bCh0PT57Y29uc3QgaT1uZXcgRihlKCkpLG49bmV3IGNlKHtjb250YWluZXJTdHlsZXM6ZGV9KTtyZXR1cm4gbmV3IHZlKHQsaSxuZXcgSCh0LGkpLG4pfSxbe2lkOlwic3RyaXBlb2NzXCJ9XSk7ZXhwb3J0e1NlIGFzIGNyZWF0ZUxpbmtWMkJ1dHRvblN0cmF0ZWd5LHllIGFzIGNyZWF0ZVN0cmlwZUxpbmtWMkN1c3RvbWVyU3RyYXRlZ3kscmUgYXMgY3JlYXRlU3RyaXBlT0NTUGF5bWVudFN0cmF0ZWd5LHNlIGFzIGNyZWF0ZVN0cmlwZVVQRUN1c3RvbWVyU3RyYXRlZ3ksdGUgYXMgY3JlYXRlU3RyaXBlVVBFUGF5bWVudFN0cmF0ZWd5LE4gYXMgY3JlYXRlU3RyaXBlVjNQYXltZW50U3RyYXRlZ3l9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RyaXBlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../checkout-sdk-js/dist/esm/integrations/stripe.js\n\n}");

/***/ })

}]);