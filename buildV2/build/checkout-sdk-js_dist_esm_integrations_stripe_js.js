"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(self["webpackJsonpCheckout"] = self["webpackJsonpCheckout"] || []).push([["checkout-sdk-js_dist_esm_integrations_stripe_js"],{

/***/ "../checkout-sdk-js/dist/esm/integrations/stripe.js":
/*!**********************************************************!*\
  !*** ../checkout-sdk-js/dist/esm/integrations/stripe.js ***!
  \**********************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("{__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createLinkV2ButtonStrategy: () => (/* binding */ Pe),\n/* harmony export */   createStripeCSPaymentStrategy: () => (/* binding */ ce),\n/* harmony export */   createStripeLinkV2CustomerStrategy: () => (/* binding */ Ce),\n/* harmony export */   createStripeOCSPaymentStrategy: () => (/* binding */ ae),\n/* harmony export */   createStripeUPECustomerStrategy: () => (/* binding */ he),\n/* harmony export */   createStripeUPEPaymentStrategy: () => (/* binding */ ne),\n/* harmony export */   createStripeV3PaymentStrategy: () => (/* binding */ T)\n/* harmony export */ });\n/* harmony import */ var _bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @bigcommerce/script-loader */ \"../checkout-sdk-js/node_modules/@bigcommerce/script-loader/lib/index.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! lodash */ \"../checkout-sdk-js/node_modules/lodash/lodash.js\");\n/* harmony import */ var lodash__WEBPACK_IMPORTED_MODULE_1___default = /*#__PURE__*/__webpack_require__.n(lodash__WEBPACK_IMPORTED_MODULE_1__);\nvar s,a,d={};function l(e,t){return Object.assign(e,{resolveIds:t})}d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);class c extends Error{constructor(e){var t;super(e||\"An unexpected error has occurred.\"),this.name=\"StandardError\",this.type=\"standard\",t=new.target.prototype,Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,\"function\"==typeof Error.captureStackTrace?Error.captureStackTrace(this,new.target):this.stack=new Error(this.message).stack}}class u extends c{constructor(e){super(e||\"Invalid arguments have been provided.\"),this.name=\"InvalidArgumentError\",this.type=\"invalid_argument\"}}class h extends u{constructor(e){let t=\"Unable to submit payment for the order because the payload is invalid.\";e&&(t=`${t} Make sure the following fields are provided correctly: ${e.join(\", \")}.`),super(t),this.name=\"PaymentArgumentInvalidError\"}}function p(e){return!(\"object\"!=typeof e||null===e||void 0!==e.shouldSaveInstrument&&\"boolean\"!=typeof e.shouldSaveInstrument||void 0!==e.shouldSetAsDefaultInstrument&&\"boolean\"!=typeof e.shouldSetAsDefaultInstrument)}function m(e){return Boolean(e.instrumentId)}!function(e){e[e.MissingBillingAddress=0]=\"MissingBillingAddress\",e[e.MissingCart=1]=\"MissingCart\",e[e.MissingCheckout=2]=\"MissingCheckout\",e[e.MissingConsignments=3]=\"MissingConsignments\",e[e.MissingCustomer=4]=\"MissingCustomer\",e[e.MissingCheckoutConfig=5]=\"MissingCheckoutConfig\",e[e.MissingOrder=6]=\"MissingOrder\",e[e.MissingOrderConfig=7]=\"MissingOrderConfig\",e[e.MissingOrderId=8]=\"MissingOrderId\",e[e.MissingPayment=9]=\"MissingPayment\",e[e.MissingPaymentId=10]=\"MissingPaymentId\",e[e.MissingPaymentInstrument=11]=\"MissingPaymentInstrument\",e[e.MissingPaymentMethod=12]=\"MissingPaymentMethod\",e[e.MissingPaymentRedirectUrl=13]=\"MissingPaymentRedirectUrl\",e[e.MissingPaymentStatus=14]=\"MissingPaymentStatus\",e[e.MissingPaymentToken=15]=\"MissingPaymentToken\",e[e.MissingShippingAddress=16]=\"MissingShippingAddress\"}(s||(s={}));class y extends c{constructor(e){super(function(e){switch(e){case s.MissingBillingAddress:return\"Unable to proceed because billing address data is unavailable.\";case s.MissingCart:return\"Unable to proceed because cart data is unavailable.\";case s.MissingConsignments:return\"Unable to proceed because consignments data is unavailable.\";case s.MissingCheckout:return\"Unable to proceed because checkout data is unavailable.\";case s.MissingCustomer:return\"Unable to proceed because customer data is unavailable.\";case s.MissingCheckoutConfig:case s.MissingOrderConfig:return\"Unable to proceed because configuration data is unavailable.\";case s.MissingOrder:return\"Unable to proceed because order data is unavailable.\";case s.MissingOrderId:return\"Unable to proceed because order ID is unavailable or not generated yet.\";case s.MissingPayment:return\"Unable to proceed because payment data is unavailable.\";case s.MissingPaymentToken:return\"Unable to proceed because the token required to submit a payment is missing.\";case s.MissingPaymentMethod:return\"Unable to proceed because payment method data is unavailable or not properly configured.\";case s.MissingShippingAddress:return\"Unable to proceed because shipping address data is unavailable.\";default:return\"Unable to proceed because the required data is unavailable.\"}}(e)),this.subtype=e,this.name=\"MissingDataError\",this.type=\"missing_data\"}}class g extends c{constructor(){super(\"The current order does not need to be finalized at this stage.\"),this.name=\"OrderFinalizationNotRequiredError\",this.type=\"order_finalization_not_required\"}}!function(e){e[e.CheckoutButtonNotInitialized=0]=\"CheckoutButtonNotInitialized\",e[e.CustomerNotInitialized=1]=\"CustomerNotInitialized\",e[e.PaymentNotInitialized=2]=\"PaymentNotInitialized\",e[e.ShippingNotInitialized=3]=\"ShippingNotInitialized\",e[e.SpamProtectionNotInitialized=4]=\"SpamProtectionNotInitialized\"}(a||(a={}));class v extends c{constructor(e){super(function(e){switch(e){case a.CustomerNotInitialized:return\"Unable to proceed because the customer step of checkout has not been initialized.\";case a.PaymentNotInitialized:return\"Unable to proceed because the payment step of checkout has not been initialized.\";case a.ShippingNotInitialized:return\"Unable to proceed because the shipping step of checkout has not been initialized.\";case a.SpamProtectionNotInitialized:return\"Unable to proceed because the checkout spam protection has not been initialized.\";default:return\"Unable to proceed because the required component has not been initialized.\"}}(e)),this.subtype=e,this.name=\"NotInitializedError\",this.type=\"not_initialized\"}}const S=e=>\"object\"==typeof e&&null!==e&&\"body\"in e;class _ extends c{constructor(e){super(e||\"Payment process was cancelled.\"),this.name=\"PaymentMethodCancelledError\",this.type=\"payment_cancelled\"}}function f(e){return null!==e&&\"object\"==typeof e&&\"cardNumberElementOptions\"in e&&\"cardCvcElementOptions\"in e&&\"cardExpiryElementOptions\"in e&&void 0!==e.cardNumberElementOptions&&void 0!==e.cardCvcElementOptions&&void 0!==e.cardExpiryElementOptions}var C,E,I,P;!function(e){e.Solid=\"solid\",e.Default=\"default\"}(C||(C={})),function(e){e.Alipay=\"alipay\",e.CardCvc=\"cardCvc\",e.CardExpiry=\"cardExpiry\",e.CardNumber=\"cardNumber\",e.CreditCard=\"card\",e.IDEAL=\"idealBank\",e.Sepa=\"iban\"}(E||(E={})),function(e){e.Alipay=\"alipay\",e.CreditCard=\"card\",e.IDEAL=\"ideal\",e.Sepa=\"sepa_debit\"}(I||(I={})),function(e){e.AuthFailure=\"auth_failure\"}(P||(P={}));class b extends c{constructor(e){super(e===P.AuthFailure?\"User did not authenticate\":\"There was an error while processing your payment. Please try again or contact us.\"),this.type=\"stripev3_error\",this.subtype=e}}var w=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};const A=[E.Alipay,E.IDEAL];class O{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){return w(this,void 0,void 0,function*(){const{stripev3:t,methodId:i,gatewayId:n}=e;if(!n)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');this.initializeOptions=t,this.isDeinitialize=!1;const r=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i),{initializationData:{stripePublishableKey:o,stripeConnectedAccount:s,useIndividualCardFields:a,allowRedisplayForStoredInstruments:d}}=r;this._allowRedisplayForStoredInstruments=d;const l=this.getInitializeOptions().form;this.useIndividualCardFields=a,this.stripeV3Client=yield this.loadStripeJs(o,s),this.isCreditCard(i)&&this.shouldShowTSVHostedForm(i,n)&&l?this.hostedForm=yield this.mountCardVerificationFields(l):this.stripeElement=yield this.mountCardFields(i)})}execute(e,i){var n,r;return w(this,void 0,void 0,function*(){const{payment:o}=e,a=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);let d,l;if(!o||!o.paymentData)throw new h([\"payment.paymentData\"]);const{paymentData:c,gatewayId:u,methodId:g}=o,{shouldSaveInstrument:v,shouldSetAsDefaultInstrument:S}=p(c)?c:{shouldSaveInstrument:!1,shouldSetAsDefaultInstrument:!1},_=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)(A,g),{isStoreCreditApplied:f}=this.paymentIntegrationService.getState().getCheckoutOrThrow();f&&(yield this.paymentIntegrationService.applyStoreCredit(f));try{_&&(yield this.paymentIntegrationService.submitOrder(a,i)),u&&(yield this.paymentIntegrationService.loadPaymentMethod(u,{params:{method:g}}));const e=this.paymentIntegrationService.getState();if(m(c)){yield this.paymentIntegrationService.submitOrder(a,i);const{instrumentId:t}=c,n=e.getPaymentMethodOrThrow(o.methodId).clientToken;if(!n)throw new y(s.MissingPaymentMethod);return yield this.executeWithVaulted(o,t,S,n)}const t=e.getPaymentMethodOrThrow(g),h=yield this.confirmStripePayment(t),{clientToken:p,method:f}=t,{id:C}=null!==(r=null!==(n=h.paymentIntent)&&void 0!==n?n:h.paymentMethod)&&void 0!==r?r:{id:\"\"};l=h.error,d={credit_card_token:{token:C},vault_payment_instrument:v,confirm:!1,set_as_default_stored_instrument:S},f===E.CreditCard&&(d.client_token=p),_||(yield this.paymentIntegrationService.submitOrder(a,i));const I=this.buildPaymentPayload(g,d,S);yield this.paymentIntegrationService.submitPayment(I)}catch(e){yield this.processAdditionalAction(this.handleEmptyPaymentIntentError(e,l),g,v,S)}})}finalize(){return Promise.reject(new g)}deinitialize(){return this.hostedForm&&this.hostedForm.detach(),this.isDeinitialize=!0,this.unmountElement(),Promise.resolve()}buildPaymentPayload(e,t,i){return{methodId:e,paymentData:i?{formattedPayload:Object.assign(Object.assign({},t),{set_as_default_stored_instrument:i})}:{formattedPayload:t}}}isCancellationError(e){var t,i;return e&&-1!==(null===(i=null===(t=e.payment_intent.last_payment_error)||void 0===t?void 0:t.message)||void 0===i?void 0:i.indexOf(\"canceled\"))}isAuthError(e){return\"payment_intent_authentication_failure\"===(null==e?void 0:e.code)}isCreditCard(e){return e===I.CreditCard}isHostedFieldAvailable(){var e;const t=this.getInitializeOptions(),r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.omitBy)(null===(e=t.form)||void 0===e?void 0:e.fields,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty);return!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.isEmpty)(r)}isHostedPaymentFormEnabled(e,t){const{getPaymentMethodOrThrow:i}=this.paymentIntegrationService.getState(),n=i(e,t);return Boolean(n.config.isHostedFormEnabled)}confirmStripePayment(e){return w(this,void 0,void 0,function*(){const{clientToken:t,method:i,returnUrl:n}=e;if(!t)throw new y(s.MissingPaymentMethod);switch(i){case E.Alipay:return this.getStripeJs().confirmAlipayPayment(t,{return_url:n},{handleActions:!1});case E.IDEAL:{const e=this.mapStripePaymentData(I.IDEAL,n);return this.getStripeJs().confirmIdealPayment(t,e,{handleActions:!1})}case E.Sepa:{const e=this.mapStripePaymentData(I.Sepa);return this.getStripeJs().confirmSepaDebitPayment(t,e)}default:{const e=this.useIndividualCardFields?this.getStripeCardElements()[0]:this.getStripeElement(),t=this.mapStripeBillingDetails(this.paymentIntegrationService.getState().getBillingAddress(),this.paymentIntegrationService.getState().getCustomer()),i=this._allowRedisplayForStoredInstruments;return this.getStripeJs().createPaymentMethod(Object.assign({type:I.CreditCard,card:e,billing_details:t},i?{allow_redisplay:\"always\"}:{}))}}})}executeWithVaulted(e,t,i,n){var r;return w(this,void 0,void 0,function*(){const o={bigpay_token:{token:t},confirm:!0,client_token:n,set_as_default_stored_instrument:i};if(this.isHostedPaymentFormEnabled(e.methodId,e.gatewayId)&&this.hostedForm){const t=this.hostedForm;return e.paymentData&&m(e.paymentData)&&(e.paymentData=Object.assign(Object.assign({},e.paymentData),{instrumentId:JSON.stringify({token:(null===(r=e.paymentData)||void 0===r?void 0:r.instrumentId)||\"\",client_token:n})})),yield t.validate(),yield t.submit(e),this.paymentIntegrationService.loadCurrentOrder()}const s=this.buildPaymentPayload(e.methodId,o,i);return this.paymentIntegrationService.submitPayment(s)})}getInitializeOptions(){if(!this.initializeOptions)throw new v(a.PaymentNotInitialized);return this.initializeOptions}getStripeCardElements(){if(!this.stripeCardElements)throw new v(a.PaymentNotInitialized);return this.stripeCardElements}getStripeElement(){if(!this.stripeElement)throw new v(a.PaymentNotInitialized);return this.stripeElement}getStripeJs(){if(!this.stripeV3Client)throw new v(a.PaymentNotInitialized);return this.stripeV3Client}handleEmptyPaymentIntentError(e,t){return S(e)&&(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"required_field\"})&&t?new Error(t.message):e}loadStripeJs(e,t){return w(this,void 0,void 0,function*(){return this.stripeV3Client?Promise.resolve(this.stripeV3Client):this.scriptLoader.load(e,t,this.paymentIntegrationService.getState().getLocale())})}mapStripeAddress(e){if(e){const{city:t,countryCode:i,address1:n,address2:r,postalCode:o,stateOrProvinceCode:s}=e;return{city:t,country:i,line1:n,line2:r,postal_code:o,state:s}}return{line1:\"\"}}mapStripeBillingDetails(e,t){const{firstName:i,lastName:n}=e||t||{firstName:\"Guest\",lastName:\"\"},r=`${i} ${n}`.trim(),{options:o}=this.getInitializeOptions();if(this.useIndividualCardFields&&f(o)){const{zipCodeElementOptions:t}=o;if(t){const i=document.getElementById(t.containerId)?document.getElementById(t.containerId).value:\"\";i&&e&&(e=Object.assign(Object.assign({},e),{postalCode:i}))}}const s={address:this.mapStripeAddress(e)};if(t&&t.addresses[0]&&function(e){return\"object\"==typeof e&&null!==e&&\"id\"in e&&void 0!==e.id}(t.addresses[0])){const e=t.addresses[0],{email:i}=t,{phone:n}=e;return n?Object.assign(Object.assign({},s),{email:i,name:r,phone:n}):Object.assign(Object.assign({},s),{email:i,name:r})}if(e){const{email:t,phone:i}=e;return i?Object.assign(Object.assign({},s),{email:t,name:r,phone:i}):Object.assign(Object.assign({},s),{email:t,name:r})}return Object.assign(Object.assign({},s),{name:r})}mapStripePaymentData(e,t){const i=this.paymentIntegrationService.getState().getCustomer(),n=this.paymentIntegrationService.getState().getBillingAddress(),r={payment_method:{[e]:this.getStripeElement(),billing_details:this.mapStripeBillingDetails(n,i)}};return e===I.IDEAL?Object.assign(Object.assign({},r),{return_url:t}):r}mountCardFields(e){const{options:t,containerId:i}=this.getInitializeOptions();let n;return new Promise((r,o)=>{switch(this.stripeElements||(this.stripeElements=this.getStripeJs().elements()),e){case E.CreditCard:if(this.useIndividualCardFields&&f(t)){const{cardNumberElementOptions:e,cardExpiryElementOptions:i,cardCvcElementOptions:r}=t,s=this.stripeElements.getElement(E.CardNumber)||this.stripeElements.create(E.CardNumber,e),a=this.stripeElements.getElement(E.CardExpiry)||this.stripeElements.create(E.CardExpiry,i),d=this.stripeElements.getElement(E.CardCvc)||this.stripeElements.create(E.CardCvc,r);this.stripeCardElements=[s,a,d],n=this.stripeCardElements[0];try{s.mount(`#${e.containerId}`),a.mount(`#${i.containerId}`),d.mount(`#${r.containerId}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}}else{n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}}break;case E.IDEAL:case E.Sepa:n=this.stripeElements.getElement(e)||this.stripeElements.create(e,t);try{n.mount(`#${i}`)}catch(e){this.isDeinitialize||o(new u(\"Unable to mount Stripe component without valid container ID.\"))}case E.Alipay:}r(n)})}mountCardVerificationFields(e){return w(this,void 0,void 0,function*(){const t=this.paymentIntegrationService.getState().getStoreConfig();if(!t)throw new y(s.MissingCheckoutConfig);const i=t.paymentSettings.bigpayBaseUrl,n=this.paymentIntegrationService.createHostedForm(i,e);return yield n.attach(),n})}processAdditionalAction(e,t,i=!1,n=!1){return w(this,void 0,void 0,function*(){if(!S(e))throw e;const r=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"additional_action_required\"}),s=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"});if(r){const t=e.body.additional_action_required;if(t&&\"redirect_to_url\"===t.type)return new Promise(()=>{t.data.redirect_url&&window.location.replace(t.data.redirect_url)})}if(s){const r=e.body.three_ds_result.token,o=!1;let s,a=!1;try{s=yield this.getStripeJs().confirmCardPayment(r)}catch(e){a=!0}if(null==s?void 0:s.error){if(this.isCancellationError(s.error))throw new _;if(this.isAuthError(s.error))throw new b(P.AuthFailure);throw new Error(s.error.message)}const d={credit_card_token:{token:this.getPaymentToken(null==s?void 0:s.paymentIntent,r,a)},vault_payment_instrument:i,confirm:o},l=this.buildPaymentPayload(t,d,n);try{return yield this.paymentIntegrationService.submitPayment(l)}catch(e){throw this.handleEmptyPaymentIntentError(e,null==s?void 0:s.error)}}throw e})}getPaymentToken(e,t,i){return!e||i?t:e.id}shouldShowTSVHostedForm(e,t){return this.isHostedFieldAvailable()&&this.isHostedPaymentFormEnabled(e,t)}unmountElement(){this.stripeElement&&(this.stripeElement.unmount(),this.stripeElement=void 0)}}class M extends c{constructor(e){super(e||\"Unable to proceed because the client library of a payment method is not loaded or ready to be used.\"),this.name=\"PaymentMethodClientUnavailableError\",this.type=\"payment_method_client_unavailable\"}}class k{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}load(e,t,i){return this.scriptLoader.loadScript(\"https://js.stripe.com/v3/\").then(()=>{if(!this.stripeWindow.Stripe)throw new M;return this.stripeWindow.Stripe(e,{stripeAccount:t,locale:i,betas:[\"payment_intent_beta_3\",\"alipay_pm_beta_1\"],apiVersion:\"2020-03-02;alipay_beta=v1\"})})}}const T=l(t=>new O(t,new k((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{gateway:\"stripev3\"}]);var N,R,D,z,L,U,V,x,j,B;!function(e){e.SHIPPING=\"shipping\",e.BILLING=\"billing\"}(N||(N={})),function(e){e.SPLIT=\"split\",e.FULL=\"full\",e.ORGANIZATION=\"organization\"}(R||(R={})),function(e){e.SUCCESS=\"success\",e.ERROR=\"error\"}(D||(D={})),function(e){e.CreditCard=\"card\",e.Link=\"link\",e.EPS=\"eps\",e.GRABPAY=\"grabpay\",e.BANCONTACT=\"bancontact\",e.IDEAL=\"ideal\",e.ALIPAY=\"alipay\",e.KLARNA=\"klarna\",e.OCS=\"optimized_checkout\"}(z||(z={})),function(e){e.NEVER=\"never\",e.AUTO=\"auto\",e.ALWAYS=\"always\",e.PAYMENT=\"payment\",e.IF_REQUIRED=\"if_required\"}(L||(L={})),function(e){e.V3=\"v3\",e.ACACIA=\"acacia\",e.BASIL=\"basil\",e.CLOVER=\"clover\"}(U||(U={})),function(e){e.PAYMENT=\"payment\",e.AUTHENTICATION=\"linkAuthentication\",e.SHIPPING=\"address\",e.EXPRESS_CHECKOUT=\"expressCheckout\"}(V||(V={})),function(e){e.REQUIRES_PAYMENT_METHOD=\"requires_payment_method\",e.REQUIRES_CONFIRMATION=\"requires_confirmation\",e.REQUIRES_ACTION=\"requires_action\",e.PROCESSING=\"processing\",e.SUCCEEDED=\"succeeded\",e.CANCELED=\"canceled\"}(x||(x={})),function(e){e.CLICK=\"click\",e.CHANGE=\"change\",e.READY=\"ready\",e.SHIPPING_ADDRESS_CHANGE=\"shippingaddresschange\",e.SHIPPING_RATE_CHANGE=\"shippingratechange\",e.CONFIRM=\"confirm\",e.CANCEL=\"cancel\",e.LOADER_START=\"loaderstart\"}(j||(j={})),function(e){e.ON_SESSION=\"on_session\",e.OFF_SESSION=\"off_session\"}(B||(B={}));var F=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class G{constructor(e,t=window){this.scriptLoader=e,this.stripeWindow=t}getStripeClient(e,t,i,n,r){return F(this,void 0,void 0,function*(){if(this.stripeWindow.bcStripeClient)return this.stripeWindow.bcStripeClient;const o=yield this.load(i),{stripePublishableKey:s,stripeConnectedAccount:a}=e,d=o(s,Object.assign(Object.assign(Object.assign(Object.assign({},a?{stripeAccount:a}:{}),t?{locale:t}:{}),n?{betas:n}:{}),r?{apiVersion:r}:{}));return Object.assign(this.stripeWindow,{bcStripeClient:d}),d})}getElements(e,t){return F(this,void 0,void 0,function*(){let i=this.stripeWindow.bcStripeElements;return i?yield this.updateStripeElements(t):(i=e.elements(t),Object.assign(this.stripeWindow,{bcStripeElements:i})),i})}updateStripeElements(e){return F(this,void 0,void 0,function*(){const t=this.stripeWindow.bcStripeElements;t&&(t.update(e),yield t.fetchUpdates())})}getCheckoutSession(e,t){return F(this,void 0,void 0,function*(){let i=this.stripeWindow.bcStripeCheckoutSession;return i||(i=yield e.initCheckout(t),Object.assign(this.stripeWindow,{bcStripeCheckoutSession:i})),i})}load(e){return F(this,void 0,void 0,function*(){if(!this.stripeWindow.Stripe&&(yield this.scriptLoader.loadScript(this.getScriptUrl(e)),!this.stripeWindow.Stripe))throw new M;return this.stripeWindow.Stripe})}getScriptUrl(e){return e&&e!==U.V3?`https://js.stripe.com/${e}/stripe.js`:\"https://js.stripe.com/v3/\"}}class H extends c{constructor(e){super(e||\"Unable to proceed because the client library of a payment method has thrown an unexpected error.\"),this.name=\"PaymentMethodFailedError\",this.type=\"payment_method_client_invalid\"}}var q=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class W{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t,this.isMounted=!1}deinitialize(){var e;null===(e=this.checkoutEventsUnsubscribe)||void 0===e||e.call(this),this.isMounted=!1}initCheckoutEventsSubscription(e,t,i,n){this.checkoutEventsUnsubscribe=this.paymentIntegrationService.subscribe(()=>q(this,void 0,void 0,function*(){var r;const o=null==n?void 0:n.getElement(V.PAYMENT);if(o){try{yield this.updateStripePaymentIntent(e,t)}catch(e){return this.isMounted&&(o.unmount(),this.isMounted=!1),void(e instanceof Error&&(null===(r=i.onError)||void 0===r||r.call(i,e)))}this.isMounted||(yield null==n?void 0:n.fetchUpdates(),this.mountElement(o,i.containerId))}}),e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.outstandingBalance},e=>{var t;return null===(t=e.getCheckout())||void 0===t?void 0:t.coupons})}mountElement(e,t){document.getElementById(t)&&(e.mount(`#${t}`),this.isMounted=!0)}mapAppearanceVariables(e){return{colorPrimary:e.fieldInnerShadow,colorBackground:e.fieldBackground,colorText:e.labelText,colorDanger:e.fieldErrorText,colorTextSecondary:e.labelText,colorTextPlaceholder:e.fieldPlaceholderText,colorIcon:e.fieldPlaceholderText}}mapInputAppearanceRules(e){return{borderColor:e.fieldBorder,color:e.fieldText,boxShadow:e.fieldInnerShadow}}throwStripeError(e){if(\"object\"==typeof(t=e)&&null!==t&&\"type\"in t&&(this.throwDisplayableStripeError(e),this.isCancellationError(e)))throw new _;var t;throw new H}throwDisplayableStripeError(e){if((0,lodash__WEBPACK_IMPORTED_MODULE_1__.includes)([\"card_error\",\"invalid_request_error\",\"validation_error\"],e.type))throw new Error(e.message)}isCancellationError(e){var t;const i=null===(t=null==e?void 0:e.payment_intent.last_payment_error)||void 0===t?void 0:t.message;return!!i&&-1!==i.indexOf(\"canceled\")}throwPaymentConfirmationProceedMessage(){throw new H(\"We've received your order and are processing your payment. Once the payment is verified, your order will be completed. We will send you an email when it's completed. Please note, this process may take a few minutes depending on the processing times of your chosen method.\")}isPaymentCompleted(e,t){return q(this,void 0,void 0,function*(){const i=this.paymentIntegrationService.getState(),n=i.getPaymentMethodOrThrow(e),{features:r}=i.getStoreConfigOrThrow().checkoutSettings;if(!n.clientToken||!t||!r[\"PI-626.Block_unnecessary_payment_confirmation_for_StripeUPE\"])return!1;const{paymentIntent:o}=yield t.retrievePaymentIntent(n.clientToken);return(null==o?void 0:o.status)===x.SUCCEEDED})}mapStripePaymentData(e,t,i=!1){const n=this.paymentIntegrationService.getState().getBillingAddress(),{firstName:r=\"\",lastName:o=\"\",email:d=\"\"}=n||{},l=this._mapStripeAddress(n);if(!e)throw new v(a.PaymentNotInitialized);if(!(d&&l&&l.city&&l.country&&r&&o))throw new y(s.MissingBillingAddress);return{elements:e,redirect:L.IF_REQUIRED,confirmParams:Object.assign({payment_method_data:Object.assign(Object.assign({},i?{allow_redisplay:\"always\"}:{}),{billing_details:{email:d,address:l,name:`${r} ${o}`}})},t&&{return_url:t})}}isAdditionalActionError(e){return (0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e,{code:\"additional_action_required\"})}isRedirectAction(e){const{type:t,data:{redirect_url:i}}=e;return\"redirect_to_url\"===t&&!!i}isOnPageAdditionalAction(e){const{type:t,data:{token:i}}=e;return\"additional_action_requires_payment_method\"===t&&!!i}updateStripePaymentIntent(e,t){return q(this,void 0,void 0,function*(){const i=yield this.paymentIntegrationService.loadPaymentMethod(e,{params:{method:t}}),{clientToken:n}=i.getPaymentMethodOrThrow(t);n&&this.scriptLoader.updateStripeElements({clientSecret:n})})}getStripeJsVersion(e){return e.useNewStripeJsVersion?U.CLOVER:U.V3}_mapStripeAddress(e){if(e){const{city:t,address1:i,address2:n,countryCode:r,postalCode:o,stateOrProvinceCode:s}=e;return Object.assign({city:t,country:r,postal_code:o,line1:i,line2:n},s?{state:s}:{})}throw new y(s.MissingBillingAddress)}}const Y={body:{},headers:{},status:0};class $ extends c{constructor(e,{message:t,errors:i}={}){const{body:n,headers:r,status:o}=e||Y;super(t||\"An unexpected error has occurred.\"),this.name=\"RequestError\",this.type=\"request\",this.body=n,this.headers=r,this.status=o,this.errors=i||[]}}function J(e){return\"object\"==typeof e&&null!==e&&\"initializationData\"in e&&void 0!==e.initializationData&&null!==e.initializationData&&\"object\"==typeof e.initializationData&&\"stripePublishableKey\"in e.initializationData&&\"stripeConnectedAccount\"in e.initializationData&&\"shopperLanguage\"in e.initializationData&&void 0!==e.initializationData.stripePublishableKey&&void 0!==e.initializationData.stripeConnectedAccount&&void 0!==e.initializationData.shopperLanguage}const K={ar:[\"ar\"],bg:[\"bg\"],cs:[\"cs\"],da:[\"da\"],de:[\"de\"],el:[\"el\"],en:[\"en\",\"en-GB\"],es:[\"es\",\"es-419\"],et:[\"et\"],fi:[\"fi\"],fil:[\"fil\"],fr:[\"fr\",\"fr-CA\"],he:[\"he\"],hr:[\"hr\"],hu:[\"hu\"],id:[\"id\"],it:[\"it\"],ja:[\"ja\"],ko:[\"ko\"],lt:[\"lt\"],lv:[\"lv\"],ms:[\"ms\"],mt:[\"mt\"],nb:[\"nb\"],nl:[\"nl\"],pl:[\"pl\"],pt:[\"pt\",\"pt-BR\"],ro:[\"ro\"],ru:[\"ru\"],sk:[\"sk\"],sl:[\"sl\"],sv:[\"sv\"],th:[\"th\"],tr:[\"tr\"],vi:[\"vi\"],zh:[\"zh\",\"zh-HK\",\"zh-TW\"]};function Z(e){const[t,i]=e.replace(/_/g,\"-\").toLowerCase().split(\"-\"),n=K[t];if(!n)return\"auto\";const r=i?`${t}-${i.toUpperCase()}`:t;return n.indexOf(r)>-1?r:n[0]}const Q=[\"payment_element_beta_2\",\"alipay_pm_beta_1\",\"link_default_integration_beta_1\",\"shipping_address_element_beta_1\",\"address_element_beta_1\"],X=\"2020-03-02;alipay_beta=v1;link_beta=v1\";function ee(e){return\"stripeLinkAuthenticationState\"in e}var te=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class ie{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){return te(this,void 0,void 0,function*(){const{stripeupe:t,methodId:i,gatewayId:n}=e;if(!(null==t?void 0:t.containerId))throw new v(a.PaymentNotInitialized);if(!n)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');return this._loadStripeElement(t,n,i).catch(e=>{var i;return null===(i=t.onError)||void 0===i?void 0:i.call(t,e)}),this.stripeIntegrationService.initCheckoutEventsSubscription(n,i,t,this._stripeElements),Promise.resolve()})}execute(e,t){return te(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]);if(!i||!i.paymentData)throw new h([\"payment.paymentData\"]);if(!this._stripeUPEClient)throw new v(a.PaymentNotInitialized);const{paymentData:r,methodId:o,gatewayId:s}=i,{shouldSaveInstrument:d=!1,shouldSetAsDefaultInstrument:l=!1}=p(r)?r:{},c=this.paymentIntegrationService.getState(),{isStoreCreditApplied:u}=c.getCheckoutOrThrow(),y=c.getPaymentProviderCustomerOrThrow(),g=(ee(y)?y:{}).stripeLinkAuthenticationState;if(u&&(yield this.paymentIntegrationService.applyStoreCredit(u)),s){yield this.stripeIntegrationService.updateStripePaymentIntent(s,o);const{email:e}=c.getCustomerOrThrow();if(void 0!==g&&!e){const e=c.getBillingAddressOrThrow();yield this.paymentIntegrationService.updateBillingAddress(e)}}if(yield this.paymentIntegrationService.submitOrder(n,t),m(r)){const{instrumentId:e}=r;return void(yield this._executeWithVaulted(i.methodId,e,l))}yield this._executeWithStripeConfirmation(i.methodId,!g&&d,l)})}finalize(){return Promise.reject(new g)}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(V.PAYMENT))||void 0===t||t.unmount(),this.stripeIntegrationService.deinitialize(),this._stripeElements=void 0,this._stripeUPEClient=void 0,Promise.resolve()}_executeWithStripeConfirmation(e,t,i){return te(this,void 0,void 0,function*(){const n=this.paymentIntegrationService.getState(),{clientToken:r}=n.getPaymentMethodOrThrow(e),o=this._getPaymentPayload(e,r||\"\",t,i);try{yield this.paymentIntegrationService.submitPayment(o)}catch(n){yield this._processAdditionalActionWithStripeConfirmation(n,e,t,i)}})}_executeWithVaulted(e,t,i){var n;return te(this,void 0,void 0,function*(){const r=this.paymentIntegrationService.getState(),o=r.getPaymentMethodOrThrow(e),s=null===(n=r.getCart())||void 0===n?void 0:n.id;try{const n={methodId:e,paymentData:{formattedPayload:{cart_id:s,bigpay_token:{token:t},confirm:!1,client_token:o.clientToken,set_as_default_stored_instrument:i}}};return yield this.paymentIntegrationService.submitPayment(n)}catch(t){return this._processVaultedAdditionalAction(t,e,i)}})}_loadStripeElement(e,t,i){return te(this,void 0,void 0,function*(){const{containerId:n,style:r,render:o,initStripeElementUpdateTrigger:a}=e,d=yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}}),l=d.getPaymentMethodOrThrow(i);if(!J(l))throw new y(s.MissingPaymentMethod);const{clientToken:c,initializationData:u}=l,{shopperLanguage:h,allowRedisplayForStoredInstruments:p=!1,enableLink:m}=u;if(this._allowRedisplayForStoredInstruments=p,!c)throw new y(s.MissingPaymentMethod);let g;if(this._stripeUPEClient=yield this._loadStripeJs(u),this._isStripeElementUpdateEnabled=\"function\"==typeof a,r){const e=r;g={variables:this.stripeIntegrationService.mapAppearanceVariables(r),rules:{\".Input\":this.stripeIntegrationService.mapInputAppearanceRules(e)}}}this._stripeElements=yield this.scriptLoader.getElements(this._stripeUPEClient,{clientSecret:c,locale:Z(h),appearance:g});const{getBillingAddress:v,getShippingAddress:S}=d,{postalCode:_}=S()||v()||{},f=this._stripeElements.getElement(V.PAYMENT)||this._stripeElements.create(V.PAYMENT,Object.assign({fields:{billingDetails:{email:L.NEVER,address:{country:L.NEVER,city:L.NEVER,postalCode:_?L.NEVER:L.AUTO}}},wallets:{applePay:L.NEVER,googlePay:L.NEVER,link:m?L.AUTO:L.NEVER}},this._getStripeElementTerms()));this.stripeIntegrationService.mountElement(f,n),f.on(j.READY,()=>{o()}),f.on(j.CHANGE,e=>{(null==e?void 0:e.value)&&\"type\"in e.value&&this._updateStripeLinkStateByElementType(e.value.type)}),this._isStripeElementUpdateEnabled&&(null==a||a(this._updateStripeElement.bind(this)))})}_processAdditionalActionWithStripeConfirmation(e,t,i=!1,n=!1){return te(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:r}=e.body.additional_action_required,{token:o}=r,{paymentIntent:s}=yield this._confirmStripePaymentOrThrow(t,r),d=this._getPaymentPayload(t,(null==s?void 0:s.id)||o,i,n);try{yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return te(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,o,!!this._allowRedisplayForStoredInstruments);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this._stripeUPEClient))?yield null===(n=this._stripeUPEClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this._stripeUPEClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new H;return t}catch(e){this.stripeIntegrationService.throwStripeError(a)}})}_processVaultedAdditionalAction(e,t,i=!1){var n;return te(this,void 0,void 0,function*(){if(!t||!S(e)||!(0,lodash__WEBPACK_IMPORTED_MODULE_1__.some)(e.body.errors,{code:\"three_d_secure_required\"}))throw e;if(!this._stripeUPEClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const r=e.body.three_ds_result.token;let s,d=!1;try{s=yield this._stripeUPEClient.confirmCardPayment(r)}catch(e){try{s=yield this._stripeUPEClient.retrievePaymentIntent(r)}catch(e){d=!0}}if((null==s?void 0:s.error)&&this.stripeIntegrationService.throwStripeError(s.error),!(null==s?void 0:s.paymentIntent)&&!d)throw new $;const l=this._getPaymentPayload(t,d?r:null===(n=null==s?void 0:s.paymentIntent)||void 0===n?void 0:n.id,!1,i);return this.paymentIntegrationService.submitPayment(l)})}_loadStripeJs(e){return te(this,void 0,void 0,function*(){if(this._stripeUPEClient)return this._stripeUPEClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale(),U.V3,Q,X)})}_getPaymentPayload(e,t,i=!1,n=!1){var r;return{methodId:e,paymentData:{formattedPayload:{cart_id:(null===(r=this.paymentIntegrationService.getState().getCart())||void 0===r?void 0:r.id)||\"\",credit_card_token:{token:t},confirm:!1,vault_payment_instrument:i,set_as_default_stored_instrument:n}}}}_updateStripeElement({shouldShowTerms:e}){var t;const i=null===(t=this._stripeElements)||void 0===t?void 0:t.getElement(V.PAYMENT);null==i||i.update(Object.assign({},this._getStripeElementTerms(e)))}_getStripeElementTerms(e){let t=L.AUTO;return this._isStripeElementUpdateEnabled&&(t=e?L.AUTO:L.NEVER),{terms:{card:t}}}_updateStripeLinkStateByElementType(e){const t=this.paymentIntegrationService.getState().getPaymentProviderCustomerOrThrow(),i=e===z.Link;!ee(t)&&i&&this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:i})}}const ne=l(t=>{const i=new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new ie(t,i,new W(t,i))},[{gateway:\"stripeupe\"},{gateway:\"stripeupe\",id:\"klarna\"}]),re=e=>\"object\"==typeof e&&null!==e&&\"value\"in e&&\"collapsed\"in e;var oe=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class se{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){var t;return oe(this,void 0,void 0,function*(){const{stripeocs:i,methodId:n,gatewayId:r}=e;if(!(null==i?void 0:i.containerId))throw new v(a.PaymentNotInitialized);if(!r)throw new u('Unable to initialize payment because \"gatewayId\" argument is not provided.');try{yield this._initializeStripeElement(i,r,n)}catch(e){e instanceof Error&&(null===(t=i.onError)||void 0===t||t.call(i,e))}this.stripeIntegrationService.initCheckoutEventsSubscription(r,n,i,this.stripeElements)})}execute(e,t){return oe(this,void 0,void 0,function*(){const{payment:i}=e,n=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&\"function\"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]])}return i}(e,[\"payment\"]),{methodId:r,gatewayId:o}=i||{};if(!this.stripeClient)throw new v(a.PaymentNotInitialized);if(!o||!r)throw new u('Unable to initialize payment because \"gatewayId\" or \"methodId\" argument is not provided.');const{isStoreCreditApplied:s}=this.paymentIntegrationService.getState().getCheckoutOrThrow();s&&(yield this.paymentIntegrationService.applyStoreCredit(s)),yield this.stripeIntegrationService.updateStripePaymentIntent(o,r),yield this.paymentIntegrationService.submitOrder(n,t);const{clientToken:d}=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(r,o),l=this._getPaymentPayload(r,d||\"\");try{yield this.paymentIntegrationService.submitPayment(l)}catch(e){yield this._processAdditionalAction(e,r)}})}finalize(){return Promise.reject(new g)}deinitialize(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(V.PAYMENT);return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeElements=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,i){return oe(this,void 0,void 0,function*(){let n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i,t);if((null==n?void 0:n.clientToken)||(n=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}})).getPaymentMethodOrThrow(i,t)),!J(n))throw new y(s.MissingPaymentMethod);const{clientToken:r,initializationData:o}=n,{shopperLanguage:a,customerSessionToken:d,enableLink:l}=o;if(!r)throw new y(s.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(o);const{appearance:c,containerId:u,fonts:h,layout:p,render:m,paymentMethodSelect:g,handleClosePaymentMethod:v,togglePreloader:S}=e;this.stripeElements=yield this.scriptLoader.getElements(this.stripeClient,{clientSecret:r,customerSessionClientSecret:d,locale:Z(a),appearance:c,fonts:h});const{getBillingAddress:_,getShippingAddress:f}=this.paymentIntegrationService.getState(),C=_(),{postalCode:E}=f()||C||{},I=this.stripeElements.getElement(V.PAYMENT)||this.stripeElements.create(V.PAYMENT,{fields:{billingDetails:{email:L.NEVER,address:{country:L.NEVER,city:L.NEVER,postalCode:E?L.NEVER:L.AUTO}}},wallets:{applePay:L.NEVER,googlePay:L.NEVER,link:l?L.AUTO:L.NEVER},layout:p,savePaymentMethod:{maxVisiblePaymentMethods:20},defaultValues:{billingDetails:{email:(null==C?void 0:C.email)||\"\"}}});this.stripeIntegrationService.mountElement(I,u),I.on(j.LOADER_START,()=>{null==S||S(!1)}),I.on(j.READY,()=>{m()}),I.on(j.CHANGE,e=>{this._onStripeElementChange(e,t,i,g)}),null==v||v(this._collapseStripeElement.bind(this))})}_loadStripeJs(e){return oe(this,void 0,void 0,function*(){if(this.stripeClient)return this.stripeClient;const t=this.paymentIntegrationService.getState(),i=this.stripeIntegrationService.getStripeJsVersion(e);return this.scriptLoader.getStripeClient(e,t.getCartLocale(),i)})}_collapseStripeElement(){var e;const t=null===(e=this.stripeElements)||void 0===e?void 0:e.getElement(V.PAYMENT);null==t||t.collapse()}_getPaymentPayload(e,t,i){var n;const r=(null===(n=this.paymentIntegrationService.getState().getCart())||void 0===n?void 0:n.id)||\"\",{card:o,us_bank_account:s}=i||{},a=this._shouldSaveInstrument(o)||this._shouldSaveInstrument(s),d=this._getTokenizedOptions(t,i);return{methodId:e,paymentData:{formattedPayload:Object.assign({cart_id:r,confirm:!1,method:this.selectedMethodId,vault_payment_instrument:a},d)}}}_processAdditionalAction(e,t){return oe(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this.stripeClient||!this.stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(t,i),{client_secret:o,payment_method_options:s}=r||{},d=this._getPaymentPayload(t,o||n,s);try{return yield this.paymentIntegrationService.submitPayment(d)}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}})}_confirmStripePaymentOrThrow(e,t){var i,n;return oe(this,void 0,void 0,function*(){const{token:r,redirect_url:o}=t,s=this.stripeIntegrationService.mapStripePaymentData(this.stripeElements,o);let a;try{const t=(yield this.stripeIntegrationService.isPaymentCompleted(e,this.stripeClient))?yield null===(n=this.stripeClient)||void 0===n?void 0:n.retrievePaymentIntent(r||\"\"):yield null===(i=this.stripeClient)||void 0===i?void 0:i.confirmPayment(s);if(a=null==t?void 0:t.error,a||!(null==t?void 0:t.paymentIntent))throw new H;return t}catch(e){return this.stripeIntegrationService.throwStripeError(a)}})}_onStripeElementChange(e,t,i,n){re(e)&&!e.collapsed&&(this.selectedMethodId=e.value.type,null==n||n(`${t}-${i}`))}_shouldSaveInstrument(e){const t=null==e?void 0:e.setup_future_usage;return t===B.ON_SESSION||t===B.OFF_SESSION}_getTokenizedOptions(e,t){return this._shouldSaveInstrument(null==t?void 0:t.us_bank_account)?{tokenized_ach:{token:e}}:{credit_card_token:{token:e}}}}const ae=l(t=>{const i=new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new se(t,i,new W(t,i))},[{gateway:\"stripeocs\",id:\"optimized_checkout\"}]);var de=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class le{constructor(e,t,i){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i}initialize(e){var t;return de(this,void 0,void 0,function*(){const{stripeocs:i,methodId:n,gatewayId:r}=e;if(!(null==i?void 0:i.containerId)||!r)throw new v(a.PaymentNotInitialized);try{yield this._initializeStripeElement(i,r,n)}catch(e){e instanceof Error&&(null===(t=i.onError)||void 0===t||t.call(i,e))}})}execute(){return de(this,void 0,void 0,function*(){return Promise.resolve()})}finalize(){return Promise.reject(new g)}deinitialize(){var e;const t=null===(e=this.stripeCheckoutSession)||void 0===e?void 0:e.getPaymentElement();return null==t||t.unmount(),null==t||t.destroy(),this.stripeIntegrationService.deinitialize(),this.stripeCheckoutSession=void 0,this.stripeClient=void 0,Promise.resolve()}_initializeStripeElement(e,t,i){return de(this,void 0,void 0,function*(){let n=this.paymentIntegrationService.getState().getPaymentMethodOrThrow(i,t);if((null==n?void 0:n.clientToken)||(n=(yield this.paymentIntegrationService.loadPaymentMethod(t,{params:{method:i}})).getPaymentMethodOrThrow(i,t)),!J(n))throw new y(s.MissingPaymentMethod);const{clientToken:r,initializationData:o}=n;if(!r)throw new y(s.MissingPaymentMethod);this.stripeClient=yield this._loadStripeJs(o);const{enableLink:d}=o,{appearance:l,containerId:c,fonts:u,layout:h,render:p,paymentMethodSelect:m,handleClosePaymentMethod:g,togglePreloader:S}=e,{getBillingAddress:_,getShippingAddress:f}=this.paymentIntegrationService.getState(),C=_(),{postalCode:E}=f()||C||{};this.stripeCheckoutSession=yield this.scriptLoader.getCheckoutSession(this.stripeClient,{clientSecret:r,elementsOptions:{appearance:l,fonts:u},adaptivePricing:{allowed:!1},defaultValues:{email:(null==C?void 0:C.email)||\"\"}});const I=this._createStripeElement({fields:{billingDetails:{email:L.NEVER,address:{country:L.NEVER,city:L.NEVER,postalCode:E?L.NEVER:L.AUTO}}},wallets:{applePay:L.NEVER,googlePay:L.NEVER,link:d?L.AUTO:L.NEVER},layout:h});if(!I)throw new v(a.PaymentNotInitialized);this.stripeIntegrationService.mountElement(I,c),I.on(j.LOADER_START,()=>{null==S||S(!1)}),I.on(j.READY,()=>{p()}),I.on(j.CHANGE,e=>{this._onStripeElementChange(e,t,i,m)}),null==g||g(this._collapseStripeElement.bind(this))})}_loadStripeJs(e){return de(this,void 0,void 0,function*(){if(this.stripeClient)return this.stripeClient;const t=this.paymentIntegrationService.getState();return this.scriptLoader.getStripeClient(e,t.getCartLocale(),U.CLOVER)})}_createStripeElement(e){var t,i;return(null===(t=this.stripeCheckoutSession)||void 0===t?void 0:t.getPaymentElement())||(null===(i=this.stripeCheckoutSession)||void 0===i?void 0:i.createPaymentElement(e))}_onStripeElementChange(e,t,i,n){re(e)&&!e.collapsed&&(null==n||n(`${t}-${i}`))}_collapseStripeElement(){var e;const t=null===(e=this.stripeCheckoutSession)||void 0===e?void 0:e.getPaymentElement();null==t||t.collapse()}}const ce=l(t=>{const i=new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)());return new le(t,i,new W(t,i))},[{gateway:\"stripeocs\",id:\"checkout_session\"}]);class ue{constructor(e,t){this.paymentIntegrationService=e,this.scriptLoader=t}initialize(e){var t,i,n,r,o;return i=this,n=void 0,o=function*(){let i;if(!e.stripeupe)throw new u('Unable to proceed because \"options\" argument is not provided.');const{container:n,gatewayId:r,methodId:o,onEmailChange:a,getStyles:d,isLoading:l}=e.stripeupe;Object.entries(e.stripeupe).forEach(([e,t])=>{if(!t)throw new u(`Unable to proceed because \"${e}\" argument is not provided.`)}),yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:o}});const c=this.paymentIntegrationService.getState(),h=c.getPaymentMethodOrThrow(o,r),{clientToken:p}=h;if(!J(h)||!p)throw new y(s.MissingPaymentToken);const{email:m}=c.getCustomerOrThrow(),g=c.getPaymentProviderCustomerOrThrow(),v=(ee(g)?g:{}).stripeLinkAuthenticationState;if(!m){let e;const r=\"function\"==typeof d&&d();e=r?{variables:{colorPrimary:r.fieldInnerShadow,colorBackground:r.fieldBackground,colorText:r.labelText,colorDanger:r.fieldErrorText,colorTextSecondary:r.labelText,colorTextPlaceholder:r.fieldPlaceholderText},rules:{\".Input\":{borderColor:r.fieldBorder,color:r.fieldText,boxShadow:r.fieldInnerShadow}}}:{},i=yield this.scriptLoader.getStripeClient(h.initializationData,c.getCartLocale(),U.V3,Q,X),this._stripeElements=yield this.scriptLoader.getElements(i,{clientSecret:p,appearance:e});const{getBillingAddress:o,getConsignments:u}=this.paymentIntegrationService.getState(),m=u(),g=null===(t=null==m?void 0:m[0])||void 0===t?void 0:t.id,{email:S}=o()||{},_=S?{defaultValues:{mode:N.SHIPPING,email:S}}:{},f=this._stripeElements.getElement(V.AUTHENTICATION)||this._stripeElements.create(V.AUTHENTICATION,_);f.on(j.CHANGE,e=>{if(!(\"authenticated\"in e))throw new y(s.MissingCustomer);this.paymentIntegrationService.updatePaymentProviderCustomer({stripeLinkAuthenticationState:e.authenticated}),e.complete?a(e.authenticated,e.value.email):a(!1,\"\"),l&&l(!1),void 0===v&&e.authenticated&&g&&this.paymentIntegrationService.deleteConsignment(g)}),f.mount(`#${n}`)}},new((r=void 0)||(r=Promise))(function(e,t){function s(e){try{d(o.next(e))}catch(e){t(e)}}function a(e){try{d(o.throw(e))}catch(e){t(e)}}function d(t){var i;t.done?e(t.value):(i=t.value,i instanceof r?i:new r(function(e){e(i)})).then(s,a)}d((o=o.apply(i,n||[])).next())})}deinitialize(){var e,t;return null===(t=null===(e=this._stripeElements)||void 0===e?void 0:e.getElement(V.AUTHENTICATION))||void 0===t||t.unmount(),Promise.resolve()}signIn(e,t){return this.paymentIntegrationService.signInCustomer(e,t),Promise.resolve()}signOut(e){return this.paymentIntegrationService.signOutCustomer(e),Promise.resolve()}executePaymentMethodCheckout(e){var t;return null===(t=null==e?void 0:e.continueWithCheckoutCallback)||void 0===t||t.call(e),Promise.resolve()}}const he=l(t=>new ue(t,new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)())),[{id:\"stripeupe\"}]),pe={size:70,color:\"#d9d9d9\",backgroundColor:\"#ffffff\"},me={position:\"fixed\",\"background-color\":\"rgba(0, 0, 0, 0.4)\",\"z-index\":\"1000\"},ye=\"embedded-checkout-loading-indicator-rotation\";class ge{constructor(e){this.styles=Object.assign(Object.assign({},pe),e&&e.styles),this.containerStyles=Object.assign({},e&&e.containerStyles),this.defineAnimation(),this.container=this.buildContainer(),this.indicator=this.buildIndicator(),this.container.appendChild(this.indicator)}show(e){if(e){const t=document.getElementById(e);if(!t)throw new Error(\"Unable to attach the loading indicator because the parent ID is not valid.\");t.appendChild(this.container)}this.container.style.visibility=\"visible\",this.container.style.opacity=\"1\"}hide(){const e=()=>{this.container.style.visibility=\"hidden\",this.container.removeEventListener(\"transitionend\",e)};this.container.addEventListener(\"transitionend\",e),this.container.style.opacity=\"0\"}buildContainer(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.bottom=\"0\",e.style.left=\"0\",e.style.height=\"100%\",e.style.width=\"100%\",e.style.position=\"absolute\",e.style.right=\"0\",e.style.top=\"0\",e.style.transition=\"all 250ms ease-out\",e.style.opacity=\"0\",this.setStyleAttribute(e,this.containerStyles),e}buildIndicator(){const e=document.createElement(\"div\");return e.style.display=\"block\",e.style.width=`${this.styles.size}px`,e.style.height=`${this.styles.size}px`,e.style.borderRadius=`${this.styles.size}px`,e.style.border=\"solid 1px\",e.style.borderColor=`${this.styles.backgroundColor} ${this.styles.backgroundColor} ${this.styles.color} ${this.styles.color}`,e.style.margin=\"0 auto\",e.style.position=\"absolute\",e.style.left=\"0\",e.style.right=\"0\",e.style.top=\"50%\",e.style.transform=\"translateY(-50%) rotate(0deg)\",e.style.transformStyle=\"preserve-3d\",e.style.animation=`${ye} 500ms infinite cubic-bezier(0.69, 0.31, 0.56, 0.83)`,e}setStyleAttribute(e,t){Object.keys(t).forEach(i=>{e.style.setProperty(i,t[i])})}defineAnimation(){var e;if(document.getElementById(ye))return;const t=document.createElement(\"style\");t.id=ye,null===(e=document.head)||void 0===e||e.appendChild(t),t.sheet instanceof CSSStyleSheet&&t.sheet.insertRule(`\\n                @keyframes ${ye} {\\n                    0% { transform: translateY(-50%) rotate(0deg); }\\n                    100% { transform: translateY(-50%) rotate(360deg); }\\n                }\\n            `,0)}}class ve{constructor(e){this._decimalPlaces=e}toInteger(e){return Math.round(e*Math.pow(10,this._decimalPlaces))}}const Se=[\"AC\",\"AD\",\"AE\",\"AF\",\"AG\",\"AI\",\"AL\",\"AM\",\"AO\",\"AQ\",\"AR\",\"AT\",\"AU\",\"AW\",\"AX\",\"AZ\",\"BA\",\"BB\",\"BD\",\"BE\",\"BF\",\"BG\",\"BH\",\"BI\",\"BJ\",\"BL\",\"BM\",\"BN\",\"BO\",\"BQ\",\"BR\",\"BS\",\"BT\",\"BV\",\"BW\",\"BY\",\"BZ\",\"CA\",\"CD\",\"CF\",\"CG\",\"CH\",\"CI\",\"CK\",\"CL\",\"CM\",\"CN\",\"CO\",\"CR\",\"CV\",\"CW\",\"CY\",\"CZ\",\"DE\",\"DJ\",\"DK\",\"DM\",\"DO\",\"DZ\",\"EC\",\"EE\",\"EG\",\"EH\",\"ER\",\"ES\",\"ET\",\"FI\",\"FJ\",\"FK\",\"FO\",\"FR\",\"GA\",\"GB\",\"GD\",\"GE\",\"GF\",\"GG\",\"GH\",\"GI\",\"GL\",\"GM\",\"GN\",\"GP\",\"GQ\",\"GR\",\"GS\",\"GT\",\"GU\",\"GW\",\"GY\",\"HK\",\"HN\",\"HR\",\"HT\",\"HU\",\"ID\",\"IE\",\"IL\",\"IM\",\"IN\",\"IO\",\"IQ\",\"IS\",\"IT\",\"JE\",\"JM\",\"JO\",\"JP\",\"KE\",\"KG\",\"KH\",\"KI\",\"KM\",\"KN\",\"KR\",\"KW\",\"KY\",\"KZ\",\"LA\",\"LB\",\"LC\",\"LI\",\"LK\",\"LR\",\"LS\",\"LT\",\"LU\",\"LV\",\"LY\",\"MA\",\"MC\",\"MD\",\"ME\",\"MF\",\"MG\",\"MK\",\"ML\",\"MM\",\"MN\",\"MO\",\"MQ\",\"MR\",\"MS\",\"MT\",\"MU\",\"MV\",\"MW\",\"MX\",\"MY\",\"MZ\",\"NA\",\"NC\",\"NE\",\"NG\",\"NI\",\"NL\",\"NO\",\"NP\",\"NR\",\"NU\",\"NZ\",\"OM\",\"PA\",\"PE\",\"PF\",\"PG\",\"PH\",\"PK\",\"PL\",\"PM\",\"PN\",\"PR\",\"PS\",\"PT\",\"PY\",\"QA\",\"RE\",\"RO\",\"RS\",\"RU\",\"RW\",\"SA\",\"SB\",\"SC\",\"SD\",\"SE\",\"SG\",\"SH\",\"SI\",\"SJ\",\"SK\",\"SL\",\"SM\",\"SN\",\"SO\",\"SR\",\"SS\",\"ST\",\"SV\",\"SX\",\"SZ\",\"TA\",\"TC\",\"TD\",\"TF\",\"TG\",\"TH\",\"TJ\",\"TK\",\"TL\",\"TM\",\"TN\",\"TO\",\"TR\",\"TT\",\"TV\",\"TW\",\"TZ\",\"UA\",\"UG\",\"US\",\"UY\",\"UZ\",\"VA\",\"VC\",\"VE\",\"VG\",\"VN\",\"VU\",\"WF\",\"WS\",\"XK\",\"YE\",\"YT\",\"ZA\",\"ZM\",\"ZW\",\"ZZ\"];var _e=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class fe{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return _e(this,void 0,void 0,function*(){const{stripeocs:t}=e||{};if(!t)throw new u('Unable to proceed because \"options\" argument is not provided.');const{methodId:i,gatewayId:n,container:r}=t;if(!r||!i||!n)throw new v(a.PaymentNotInitialized);const o=yield this.paymentIntegrationService.loadPaymentMethod(n,{params:{method:i}}),d=o.getPaymentMethodOrThrow(i,n),{loadingContainerId:l,buttonHeight:c,onComplete:h}=t;if(this._loadingIndicatorContainer=l,this._onComplete=h,!J(d))throw new y(s.MissingPaymentMethod);const{initializationData:p}=d,{captureMethod:m}=p,g=this.stripeIntegrationService.getStripeJsVersion(p);this._captureMethod=m,this._stripeClient=yield this.scriptLoader.getStripeClient(p,o.getCartLocale(),g),yield this._mountExpressCheckoutElement(r,this._stripeClient,c),this._initializeEvents(i)})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i=40){return _e(this,void 0,void 0,function*(){const n=this._shouldRequireShippingAddress(),r=Object.assign(Object.assign(Object.assign({shippingAddressRequired:n},n?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),n?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:L.AUTO,applePay:L.NEVER,googlePay:L.NEVER,amazonPay:L.NEVER,paypal:L.NEVER,klarna:L.NEVER},buttonHeight:i}),{cartAmount:o}=this.paymentIntegrationService.getState().getCartOrThrow(),s=Object.assign({mode:\"payment\",amount:this._toCents(o),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});return this._stripeElements=t.elements(s),this._linkV2Element=this._stripeElements.create(V.EXPRESS_CHECKOUT,r),this._linkV2Element.mount(`#${e}`),this._linkV2Element})}_initializeEvents(e){this._linkV2Element&&(this._shouldRequireShippingAddress()&&(this._linkV2Element.on(j.SHIPPING_ADDRESS_CHANGE,e=>_e(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),this._linkV2Element.on(j.SHIPPING_RATE_CHANGE,e=>_e(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),this._linkV2Element.on(j.CONFIRM,t=>_e(this,void 0,void 0,function*(){return this._onConfirm(t,e)})),this._linkV2Element.on(j.CANCEL,this._onCancel))}_onShippingAddressChange(e){return _e(this,void 0,void 0,function*(){if(!(\"address\"in e))return;const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:(null==t?void 0:t.state)||\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),(null==n?void 0:n.length)?e.resolve({shippingRates:n}):e.reject()})}_onCancel(){throw new _}_onShippingRateChange(e){return _e(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return _e(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return _e(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return _e(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return _e(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:L.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new H;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return _e(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,method:z.Link})}}}_shouldRequireShippingAddress(){const{getCartOrThrow:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e();return!!t.physicalItems.length}_updateDisplayedPrice(){return _e(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){if(!this._currencyCode){const{code:e}=this.paymentIntegrationService.getState().getCartOrThrow().currency;this._currencyCode=e.toLowerCase()}return this._currencyCode}_getTotalPrice(){return _e(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:e,getCartOrThrow:t}=this.paymentIntegrationService.getState(),{decimalPlaces:i}=t().currency,n=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(e().outstandingBalance,i).toFixed(i);return this._toCents(+n)})}_getAvailableCountries(){var e;return _e(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>Se.includes(e))})}_getAvailableShippingOptions(){var e,t,i;return _e(this,void 0,void 0,function*(){const n=this.paymentIntegrationService.getState().getConsignments();if(!(null==n?void 0:n[0]))return;const r=n[0],o=(r.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),s=null===(e=r.availableShippingOptions)||void 0===e?void 0:e.find(e=>e.isRecommended),a=null===(t=r.selectedShippingOption)||void 0===t?void 0:t.id,d=null==s?void 0:s.id;return a?o.sort(e=>e.id===a?-1:0):d?(o.sort(e=>e.id===d?-1:0),yield this._handleShippingOptionChange(d)):yield this._handleShippingOptionChange(null===(i=o[0])||void 0===i?void 0:i.id),o})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return _e(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new ve(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const Ce=l(t=>{const i=new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new ge({containerStyles:me});return new fe(t,i,new W(t,i),n)},[{id:\"stripeocs\"}]);var Ee=function(e,t,i,n){return new(i||(i=Promise))(function(r,o){function s(e){try{d(n.next(e))}catch(e){o(e)}}function a(e){try{d(n.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?r(e.value):(t=e.value,t instanceof i?t:new i(function(e){e(t)})).then(s,a)}d((n=n.apply(e,t||[])).next())})};class Ie{constructor(e,t,i,n){this.paymentIntegrationService=e,this.scriptLoader=t,this.stripeIntegrationService=i,this.loadingIndicator=n}initialize(e){return Ee(this,void 0,void 0,function*(){const{stripeocs:t,containerId:i}=e||{};if(!t||!i)throw new v(a.PaymentNotInitialized);const{methodId:n,gatewayId:r}=t;if(!n||!r)throw new y(s.MissingPaymentMethod);const o=yield this.paymentIntegrationService.loadPaymentMethod(r,{params:{method:n}}),d=o.getPaymentMethodOrThrow(n,r),{loadingContainerId:l,buttonHeight:c,onComplete:u}=t;if(this._loadingIndicatorContainer=l,this._onComplete=u,!J(d))throw new y(s.MissingPaymentMethod);const{initializationData:h}=d,{captureMethod:p}=h,m=this.stripeIntegrationService.getStripeJsVersion(h);this._captureMethod=p,this._stripeClient=yield this.scriptLoader.getStripeClient(h,o.getCartLocale(),m),yield this.paymentIntegrationService.loadDefaultCheckout(),yield this._mountExpressCheckoutElement(i,this._stripeClient,c),this._initializeEvents(n)})}signIn(){return Promise.resolve()}signOut(){return Promise.resolve()}executePaymentMethodCheckout(){return Promise.resolve()}deinitialize(){return Promise.resolve()}_mountExpressCheckoutElement(e,t,i=40){return Ee(this,void 0,void 0,function*(){const n=this._shouldRequireShippingAddress(),r=Object.assign(Object.assign(Object.assign({shippingAddressRequired:n},n?{allowedShippingCountries:yield this._getAvailableCountries()}:{}),n?{shippingRates:[{id:\"_\",amount:0,displayName:\"Pending rates\"}]}:{}),{billingAddressRequired:!0,emailRequired:!0,phoneNumberRequired:!0,paymentMethods:{link:L.AUTO,applePay:L.NEVER,googlePay:L.NEVER,amazonPay:L.NEVER,paypal:L.NEVER,klarna:L.NEVER},buttonHeight:i}),{cartAmount:o=1}=this.paymentIntegrationService.getState().getCart()||{},s=Object.assign({mode:\"payment\",amount:this._toCents(o),currency:this._getCurrency()},this._captureMethod?{captureMethod:this._captureMethod}:{});this._stripeElements=t.elements(s),this._linkV2Element=this._stripeElements.create(V.EXPRESS_CHECKOUT,r),this._linkV2Element.mount(`#${e}`)})}_initializeEvents(e){this._linkV2Element&&(this._shouldRequireShippingAddress()&&(this._linkV2Element.on(j.SHIPPING_ADDRESS_CHANGE,e=>Ee(this,void 0,void 0,function*(){return this._onShippingAddressChange(e)})),this._linkV2Element.on(j.SHIPPING_RATE_CHANGE,e=>Ee(this,void 0,void 0,function*(){return this._onShippingRateChange(e)}))),this._linkV2Element.on(j.CONFIRM,t=>Ee(this,void 0,void 0,function*(){return this._onConfirm(t,e)})),this._linkV2Element.on(j.CANCEL,this._onCancel))}_onShippingAddressChange(e){return Ee(this,void 0,void 0,function*(){if(!(\"address\"in e))return;const t=e.address,i={firstName:\"\",lastName:\"\",phone:\"\",company:\"\",address1:\"\",address2:\"\",city:(null==t?void 0:t.city)||\"\",countryCode:(null==t?void 0:t.country)||\"\",postalCode:(null==t?void 0:t.postal_code)||\"\",stateOrProvince:(null==t?void 0:t.state)||\"\",stateOrProvinceCode:(null==t?void 0:t.state)||\"\",customFields:[]};yield this.paymentIntegrationService.updateShippingAddress(i);const n=yield this._getAvailableShippingOptions();yield this._updateDisplayedPrice(),(null==n?void 0:n.length)?e.resolve({shippingRates:n}):e.reject()})}_onCancel(){throw new _}_onShippingRateChange(e){return Ee(this,void 0,void 0,function*(){if(\"shippingRate\"in e){const{shippingRate:t}=e;yield this._handleShippingOptionChange(null==t?void 0:t.id),yield this._updateDisplayedPrice(),e.resolve({})}})}_onConfirm(e,t){return Ee(this,void 0,void 0,function*(){if(\"billingDetails\"in e&&\"shippingAddress\"in e&&this._stripeClient&&this._stripeElements){yield this._updateShippingAndBillingAddress(e),yield this.paymentIntegrationService.submitOrder();const i=this._getPaymentPayload(t);try{yield this.paymentIntegrationService.submitPayment(i)}catch(e){yield this._processAdditionalAction(e,t)}}return Promise.resolve()})}_updateShippingAndBillingAddress(e){var t,i,n,r,o,s,a,d;return Ee(this,void 0,void 0,function*(){const l=this._shouldRequireShippingAddress(),c=(null===(i=null===(t=e.shippingAddress)||void 0===t?void 0:t.name)||void 0===i?void 0:i.split(\" \")[0])||(null===(r=null===(n=e.billingDetails)||void 0===n?void 0:n.name)||void 0===r?void 0:r.split(\" \")[0])||\"\",u=(null===(s=null===(o=e.shippingAddress)||void 0===o?void 0:o.name)||void 0===s?void 0:s.split(\" \")[1])||(null===(d=null===(a=e.billingDetails)||void 0===a?void 0:a.name)||void 0===d?void 0:d.split(\" \")[1])||\"\";if(l){const t=this._mapShippingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateShippingAddress(t)}const h=this._mapBillingAddress(e.shippingAddress,e.billingDetails,c,u);yield this.paymentIntegrationService.updateBillingAddress(h)})}_mapShippingAddress(e,t,i,n){var r,o,s,a,d,l,c;return{firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==e?void 0:e.address)||void 0===r?void 0:r.line1)||\"\",address2:(null===(o=null==e?void 0:e.address)||void 0===o?void 0:o.line2)||\"\",city:(null===(s=null==e?void 0:e.address)||void 0===s?void 0:s.city)||\"\",countryCode:(null===(a=null==e?void 0:e.address)||void 0===a?void 0:a.country)||\"\",postalCode:(null===(d=null==e?void 0:e.address)||void 0===d?void 0:d.postal_code)||\"\",stateOrProvince:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",stateOrProvinceCode:(null===(c=null==e?void 0:e.address)||void 0===c?void 0:c.state)||\"\",customFields:[]}}_mapBillingAddress(e,t,i,n){var r,o,s,a,d,l;return{email:(null==t?void 0:t.email)||\"\",firstName:i,lastName:n,phone:(null==t?void 0:t.phone)||\"\",company:\"\",address1:(null===(r=null==t?void 0:t.address)||void 0===r?void 0:r.line1)||\"\",address2:\"\",city:(null===(o=null==t?void 0:t.address)||void 0===o?void 0:o.city)||\"\",countryCode:(null===(s=null==t?void 0:t.address)||void 0===s?void 0:s.country)||\"\",postalCode:(null===(a=null==t?void 0:t.address)||void 0===a?void 0:a.postal_code)||\"\",stateOrProvince:(null===(d=null==t?void 0:t.address)||void 0===d?void 0:d.state)||\"\",stateOrProvinceCode:(null===(l=null==e?void 0:e.address)||void 0===l?void 0:l.state)||\"\",customFields:[]}}_processAdditionalAction(e,t){return Ee(this,void 0,void 0,function*(){if(!S(e)||!this.stripeIntegrationService.isAdditionalActionError(e.body.errors))throw e;if(!this._stripeClient||!this._stripeElements)throw new v(a.PaymentNotInitialized);const{data:i}=e.body.additional_action_required,{token:n}=i,{paymentIntent:r}=yield this._confirmStripePaymentOrThrow(i,t),o=this._getPaymentPayload(t,(null==r?void 0:r.id)||n);try{this._toggleLoadingIndicator(!0),yield this.paymentIntegrationService.submitPayment(o),yield this._completeCheckoutFlow()}catch(e){this.stripeIntegrationService.throwPaymentConfirmationProceedMessage()}finally{this._toggleLoadingIndicator(!1)}})}_confirmStripePaymentOrThrow(e,t){var i,n,r;return Ee(this,void 0,void 0,function*(){const{token:o,redirect_url:s}=e,a=this.stripeIntegrationService.mapStripePaymentData(this._stripeElements,s);let d;try{const e=(yield this.stripeIntegrationService.isPaymentCompleted(t,this._stripeClient))?yield null===(r=this._stripeClient)||void 0===r?void 0:r.retrievePaymentIntent(o||\"\"):yield null===(i=this._stripeClient)||void 0===i?void 0:i.confirmPayment({elements:a.elements,clientSecret:o,redirect:L.IF_REQUIRED,confirmParams:{return_url:null===(n=a.confirmParams)||void 0===n?void 0:n.return_url}});if(d=null==e?void 0:e.error,d||!(null==e?void 0:e.paymentIntent))throw new H;return e}catch(e){return this.stripeIntegrationService.throwStripeError(d)}})}_completeCheckoutFlow(){return Ee(this,void 0,void 0,function*(){return\"function\"==typeof this._onComplete?this._onComplete():(window.location.replace(\"/checkout/order-confirmation\"),Promise.resolve())})}_getPaymentPayload(e,t){var i;const n=(null===(i=this.paymentIntegrationService.getState().getCart())||void 0===i?void 0:i.id)||\"\";return{methodId:e,paymentData:{formattedPayload:Object.assign(Object.assign({cart_id:n},t?{credit_card_token:{token:t}}:{}),{confirm:!1,method:z.Link})}}}_shouldRequireShippingAddress(){const{getCart:e}=this.paymentIntegrationService.getState(),{lineItems:t}=e()||{};return!!(null==t?void 0:t.physicalItems.length)}_updateDisplayedPrice(){return Ee(this,void 0,void 0,function*(){this._stripeElements&&this._stripeElements.update({currency:this._getCurrency(),mode:\"payment\",amount:yield this._getTotalPrice()})})}_getCurrency(){var e;if(!this._currencyCode){const t=null===(e=this.paymentIntegrationService.getState().getCart())||void 0===e?void 0:e.currency;t&&(this._currencyCode=t.code.toLowerCase())}return this._currencyCode}_getTotalPrice(){var e;return Ee(this,void 0,void 0,function*(){yield this.paymentIntegrationService.loadCheckout();const{getCheckoutOrThrow:t,getCart:i}=this.paymentIntegrationService.getState(),{decimalPlaces:n}=(null===(e=i())||void 0===e?void 0:e.currency)||{},o=(0,lodash__WEBPACK_IMPORTED_MODULE_1__.round)(t().outstandingBalance,n).toFixed(n);return this._toCents(+o)})}_getAvailableCountries(){var e;return Ee(this,void 0,void 0,function*(){const t=yield this.paymentIntegrationService.loadShippingCountries();return((null===(e=t.getShippingCountries())||void 0===e?void 0:e.map(e=>e.code))||[]).filter(e=>Se.includes(e))})}_getAvailableShippingOptions(){var e,t,i;return Ee(this,void 0,void 0,function*(){const n=this.paymentIntegrationService.getState().getConsignments();if(!(null==n?void 0:n[0]))return;const r=n[0],o=(r.availableShippingOptions||[]).map(this._getStripeShippingOption.bind(this)),s=null===(e=r.availableShippingOptions)||void 0===e?void 0:e.find(e=>e.isRecommended),a=null===(t=r.selectedShippingOption)||void 0===t?void 0:t.id,d=null==s?void 0:s.id;return a?o.sort(e=>e.id===a?-1:0):d?(o.sort(e=>e.id===d?-1:0),yield this._handleShippingOptionChange(d)):yield this._handleShippingOptionChange(null===(i=o[0])||void 0===i?void 0:i.id),o})}_getStripeShippingOption({id:e,cost:t,description:i}){return{id:e,displayName:i,amount:this._toCents(t)}}_handleShippingOptionChange(e){return Ee(this,void 0,void 0,function*(){if(e&&\"shipping_option_unselected\"!==e)return this.paymentIntegrationService.selectShippingOption(e)})}_getAmountTransformer(){if(this._amountTransformer)return this._amountTransformer;const{getCart:e}=this.paymentIntegrationService.getState(),{currency:t}=e()||{};return t?new ve(t.decimalPlaces):void 0}_toCents(e){const t=Math.round(100*e),i=this._getAmountTransformer();return i?i.toInteger(e):t}_toggleLoadingIndicator(e){e&&this._loadingIndicatorContainer?this.loadingIndicator.show(this._loadingIndicatorContainer):this.loadingIndicator.hide()}}const Pe=l(t=>{const i=new G((0,_bigcommerce_script_loader__WEBPACK_IMPORTED_MODULE_0__.getScriptLoader)()),n=new ge({containerStyles:me});return new Ie(t,i,new W(t,i),n)},[{id:\"stripeocs\"}]);\n//# sourceMappingURL=stripe.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiLi4vY2hlY2tvdXQtc2RrLWpzL2Rpc3QvZXNtL2ludGVncmF0aW9ucy9zdHJpcGUuanMiLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7OztBQUE2SSxhQUFhLGdCQUFnQix3QkFBd0IsYUFBYSxFQUFFLFlBQVksK0RBQStELHVCQUF1QixFQUFFLHNEQUFzRCxzQkFBc0IsZUFBZSxNQUFNLHVUQUF1VCxrQkFBa0IsZUFBZSxpSEFBaUgsa0JBQWtCLGVBQWUsK0VBQStFLFNBQVMsR0FBRyx5REFBeUQsYUFBYSxzREFBc0QsY0FBYyw0TUFBNE0sY0FBYywrQkFBK0IsYUFBYSxzeUJBQXN5QixTQUFTLEdBQUcsa0JBQWtCLGVBQWUsa0JBQWtCLFVBQVUsb0dBQW9HLCtFQUErRSwrRkFBK0YsdUZBQXVGLHVGQUF1Riw0SEFBNEgsaUZBQWlGLHNHQUFzRyxxRkFBcUYsZ0hBQWdILDZIQUE2SCxzR0FBc0csNkVBQTZFLDJFQUEyRSxrQkFBa0IsY0FBYyxtS0FBbUssYUFBYSx5U0FBeVMsU0FBUyxHQUFHLGtCQUFrQixlQUFlLGtCQUFrQixVQUFVLHdIQUF3SCxzSEFBc0gsd0hBQXdILDZIQUE2SCw0RkFBNEYsaUZBQWlGLG9EQUFvRCxrQkFBa0IsZUFBZSxrSEFBa0gsY0FBYyw2T0FBNk8sWUFBWSxhQUFhLG9DQUFvQyxTQUFTLGVBQWUsZ0pBQWdKLFNBQVMsZUFBZSwwRUFBMEUsU0FBUyxlQUFlLDZCQUE2QixTQUFTLEdBQUcsa0JBQWtCLGVBQWUsb0xBQW9MLHdCQUF3Qix5Q0FBeUMsY0FBYyxJQUFJLGFBQWEsU0FBUyxNQUFNLGNBQWMsSUFBSSxjQUFjLFNBQVMsTUFBTSxjQUFjLE1BQU0sZ0VBQWdFLEtBQUssYUFBYSwrQkFBK0IsR0FBRywyQkFBMkIsUUFBUSxpQkFBaUIscURBQXFELGNBQWMsd0NBQXdDLE1BQU0sa0NBQWtDLEdBQUcsZ0dBQWdHLGdEQUFnRCw4RUFBOEUsb0JBQW9CLGdIQUFnSCxHQUFHLDJDQUEyQyx5Q0FBeUMsc1BBQXNQLEVBQUUsYUFBYSxRQUFR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RSxFQUFFLDZFQUE2RSxTQUFTLFNBQVMsMERBQTBELEVBQUUsd0JBQXdCLHlDQUF5Qyx5SUFBeUksRUFBRSx3QkFBd0IsTUFBTSxxR0FBcUcsT0FBTyx3QkFBd0IsOENBQThDLFVBQVUsSUFBSSxtQkFBbUIsU0FBUyxHQUFHLEdBQUcseUJBQXlCLElBQUksZ0NBQWdDLE1BQU0sVUFBVSw0Q0FBNEMsWUFBWSxTQUFTLGdEQUFnRCx3QkFBd0IseUNBQXlDLG1EQUFtRCwrRUFBK0UsRUFBRSxFQUFFLGVBQWUsTUFBTSx3QkFBd0IscUdBQXFHLDZDQUE2QywwQkFBMEIsaUJBQWlCLE1BQU0seUNBQXlDLG9EQUFvRCxNQUFNLCtCQUErQiw0Q0FBNEMsZ0JBQWdCLG1EQUFtRCxHQUFHLDZDQUFDLHNDQUFzQyx5QkFBeUIsRUFBRSx5QkFBeUIsTUFBTSx5Q0FBeUMscUVBQXFFLGdIQUFnSCxFQUFFLCtCQUErQixVQUFVLHlDQUF5QyxvRUFBb0UsaUNBQWlDLHdRQUF3USwyTEFBMkwsRUFBRSwwQkFBMEIsMEJBQTBCLEVBQUUsT0FBTyw0Q0FBNEMsK0JBQStCLHlDQUF5QyxxR0FBcUcsRUFBRSx3QkFBd0IsMERBQTBELE1BQU0sVUFBVSw0Q0FBNEMsV0FBVyxTQUFTLHdDQUF3QyxZQUFZLHlEQUF5RCwwQkFBMEIsMkJBQTJCLDZIQUE2SCxlQUFlLGNBQWMsMkVBQUMsY0FBYyxtQkFBbUIsRUFBRSxnQ0FBZ0MsR0FBRyxlQUFlLEdBQTRRO0FBQzM2dEUiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9jaGVja291dC8uLi9jaGVja291dC1zZGstanMvZGlzdC9lc20vaW50ZWdyYXRpb25zL3N0cmlwZS5qcz9hMTc1Il0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydHtnZXRTY3JpcHRMb2FkZXIgYXMgZX1mcm9tXCJAYmlnY29tbWVyY2Uvc2NyaXB0LWxvYWRlclwiO2ltcG9ydHtpbmNsdWRlcyBhcyB0LGlzRW1wdHkgYXMgaSxvbWl0QnkgYXMgbixyb3VuZCBhcyByLHNvbWUgYXMgb31mcm9tXCJsb2Rhc2hcIjt2YXIgcyxhLGQ9e307ZnVuY3Rpb24gbChlLHQpe3JldHVybiBPYmplY3QuYXNzaWduKGUse3Jlc29sdmVJZHM6dH0pfWQuZD0oZSx0KT0+e2Zvcih2YXIgaSBpbiB0KWQubyh0LGkpJiYhZC5vKGUsaSkmJk9iamVjdC5kZWZpbmVQcm9wZXJ0eShlLGkse2VudW1lcmFibGU6ITAsZ2V0OnRbaV19KX0sZC5vPShlLHQpPT5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSx0KTtjbGFzcyBjIGV4dGVuZHMgRXJyb3J7Y29uc3RydWN0b3IoZSl7dmFyIHQ7c3VwZXIoZXx8XCJBbiB1bmV4cGVjdGVkIGVycm9yIGhhcyBvY2N1cnJlZC5cIiksdGhpcy5uYW1lPVwiU3RhbmRhcmRFcnJvclwiLHRoaXMudHlwZT1cInN0YW5kYXJkXCIsdD1uZXcudGFyZ2V0LnByb3RvdHlwZSxPYmplY3Quc2V0UHJvdG90eXBlT2Y/T2JqZWN0LnNldFByb3RvdHlwZU9mKHRoaXMsdCk6dGhpcy5fX3Byb3RvX189dCxcImZ1bmN0aW9uXCI9PXR5cGVvZiBFcnJvci5jYXB0dXJlU3RhY2tUcmFjZT9FcnJvci5jYXB0dXJlU3RhY2tUcmFjZSh0aGlzLG5ldy50YXJnZXQpOnRoaXMuc3RhY2s9bmV3IEVycm9yKHRoaXMubWVzc2FnZSkuc3RhY2t9fWNsYXNzIHUgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUpe3N1cGVyKGV8fFwiSW52YWxpZCBhcmd1bWVudHMgaGF2ZSBiZWVuIHByb3ZpZGVkLlwiKSx0aGlzLm5hbWU9XCJJbnZhbGlkQXJndW1lbnRFcnJvclwiLHRoaXMudHlwZT1cImludmFsaWRfYXJndW1lbnRcIn19Y2xhc3MgaCBleHRlbmRzIHV7Y29uc3RydWN0b3IoZSl7bGV0IHQ9XCJVbmFibGUgdG8gc3VibWl0IHBheW1lbnQgZm9yIHRoZSBvcmRlciBiZWNhdXNlIHRoZSBwYXlsb2FkIGlzIGludmFsaWQuXCI7ZSYmKHQ9YCR7dH0gTWFrZSBzdXJlIHRoZSBmb2xsb3dpbmcgZmllbGRzIGFyZSBwcm92aWRlZCBjb3JyZWN0bHk6ICR7ZS5qb2luKFwiLCBcIil9LmApLHN1cGVyKHQpLHRoaXMubmFtZT1cIlBheW1lbnRBcmd1bWVudEludmFsaWRFcnJvclwifX1mdW5jdGlvbiBwKGUpe3JldHVybiEoXCJvYmplY3RcIiE9dHlwZW9mIGV8fG51bGw9PT1lfHx2b2lkIDAhPT1lLnNob3VsZFNhdmVJbnN0cnVtZW50JiZcImJvb2xlYW5cIiE9dHlwZW9mIGUuc2hvdWxkU2F2ZUluc3RydW1lbnR8fHZvaWQgMCE9PWUuc2hvdWxkU2V0QXNEZWZhdWx0SW5zdHJ1bWVudCYmXCJib29sZWFuXCIhPXR5cGVvZiBlLnNob3VsZFNldEFzRGVmYXVsdEluc3RydW1lbnQpfWZ1bmN0aW9uIG0oZSl7cmV0dXJuIEJvb2xlYW4oZS5pbnN0cnVtZW50SWQpfSFmdW5jdGlvbihlKXtlW2UuTWlzc2luZ0JpbGxpbmdBZGRyZXNzPTBdPVwiTWlzc2luZ0JpbGxpbmdBZGRyZXNzXCIsZVtlLk1pc3NpbmdDYXJ0PTFdPVwiTWlzc2luZ0NhcnRcIixlW2UuTWlzc2luZ0NoZWNrb3V0PTJdPVwiTWlzc2luZ0NoZWNrb3V0XCIsZVtlLk1pc3NpbmdDb25zaWdubWVudHM9M109XCJNaXNzaW5nQ29uc2lnbm1lbnRzXCIsZVtlLk1pc3NpbmdDdXN0b21lcj00XT1cIk1pc3NpbmdDdXN0b21lclwiLGVbZS5NaXNzaW5nQ2hlY2tvdXRDb25maWc9NV09XCJNaXNzaW5nQ2hlY2tvdXRDb25maWdcIixlW2UuTWlzc2luZ09yZGVyPTZdPVwiTWlzc2luZ09yZGVyXCIsZVtlLk1pc3NpbmdPcmRlckNvbmZpZz03XT1cIk1pc3NpbmdPcmRlckNvbmZpZ1wiLGVbZS5NaXNzaW5nT3JkZXJJZD04XT1cIk1pc3NpbmdPcmRlcklkXCIsZVtlLk1pc3NpbmdQYXltZW50PTldPVwiTWlzc2luZ1BheW1lbnRcIixlW2UuTWlzc2luZ1BheW1lbnRJZD0xMF09XCJNaXNzaW5nUGF5bWVudElkXCIsZVtlLk1pc3NpbmdQYXltZW50SW5zdHJ1bWVudD0xMV09XCJNaXNzaW5nUGF5bWVudEluc3RydW1lbnRcIixlW2UuTWlzc2luZ1BheW1lbnRNZXRob2Q9MTJdPVwiTWlzc2luZ1BheW1lbnRNZXRob2RcIixlW2UuTWlzc2luZ1BheW1lbnRSZWRpcmVjdFVybD0xM109XCJNaXNzaW5nUGF5bWVudFJlZGlyZWN0VXJsXCIsZVtlLk1pc3NpbmdQYXltZW50U3RhdHVzPTE0XT1cIk1pc3NpbmdQYXltZW50U3RhdHVzXCIsZVtlLk1pc3NpbmdQYXltZW50VG9rZW49MTVdPVwiTWlzc2luZ1BheW1lbnRUb2tlblwiLGVbZS5NaXNzaW5nU2hpcHBpbmdBZGRyZXNzPTE2XT1cIk1pc3NpbmdTaGlwcGluZ0FkZHJlc3NcIn0oc3x8KHM9e30pKTtjbGFzcyB5IGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihmdW5jdGlvbihlKXtzd2l0Y2goZSl7Y2FzZSBzLk1pc3NpbmdCaWxsaW5nQWRkcmVzczpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgYmlsbGluZyBhZGRyZXNzIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdDYXJ0OnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBjYXJ0IGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdDb25zaWdubWVudHM6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGNvbnNpZ25tZW50cyBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nQ2hlY2tvdXQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGNoZWNrb3V0IGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdDdXN0b21lcjpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgY3VzdG9tZXIgZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIHMuTWlzc2luZ0NoZWNrb3V0Q29uZmlnOmNhc2Ugcy5NaXNzaW5nT3JkZXJDb25maWc6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIGNvbmZpZ3VyYXRpb24gZGF0YSBpcyB1bmF2YWlsYWJsZS5cIjtjYXNlIHMuTWlzc2luZ09yZGVyOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBvcmRlciBkYXRhIGlzIHVuYXZhaWxhYmxlLlwiO2Nhc2Ugcy5NaXNzaW5nT3JkZXJJZDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2Ugb3JkZXIgSUQgaXMgdW5hdmFpbGFibGUgb3Igbm90IGdlbmVyYXRlZCB5ZXQuXCI7Y2FzZSBzLk1pc3NpbmdQYXltZW50OnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBwYXltZW50IGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7Y2FzZSBzLk1pc3NpbmdQYXltZW50VG9rZW46cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSB0b2tlbiByZXF1aXJlZCB0byBzdWJtaXQgYSBwYXltZW50IGlzIG1pc3NpbmcuXCI7Y2FzZSBzLk1pc3NpbmdQYXltZW50TWV0aG9kOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBwYXltZW50IG1ldGhvZCBkYXRhIGlzIHVuYXZhaWxhYmxlIG9yIG5vdCBwcm9wZXJseSBjb25maWd1cmVkLlwiO2Nhc2Ugcy5NaXNzaW5nU2hpcHBpbmdBZGRyZXNzOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBzaGlwcGluZyBhZGRyZXNzIGRhdGEgaXMgdW5hdmFpbGFibGUuXCI7ZGVmYXVsdDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIHJlcXVpcmVkIGRhdGEgaXMgdW5hdmFpbGFibGUuXCJ9fShlKSksdGhpcy5zdWJ0eXBlPWUsdGhpcy5uYW1lPVwiTWlzc2luZ0RhdGFFcnJvclwiLHRoaXMudHlwZT1cIm1pc3NpbmdfZGF0YVwifX1jbGFzcyBnIGV4dGVuZHMgY3tjb25zdHJ1Y3Rvcigpe3N1cGVyKFwiVGhlIGN1cnJlbnQgb3JkZXIgZG9lcyBub3QgbmVlZCB0byBiZSBmaW5hbGl6ZWQgYXQgdGhpcyBzdGFnZS5cIiksdGhpcy5uYW1lPVwiT3JkZXJGaW5hbGl6YXRpb25Ob3RSZXF1aXJlZEVycm9yXCIsdGhpcy50eXBlPVwib3JkZXJfZmluYWxpemF0aW9uX25vdF9yZXF1aXJlZFwifX0hZnVuY3Rpb24oZSl7ZVtlLkNoZWNrb3V0QnV0dG9uTm90SW5pdGlhbGl6ZWQ9MF09XCJDaGVja291dEJ1dHRvbk5vdEluaXRpYWxpemVkXCIsZVtlLkN1c3RvbWVyTm90SW5pdGlhbGl6ZWQ9MV09XCJDdXN0b21lck5vdEluaXRpYWxpemVkXCIsZVtlLlBheW1lbnROb3RJbml0aWFsaXplZD0yXT1cIlBheW1lbnROb3RJbml0aWFsaXplZFwiLGVbZS5TaGlwcGluZ05vdEluaXRpYWxpemVkPTNdPVwiU2hpcHBpbmdOb3RJbml0aWFsaXplZFwiLGVbZS5TcGFtUHJvdGVjdGlvbk5vdEluaXRpYWxpemVkPTRdPVwiU3BhbVByb3RlY3Rpb25Ob3RJbml0aWFsaXplZFwifShhfHwoYT17fSkpO2NsYXNzIHYgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUpe3N1cGVyKGZ1bmN0aW9uKGUpe3N3aXRjaChlKXtjYXNlIGEuQ3VzdG9tZXJOb3RJbml0aWFsaXplZDpyZXR1cm5cIlVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgdGhlIGN1c3RvbWVyIHN0ZXAgb2YgY2hlY2tvdXQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2Nhc2UgYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBwYXltZW50IHN0ZXAgb2YgY2hlY2tvdXQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2Nhc2UgYS5TaGlwcGluZ05vdEluaXRpYWxpemVkOnJldHVyblwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgc2hpcHBpbmcgc3RlcCBvZiBjaGVja291dCBoYXMgbm90IGJlZW4gaW5pdGlhbGl6ZWQuXCI7Y2FzZSBhLlNwYW1Qcm90ZWN0aW9uTm90SW5pdGlhbGl6ZWQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBjaGVja291dCBzcGFtIHByb3RlY3Rpb24gaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwiO2RlZmF1bHQ6cmV0dXJuXCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSByZXF1aXJlZCBjb21wb25lbnQgaGFzIG5vdCBiZWVuIGluaXRpYWxpemVkLlwifX0oZSkpLHRoaXMuc3VidHlwZT1lLHRoaXMubmFtZT1cIk5vdEluaXRpYWxpemVkRXJyb3JcIix0aGlzLnR5cGU9XCJub3RfaW5pdGlhbGl6ZWRcIn19Y29uc3QgUz1lPT5cIm9iamVjdFwiPT10eXBlb2YgZSYmbnVsbCE9PWUmJlwiYm9keVwiaW4gZTtjbGFzcyBfIGV4dGVuZHMgY3tjb25zdHJ1Y3RvcihlKXtzdXBlcihlfHxcIlBheW1lbnQgcHJvY2VzcyB3YXMgY2FuY2VsbGVkLlwiKSx0aGlzLm5hbWU9XCJQYXltZW50TWV0aG9kQ2FuY2VsbGVkRXJyb3JcIix0aGlzLnR5cGU9XCJwYXltZW50X2NhbmNlbGxlZFwifX1mdW5jdGlvbiBmKGUpe3JldHVybiBudWxsIT09ZSYmXCJvYmplY3RcIj09dHlwZW9mIGUmJlwiY2FyZE51bWJlckVsZW1lbnRPcHRpb25zXCJpbiBlJiZcImNhcmRDdmNFbGVtZW50T3B0aW9uc1wiaW4gZSYmXCJjYXJkRXhwaXJ5RWxlbWVudE9wdGlvbnNcImluIGUmJnZvaWQgMCE9PWUuY2FyZE51bWJlckVsZW1lbnRPcHRpb25zJiZ2b2lkIDAhPT1lLmNhcmRDdmNFbGVtZW50T3B0aW9ucyYmdm9pZCAwIT09ZS5jYXJkRXhwaXJ5RWxlbWVudE9wdGlvbnN9dmFyIEMsRSxJLFA7IWZ1bmN0aW9uKGUpe2UuU29saWQ9XCJzb2xpZFwiLGUuRGVmYXVsdD1cImRlZmF1bHRcIn0oQ3x8KEM9e30pKSxmdW5jdGlvbihlKXtlLkFsaXBheT1cImFsaXBheVwiLGUuQ2FyZEN2Yz1cImNhcmRDdmNcIixlLkNhcmRFeHBpcnk9XCJjYXJkRXhwaXJ5XCIsZS5DYXJkTnVtYmVyPVwiY2FyZE51bWJlclwiLGUuQ3JlZGl0Q2FyZD1cImNhcmRcIixlLklERUFMPVwiaWRlYWxCYW5rXCIsZS5TZXBhPVwiaWJhblwifShFfHwoRT17fSkpLGZ1bmN0aW9uKGUpe2UuQWxpcGF5PVwiYWxpcGF5XCIsZS5DcmVkaXRDYXJkPVwiY2FyZFwiLGUuSURFQUw9XCJpZGVhbFwiLGUuU2VwYT1cInNlcGFfZGViaXRcIn0oSXx8KEk9e30pKSxmdW5jdGlvbihlKXtlLkF1dGhGYWlsdXJlPVwiYXV0aF9mYWlsdXJlXCJ9KFB8fChQPXt9KSk7Y2xhc3MgYiBleHRlbmRzIGN7Y29uc3RydWN0b3IoZSl7c3VwZXIoZT09PVAuQXV0aEZhaWx1cmU/XCJVc2VyIGRpZCBub3QgYXV0aGVudGljYXRlXCI6XCJUaGVyZSB3YXMgYW4gZXJyb3Igd2hpbGUgcHJvY2Vzc2luZyB5b3VyIHBheW1lbnQuIFBsZWFzZSB0cnkgYWdhaW4gb3IgY29udGFjdCB1cy5cIiksdGhpcy50eXBlPVwic3RyaXBldjNfZXJyb3JcIix0aGlzLnN1YnR5cGU9ZX19dmFyIHc9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y29uc3QgQT1bRS5BbGlwYXksRS5JREVBTF07Y2xhc3MgT3tjb25zdHJ1Y3RvcihlLHQpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXR9aW5pdGlhbGl6ZShlKXtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7c3RyaXBldjM6dCxtZXRob2RJZDppLGdhdGV3YXlJZDpufT1lO2lmKCFuKXRocm93IG5ldyB1KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBwYXltZW50IGJlY2F1c2UgXCJnYXRld2F5SWRcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7dGhpcy5pbml0aWFsaXplT3B0aW9ucz10LHRoaXMuaXNEZWluaXRpYWxpemU9ITE7Y29uc3Qgcj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhpKSx7aW5pdGlhbGl6YXRpb25EYXRhOntzdHJpcGVQdWJsaXNoYWJsZUtleTpvLHN0cmlwZUNvbm5lY3RlZEFjY291bnQ6cyx1c2VJbmRpdmlkdWFsQ2FyZEZpZWxkczphLGFsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM6ZH19PXI7dGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cz1kO2NvbnN0IGw9dGhpcy5nZXRJbml0aWFsaXplT3B0aW9ucygpLmZvcm07dGhpcy51c2VJbmRpdmlkdWFsQ2FyZEZpZWxkcz1hLHRoaXMuc3RyaXBlVjNDbGllbnQ9eWllbGQgdGhpcy5sb2FkU3RyaXBlSnMobyxzKSx0aGlzLmlzQ3JlZGl0Q2FyZChpKSYmdGhpcy5zaG91bGRTaG93VFNWSG9zdGVkRm9ybShpLG4pJiZsP3RoaXMuaG9zdGVkRm9ybT15aWVsZCB0aGlzLm1vdW50Q2FyZFZlcmlmaWNhdGlvbkZpZWxkcyhsKTp0aGlzLnN0cmlwZUVsZW1lbnQ9eWllbGQgdGhpcy5tb3VudENhcmRGaWVsZHMoaSl9KX1leGVjdXRlKGUsaSl7dmFyIG4scjtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7cGF5bWVudDpvfT1lLGE9ZnVuY3Rpb24oZSx0KXt2YXIgaT17fTtmb3IodmFyIG4gaW4gZSlPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwoZSxuKSYmdC5pbmRleE9mKG4pPDAmJihpW25dPWVbbl0pO2lmKG51bGwhPWUmJlwiZnVuY3Rpb25cIj09dHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMpe3ZhciByPTA7Zm9yKG49T2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyhlKTtyPG4ubGVuZ3RoO3IrKyl0LmluZGV4T2YobltyXSk8MCYmT2JqZWN0LnByb3RvdHlwZS5wcm9wZXJ0eUlzRW51bWVyYWJsZS5jYWxsKGUsbltyXSkmJihpW25bcl1dPWVbbltyXV0pfXJldHVybiBpfShlLFtcInBheW1lbnRcIl0pO2xldCBkLGw7aWYoIW98fCFvLnBheW1lbnREYXRhKXRocm93IG5ldyBoKFtcInBheW1lbnQucGF5bWVudERhdGFcIl0pO2NvbnN0e3BheW1lbnREYXRhOmMsZ2F0ZXdheUlkOnUsbWV0aG9kSWQ6Z309byx7c2hvdWxkU2F2ZUluc3RydW1lbnQ6dixzaG91bGRTZXRBc0RlZmF1bHRJbnN0cnVtZW50OlN9PXAoYyk/Yzp7c2hvdWxkU2F2ZUluc3RydW1lbnQ6ITEsc2hvdWxkU2V0QXNEZWZhdWx0SW5zdHJ1bWVudDohMX0sXz10KEEsZykse2lzU3RvcmVDcmVkaXRBcHBsaWVkOmZ9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENoZWNrb3V0T3JUaHJvdygpO2YmJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuYXBwbHlTdG9yZUNyZWRpdChmKSk7dHJ5e18mJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoYSxpKSksdSYmKHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZCh1LHtwYXJhbXM6e21ldGhvZDpnfX0pKTtjb25zdCBlPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpO2lmKG0oYykpe3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcihhLGkpO2NvbnN0e2luc3RydW1lbnRJZDp0fT1jLG49ZS5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhvLm1ldGhvZElkKS5jbGllbnRUb2tlbjtpZighbil0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtyZXR1cm4geWllbGQgdGhpcy5leGVjdXRlV2l0aFZhdWx0ZWQobyx0LFMsbil9Y29uc3QgdD1lLmdldFBheW1lbnRNZXRob2RPclRocm93KGcpLGg9eWllbGQgdGhpcy5jb25maXJtU3RyaXBlUGF5bWVudCh0KSx7Y2xpZW50VG9rZW46cCxtZXRob2Q6Zn09dCx7aWQ6Q309bnVsbCE9PShyPW51bGwhPT0obj1oLnBheW1lbnRJbnRlbnQpJiZ2b2lkIDAhPT1uP246aC5wYXltZW50TWV0aG9kKSYmdm9pZCAwIT09cj9yOntpZDpcIlwifTtsPWguZXJyb3IsZD17Y3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOkN9LHZhdWx0X3BheW1lbnRfaW5zdHJ1bWVudDp2LGNvbmZpcm06ITEsc2V0X2FzX2RlZmF1bHRfc3RvcmVkX2luc3RydW1lbnQ6U30sZj09PUUuQ3JlZGl0Q2FyZCYmKGQuY2xpZW50X3Rva2VuPXApLF98fCh5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoYSxpKSk7Y29uc3QgST10aGlzLmJ1aWxkUGF5bWVudFBheWxvYWQoZyxkLFMpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KEkpfWNhdGNoKGUpe3lpZWxkIHRoaXMucHJvY2Vzc0FkZGl0aW9uYWxBY3Rpb24odGhpcy5oYW5kbGVFbXB0eVBheW1lbnRJbnRlbnRFcnJvcihlLGwpLGcsdixTKX19KX1maW5hbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlamVjdChuZXcgZyl9ZGVpbml0aWFsaXplKCl7cmV0dXJuIHRoaXMuaG9zdGVkRm9ybSYmdGhpcy5ob3N0ZWRGb3JtLmRldGFjaCgpLHRoaXMuaXNEZWluaXRpYWxpemU9ITAsdGhpcy51bm1vdW50RWxlbWVudCgpLFByb21pc2UucmVzb2x2ZSgpfWJ1aWxkUGF5bWVudFBheWxvYWQoZSx0LGkpe3JldHVybnttZXRob2RJZDplLHBheW1lbnREYXRhOmk/e2Zvcm1hdHRlZFBheWxvYWQ6T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHQpLHtzZXRfYXNfZGVmYXVsdF9zdG9yZWRfaW5zdHJ1bWVudDppfSl9Ontmb3JtYXR0ZWRQYXlsb2FkOnR9fX1pc0NhbmNlbGxhdGlvbkVycm9yKGUpe3ZhciB0LGk7cmV0dXJuIGUmJi0xIT09KG51bGw9PT0oaT1udWxsPT09KHQ9ZS5wYXltZW50X2ludGVudC5sYXN0X3BheW1lbnRfZXJyb3IpfHx2b2lkIDA9PT10P3ZvaWQgMDp0Lm1lc3NhZ2UpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmluZGV4T2YoXCJjYW5jZWxlZFwiKSl9aXNBdXRoRXJyb3IoZSl7cmV0dXJuXCJwYXltZW50X2ludGVudF9hdXRoZW50aWNhdGlvbl9mYWlsdXJlXCI9PT0obnVsbD09ZT92b2lkIDA6ZS5jb2RlKX1pc0NyZWRpdENhcmQoZSl7cmV0dXJuIGU9PT1JLkNyZWRpdENhcmR9aXNIb3N0ZWRGaWVsZEF2YWlsYWJsZSgpe3ZhciBlO2NvbnN0IHQ9dGhpcy5nZXRJbml0aWFsaXplT3B0aW9ucygpLHI9bihudWxsPT09KGU9dC5mb3JtKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5maWVsZHMsaSk7cmV0dXJuIWkocil9aXNIb3N0ZWRQYXltZW50Rm9ybUVuYWJsZWQoZSx0KXtjb25zdHtnZXRQYXltZW50TWV0aG9kT3JUaHJvdzppfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxuPWkoZSx0KTtyZXR1cm4gQm9vbGVhbihuLmNvbmZpZy5pc0hvc3RlZEZvcm1FbmFibGVkKX1jb25maXJtU3RyaXBlUGF5bWVudChlKXtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7Y2xpZW50VG9rZW46dCxtZXRob2Q6aSxyZXR1cm5Vcmw6bn09ZTtpZighdCl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtzd2l0Y2goaSl7Y2FzZSBFLkFsaXBheTpyZXR1cm4gdGhpcy5nZXRTdHJpcGVKcygpLmNvbmZpcm1BbGlwYXlQYXltZW50KHQse3JldHVybl91cmw6bn0se2hhbmRsZUFjdGlvbnM6ITF9KTtjYXNlIEUuSURFQUw6e2NvbnN0IGU9dGhpcy5tYXBTdHJpcGVQYXltZW50RGF0YShJLklERUFMLG4pO3JldHVybiB0aGlzLmdldFN0cmlwZUpzKCkuY29uZmlybUlkZWFsUGF5bWVudCh0LGUse2hhbmRsZUFjdGlvbnM6ITF9KX1jYXNlIEUuU2VwYTp7Y29uc3QgZT10aGlzLm1hcFN0cmlwZVBheW1lbnREYXRhKEkuU2VwYSk7cmV0dXJuIHRoaXMuZ2V0U3RyaXBlSnMoKS5jb25maXJtU2VwYURlYml0UGF5bWVudCh0LGUpfWRlZmF1bHQ6e2NvbnN0IGU9dGhpcy51c2VJbmRpdmlkdWFsQ2FyZEZpZWxkcz90aGlzLmdldFN0cmlwZUNhcmRFbGVtZW50cygpWzBdOnRoaXMuZ2V0U3RyaXBlRWxlbWVudCgpLHQ9dGhpcy5tYXBTdHJpcGVCaWxsaW5nRGV0YWlscyh0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRCaWxsaW5nQWRkcmVzcygpLHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEN1c3RvbWVyKCkpLGk9dGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cztyZXR1cm4gdGhpcy5nZXRTdHJpcGVKcygpLmNyZWF0ZVBheW1lbnRNZXRob2QoT2JqZWN0LmFzc2lnbih7dHlwZTpJLkNyZWRpdENhcmQsY2FyZDplLGJpbGxpbmdfZGV0YWlsczp0fSxpP3thbGxvd19yZWRpc3BsYXk6XCJhbHdheXNcIn06e30pKX19fSl9ZXhlY3V0ZVdpdGhWYXVsdGVkKGUsdCxpLG4pe3ZhciByO3JldHVybiB3KHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBvPXtiaWdwYXlfdG9rZW46e3Rva2VuOnR9LGNvbmZpcm06ITAsY2xpZW50X3Rva2VuOm4sc2V0X2FzX2RlZmF1bHRfc3RvcmVkX2luc3RydW1lbnQ6aX07aWYodGhpcy5pc0hvc3RlZFBheW1lbnRGb3JtRW5hYmxlZChlLm1ldGhvZElkLGUuZ2F0ZXdheUlkKSYmdGhpcy5ob3N0ZWRGb3JtKXtjb25zdCB0PXRoaXMuaG9zdGVkRm9ybTtyZXR1cm4gZS5wYXltZW50RGF0YSYmbShlLnBheW1lbnREYXRhKSYmKGUucGF5bWVudERhdGE9T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LGUucGF5bWVudERhdGEpLHtpbnN0cnVtZW50SWQ6SlNPTi5zdHJpbmdpZnkoe3Rva2VuOihudWxsPT09KHI9ZS5wYXltZW50RGF0YSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuaW5zdHJ1bWVudElkKXx8XCJcIixjbGllbnRfdG9rZW46bn0pfSkpLHlpZWxkIHQudmFsaWRhdGUoKSx5aWVsZCB0LnN1Ym1pdChlKSx0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZEN1cnJlbnRPcmRlcigpfWNvbnN0IHM9dGhpcy5idWlsZFBheW1lbnRQYXlsb2FkKGUubWV0aG9kSWQsbyxpKTtyZXR1cm4gdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQocyl9KX1nZXRJbml0aWFsaXplT3B0aW9ucygpe2lmKCF0aGlzLmluaXRpYWxpemVPcHRpb25zKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtyZXR1cm4gdGhpcy5pbml0aWFsaXplT3B0aW9uc31nZXRTdHJpcGVDYXJkRWxlbWVudHMoKXtpZighdGhpcy5zdHJpcGVDYXJkRWxlbWVudHMpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO3JldHVybiB0aGlzLnN0cmlwZUNhcmRFbGVtZW50c31nZXRTdHJpcGVFbGVtZW50KCl7aWYoIXRoaXMuc3RyaXBlRWxlbWVudCl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7cmV0dXJuIHRoaXMuc3RyaXBlRWxlbWVudH1nZXRTdHJpcGVKcygpe2lmKCF0aGlzLnN0cmlwZVYzQ2xpZW50KXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtyZXR1cm4gdGhpcy5zdHJpcGVWM0NsaWVudH1oYW5kbGVFbXB0eVBheW1lbnRJbnRlbnRFcnJvcihlLHQpe3JldHVybiBTKGUpJiZvKGUuYm9keS5lcnJvcnMse2NvZGU6XCJyZXF1aXJlZF9maWVsZFwifSkmJnQ/bmV3IEVycm9yKHQubWVzc2FnZSk6ZX1sb2FkU3RyaXBlSnMoZSx0KXtyZXR1cm4gdyh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuc3RyaXBlVjNDbGllbnQ/UHJvbWlzZS5yZXNvbHZlKHRoaXMuc3RyaXBlVjNDbGllbnQpOnRoaXMuc2NyaXB0TG9hZGVyLmxvYWQoZSx0LHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldExvY2FsZSgpKX0pfW1hcFN0cmlwZUFkZHJlc3MoZSl7aWYoZSl7Y29uc3R7Y2l0eTp0LGNvdW50cnlDb2RlOmksYWRkcmVzczE6bixhZGRyZXNzMjpyLHBvc3RhbENvZGU6byxzdGF0ZU9yUHJvdmluY2VDb2RlOnN9PWU7cmV0dXJue2NpdHk6dCxjb3VudHJ5OmksbGluZTE6bixsaW5lMjpyLHBvc3RhbF9jb2RlOm8sc3RhdGU6c319cmV0dXJue2xpbmUxOlwiXCJ9fW1hcFN0cmlwZUJpbGxpbmdEZXRhaWxzKGUsdCl7Y29uc3R7Zmlyc3ROYW1lOmksbGFzdE5hbWU6bn09ZXx8dHx8e2ZpcnN0TmFtZTpcIkd1ZXN0XCIsbGFzdE5hbWU6XCJcIn0scj1gJHtpfSAke259YC50cmltKCkse29wdGlvbnM6b309dGhpcy5nZXRJbml0aWFsaXplT3B0aW9ucygpO2lmKHRoaXMudXNlSW5kaXZpZHVhbENhcmRGaWVsZHMmJmYobykpe2NvbnN0e3ppcENvZGVFbGVtZW50T3B0aW9uczp0fT1vO2lmKHQpe2NvbnN0IGk9ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodC5jb250YWluZXJJZCk/ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodC5jb250YWluZXJJZCkudmFsdWU6XCJcIjtpJiZlJiYoZT1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sZSkse3Bvc3RhbENvZGU6aX0pKX19Y29uc3Qgcz17YWRkcmVzczp0aGlzLm1hcFN0cmlwZUFkZHJlc3MoZSl9O2lmKHQmJnQuYWRkcmVzc2VzWzBdJiZmdW5jdGlvbihlKXtyZXR1cm5cIm9iamVjdFwiPT10eXBlb2YgZSYmbnVsbCE9PWUmJlwiaWRcImluIGUmJnZvaWQgMCE9PWUuaWR9KHQuYWRkcmVzc2VzWzBdKSl7Y29uc3QgZT10LmFkZHJlc3Nlc1swXSx7ZW1haWw6aX09dCx7cGhvbmU6bn09ZTtyZXR1cm4gbj9PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOmksbmFtZTpyLHBob25lOm59KTpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scykse2VtYWlsOmksbmFtZTpyfSl9aWYoZSl7Y29uc3R7ZW1haWw6dCxwaG9uZTppfT1lO3JldHVybiBpP09iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxzKSx7ZW1haWw6dCxuYW1lOnIscGhvbmU6aX0pOk9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxzKSx7ZW1haWw6dCxuYW1lOnJ9KX1yZXR1cm4gT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHt9LHMpLHtuYW1lOnJ9KX1tYXBTdHJpcGVQYXltZW50RGF0YShlLHQpe2NvbnN0IGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q3VzdG9tZXIoKSxuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldEJpbGxpbmdBZGRyZXNzKCkscj17cGF5bWVudF9tZXRob2Q6e1tlXTp0aGlzLmdldFN0cmlwZUVsZW1lbnQoKSxiaWxsaW5nX2RldGFpbHM6dGhpcy5tYXBTdHJpcGVCaWxsaW5nRGV0YWlscyhuLGkpfX07cmV0dXJuIGU9PT1JLklERUFMP09iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7fSxyKSx7cmV0dXJuX3VybDp0fSk6cn1tb3VudENhcmRGaWVsZHMoZSl7Y29uc3R7b3B0aW9uczp0LGNvbnRhaW5lcklkOml9PXRoaXMuZ2V0SW5pdGlhbGl6ZU9wdGlvbnMoKTtsZXQgbjtyZXR1cm4gbmV3IFByb21pc2UoKHIsbyk9Pntzd2l0Y2godGhpcy5zdHJpcGVFbGVtZW50c3x8KHRoaXMuc3RyaXBlRWxlbWVudHM9dGhpcy5nZXRTdHJpcGVKcygpLmVsZW1lbnRzKCkpLGUpe2Nhc2UgRS5DcmVkaXRDYXJkOmlmKHRoaXMudXNlSW5kaXZpZHVhbENhcmRGaWVsZHMmJmYodCkpe2NvbnN0e2NhcmROdW1iZXJFbGVtZW50T3B0aW9uczplLGNhcmRFeHBpcnlFbGVtZW50T3B0aW9uczppLGNhcmRDdmNFbGVtZW50T3B0aW9uczpyfT10LHM9dGhpcy5zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KEUuQ2FyZE51bWJlcil8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKEUuQ2FyZE51bWJlcixlKSxhPXRoaXMuc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChFLkNhcmRFeHBpcnkpfHx0aGlzLnN0cmlwZUVsZW1lbnRzLmNyZWF0ZShFLkNhcmRFeHBpcnksaSksZD10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoRS5DYXJkQ3ZjKXx8dGhpcy5zdHJpcGVFbGVtZW50cy5jcmVhdGUoRS5DYXJkQ3ZjLHIpO3RoaXMuc3RyaXBlQ2FyZEVsZW1lbnRzPVtzLGEsZF0sbj10aGlzLnN0cmlwZUNhcmRFbGVtZW50c1swXTt0cnl7cy5tb3VudChgIyR7ZS5jb250YWluZXJJZH1gKSxhLm1vdW50KGAjJHtpLmNvbnRhaW5lcklkfWApLGQubW91bnQoYCMke3IuY29udGFpbmVySWR9YCl9Y2F0Y2goZSl7dGhpcy5pc0RlaW5pdGlhbGl6ZXx8byhuZXcgdShcIlVuYWJsZSB0byBtb3VudCBTdHJpcGUgY29tcG9uZW50IHdpdGhvdXQgdmFsaWQgY29udGFpbmVyIElELlwiKSl9fWVsc2V7bj10aGlzLnN0cmlwZUVsZW1lbnRzLmdldEVsZW1lbnQoZSl8fHRoaXMuc3RyaXBlRWxlbWVudHMuY3JlYXRlKGUsdCk7dHJ5e24ubW91bnQoYCMke2l9YCl9Y2F0Y2goZSl7dGhpcy5pc0RlaW5pdGlhbGl6ZXx8byhuZXcgdShcIlVuYWJsZSB0byBtb3VudCBTdHJpcGUgY29tcG9uZW50IHdpdGhvdXQgdmFsaWQgY29udGFpbmVyIElELlwiKSl9fWJyZWFrO2Nhc2UgRS5JREVBTDpjYXNlIEUuU2VwYTpuPXRoaXMuc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChlKXx8dGhpcy5zdHJpcGVFbGVtZW50cy5jcmVhdGUoZSx0KTt0cnl7bi5tb3VudChgIyR7aX1gKX1jYXRjaChlKXt0aGlzLmlzRGVpbml0aWFsaXplfHxvKG5ldyB1KFwiVW5hYmxlIHRvIG1vdW50IFN0cmlwZSBjb21wb25lbnQgd2l0aG91dCB2YWxpZCBjb250YWluZXIgSUQuXCIpKX1jYXNlIEUuQWxpcGF5On1yKG4pfSl9bW91bnRDYXJkVmVyaWZpY2F0aW9uRmllbGRzKGUpe3JldHVybiB3KHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFN0b3JlQ29uZmlnKCk7aWYoIXQpdGhyb3cgbmV3IHkocy5NaXNzaW5nQ2hlY2tvdXRDb25maWcpO2NvbnN0IGk9dC5wYXltZW50U2V0dGluZ3MuYmlncGF5QmFzZVVybCxuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5jcmVhdGVIb3N0ZWRGb3JtKGksZSk7cmV0dXJuIHlpZWxkIG4uYXR0YWNoKCksbn0pfXByb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCxpPSExLG49ITEpe3JldHVybiB3KHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighUyhlKSl0aHJvdyBlO2NvbnN0IHI9byhlLmJvZHkuZXJyb3JzLHtjb2RlOlwiYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWRcIn0pLHM9byhlLmJvZHkuZXJyb3JzLHtjb2RlOlwidGhyZWVfZF9zZWN1cmVfcmVxdWlyZWRcIn0pO2lmKHIpe2NvbnN0IHQ9ZS5ib2R5LmFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkO2lmKHQmJlwicmVkaXJlY3RfdG9fdXJsXCI9PT10LnR5cGUpcmV0dXJuIG5ldyBQcm9taXNlKCgpPT57dC5kYXRhLnJlZGlyZWN0X3VybCYmd2luZG93LmxvY2F0aW9uLnJlcGxhY2UodC5kYXRhLnJlZGlyZWN0X3VybCl9KX1pZihzKXtjb25zdCByPWUuYm9keS50aHJlZV9kc19yZXN1bHQudG9rZW4sbz0hMTtsZXQgcyxhPSExO3RyeXtzPXlpZWxkIHRoaXMuZ2V0U3RyaXBlSnMoKS5jb25maXJtQ2FyZFBheW1lbnQocil9Y2F0Y2goZSl7YT0hMH1pZihudWxsPT1zP3ZvaWQgMDpzLmVycm9yKXtpZih0aGlzLmlzQ2FuY2VsbGF0aW9uRXJyb3Iocy5lcnJvcikpdGhyb3cgbmV3IF87aWYodGhpcy5pc0F1dGhFcnJvcihzLmVycm9yKSl0aHJvdyBuZXcgYihQLkF1dGhGYWlsdXJlKTt0aHJvdyBuZXcgRXJyb3Iocy5lcnJvci5tZXNzYWdlKX1jb25zdCBkPXtjcmVkaXRfY2FyZF90b2tlbjp7dG9rZW46dGhpcy5nZXRQYXltZW50VG9rZW4obnVsbD09cz92b2lkIDA6cy5wYXltZW50SW50ZW50LHIsYSl9LHZhdWx0X3BheW1lbnRfaW5zdHJ1bWVudDppLGNvbmZpcm06b30sbD10aGlzLmJ1aWxkUGF5bWVudFBheWxvYWQodCxkLG4pO3RyeXtyZXR1cm4geWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobCl9Y2F0Y2goZSl7dGhyb3cgdGhpcy5oYW5kbGVFbXB0eVBheW1lbnRJbnRlbnRFcnJvcihlLG51bGw9PXM/dm9pZCAwOnMuZXJyb3IpfX10aHJvdyBlfSl9Z2V0UGF5bWVudFRva2VuKGUsdCxpKXtyZXR1cm4hZXx8aT90OmUuaWR9c2hvdWxkU2hvd1RTVkhvc3RlZEZvcm0oZSx0KXtyZXR1cm4gdGhpcy5pc0hvc3RlZEZpZWxkQXZhaWxhYmxlKCkmJnRoaXMuaXNIb3N0ZWRQYXltZW50Rm9ybUVuYWJsZWQoZSx0KX11bm1vdW50RWxlbWVudCgpe3RoaXMuc3RyaXBlRWxlbWVudCYmKHRoaXMuc3RyaXBlRWxlbWVudC51bm1vdW50KCksdGhpcy5zdHJpcGVFbGVtZW50PXZvaWQgMCl9fWNsYXNzIE0gZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUpe3N1cGVyKGV8fFwiVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSB0aGUgY2xpZW50IGxpYnJhcnkgb2YgYSBwYXltZW50IG1ldGhvZCBpcyBub3QgbG9hZGVkIG9yIHJlYWR5IHRvIGJlIHVzZWQuXCIpLHRoaXMubmFtZT1cIlBheW1lbnRNZXRob2RDbGllbnRVbmF2YWlsYWJsZUVycm9yXCIsdGhpcy50eXBlPVwicGF5bWVudF9tZXRob2RfY2xpZW50X3VuYXZhaWxhYmxlXCJ9fWNsYXNzIGt7Y29uc3RydWN0b3IoZSx0PXdpbmRvdyl7dGhpcy5zY3JpcHRMb2FkZXI9ZSx0aGlzLnN0cmlwZVdpbmRvdz10fWxvYWQoZSx0LGkpe3JldHVybiB0aGlzLnNjcmlwdExvYWRlci5sb2FkU2NyaXB0KFwiaHR0cHM6Ly9qcy5zdHJpcGUuY29tL3YzL1wiKS50aGVuKCgpPT57aWYoIXRoaXMuc3RyaXBlV2luZG93LlN0cmlwZSl0aHJvdyBuZXcgTTtyZXR1cm4gdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlKGUse3N0cmlwZUFjY291bnQ6dCxsb2NhbGU6aSxiZXRhczpbXCJwYXltZW50X2ludGVudF9iZXRhXzNcIixcImFsaXBheV9wbV9iZXRhXzFcIl0sYXBpVmVyc2lvbjpcIjIwMjAtMDMtMDI7YWxpcGF5X2JldGE9djFcIn0pfSl9fWNvbnN0IFQ9bCh0PT5uZXcgTyh0LG5ldyBrKGUoKSkpLFt7Z2F0ZXdheTpcInN0cmlwZXYzXCJ9XSk7dmFyIE4sUixELHosTCxVLFYseCxqLEI7IWZ1bmN0aW9uKGUpe2UuU0hJUFBJTkc9XCJzaGlwcGluZ1wiLGUuQklMTElORz1cImJpbGxpbmdcIn0oTnx8KE49e30pKSxmdW5jdGlvbihlKXtlLlNQTElUPVwic3BsaXRcIixlLkZVTEw9XCJmdWxsXCIsZS5PUkdBTklaQVRJT049XCJvcmdhbml6YXRpb25cIn0oUnx8KFI9e30pKSxmdW5jdGlvbihlKXtlLlNVQ0NFU1M9XCJzdWNjZXNzXCIsZS5FUlJPUj1cImVycm9yXCJ9KER8fChEPXt9KSksZnVuY3Rpb24oZSl7ZS5DcmVkaXRDYXJkPVwiY2FyZFwiLGUuTGluaz1cImxpbmtcIixlLkVQUz1cImVwc1wiLGUuR1JBQlBBWT1cImdyYWJwYXlcIixlLkJBTkNPTlRBQ1Q9XCJiYW5jb250YWN0XCIsZS5JREVBTD1cImlkZWFsXCIsZS5BTElQQVk9XCJhbGlwYXlcIixlLktMQVJOQT1cImtsYXJuYVwiLGUuT0NTPVwib3B0aW1pemVkX2NoZWNrb3V0XCJ9KHp8fCh6PXt9KSksZnVuY3Rpb24oZSl7ZS5ORVZFUj1cIm5ldmVyXCIsZS5BVVRPPVwiYXV0b1wiLGUuQUxXQVlTPVwiYWx3YXlzXCIsZS5QQVlNRU5UPVwicGF5bWVudFwiLGUuSUZfUkVRVUlSRUQ9XCJpZl9yZXF1aXJlZFwifShMfHwoTD17fSkpLGZ1bmN0aW9uKGUpe2UuVjM9XCJ2M1wiLGUuQUNBQ0lBPVwiYWNhY2lhXCIsZS5CQVNJTD1cImJhc2lsXCIsZS5DTE9WRVI9XCJjbG92ZXJcIn0oVXx8KFU9e30pKSxmdW5jdGlvbihlKXtlLlBBWU1FTlQ9XCJwYXltZW50XCIsZS5BVVRIRU5USUNBVElPTj1cImxpbmtBdXRoZW50aWNhdGlvblwiLGUuU0hJUFBJTkc9XCJhZGRyZXNzXCIsZS5FWFBSRVNTX0NIRUNLT1VUPVwiZXhwcmVzc0NoZWNrb3V0XCJ9KFZ8fChWPXt9KSksZnVuY3Rpb24oZSl7ZS5SRVFVSVJFU19QQVlNRU5UX01FVEhPRD1cInJlcXVpcmVzX3BheW1lbnRfbWV0aG9kXCIsZS5SRVFVSVJFU19DT05GSVJNQVRJT049XCJyZXF1aXJlc19jb25maXJtYXRpb25cIixlLlJFUVVJUkVTX0FDVElPTj1cInJlcXVpcmVzX2FjdGlvblwiLGUuUFJPQ0VTU0lORz1cInByb2Nlc3NpbmdcIixlLlNVQ0NFRURFRD1cInN1Y2NlZWRlZFwiLGUuQ0FOQ0VMRUQ9XCJjYW5jZWxlZFwifSh4fHwoeD17fSkpLGZ1bmN0aW9uKGUpe2UuQ0xJQ0s9XCJjbGlja1wiLGUuQ0hBTkdFPVwiY2hhbmdlXCIsZS5SRUFEWT1cInJlYWR5XCIsZS5TSElQUElOR19BRERSRVNTX0NIQU5HRT1cInNoaXBwaW5nYWRkcmVzc2NoYW5nZVwiLGUuU0hJUFBJTkdfUkFURV9DSEFOR0U9XCJzaGlwcGluZ3JhdGVjaGFuZ2VcIixlLkNPTkZJUk09XCJjb25maXJtXCIsZS5DQU5DRUw9XCJjYW5jZWxcIixlLkxPQURFUl9TVEFSVD1cImxvYWRlcnN0YXJ0XCJ9KGp8fChqPXt9KSksZnVuY3Rpb24oZSl7ZS5PTl9TRVNTSU9OPVwib25fc2Vzc2lvblwiLGUuT0ZGX1NFU1NJT049XCJvZmZfc2Vzc2lvblwifShCfHwoQj17fSkpO3ZhciBGPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIEd7Y29uc3RydWN0b3IoZSx0PXdpbmRvdyl7dGhpcy5zY3JpcHRMb2FkZXI9ZSx0aGlzLnN0cmlwZVdpbmRvdz10fWdldFN0cmlwZUNsaWVudChlLHQsaSxuLHIpe3JldHVybiBGKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZih0aGlzLnN0cmlwZVdpbmRvdy5iY1N0cmlwZUNsaWVudClyZXR1cm4gdGhpcy5zdHJpcGVXaW5kb3cuYmNTdHJpcGVDbGllbnQ7Y29uc3Qgbz15aWVsZCB0aGlzLmxvYWQoaSkse3N0cmlwZVB1Ymxpc2hhYmxlS2V5OnMsc3RyaXBlQ29ubmVjdGVkQWNjb3VudDphfT1lLGQ9byhzLE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30sYT97c3RyaXBlQWNjb3VudDphfTp7fSksdD97bG9jYWxlOnR9Ont9KSxuP3tiZXRhczpufTp7fSkscj97YXBpVmVyc2lvbjpyfTp7fSkpO3JldHVybiBPYmplY3QuYXNzaWduKHRoaXMuc3RyaXBlV2luZG93LHtiY1N0cmlwZUNsaWVudDpkfSksZH0pfWdldEVsZW1lbnRzKGUsdCl7cmV0dXJuIEYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2xldCBpPXRoaXMuc3RyaXBlV2luZG93LmJjU3RyaXBlRWxlbWVudHM7cmV0dXJuIGk/eWllbGQgdGhpcy51cGRhdGVTdHJpcGVFbGVtZW50cyh0KTooaT1lLmVsZW1lbnRzKHQpLE9iamVjdC5hc3NpZ24odGhpcy5zdHJpcGVXaW5kb3cse2JjU3RyaXBlRWxlbWVudHM6aX0pKSxpfSl9dXBkYXRlU3RyaXBlRWxlbWVudHMoZSl7cmV0dXJuIEYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHQ9dGhpcy5zdHJpcGVXaW5kb3cuYmNTdHJpcGVFbGVtZW50czt0JiYodC51cGRhdGUoZSkseWllbGQgdC5mZXRjaFVwZGF0ZXMoKSl9KX1nZXRDaGVja291dFNlc3Npb24oZSx0KXtyZXR1cm4gRih0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7bGV0IGk9dGhpcy5zdHJpcGVXaW5kb3cuYmNTdHJpcGVDaGVja291dFNlc3Npb247cmV0dXJuIGl8fChpPXlpZWxkIGUuaW5pdENoZWNrb3V0KHQpLE9iamVjdC5hc3NpZ24odGhpcy5zdHJpcGVXaW5kb3cse2JjU3RyaXBlQ2hlY2tvdXRTZXNzaW9uOml9KSksaX0pfWxvYWQoZSl7cmV0dXJuIEYodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCF0aGlzLnN0cmlwZVdpbmRvdy5TdHJpcGUmJih5aWVsZCB0aGlzLnNjcmlwdExvYWRlci5sb2FkU2NyaXB0KHRoaXMuZ2V0U2NyaXB0VXJsKGUpKSwhdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlKSl0aHJvdyBuZXcgTTtyZXR1cm4gdGhpcy5zdHJpcGVXaW5kb3cuU3RyaXBlfSl9Z2V0U2NyaXB0VXJsKGUpe3JldHVybiBlJiZlIT09VS5WMz9gaHR0cHM6Ly9qcy5zdHJpcGUuY29tLyR7ZX0vc3RyaXBlLmpzYDpcImh0dHBzOi8vanMuc3RyaXBlLmNvbS92My9cIn19Y2xhc3MgSCBleHRlbmRzIGN7Y29uc3RydWN0b3IoZSl7c3VwZXIoZXx8XCJVbmFibGUgdG8gcHJvY2VlZCBiZWNhdXNlIHRoZSBjbGllbnQgbGlicmFyeSBvZiBhIHBheW1lbnQgbWV0aG9kIGhhcyB0aHJvd24gYW4gdW5leHBlY3RlZCBlcnJvci5cIiksdGhpcy5uYW1lPVwiUGF5bWVudE1ldGhvZEZhaWxlZEVycm9yXCIsdGhpcy50eXBlPVwicGF5bWVudF9tZXRob2RfY2xpZW50X2ludmFsaWRcIn19dmFyIHE9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgV3tjb25zdHJ1Y3RvcihlLHQpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5pc01vdW50ZWQ9ITF9ZGVpbml0aWFsaXplKCl7dmFyIGU7bnVsbD09PShlPXRoaXMuY2hlY2tvdXRFdmVudHNVbnN1YnNjcmliZSl8fHZvaWQgMD09PWV8fGUuY2FsbCh0aGlzKSx0aGlzLmlzTW91bnRlZD0hMX1pbml0Q2hlY2tvdXRFdmVudHNTdWJzY3JpcHRpb24oZSx0LGksbil7dGhpcy5jaGVja291dEV2ZW50c1Vuc3Vic2NyaWJlPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJzY3JpYmUoKCk9PnEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3ZhciByO2NvbnN0IG89bnVsbD09bj92b2lkIDA6bi5nZXRFbGVtZW50KFYuUEFZTUVOVCk7aWYobyl7dHJ5e3lpZWxkIHRoaXMudXBkYXRlU3RyaXBlUGF5bWVudEludGVudChlLHQpfWNhdGNoKGUpe3JldHVybiB0aGlzLmlzTW91bnRlZCYmKG8udW5tb3VudCgpLHRoaXMuaXNNb3VudGVkPSExKSx2b2lkKGUgaW5zdGFuY2VvZiBFcnJvciYmKG51bGw9PT0ocj1pLm9uRXJyb3IpfHx2b2lkIDA9PT1yfHxyLmNhbGwoaSxlKSkpfXRoaXMuaXNNb3VudGVkfHwoeWllbGQgbnVsbD09bj92b2lkIDA6bi5mZXRjaFVwZGF0ZXMoKSx0aGlzLm1vdW50RWxlbWVudChvLGkuY29udGFpbmVySWQpKX19KSxlPT57dmFyIHQ7cmV0dXJuIG51bGw9PT0odD1lLmdldENoZWNrb3V0KCkpfHx2b2lkIDA9PT10P3ZvaWQgMDp0Lm91dHN0YW5kaW5nQmFsYW5jZX0sZT0+e3ZhciB0O3JldHVybiBudWxsPT09KHQ9ZS5nZXRDaGVja291dCgpKXx8dm9pZCAwPT09dD92b2lkIDA6dC5jb3Vwb25zfSl9bW91bnRFbGVtZW50KGUsdCl7ZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodCkmJihlLm1vdW50KGAjJHt0fWApLHRoaXMuaXNNb3VudGVkPSEwKX1tYXBBcHBlYXJhbmNlVmFyaWFibGVzKGUpe3JldHVybntjb2xvclByaW1hcnk6ZS5maWVsZElubmVyU2hhZG93LGNvbG9yQmFja2dyb3VuZDplLmZpZWxkQmFja2dyb3VuZCxjb2xvclRleHQ6ZS5sYWJlbFRleHQsY29sb3JEYW5nZXI6ZS5maWVsZEVycm9yVGV4dCxjb2xvclRleHRTZWNvbmRhcnk6ZS5sYWJlbFRleHQsY29sb3JUZXh0UGxhY2Vob2xkZXI6ZS5maWVsZFBsYWNlaG9sZGVyVGV4dCxjb2xvckljb246ZS5maWVsZFBsYWNlaG9sZGVyVGV4dH19bWFwSW5wdXRBcHBlYXJhbmNlUnVsZXMoZSl7cmV0dXJue2JvcmRlckNvbG9yOmUuZmllbGRCb3JkZXIsY29sb3I6ZS5maWVsZFRleHQsYm94U2hhZG93OmUuZmllbGRJbm5lclNoYWRvd319dGhyb3dTdHJpcGVFcnJvcihlKXtpZihcIm9iamVjdFwiPT10eXBlb2YodD1lKSYmbnVsbCE9PXQmJlwidHlwZVwiaW4gdCYmKHRoaXMudGhyb3dEaXNwbGF5YWJsZVN0cmlwZUVycm9yKGUpLHRoaXMuaXNDYW5jZWxsYXRpb25FcnJvcihlKSkpdGhyb3cgbmV3IF87dmFyIHQ7dGhyb3cgbmV3IEh9dGhyb3dEaXNwbGF5YWJsZVN0cmlwZUVycm9yKGUpe2lmKHQoW1wiY2FyZF9lcnJvclwiLFwiaW52YWxpZF9yZXF1ZXN0X2Vycm9yXCIsXCJ2YWxpZGF0aW9uX2Vycm9yXCJdLGUudHlwZSkpdGhyb3cgbmV3IEVycm9yKGUubWVzc2FnZSl9aXNDYW5jZWxsYXRpb25FcnJvcihlKXt2YXIgdDtjb25zdCBpPW51bGw9PT0odD1udWxsPT1lP3ZvaWQgMDplLnBheW1lbnRfaW50ZW50Lmxhc3RfcGF5bWVudF9lcnJvcil8fHZvaWQgMD09PXQ/dm9pZCAwOnQubWVzc2FnZTtyZXR1cm4hIWkmJi0xIT09aS5pbmRleE9mKFwiY2FuY2VsZWRcIil9dGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKXt0aHJvdyBuZXcgSChcIldlJ3ZlIHJlY2VpdmVkIHlvdXIgb3JkZXIgYW5kIGFyZSBwcm9jZXNzaW5nIHlvdXIgcGF5bWVudC4gT25jZSB0aGUgcGF5bWVudCBpcyB2ZXJpZmllZCwgeW91ciBvcmRlciB3aWxsIGJlIGNvbXBsZXRlZC4gV2Ugd2lsbCBzZW5kIHlvdSBhbiBlbWFpbCB3aGVuIGl0J3MgY29tcGxldGVkLiBQbGVhc2Ugbm90ZSwgdGhpcyBwcm9jZXNzIG1heSB0YWtlIGEgZmV3IG1pbnV0ZXMgZGVwZW5kaW5nIG9uIHRoZSBwcm9jZXNzaW5nIHRpbWVzIG9mIHlvdXIgY2hvc2VuIG1ldGhvZC5cIil9aXNQYXltZW50Q29tcGxldGVkKGUsdCl7cmV0dXJuIHEodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksbj1pLmdldFBheW1lbnRNZXRob2RPclRocm93KGUpLHtmZWF0dXJlczpyfT1pLmdldFN0b3JlQ29uZmlnT3JUaHJvdygpLmNoZWNrb3V0U2V0dGluZ3M7aWYoIW4uY2xpZW50VG9rZW58fCF0fHwhcltcIlBJLTYyNi5CbG9ja191bm5lY2Vzc2FyeV9wYXltZW50X2NvbmZpcm1hdGlvbl9mb3JfU3RyaXBlVVBFXCJdKXJldHVybiExO2NvbnN0e3BheW1lbnRJbnRlbnQ6b309eWllbGQgdC5yZXRyaWV2ZVBheW1lbnRJbnRlbnQobi5jbGllbnRUb2tlbik7cmV0dXJuKG51bGw9PW8/dm9pZCAwOm8uc3RhdHVzKT09PXguU1VDQ0VFREVEfSl9bWFwU3RyaXBlUGF5bWVudERhdGEoZSx0LGk9ITEpe2NvbnN0IG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0QmlsbGluZ0FkZHJlc3MoKSx7Zmlyc3ROYW1lOnI9XCJcIixsYXN0TmFtZTpvPVwiXCIsZW1haWw6ZD1cIlwifT1ufHx7fSxsPXRoaXMuX21hcFN0cmlwZUFkZHJlc3Mobik7aWYoIWUpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCEoZCYmbCYmbC5jaXR5JiZsLmNvdW50cnkmJnImJm8pKXRocm93IG5ldyB5KHMuTWlzc2luZ0JpbGxpbmdBZGRyZXNzKTtyZXR1cm57ZWxlbWVudHM6ZSxyZWRpcmVjdDpMLklGX1JFUVVJUkVELGNvbmZpcm1QYXJhbXM6T2JqZWN0LmFzc2lnbih7cGF5bWVudF9tZXRob2RfZGF0YTpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30saT97YWxsb3dfcmVkaXNwbGF5OlwiYWx3YXlzXCJ9Ont9KSx7YmlsbGluZ19kZXRhaWxzOntlbWFpbDpkLGFkZHJlc3M6bCxuYW1lOmAke3J9ICR7b31gfX0pfSx0JiZ7cmV0dXJuX3VybDp0fSl9fWlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUpe3JldHVybiBvKGUse2NvZGU6XCJhZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZFwifSl9aXNSZWRpcmVjdEFjdGlvbihlKXtjb25zdHt0eXBlOnQsZGF0YTp7cmVkaXJlY3RfdXJsOml9fT1lO3JldHVyblwicmVkaXJlY3RfdG9fdXJsXCI9PT10JiYhIWl9aXNPblBhZ2VBZGRpdGlvbmFsQWN0aW9uKGUpe2NvbnN0e3R5cGU6dCxkYXRhOnt0b2tlbjppfX09ZTtyZXR1cm5cImFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVzX3BheW1lbnRfbWV0aG9kXCI9PT10JiYhIWl9dXBkYXRlU3RyaXBlUGF5bWVudEludGVudChlLHQpe3JldHVybiBxKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBpPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChlLHtwYXJhbXM6e21ldGhvZDp0fX0pLHtjbGllbnRUb2tlbjpufT1pLmdldFBheW1lbnRNZXRob2RPclRocm93KHQpO24mJnRoaXMuc2NyaXB0TG9hZGVyLnVwZGF0ZVN0cmlwZUVsZW1lbnRzKHtjbGllbnRTZWNyZXQ6bn0pfSl9Z2V0U3RyaXBlSnNWZXJzaW9uKGUpe3JldHVybiBlLnVzZU5ld1N0cmlwZUpzVmVyc2lvbj9VLkNMT1ZFUjpVLlYzfV9tYXBTdHJpcGVBZGRyZXNzKGUpe2lmKGUpe2NvbnN0e2NpdHk6dCxhZGRyZXNzMTppLGFkZHJlc3MyOm4sY291bnRyeUNvZGU6cixwb3N0YWxDb2RlOm8sc3RhdGVPclByb3ZpbmNlQ29kZTpzfT1lO3JldHVybiBPYmplY3QuYXNzaWduKHtjaXR5OnQsY291bnRyeTpyLHBvc3RhbF9jb2RlOm8sbGluZTE6aSxsaW5lMjpufSxzP3tzdGF0ZTpzfTp7fSl9dGhyb3cgbmV3IHkocy5NaXNzaW5nQmlsbGluZ0FkZHJlc3MpfX1jb25zdCBZPXtib2R5Ont9LGhlYWRlcnM6e30sc3RhdHVzOjB9O2NsYXNzICQgZXh0ZW5kcyBje2NvbnN0cnVjdG9yKGUse21lc3NhZ2U6dCxlcnJvcnM6aX09e30pe2NvbnN0e2JvZHk6bixoZWFkZXJzOnIsc3RhdHVzOm99PWV8fFk7c3VwZXIodHx8XCJBbiB1bmV4cGVjdGVkIGVycm9yIGhhcyBvY2N1cnJlZC5cIiksdGhpcy5uYW1lPVwiUmVxdWVzdEVycm9yXCIsdGhpcy50eXBlPVwicmVxdWVzdFwiLHRoaXMuYm9keT1uLHRoaXMuaGVhZGVycz1yLHRoaXMuc3RhdHVzPW8sdGhpcy5lcnJvcnM9aXx8W119fWZ1bmN0aW9uIEooZSl7cmV0dXJuXCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcImluaXRpYWxpemF0aW9uRGF0YVwiaW4gZSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEmJm51bGwhPT1lLmluaXRpYWxpemF0aW9uRGF0YSYmXCJvYmplY3RcIj09dHlwZW9mIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZcInN0cmlwZVB1Ymxpc2hhYmxlS2V5XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzdHJpcGVDb25uZWN0ZWRBY2NvdW50XCJpbiBlLmluaXRpYWxpemF0aW9uRGF0YSYmXCJzaG9wcGVyTGFuZ3VhZ2VcImluIGUuaW5pdGlhbGl6YXRpb25EYXRhJiZ2b2lkIDAhPT1lLmluaXRpYWxpemF0aW9uRGF0YS5zdHJpcGVQdWJsaXNoYWJsZUtleSYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc3RyaXBlQ29ubmVjdGVkQWNjb3VudCYmdm9pZCAwIT09ZS5pbml0aWFsaXphdGlvbkRhdGEuc2hvcHBlckxhbmd1YWdlfWNvbnN0IEs9e2FyOltcImFyXCJdLGJnOltcImJnXCJdLGNzOltcImNzXCJdLGRhOltcImRhXCJdLGRlOltcImRlXCJdLGVsOltcImVsXCJdLGVuOltcImVuXCIsXCJlbi1HQlwiXSxlczpbXCJlc1wiLFwiZXMtNDE5XCJdLGV0OltcImV0XCJdLGZpOltcImZpXCJdLGZpbDpbXCJmaWxcIl0sZnI6W1wiZnJcIixcImZyLUNBXCJdLGhlOltcImhlXCJdLGhyOltcImhyXCJdLGh1OltcImh1XCJdLGlkOltcImlkXCJdLGl0OltcIml0XCJdLGphOltcImphXCJdLGtvOltcImtvXCJdLGx0OltcImx0XCJdLGx2OltcImx2XCJdLG1zOltcIm1zXCJdLG10OltcIm10XCJdLG5iOltcIm5iXCJdLG5sOltcIm5sXCJdLHBsOltcInBsXCJdLHB0OltcInB0XCIsXCJwdC1CUlwiXSxybzpbXCJyb1wiXSxydTpbXCJydVwiXSxzazpbXCJza1wiXSxzbDpbXCJzbFwiXSxzdjpbXCJzdlwiXSx0aDpbXCJ0aFwiXSx0cjpbXCJ0clwiXSx2aTpbXCJ2aVwiXSx6aDpbXCJ6aFwiLFwiemgtSEtcIixcInpoLVRXXCJdfTtmdW5jdGlvbiBaKGUpe2NvbnN0W3QsaV09ZS5yZXBsYWNlKC9fL2csXCItXCIpLnRvTG93ZXJDYXNlKCkuc3BsaXQoXCItXCIpLG49S1t0XTtpZighbilyZXR1cm5cImF1dG9cIjtjb25zdCByPWk/YCR7dH0tJHtpLnRvVXBwZXJDYXNlKCl9YDp0O3JldHVybiBuLmluZGV4T2Yocik+LTE/cjpuWzBdfWNvbnN0IFE9W1wicGF5bWVudF9lbGVtZW50X2JldGFfMlwiLFwiYWxpcGF5X3BtX2JldGFfMVwiLFwibGlua19kZWZhdWx0X2ludGVncmF0aW9uX2JldGFfMVwiLFwic2hpcHBpbmdfYWRkcmVzc19lbGVtZW50X2JldGFfMVwiLFwiYWRkcmVzc19lbGVtZW50X2JldGFfMVwiXSxYPVwiMjAyMC0wMy0wMjthbGlwYXlfYmV0YT12MTtsaW5rX2JldGE9djFcIjtmdW5jdGlvbiBlZShlKXtyZXR1cm5cInN0cmlwZUxpbmtBdXRoZW50aWNhdGlvblN0YXRlXCJpbiBlfXZhciB0ZT1mdW5jdGlvbihlLHQsaSxuKXtyZXR1cm4gbmV3KGl8fChpPVByb21pc2UpKShmdW5jdGlvbihyLG8pe2Z1bmN0aW9uIHMoZSl7dHJ5e2Qobi5uZXh0KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtkKG4udGhyb3coZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGQoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KHQ9ZS52YWx1ZSx0IGluc3RhbmNlb2YgaT90Om5ldyBpKGZ1bmN0aW9uKGUpe2UodCl9KSkudGhlbihzLGEpfWQoKG49bi5hcHBseShlLHR8fFtdKSkubmV4dCgpKX0pfTtjbGFzcyBpZXtjb25zdHJ1Y3RvcihlLHQsaSl7dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlPWUsdGhpcy5zY3JpcHRMb2FkZXI9dCx0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZT1pfWluaXRpYWxpemUoZSl7cmV0dXJuIHRlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtzdHJpcGV1cGU6dCxtZXRob2RJZDppLGdhdGV3YXlJZDpufT1lO2lmKCEobnVsbD09dD92b2lkIDA6dC5jb250YWluZXJJZCkpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2lmKCFuKXRocm93IG5ldyB1KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBwYXltZW50IGJlY2F1c2UgXCJnYXRld2F5SWRcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7cmV0dXJuIHRoaXMuX2xvYWRTdHJpcGVFbGVtZW50KHQsbixpKS5jYXRjaChlPT57dmFyIGk7cmV0dXJuIG51bGw9PT0oaT10Lm9uRXJyb3IpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNhbGwodCxlKX0pLHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmluaXRDaGVja291dEV2ZW50c1N1YnNjcmlwdGlvbihuLGksdCx0aGlzLl9zdHJpcGVFbGVtZW50cyksUHJvbWlzZS5yZXNvbHZlKCl9KX1leGVjdXRlKGUsdCl7cmV0dXJuIHRlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtwYXltZW50Oml9PWUsbj1mdW5jdGlvbihlLHQpe3ZhciBpPXt9O2Zvcih2YXIgbiBpbiBlKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLG4pJiZ0LmluZGV4T2Yobik8MCYmKGlbbl09ZVtuXSk7aWYobnVsbCE9ZSYmXCJmdW5jdGlvblwiPT10eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyl7dmFyIHI9MDtmb3Iobj1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3I8bi5sZW5ndGg7cisrKXQuaW5kZXhPZihuW3JdKTwwJiZPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZSxuW3JdKSYmKGlbbltyXV09ZVtuW3JdXSl9cmV0dXJuIGl9KGUsW1wicGF5bWVudFwiXSk7aWYoIWl8fCFpLnBheW1lbnREYXRhKXRocm93IG5ldyBoKFtcInBheW1lbnQucGF5bWVudERhdGFcIl0pO2lmKCF0aGlzLl9zdHJpcGVVUEVDbGllbnQpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e3BheW1lbnREYXRhOnIsbWV0aG9kSWQ6byxnYXRld2F5SWQ6c309aSx7c2hvdWxkU2F2ZUluc3RydW1lbnQ6ZD0hMSxzaG91bGRTZXRBc0RlZmF1bHRJbnN0cnVtZW50Omw9ITF9PXAocik/cjp7fSxjPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtpc1N0b3JlQ3JlZGl0QXBwbGllZDp1fT1jLmdldENoZWNrb3V0T3JUaHJvdygpLHk9Yy5nZXRQYXltZW50UHJvdmlkZXJDdXN0b21lck9yVGhyb3coKSxnPShlZSh5KT95Ont9KS5zdHJpcGVMaW5rQXV0aGVudGljYXRpb25TdGF0ZTtpZih1JiYoeWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmFwcGx5U3RvcmVDcmVkaXQodSkpLHMpe3lpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVN0cmlwZVBheW1lbnRJbnRlbnQocyxvKTtjb25zdHtlbWFpbDplfT1jLmdldEN1c3RvbWVyT3JUaHJvdygpO2lmKHZvaWQgMCE9PWcmJiFlKXtjb25zdCBlPWMuZ2V0QmlsbGluZ0FkZHJlc3NPclRocm93KCk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZUJpbGxpbmdBZGRyZXNzKGUpfX1pZih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIobix0KSxtKHIpKXtjb25zdHtpbnN0cnVtZW50SWQ6ZX09cjtyZXR1cm4gdm9pZCh5aWVsZCB0aGlzLl9leGVjdXRlV2l0aFZhdWx0ZWQoaS5tZXRob2RJZCxlLGwpKX15aWVsZCB0aGlzLl9leGVjdXRlV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihpLm1ldGhvZElkLCFnJiZkLGwpfSl9ZmluYWxpemUoKXtyZXR1cm4gUHJvbWlzZS5yZWplY3QobmV3IGcpfWRlaW5pdGlhbGl6ZSgpe3ZhciBlLHQ7cmV0dXJuIG51bGw9PT0odD1udWxsPT09KGU9dGhpcy5fc3RyaXBlRWxlbWVudHMpfHx2b2lkIDA9PT1lP3ZvaWQgMDplLmdldEVsZW1lbnQoVi5QQVlNRU5UKSl8fHZvaWQgMD09PXR8fHQudW5tb3VudCgpLHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmRlaW5pdGlhbGl6ZSgpLHRoaXMuX3N0cmlwZUVsZW1lbnRzPXZvaWQgMCx0aGlzLl9zdHJpcGVVUEVDbGllbnQ9dm9pZCAwLFByb21pc2UucmVzb2x2ZSgpfV9leGVjdXRlV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihlLHQsaSl7cmV0dXJuIHRlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjbGllbnRUb2tlbjpyfT1uLmdldFBheW1lbnRNZXRob2RPclRocm93KGUpLG89dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQoZSxyfHxcIlwiLHQsaSk7dHJ5e3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG8pfWNhdGNoKG4pe3lpZWxkIHRoaXMuX3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihuLGUsdCxpKX19KX1fZXhlY3V0ZVdpdGhWYXVsdGVkKGUsdCxpKXt2YXIgbjtyZXR1cm4gdGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHI9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksbz1yLmdldFBheW1lbnRNZXRob2RPclRocm93KGUpLHM9bnVsbD09PShuPXIuZ2V0Q2FydCgpKXx8dm9pZCAwPT09bj92b2lkIDA6bi5pZDt0cnl7Y29uc3Qgbj17bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTp7Zm9ybWF0dGVkUGF5bG9hZDp7Y2FydF9pZDpzLGJpZ3BheV90b2tlbjp7dG9rZW46dH0sY29uZmlybTohMSxjbGllbnRfdG9rZW46by5jbGllbnRUb2tlbixzZXRfYXNfZGVmYXVsdF9zdG9yZWRfaW5zdHJ1bWVudDppfX19O3JldHVybiB5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChuKX1jYXRjaCh0KXtyZXR1cm4gdGhpcy5fcHJvY2Vzc1ZhdWx0ZWRBZGRpdGlvbmFsQWN0aW9uKHQsZSxpKX19KX1fbG9hZFN0cmlwZUVsZW1lbnQoZSx0LGkpe3JldHVybiB0ZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7Y29udGFpbmVySWQ6bixzdHlsZTpyLHJlbmRlcjpvLGluaXRTdHJpcGVFbGVtZW50VXBkYXRlVHJpZ2dlcjphfT1lLGQ9eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRQYXltZW50TWV0aG9kKHQse3BhcmFtczp7bWV0aG9kOml9fSksbD1kLmdldFBheW1lbnRNZXRob2RPclRocm93KGkpO2lmKCFKKGwpKXRocm93IG5ldyB5KHMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2NvbnN0e2NsaWVudFRva2VuOmMsaW5pdGlhbGl6YXRpb25EYXRhOnV9PWwse3Nob3BwZXJMYW5ndWFnZTpoLGFsbG93UmVkaXNwbGF5Rm9yU3RvcmVkSW5zdHJ1bWVudHM6cD0hMSxlbmFibGVMaW5rOm19PXU7aWYodGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cz1wLCFjKXRocm93IG5ldyB5KHMuTWlzc2luZ1BheW1lbnRNZXRob2QpO2xldCBnO2lmKHRoaXMuX3N0cmlwZVVQRUNsaWVudD15aWVsZCB0aGlzLl9sb2FkU3RyaXBlSnModSksdGhpcy5faXNTdHJpcGVFbGVtZW50VXBkYXRlRW5hYmxlZD1cImZ1bmN0aW9uXCI9PXR5cGVvZiBhLHIpe2NvbnN0IGU9cjtnPXt2YXJpYWJsZXM6dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubWFwQXBwZWFyYW5jZVZhcmlhYmxlcyhyKSxydWxlczp7XCIuSW5wdXRcIjp0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBJbnB1dEFwcGVhcmFuY2VSdWxlcyhlKX19fXRoaXMuX3N0cmlwZUVsZW1lbnRzPXlpZWxkIHRoaXMuc2NyaXB0TG9hZGVyLmdldEVsZW1lbnRzKHRoaXMuX3N0cmlwZVVQRUNsaWVudCx7Y2xpZW50U2VjcmV0OmMsbG9jYWxlOlooaCksYXBwZWFyYW5jZTpnfSk7Y29uc3R7Z2V0QmlsbGluZ0FkZHJlc3M6dixnZXRTaGlwcGluZ0FkZHJlc3M6U309ZCx7cG9zdGFsQ29kZTpffT1TKCl8fHYoKXx8e30sZj10aGlzLl9zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KFYuUEFZTUVOVCl8fHRoaXMuX3N0cmlwZUVsZW1lbnRzLmNyZWF0ZShWLlBBWU1FTlQsT2JqZWN0LmFzc2lnbih7ZmllbGRzOntiaWxsaW5nRGV0YWlsczp7ZW1haWw6TC5ORVZFUixhZGRyZXNzOntjb3VudHJ5OkwuTkVWRVIsY2l0eTpMLk5FVkVSLHBvc3RhbENvZGU6Xz9MLk5FVkVSOkwuQVVUT319fSx3YWxsZXRzOnthcHBsZVBheTpMLk5FVkVSLGdvb2dsZVBheTpMLk5FVkVSLGxpbms6bT9MLkFVVE86TC5ORVZFUn19LHRoaXMuX2dldFN0cmlwZUVsZW1lbnRUZXJtcygpKSk7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubW91bnRFbGVtZW50KGYsbiksZi5vbihqLlJFQURZLCgpPT57bygpfSksZi5vbihqLkNIQU5HRSxlPT57KG51bGw9PWU/dm9pZCAwOmUudmFsdWUpJiZcInR5cGVcImluIGUudmFsdWUmJnRoaXMuX3VwZGF0ZVN0cmlwZUxpbmtTdGF0ZUJ5RWxlbWVudFR5cGUoZS52YWx1ZS50eXBlKX0pLHRoaXMuX2lzU3RyaXBlRWxlbWVudFVwZGF0ZUVuYWJsZWQmJihudWxsPT1hfHxhKHRoaXMuX3VwZGF0ZVN0cmlwZUVsZW1lbnQuYmluZCh0aGlzKSkpfSl9X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uV2l0aFN0cmlwZUNvbmZpcm1hdGlvbihlLHQsaT0hMSxuPSExKXtyZXR1cm4gdGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCFTKGUpfHwhdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNBZGRpdGlvbmFsQWN0aW9uRXJyb3IoZS5ib2R5LmVycm9ycykpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlVVBFQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0e2RhdGE6cn09ZS5ib2R5LmFkZGl0aW9uYWxfYWN0aW9uX3JlcXVpcmVkLHt0b2tlbjpvfT1yLHtwYXltZW50SW50ZW50OnN9PXlpZWxkIHRoaXMuX2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyh0LHIpLGQ9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCwobnVsbD09cz92b2lkIDA6cy5pZCl8fG8saSxuKTt0cnl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoZCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbjtyZXR1cm4gdGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOnIscmVkaXJlY3RfdXJsOm99PXQscz10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLl9zdHJpcGVFbGVtZW50cyxvLCEhdGhpcy5fYWxsb3dSZWRpc3BsYXlGb3JTdG9yZWRJbnN0cnVtZW50cyk7bGV0IGE7dHJ5e2NvbnN0IHQ9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZChlLHRoaXMuX3N0cmlwZVVQRUNsaWVudCkpP3lpZWxkIG51bGw9PT0obj10aGlzLl9zdHJpcGVVUEVDbGllbnQpfHx2b2lkIDA9PT1uP3ZvaWQgMDpuLnJldHJpZXZlUGF5bWVudEludGVudChyfHxcIlwiKTp5aWVsZCBudWxsPT09KGk9dGhpcy5fc3RyaXBlVVBFQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudChzKTtpZihhPW51bGw9PXQ/dm9pZCAwOnQuZXJyb3IsYXx8IShudWxsPT10P3ZvaWQgMDp0LnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBIO3JldHVybiB0fWNhdGNoKGUpe3RoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3IoYSl9fSl9X3Byb2Nlc3NWYXVsdGVkQWRkaXRpb25hbEFjdGlvbihlLHQsaT0hMSl7dmFyIG47cmV0dXJuIHRlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighdHx8IVMoZSl8fCFvKGUuYm9keS5lcnJvcnMse2NvZGU6XCJ0aHJlZV9kX3NlY3VyZV9yZXF1aXJlZFwifSkpdGhyb3cgZTtpZighdGhpcy5fc3RyaXBlVVBFQ2xpZW50fHwhdGhpcy5fc3RyaXBlRWxlbWVudHMpdGhyb3cgbmV3IHYoYS5QYXltZW50Tm90SW5pdGlhbGl6ZWQpO2NvbnN0IHI9ZS5ib2R5LnRocmVlX2RzX3Jlc3VsdC50b2tlbjtsZXQgcyxkPSExO3RyeXtzPXlpZWxkIHRoaXMuX3N0cmlwZVVQRUNsaWVudC5jb25maXJtQ2FyZFBheW1lbnQocil9Y2F0Y2goZSl7dHJ5e3M9eWllbGQgdGhpcy5fc3RyaXBlVVBFQ2xpZW50LnJldHJpZXZlUGF5bWVudEludGVudChyKX1jYXRjaChlKXtkPSEwfX1pZigobnVsbD09cz92b2lkIDA6cy5lcnJvcikmJnRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3Iocy5lcnJvciksIShudWxsPT1zP3ZvaWQgMDpzLnBheW1lbnRJbnRlbnQpJiYhZCl0aHJvdyBuZXcgJDtjb25zdCBsPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQsZD9yOm51bGw9PT0obj1udWxsPT1zP3ZvaWQgMDpzLnBheW1lbnRJbnRlbnQpfHx2b2lkIDA9PT1uP3ZvaWQgMDpuLmlkLCExLGkpO3JldHVybiB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChsKX0pfV9sb2FkU3RyaXBlSnMoZSl7cmV0dXJuIHRlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZih0aGlzLl9zdHJpcGVVUEVDbGllbnQpcmV0dXJuIHRoaXMuX3N0cmlwZVVQRUNsaWVudDtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpO3JldHVybiB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQoZSx0LmdldENhcnRMb2NhbGUoKSxVLlYzLFEsWCl9KX1fZ2V0UGF5bWVudFBheWxvYWQoZSx0LGk9ITEsbj0hMSl7dmFyIHI7cmV0dXJue21ldGhvZElkOmUscGF5bWVudERhdGE6e2Zvcm1hdHRlZFBheWxvYWQ6e2NhcnRfaWQ6KG51bGw9PT0ocj10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCkpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmlkKXx8XCJcIixjcmVkaXRfY2FyZF90b2tlbjp7dG9rZW46dH0sY29uZmlybTohMSx2YXVsdF9wYXltZW50X2luc3RydW1lbnQ6aSxzZXRfYXNfZGVmYXVsdF9zdG9yZWRfaW5zdHJ1bWVudDpufX19fV91cGRhdGVTdHJpcGVFbGVtZW50KHtzaG91bGRTaG93VGVybXM6ZX0pe3ZhciB0O2NvbnN0IGk9bnVsbD09PSh0PXRoaXMuX3N0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09dD92b2lkIDA6dC5nZXRFbGVtZW50KFYuUEFZTUVOVCk7bnVsbD09aXx8aS51cGRhdGUoT2JqZWN0LmFzc2lnbih7fSx0aGlzLl9nZXRTdHJpcGVFbGVtZW50VGVybXMoZSkpKX1fZ2V0U3RyaXBlRWxlbWVudFRlcm1zKGUpe2xldCB0PUwuQVVUTztyZXR1cm4gdGhpcy5faXNTdHJpcGVFbGVtZW50VXBkYXRlRW5hYmxlZCYmKHQ9ZT9MLkFVVE86TC5ORVZFUikse3Rlcm1zOntjYXJkOnR9fX1fdXBkYXRlU3RyaXBlTGlua1N0YXRlQnlFbGVtZW50VHlwZShlKXtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFBheW1lbnRQcm92aWRlckN1c3RvbWVyT3JUaHJvdygpLGk9ZT09PXouTGluazshZWUodCkmJmkmJnRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVQYXltZW50UHJvdmlkZXJDdXN0b21lcih7c3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGU6aX0pfX1jb25zdCBuZT1sKHQ9Pntjb25zdCBpPW5ldyBHKGUoKSk7cmV0dXJuIG5ldyBpZSh0LGksbmV3IFcodCxpKSl9LFt7Z2F0ZXdheTpcInN0cmlwZXVwZVwifSx7Z2F0ZXdheTpcInN0cmlwZXVwZVwiLGlkOlwia2xhcm5hXCJ9XSkscmU9ZT0+XCJvYmplY3RcIj09dHlwZW9mIGUmJm51bGwhPT1lJiZcInZhbHVlXCJpbiBlJiZcImNvbGxhcHNlZFwiaW4gZTt2YXIgb2U9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3Mgc2V7Y29uc3RydWN0b3IoZSx0LGkpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2U9aX1pbml0aWFsaXplKGUpe3ZhciB0O3JldHVybiBvZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7c3RyaXBlb2NzOmksbWV0aG9kSWQ6bixnYXRld2F5SWQ6cn09ZTtpZighKG51bGw9PWk/dm9pZCAwOmkuY29udGFpbmVySWQpKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtpZighcil0aHJvdyBuZXcgdSgnVW5hYmxlIHRvIGluaXRpYWxpemUgcGF5bWVudCBiZWNhdXNlIFwiZ2F0ZXdheUlkXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO3RyeXt5aWVsZCB0aGlzLl9pbml0aWFsaXplU3RyaXBlRWxlbWVudChpLHIsbil9Y2F0Y2goZSl7ZSBpbnN0YW5jZW9mIEVycm9yJiYobnVsbD09PSh0PWkub25FcnJvcil8fHZvaWQgMD09PXR8fHQuY2FsbChpLGUpKX10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pbml0Q2hlY2tvdXRFdmVudHNTdWJzY3JpcHRpb24ocixuLGksdGhpcy5zdHJpcGVFbGVtZW50cyl9KX1leGVjdXRlKGUsdCl7cmV0dXJuIG9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHtwYXltZW50Oml9PWUsbj1mdW5jdGlvbihlLHQpe3ZhciBpPXt9O2Zvcih2YXIgbiBpbiBlKU9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChlLG4pJiZ0LmluZGV4T2Yobik8MCYmKGlbbl09ZVtuXSk7aWYobnVsbCE9ZSYmXCJmdW5jdGlvblwiPT10eXBlb2YgT2JqZWN0LmdldE93blByb3BlcnR5U3ltYm9scyl7dmFyIHI9MDtmb3Iobj1PYmplY3QuZ2V0T3duUHJvcGVydHlTeW1ib2xzKGUpO3I8bi5sZW5ndGg7cisrKXQuaW5kZXhPZihuW3JdKTwwJiZPYmplY3QucHJvdG90eXBlLnByb3BlcnR5SXNFbnVtZXJhYmxlLmNhbGwoZSxuW3JdKSYmKGlbbltyXV09ZVtuW3JdXSl9cmV0dXJuIGl9KGUsW1wicGF5bWVudFwiXSkse21ldGhvZElkOnIsZ2F0ZXdheUlkOm99PWl8fHt9O2lmKCF0aGlzLnN0cmlwZUNsaWVudCl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7aWYoIW98fCFyKXRocm93IG5ldyB1KCdVbmFibGUgdG8gaW5pdGlhbGl6ZSBwYXltZW50IGJlY2F1c2UgXCJnYXRld2F5SWRcIiBvciBcIm1ldGhvZElkXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO2NvbnN0e2lzU3RvcmVDcmVkaXRBcHBsaWVkOnN9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENoZWNrb3V0T3JUaHJvdygpO3MmJih5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuYXBwbHlTdG9yZUNyZWRpdChzKSkseWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlU3RyaXBlUGF5bWVudEludGVudChvLHIpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcihuLHQpO2NvbnN0e2NsaWVudFRva2VuOmR9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldFBheW1lbnRNZXRob2RPclRocm93KHIsbyksbD10aGlzLl9nZXRQYXltZW50UGF5bG9hZChyLGR8fFwiXCIpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChsKX1jYXRjaChlKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHIpfX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBnKX1kZWluaXRpYWxpemUoKXt2YXIgZTtjb25zdCB0PW51bGw9PT0oZT10aGlzLnN0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KFYuUEFZTUVOVCk7cmV0dXJuIG51bGw9PXR8fHQudW5tb3VudCgpLG51bGw9PXR8fHQuZGVzdHJveSgpLHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmRlaW5pdGlhbGl6ZSgpLHRoaXMuc3RyaXBlRWxlbWVudHM9dm9pZCAwLHRoaXMuc3RyaXBlQ2xpZW50PXZvaWQgMCxQcm9taXNlLnJlc29sdmUoKX1faW5pdGlhbGl6ZVN0cmlwZUVsZW1lbnQoZSx0LGkpe3JldHVybiBvZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7bGV0IG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSx0KTtpZigobnVsbD09bj92b2lkIDA6bi5jbGllbnRUb2tlbil8fChuPSh5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2QodCx7cGFyYW1zOnttZXRob2Q6aX19KSkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSx0KSksIUoobikpdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7Y2xpZW50VG9rZW46cixpbml0aWFsaXphdGlvbkRhdGE6b309bix7c2hvcHBlckxhbmd1YWdlOmEsY3VzdG9tZXJTZXNzaW9uVG9rZW46ZCxlbmFibGVMaW5rOmx9PW87aWYoIXIpdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7dGhpcy5zdHJpcGVDbGllbnQ9eWllbGQgdGhpcy5fbG9hZFN0cmlwZUpzKG8pO2NvbnN0e2FwcGVhcmFuY2U6Yyxjb250YWluZXJJZDp1LGZvbnRzOmgsbGF5b3V0OnAscmVuZGVyOm0scGF5bWVudE1ldGhvZFNlbGVjdDpnLGhhbmRsZUNsb3NlUGF5bWVudE1ldGhvZDp2LHRvZ2dsZVByZWxvYWRlcjpTfT1lO3RoaXMuc3RyaXBlRWxlbWVudHM9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0RWxlbWVudHModGhpcy5zdHJpcGVDbGllbnQse2NsaWVudFNlY3JldDpyLGN1c3RvbWVyU2Vzc2lvbkNsaWVudFNlY3JldDpkLGxvY2FsZTpaKGEpLGFwcGVhcmFuY2U6Yyxmb250czpofSk7Y29uc3R7Z2V0QmlsbGluZ0FkZHJlc3M6XyxnZXRTaGlwcGluZ0FkZHJlc3M6Zn09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksQz1fKCkse3Bvc3RhbENvZGU6RX09ZigpfHxDfHx7fSxJPXRoaXMuc3RyaXBlRWxlbWVudHMuZ2V0RWxlbWVudChWLlBBWU1FTlQpfHx0aGlzLnN0cmlwZUVsZW1lbnRzLmNyZWF0ZShWLlBBWU1FTlQse2ZpZWxkczp7YmlsbGluZ0RldGFpbHM6e2VtYWlsOkwuTkVWRVIsYWRkcmVzczp7Y291bnRyeTpMLk5FVkVSLGNpdHk6TC5ORVZFUixwb3N0YWxDb2RlOkU/TC5ORVZFUjpMLkFVVE99fX0sd2FsbGV0czp7YXBwbGVQYXk6TC5ORVZFUixnb29nbGVQYXk6TC5ORVZFUixsaW5rOmw/TC5BVVRPOkwuTkVWRVJ9LGxheW91dDpwLHNhdmVQYXltZW50TWV0aG9kOnttYXhWaXNpYmxlUGF5bWVudE1ldGhvZHM6MjB9LGRlZmF1bHRWYWx1ZXM6e2JpbGxpbmdEZXRhaWxzOntlbWFpbDoobnVsbD09Qz92b2lkIDA6Qy5lbWFpbCl8fFwiXCJ9fX0pO3RoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLm1vdW50RWxlbWVudChJLHUpLEkub24oai5MT0FERVJfU1RBUlQsKCk9PntudWxsPT1TfHxTKCExKX0pLEkub24oai5SRUFEWSwoKT0+e20oKX0pLEkub24oai5DSEFOR0UsZT0+e3RoaXMuX29uU3RyaXBlRWxlbWVudENoYW5nZShlLHQsaSxnKX0pLG51bGw9PXZ8fHYodGhpcy5fY29sbGFwc2VTdHJpcGVFbGVtZW50LmJpbmQodGhpcykpfSl9X2xvYWRTdHJpcGVKcyhlKXtyZXR1cm4gb2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKHRoaXMuc3RyaXBlQ2xpZW50KXJldHVybiB0aGlzLnN0cmlwZUNsaWVudDtjb25zdCB0PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLGk9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RyaXBlSnNWZXJzaW9uKGUpO3JldHVybiB0aGlzLnNjcmlwdExvYWRlci5nZXRTdHJpcGVDbGllbnQoZSx0LmdldENhcnRMb2NhbGUoKSxpKX0pfV9jb2xsYXBzZVN0cmlwZUVsZW1lbnQoKXt2YXIgZTtjb25zdCB0PW51bGw9PT0oZT10aGlzLnN0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KFYuUEFZTUVOVCk7bnVsbD09dHx8dC5jb2xsYXBzZSgpfV9nZXRQYXltZW50UGF5bG9hZChlLHQsaSl7dmFyIG47Y29uc3Qgcj0obnVsbD09PShuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnQoKSl8fHZvaWQgMD09PW4/dm9pZCAwOm4uaWQpfHxcIlwiLHtjYXJkOm8sdXNfYmFua19hY2NvdW50OnN9PWl8fHt9LGE9dGhpcy5fc2hvdWxkU2F2ZUluc3RydW1lbnQobyl8fHRoaXMuX3Nob3VsZFNhdmVJbnN0cnVtZW50KHMpLGQ9dGhpcy5fZ2V0VG9rZW5pemVkT3B0aW9ucyh0LGkpO3JldHVybnttZXRob2RJZDplLHBheW1lbnREYXRhOntmb3JtYXR0ZWRQYXlsb2FkOk9iamVjdC5hc3NpZ24oe2NhcnRfaWQ6cixjb25maXJtOiExLG1ldGhvZDp0aGlzLnNlbGVjdGVkTWV0aG9kSWQsdmF1bHRfcGF5bWVudF9pbnN0cnVtZW50OmF9LGQpfX19X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl7cmV0dXJuIG9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighUyhlKXx8IXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUuYm9keS5lcnJvcnMpKXRocm93IGU7aWYoIXRoaXMuc3RyaXBlQ2xpZW50fHwhdGhpcy5zdHJpcGVFbGVtZW50cyl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7ZGF0YTppfT1lLmJvZHkuYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWQse3Rva2VuOm59PWkse3BheW1lbnRJbnRlbnQ6cn09eWllbGQgdGhpcy5fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KHQsaSkse2NsaWVudF9zZWNyZXQ6byxwYXltZW50X21ldGhvZF9vcHRpb25zOnN9PXJ8fHt9LGQ9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCxvfHxuLHMpO3RyeXtyZXR1cm4geWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQoZCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX19KX1fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGUsdCl7dmFyIGksbjtyZXR1cm4gb2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOnIscmVkaXJlY3RfdXJsOm99PXQscz10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLnN0cmlwZUVsZW1lbnRzLG8pO2xldCBhO3RyeXtjb25zdCB0PSh5aWVsZCB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pc1BheW1lbnRDb21wbGV0ZWQoZSx0aGlzLnN0cmlwZUNsaWVudCkpP3lpZWxkIG51bGw9PT0obj10aGlzLnN0cmlwZUNsaWVudCl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0cmlldmVQYXltZW50SW50ZW50KHJ8fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLnN0cmlwZUNsaWVudCl8fHZvaWQgMD09PWk/dm9pZCAwOmkuY29uZmlybVBheW1lbnQocyk7aWYoYT1udWxsPT10P3ZvaWQgMDp0LmVycm9yLGF8fCEobnVsbD09dD92b2lkIDA6dC5wYXltZW50SW50ZW50KSl0aHJvdyBuZXcgSDtyZXR1cm4gdH1jYXRjaChlKXtyZXR1cm4gdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dTdHJpcGVFcnJvcihhKX19KX1fb25TdHJpcGVFbGVtZW50Q2hhbmdlKGUsdCxpLG4pe3JlKGUpJiYhZS5jb2xsYXBzZWQmJih0aGlzLnNlbGVjdGVkTWV0aG9kSWQ9ZS52YWx1ZS50eXBlLG51bGw9PW58fG4oYCR7dH0tJHtpfWApKX1fc2hvdWxkU2F2ZUluc3RydW1lbnQoZSl7Y29uc3QgdD1udWxsPT1lP3ZvaWQgMDplLnNldHVwX2Z1dHVyZV91c2FnZTtyZXR1cm4gdD09PUIuT05fU0VTU0lPTnx8dD09PUIuT0ZGX1NFU1NJT059X2dldFRva2VuaXplZE9wdGlvbnMoZSx0KXtyZXR1cm4gdGhpcy5fc2hvdWxkU2F2ZUluc3RydW1lbnQobnVsbD09dD92b2lkIDA6dC51c19iYW5rX2FjY291bnQpP3t0b2tlbml6ZWRfYWNoOnt0b2tlbjplfX06e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjplfX19fWNvbnN0IGFlPWwodD0+e2NvbnN0IGk9bmV3IEcoZSgpKTtyZXR1cm4gbmV3IHNlKHQsaSxuZXcgVyh0LGkpKX0sW3tnYXRld2F5Olwic3RyaXBlb2NzXCIsaWQ6XCJvcHRpbWl6ZWRfY2hlY2tvdXRcIn1dKTt2YXIgZGU9ZnVuY3Rpb24oZSx0LGksbil7cmV0dXJuIG5ldyhpfHwoaT1Qcm9taXNlKSkoZnVuY3Rpb24ocixvKXtmdW5jdGlvbiBzKGUpe3RyeXtkKG4ubmV4dChlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChuLnRocm93KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBkKGUpe3ZhciB0O2UuZG9uZT9yKGUudmFsdWUpOih0PWUudmFsdWUsdCBpbnN0YW5jZW9mIGk/dDpuZXcgaShmdW5jdGlvbihlKXtlKHQpfSkpLnRoZW4ocyxhKX1kKChuPW4uYXBwbHkoZSx0fHxbXSkpLm5leHQoKSl9KX07Y2xhc3MgbGV7Y29uc3RydWN0b3IoZSx0LGkpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2U9aX1pbml0aWFsaXplKGUpe3ZhciB0O3JldHVybiBkZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7c3RyaXBlb2NzOmksbWV0aG9kSWQ6bixnYXRld2F5SWQ6cn09ZTtpZighKG51bGw9PWk/dm9pZCAwOmkuY29udGFpbmVySWQpfHwhcil0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7dHJ5e3lpZWxkIHRoaXMuX2luaXRpYWxpemVTdHJpcGVFbGVtZW50KGkscixuKX1jYXRjaChlKXtlIGluc3RhbmNlb2YgRXJyb3ImJihudWxsPT09KHQ9aS5vbkVycm9yKXx8dm9pZCAwPT09dHx8dC5jYWxsKGksZSkpfX0pfWV4ZWN1dGUoKXtyZXR1cm4gZGUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX0pfWZpbmFsaXplKCl7cmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBnKX1kZWluaXRpYWxpemUoKXt2YXIgZTtjb25zdCB0PW51bGw9PT0oZT10aGlzLnN0cmlwZUNoZWNrb3V0U2Vzc2lvbil8fHZvaWQgMD09PWU/dm9pZCAwOmUuZ2V0UGF5bWVudEVsZW1lbnQoKTtyZXR1cm4gbnVsbD09dHx8dC51bm1vdW50KCksbnVsbD09dHx8dC5kZXN0cm95KCksdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuZGVpbml0aWFsaXplKCksdGhpcy5zdHJpcGVDaGVja291dFNlc3Npb249dm9pZCAwLHRoaXMuc3RyaXBlQ2xpZW50PXZvaWQgMCxQcm9taXNlLnJlc29sdmUoKX1faW5pdGlhbGl6ZVN0cmlwZUVsZW1lbnQoZSx0LGkpe3JldHVybiBkZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7bGV0IG49dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSx0KTtpZigobnVsbD09bj92b2lkIDA6bi5jbGllbnRUb2tlbil8fChuPSh5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZFBheW1lbnRNZXRob2QodCx7cGFyYW1zOnttZXRob2Q6aX19KSkuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3coaSx0KSksIUoobikpdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudE1ldGhvZCk7Y29uc3R7Y2xpZW50VG9rZW46cixpbml0aWFsaXphdGlvbkRhdGE6b309bjtpZighcil0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTt0aGlzLnN0cmlwZUNsaWVudD15aWVsZCB0aGlzLl9sb2FkU3RyaXBlSnMobyk7Y29uc3R7ZW5hYmxlTGluazpkfT1vLHthcHBlYXJhbmNlOmwsY29udGFpbmVySWQ6Yyxmb250czp1LGxheW91dDpoLHJlbmRlcjpwLHBheW1lbnRNZXRob2RTZWxlY3Q6bSxoYW5kbGVDbG9zZVBheW1lbnRNZXRob2Q6Zyx0b2dnbGVQcmVsb2FkZXI6U309ZSx7Z2V0QmlsbGluZ0FkZHJlc3M6XyxnZXRTaGlwcGluZ0FkZHJlc3M6Zn09dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCksQz1fKCkse3Bvc3RhbENvZGU6RX09ZigpfHxDfHx7fTt0aGlzLnN0cmlwZUNoZWNrb3V0U2Vzc2lvbj15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRDaGVja291dFNlc3Npb24odGhpcy5zdHJpcGVDbGllbnQse2NsaWVudFNlY3JldDpyLGVsZW1lbnRzT3B0aW9uczp7YXBwZWFyYW5jZTpsLGZvbnRzOnV9LGFkYXB0aXZlUHJpY2luZzp7YWxsb3dlZDohMX0sZGVmYXVsdFZhbHVlczp7ZW1haWw6KG51bGw9PUM/dm9pZCAwOkMuZW1haWwpfHxcIlwifX0pO2NvbnN0IEk9dGhpcy5fY3JlYXRlU3RyaXBlRWxlbWVudCh7ZmllbGRzOntiaWxsaW5nRGV0YWlsczp7ZW1haWw6TC5ORVZFUixhZGRyZXNzOntjb3VudHJ5OkwuTkVWRVIsY2l0eTpMLk5FVkVSLHBvc3RhbENvZGU6RT9MLk5FVkVSOkwuQVVUT319fSx3YWxsZXRzOnthcHBsZVBheTpMLk5FVkVSLGdvb2dsZVBheTpMLk5FVkVSLGxpbms6ZD9MLkFVVE86TC5ORVZFUn0sbGF5b3V0Omh9KTtpZighSSl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubW91bnRFbGVtZW50KEksYyksSS5vbihqLkxPQURFUl9TVEFSVCwoKT0+e251bGw9PVN8fFMoITEpfSksSS5vbihqLlJFQURZLCgpPT57cCgpfSksSS5vbihqLkNIQU5HRSxlPT57dGhpcy5fb25TdHJpcGVFbGVtZW50Q2hhbmdlKGUsdCxpLG0pfSksbnVsbD09Z3x8Zyh0aGlzLl9jb2xsYXBzZVN0cmlwZUVsZW1lbnQuYmluZCh0aGlzKSl9KX1fbG9hZFN0cmlwZUpzKGUpe3JldHVybiBkZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYodGhpcy5zdHJpcGVDbGllbnQpcmV0dXJuIHRoaXMuc3RyaXBlQ2xpZW50O2NvbnN0IHQ9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCk7cmV0dXJuIHRoaXMuc2NyaXB0TG9hZGVyLmdldFN0cmlwZUNsaWVudChlLHQuZ2V0Q2FydExvY2FsZSgpLFUuQ0xPVkVSKX0pfV9jcmVhdGVTdHJpcGVFbGVtZW50KGUpe3ZhciB0LGk7cmV0dXJuKG51bGw9PT0odD10aGlzLnN0cmlwZUNoZWNrb3V0U2Vzc2lvbil8fHZvaWQgMD09PXQ/dm9pZCAwOnQuZ2V0UGF5bWVudEVsZW1lbnQoKSl8fChudWxsPT09KGk9dGhpcy5zdHJpcGVDaGVja291dFNlc3Npb24pfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNyZWF0ZVBheW1lbnRFbGVtZW50KGUpKX1fb25TdHJpcGVFbGVtZW50Q2hhbmdlKGUsdCxpLG4pe3JlKGUpJiYhZS5jb2xsYXBzZWQmJihudWxsPT1ufHxuKGAke3R9LSR7aX1gKSl9X2NvbGxhcHNlU3RyaXBlRWxlbWVudCgpe3ZhciBlO2NvbnN0IHQ9bnVsbD09PShlPXRoaXMuc3RyaXBlQ2hlY2tvdXRTZXNzaW9uKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRQYXltZW50RWxlbWVudCgpO251bGw9PXR8fHQuY29sbGFwc2UoKX19Y29uc3QgY2U9bCh0PT57Y29uc3QgaT1uZXcgRyhlKCkpO3JldHVybiBuZXcgbGUodCxpLG5ldyBXKHQsaSkpfSxbe2dhdGV3YXk6XCJzdHJpcGVvY3NcIixpZDpcImNoZWNrb3V0X3Nlc3Npb25cIn1dKTtjbGFzcyB1ZXtjb25zdHJ1Y3RvcihlLHQpe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXR9aW5pdGlhbGl6ZShlKXt2YXIgdCxpLG4scixvO3JldHVybiBpPXRoaXMsbj12b2lkIDAsbz1mdW5jdGlvbiooKXtsZXQgaTtpZighZS5zdHJpcGV1cGUpdGhyb3cgbmV3IHUoJ1VuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgXCJvcHRpb25zXCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLicpO2NvbnN0e2NvbnRhaW5lcjpuLGdhdGV3YXlJZDpyLG1ldGhvZElkOm8sb25FbWFpbENoYW5nZTphLGdldFN0eWxlczpkLGlzTG9hZGluZzpsfT1lLnN0cmlwZXVwZTtPYmplY3QuZW50cmllcyhlLnN0cmlwZXVwZSkuZm9yRWFjaCgoW2UsdF0pPT57aWYoIXQpdGhyb3cgbmV3IHUoYFVuYWJsZSB0byBwcm9jZWVkIGJlY2F1c2UgXCIke2V9XCIgYXJndW1lbnQgaXMgbm90IHByb3ZpZGVkLmApfSkseWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRQYXltZW50TWV0aG9kKHIse3BhcmFtczp7bWV0aG9kOm99fSk7Y29uc3QgYz10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxoPWMuZ2V0UGF5bWVudE1ldGhvZE9yVGhyb3cobyxyKSx7Y2xpZW50VG9rZW46cH09aDtpZighSihoKXx8IXApdGhyb3cgbmV3IHkocy5NaXNzaW5nUGF5bWVudFRva2VuKTtjb25zdHtlbWFpbDptfT1jLmdldEN1c3RvbWVyT3JUaHJvdygpLGc9Yy5nZXRQYXltZW50UHJvdmlkZXJDdXN0b21lck9yVGhyb3coKSx2PShlZShnKT9nOnt9KS5zdHJpcGVMaW5rQXV0aGVudGljYXRpb25TdGF0ZTtpZighbSl7bGV0IGU7Y29uc3Qgcj1cImZ1bmN0aW9uXCI9PXR5cGVvZiBkJiZkKCk7ZT1yP3t2YXJpYWJsZXM6e2NvbG9yUHJpbWFyeTpyLmZpZWxkSW5uZXJTaGFkb3csY29sb3JCYWNrZ3JvdW5kOnIuZmllbGRCYWNrZ3JvdW5kLGNvbG9yVGV4dDpyLmxhYmVsVGV4dCxjb2xvckRhbmdlcjpyLmZpZWxkRXJyb3JUZXh0LGNvbG9yVGV4dFNlY29uZGFyeTpyLmxhYmVsVGV4dCxjb2xvclRleHRQbGFjZWhvbGRlcjpyLmZpZWxkUGxhY2Vob2xkZXJUZXh0fSxydWxlczp7XCIuSW5wdXRcIjp7Ym9yZGVyQ29sb3I6ci5maWVsZEJvcmRlcixjb2xvcjpyLmZpZWxkVGV4dCxib3hTaGFkb3c6ci5maWVsZElubmVyU2hhZG93fX19Ont9LGk9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGguaW5pdGlhbGl6YXRpb25EYXRhLGMuZ2V0Q2FydExvY2FsZSgpLFUuVjMsUSxYKSx0aGlzLl9zdHJpcGVFbGVtZW50cz15aWVsZCB0aGlzLnNjcmlwdExvYWRlci5nZXRFbGVtZW50cyhpLHtjbGllbnRTZWNyZXQ6cCxhcHBlYXJhbmNlOmV9KTtjb25zdHtnZXRCaWxsaW5nQWRkcmVzczpvLGdldENvbnNpZ25tZW50czp1fT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSxtPXUoKSxnPW51bGw9PT0odD1udWxsPT1tP3ZvaWQgMDptWzBdKXx8dm9pZCAwPT09dD92b2lkIDA6dC5pZCx7ZW1haWw6U309bygpfHx7fSxfPVM/e2RlZmF1bHRWYWx1ZXM6e21vZGU6Ti5TSElQUElORyxlbWFpbDpTfX06e30sZj10aGlzLl9zdHJpcGVFbGVtZW50cy5nZXRFbGVtZW50KFYuQVVUSEVOVElDQVRJT04pfHx0aGlzLl9zdHJpcGVFbGVtZW50cy5jcmVhdGUoVi5BVVRIRU5USUNBVElPTixfKTtmLm9uKGouQ0hBTkdFLGU9PntpZighKFwiYXV0aGVudGljYXRlZFwiaW4gZSkpdGhyb3cgbmV3IHkocy5NaXNzaW5nQ3VzdG9tZXIpO3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVQYXltZW50UHJvdmlkZXJDdXN0b21lcih7c3RyaXBlTGlua0F1dGhlbnRpY2F0aW9uU3RhdGU6ZS5hdXRoZW50aWNhdGVkfSksZS5jb21wbGV0ZT9hKGUuYXV0aGVudGljYXRlZCxlLnZhbHVlLmVtYWlsKTphKCExLFwiXCIpLGwmJmwoITEpLHZvaWQgMD09PXYmJmUuYXV0aGVudGljYXRlZCYmZyYmdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmRlbGV0ZUNvbnNpZ25tZW50KGcpfSksZi5tb3VudChgIyR7bn1gKX19LG5ldygocj12b2lkIDApfHwocj1Qcm9taXNlKSkoZnVuY3Rpb24oZSx0KXtmdW5jdGlvbiBzKGUpe3RyeXtkKG8ubmV4dChlKSl9Y2F0Y2goZSl7dChlKX19ZnVuY3Rpb24gYShlKXt0cnl7ZChvLnRocm93KGUpKX1jYXRjaChlKXt0KGUpfX1mdW5jdGlvbiBkKHQpe3ZhciBpO3QuZG9uZT9lKHQudmFsdWUpOihpPXQudmFsdWUsaSBpbnN0YW5jZW9mIHI/aTpuZXcgcihmdW5jdGlvbihlKXtlKGkpfSkpLnRoZW4ocyxhKX1kKChvPW8uYXBwbHkoaSxufHxbXSkpLm5leHQoKSl9KX1kZWluaXRpYWxpemUoKXt2YXIgZSx0O3JldHVybiBudWxsPT09KHQ9bnVsbD09PShlPXRoaXMuX3N0cmlwZUVsZW1lbnRzKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5nZXRFbGVtZW50KFYuQVVUSEVOVElDQVRJT04pKXx8dm9pZCAwPT09dHx8dC51bm1vdW50KCksUHJvbWlzZS5yZXNvbHZlKCl9c2lnbkluKGUsdCl7cmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zaWduSW5DdXN0b21lcihlLHQpLFByb21pc2UucmVzb2x2ZSgpfXNpZ25PdXQoZSl7cmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zaWduT3V0Q3VzdG9tZXIoZSksUHJvbWlzZS5yZXNvbHZlKCl9ZXhlY3V0ZVBheW1lbnRNZXRob2RDaGVja291dChlKXt2YXIgdDtyZXR1cm4gbnVsbD09PSh0PW51bGw9PWU/dm9pZCAwOmUuY29udGludWVXaXRoQ2hlY2tvdXRDYWxsYmFjayl8fHZvaWQgMD09PXR8fHQuY2FsbChlKSxQcm9taXNlLnJlc29sdmUoKX19Y29uc3QgaGU9bCh0PT5uZXcgdWUodCxuZXcgRyhlKCkpKSxbe2lkOlwic3RyaXBldXBlXCJ9XSkscGU9e3NpemU6NzAsY29sb3I6XCIjZDlkOWQ5XCIsYmFja2dyb3VuZENvbG9yOlwiI2ZmZmZmZlwifSxtZT17cG9zaXRpb246XCJmaXhlZFwiLFwiYmFja2dyb3VuZC1jb2xvclwiOlwicmdiYSgwLCAwLCAwLCAwLjQpXCIsXCJ6LWluZGV4XCI6XCIxMDAwXCJ9LHllPVwiZW1iZWRkZWQtY2hlY2tvdXQtbG9hZGluZy1pbmRpY2F0b3Itcm90YXRpb25cIjtjbGFzcyBnZXtjb25zdHJ1Y3RvcihlKXt0aGlzLnN0eWxlcz1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe30scGUpLGUmJmUuc3R5bGVzKSx0aGlzLmNvbnRhaW5lclN0eWxlcz1PYmplY3QuYXNzaWduKHt9LGUmJmUuY29udGFpbmVyU3R5bGVzKSx0aGlzLmRlZmluZUFuaW1hdGlvbigpLHRoaXMuY29udGFpbmVyPXRoaXMuYnVpbGRDb250YWluZXIoKSx0aGlzLmluZGljYXRvcj10aGlzLmJ1aWxkSW5kaWNhdG9yKCksdGhpcy5jb250YWluZXIuYXBwZW5kQ2hpbGQodGhpcy5pbmRpY2F0b3IpfXNob3coZSl7aWYoZSl7Y29uc3QgdD1kb2N1bWVudC5nZXRFbGVtZW50QnlJZChlKTtpZighdCl0aHJvdyBuZXcgRXJyb3IoXCJVbmFibGUgdG8gYXR0YWNoIHRoZSBsb2FkaW5nIGluZGljYXRvciBiZWNhdXNlIHRoZSBwYXJlbnQgSUQgaXMgbm90IHZhbGlkLlwiKTt0LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyKX10aGlzLmNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PVwidmlzaWJsZVwiLHRoaXMuY29udGFpbmVyLnN0eWxlLm9wYWNpdHk9XCIxXCJ9aGlkZSgpe2NvbnN0IGU9KCk9Pnt0aGlzLmNvbnRhaW5lci5zdHlsZS52aXNpYmlsaXR5PVwiaGlkZGVuXCIsdGhpcy5jb250YWluZXIucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIixlKX07dGhpcy5jb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcihcInRyYW5zaXRpb25lbmRcIixlKSx0aGlzLmNvbnRhaW5lci5zdHlsZS5vcGFjaXR5PVwiMFwifWJ1aWxkQ29udGFpbmVyKCl7Y29uc3QgZT1kb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3JldHVybiBlLnN0eWxlLmRpc3BsYXk9XCJibG9ja1wiLGUuc3R5bGUuYm90dG9tPVwiMFwiLGUuc3R5bGUubGVmdD1cIjBcIixlLnN0eWxlLmhlaWdodD1cIjEwMCVcIixlLnN0eWxlLndpZHRoPVwiMTAwJVwiLGUuc3R5bGUucG9zaXRpb249XCJhYnNvbHV0ZVwiLGUuc3R5bGUucmlnaHQ9XCIwXCIsZS5zdHlsZS50b3A9XCIwXCIsZS5zdHlsZS50cmFuc2l0aW9uPVwiYWxsIDI1MG1zIGVhc2Utb3V0XCIsZS5zdHlsZS5vcGFjaXR5PVwiMFwiLHRoaXMuc2V0U3R5bGVBdHRyaWJ1dGUoZSx0aGlzLmNvbnRhaW5lclN0eWxlcyksZX1idWlsZEluZGljYXRvcigpe2NvbnN0IGU9ZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtyZXR1cm4gZS5zdHlsZS5kaXNwbGF5PVwiYmxvY2tcIixlLnN0eWxlLndpZHRoPWAke3RoaXMuc3R5bGVzLnNpemV9cHhgLGUuc3R5bGUuaGVpZ2h0PWAke3RoaXMuc3R5bGVzLnNpemV9cHhgLGUuc3R5bGUuYm9yZGVyUmFkaXVzPWAke3RoaXMuc3R5bGVzLnNpemV9cHhgLGUuc3R5bGUuYm9yZGVyPVwic29saWQgMXB4XCIsZS5zdHlsZS5ib3JkZXJDb2xvcj1gJHt0aGlzLnN0eWxlcy5iYWNrZ3JvdW5kQ29sb3J9ICR7dGhpcy5zdHlsZXMuYmFja2dyb3VuZENvbG9yfSAke3RoaXMuc3R5bGVzLmNvbG9yfSAke3RoaXMuc3R5bGVzLmNvbG9yfWAsZS5zdHlsZS5tYXJnaW49XCIwIGF1dG9cIixlLnN0eWxlLnBvc2l0aW9uPVwiYWJzb2x1dGVcIixlLnN0eWxlLmxlZnQ9XCIwXCIsZS5zdHlsZS5yaWdodD1cIjBcIixlLnN0eWxlLnRvcD1cIjUwJVwiLGUuc3R5bGUudHJhbnNmb3JtPVwidHJhbnNsYXRlWSgtNTAlKSByb3RhdGUoMGRlZylcIixlLnN0eWxlLnRyYW5zZm9ybVN0eWxlPVwicHJlc2VydmUtM2RcIixlLnN0eWxlLmFuaW1hdGlvbj1gJHt5ZX0gNTAwbXMgaW5maW5pdGUgY3ViaWMtYmV6aWVyKDAuNjksIDAuMzEsIDAuNTYsIDAuODMpYCxlfXNldFN0eWxlQXR0cmlidXRlKGUsdCl7T2JqZWN0LmtleXModCkuZm9yRWFjaChpPT57ZS5zdHlsZS5zZXRQcm9wZXJ0eShpLHRbaV0pfSl9ZGVmaW5lQW5pbWF0aW9uKCl7dmFyIGU7aWYoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoeWUpKXJldHVybjtjb25zdCB0PWRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJzdHlsZVwiKTt0LmlkPXllLG51bGw9PT0oZT1kb2N1bWVudC5oZWFkKXx8dm9pZCAwPT09ZXx8ZS5hcHBlbmRDaGlsZCh0KSx0LnNoZWV0IGluc3RhbmNlb2YgQ1NTU3R5bGVTaGVldCYmdC5zaGVldC5pbnNlcnRSdWxlKGBcXG4gICAgICAgICAgICAgICAgQGtleWZyYW1lcyAke3llfSB7XFxuICAgICAgICAgICAgICAgICAgICAwJSB7IHRyYW5zZm9ybTogdHJhbnNsYXRlWSgtNTAlKSByb3RhdGUoMGRlZyk7IH1cXG4gICAgICAgICAgICAgICAgICAgIDEwMCUgeyB0cmFuc2Zvcm06IHRyYW5zbGF0ZVkoLTUwJSkgcm90YXRlKDM2MGRlZyk7IH1cXG4gICAgICAgICAgICAgICAgfVxcbiAgICAgICAgICAgIGAsMCl9fWNsYXNzIHZle2NvbnN0cnVjdG9yKGUpe3RoaXMuX2RlY2ltYWxQbGFjZXM9ZX10b0ludGVnZXIoZSl7cmV0dXJuIE1hdGgucm91bmQoZSpNYXRoLnBvdygxMCx0aGlzLl9kZWNpbWFsUGxhY2VzKSl9fWNvbnN0IFNlPVtcIkFDXCIsXCJBRFwiLFwiQUVcIixcIkFGXCIsXCJBR1wiLFwiQUlcIixcIkFMXCIsXCJBTVwiLFwiQU9cIixcIkFRXCIsXCJBUlwiLFwiQVRcIixcIkFVXCIsXCJBV1wiLFwiQVhcIixcIkFaXCIsXCJCQVwiLFwiQkJcIixcIkJEXCIsXCJCRVwiLFwiQkZcIixcIkJHXCIsXCJCSFwiLFwiQklcIixcIkJKXCIsXCJCTFwiLFwiQk1cIixcIkJOXCIsXCJCT1wiLFwiQlFcIixcIkJSXCIsXCJCU1wiLFwiQlRcIixcIkJWXCIsXCJCV1wiLFwiQllcIixcIkJaXCIsXCJDQVwiLFwiQ0RcIixcIkNGXCIsXCJDR1wiLFwiQ0hcIixcIkNJXCIsXCJDS1wiLFwiQ0xcIixcIkNNXCIsXCJDTlwiLFwiQ09cIixcIkNSXCIsXCJDVlwiLFwiQ1dcIixcIkNZXCIsXCJDWlwiLFwiREVcIixcIkRKXCIsXCJES1wiLFwiRE1cIixcIkRPXCIsXCJEWlwiLFwiRUNcIixcIkVFXCIsXCJFR1wiLFwiRUhcIixcIkVSXCIsXCJFU1wiLFwiRVRcIixcIkZJXCIsXCJGSlwiLFwiRktcIixcIkZPXCIsXCJGUlwiLFwiR0FcIixcIkdCXCIsXCJHRFwiLFwiR0VcIixcIkdGXCIsXCJHR1wiLFwiR0hcIixcIkdJXCIsXCJHTFwiLFwiR01cIixcIkdOXCIsXCJHUFwiLFwiR1FcIixcIkdSXCIsXCJHU1wiLFwiR1RcIixcIkdVXCIsXCJHV1wiLFwiR1lcIixcIkhLXCIsXCJITlwiLFwiSFJcIixcIkhUXCIsXCJIVVwiLFwiSURcIixcIklFXCIsXCJJTFwiLFwiSU1cIixcIklOXCIsXCJJT1wiLFwiSVFcIixcIklTXCIsXCJJVFwiLFwiSkVcIixcIkpNXCIsXCJKT1wiLFwiSlBcIixcIktFXCIsXCJLR1wiLFwiS0hcIixcIktJXCIsXCJLTVwiLFwiS05cIixcIktSXCIsXCJLV1wiLFwiS1lcIixcIktaXCIsXCJMQVwiLFwiTEJcIixcIkxDXCIsXCJMSVwiLFwiTEtcIixcIkxSXCIsXCJMU1wiLFwiTFRcIixcIkxVXCIsXCJMVlwiLFwiTFlcIixcIk1BXCIsXCJNQ1wiLFwiTURcIixcIk1FXCIsXCJNRlwiLFwiTUdcIixcIk1LXCIsXCJNTFwiLFwiTU1cIixcIk1OXCIsXCJNT1wiLFwiTVFcIixcIk1SXCIsXCJNU1wiLFwiTVRcIixcIk1VXCIsXCJNVlwiLFwiTVdcIixcIk1YXCIsXCJNWVwiLFwiTVpcIixcIk5BXCIsXCJOQ1wiLFwiTkVcIixcIk5HXCIsXCJOSVwiLFwiTkxcIixcIk5PXCIsXCJOUFwiLFwiTlJcIixcIk5VXCIsXCJOWlwiLFwiT01cIixcIlBBXCIsXCJQRVwiLFwiUEZcIixcIlBHXCIsXCJQSFwiLFwiUEtcIixcIlBMXCIsXCJQTVwiLFwiUE5cIixcIlBSXCIsXCJQU1wiLFwiUFRcIixcIlBZXCIsXCJRQVwiLFwiUkVcIixcIlJPXCIsXCJSU1wiLFwiUlVcIixcIlJXXCIsXCJTQVwiLFwiU0JcIixcIlNDXCIsXCJTRFwiLFwiU0VcIixcIlNHXCIsXCJTSFwiLFwiU0lcIixcIlNKXCIsXCJTS1wiLFwiU0xcIixcIlNNXCIsXCJTTlwiLFwiU09cIixcIlNSXCIsXCJTU1wiLFwiU1RcIixcIlNWXCIsXCJTWFwiLFwiU1pcIixcIlRBXCIsXCJUQ1wiLFwiVERcIixcIlRGXCIsXCJUR1wiLFwiVEhcIixcIlRKXCIsXCJUS1wiLFwiVExcIixcIlRNXCIsXCJUTlwiLFwiVE9cIixcIlRSXCIsXCJUVFwiLFwiVFZcIixcIlRXXCIsXCJUWlwiLFwiVUFcIixcIlVHXCIsXCJVU1wiLFwiVVlcIixcIlVaXCIsXCJWQVwiLFwiVkNcIixcIlZFXCIsXCJWR1wiLFwiVk5cIixcIlZVXCIsXCJXRlwiLFwiV1NcIixcIlhLXCIsXCJZRVwiLFwiWVRcIixcIlpBXCIsXCJaTVwiLFwiWldcIixcIlpaXCJdO3ZhciBfZT1mdW5jdGlvbihlLHQsaSxuKXtyZXR1cm4gbmV3KGl8fChpPVByb21pc2UpKShmdW5jdGlvbihyLG8pe2Z1bmN0aW9uIHMoZSl7dHJ5e2Qobi5uZXh0KGUpKX1jYXRjaChlKXtvKGUpfX1mdW5jdGlvbiBhKGUpe3RyeXtkKG4udGhyb3coZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGQoZSl7dmFyIHQ7ZS5kb25lP3IoZS52YWx1ZSk6KHQ9ZS52YWx1ZSx0IGluc3RhbmNlb2YgaT90Om5ldyBpKGZ1bmN0aW9uKGUpe2UodCl9KSkudGhlbihzLGEpfWQoKG49bi5hcHBseShlLHR8fFtdKSkubmV4dCgpKX0pfTtjbGFzcyBmZXtjb25zdHJ1Y3RvcihlLHQsaSxuKXt0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2U9ZSx0aGlzLnNjcmlwdExvYWRlcj10LHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlPWksdGhpcy5sb2FkaW5nSW5kaWNhdG9yPW59aW5pdGlhbGl6ZShlKXtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3N0cmlwZW9jczp0fT1lfHx7fTtpZighdCl0aHJvdyBuZXcgdSgnVW5hYmxlIHRvIHByb2NlZWQgYmVjYXVzZSBcIm9wdGlvbnNcIiBhcmd1bWVudCBpcyBub3QgcHJvdmlkZWQuJyk7Y29uc3R7bWV0aG9kSWQ6aSxnYXRld2F5SWQ6bixjb250YWluZXI6cn09dDtpZighcnx8IWl8fCFuKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdCBvPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChuLHtwYXJhbXM6e21ldGhvZDppfX0pLGQ9by5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhpLG4pLHtsb2FkaW5nQ29udGFpbmVySWQ6bCxidXR0b25IZWlnaHQ6YyxvbkNvbXBsZXRlOmh9PXQ7aWYodGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcj1sLHRoaXMuX29uQ29tcGxldGU9aCwhSihkKSl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtjb25zdHtpbml0aWFsaXphdGlvbkRhdGE6cH09ZCx7Y2FwdHVyZU1ldGhvZDptfT1wLGc9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RyaXBlSnNWZXJzaW9uKHApO3RoaXMuX2NhcHR1cmVNZXRob2Q9bSx0aGlzLl9zdHJpcGVDbGllbnQ9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KHAsby5nZXRDYXJ0TG9jYWxlKCksZykseWllbGQgdGhpcy5fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KHIsdGhpcy5fc3RyaXBlQ2xpZW50LGMpLHRoaXMuX2luaXRpYWxpemVFdmVudHMoaSl9KX1zaWduSW4oKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9c2lnbk91dCgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1leGVjdXRlUGF5bWVudE1ldGhvZENoZWNrb3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWRlaW5pdGlhbGl6ZSgpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1fbW91bnRFeHByZXNzQ2hlY2tvdXRFbGVtZW50KGUsdCxpPTQwKXtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IG49dGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpLHI9T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe3NoaXBwaW5nQWRkcmVzc1JlcXVpcmVkOm59LG4/e2FsbG93ZWRTaGlwcGluZ0NvdW50cmllczp5aWVsZCB0aGlzLl9nZXRBdmFpbGFibGVDb3VudHJpZXMoKX06e30pLG4/e3NoaXBwaW5nUmF0ZXM6W3tpZDpcIl9cIixhbW91bnQ6MCxkaXNwbGF5TmFtZTpcIlBlbmRpbmcgcmF0ZXNcIn1dfTp7fSkse2JpbGxpbmdBZGRyZXNzUmVxdWlyZWQ6ITAsZW1haWxSZXF1aXJlZDohMCxwaG9uZU51bWJlclJlcXVpcmVkOiEwLHBheW1lbnRNZXRob2RzOntsaW5rOkwuQVVUTyxhcHBsZVBheTpMLk5FVkVSLGdvb2dsZVBheTpMLk5FVkVSLGFtYXpvblBheTpMLk5FVkVSLHBheXBhbDpMLk5FVkVSLGtsYXJuYTpMLk5FVkVSfSxidXR0b25IZWlnaHQ6aX0pLHtjYXJ0QW1vdW50Om99PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENhcnRPclRocm93KCkscz1PYmplY3QuYXNzaWduKHttb2RlOlwicGF5bWVudFwiLGFtb3VudDp0aGlzLl90b0NlbnRzKG8pLGN1cnJlbmN5OnRoaXMuX2dldEN1cnJlbmN5KCl9LHRoaXMuX2NhcHR1cmVNZXRob2Q/e2NhcHR1cmVNZXRob2Q6dGhpcy5fY2FwdHVyZU1ldGhvZH06e30pO3JldHVybiB0aGlzLl9zdHJpcGVFbGVtZW50cz10LmVsZW1lbnRzKHMpLHRoaXMuX2xpbmtWMkVsZW1lbnQ9dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKFYuRVhQUkVTU19DSEVDS09VVCxyKSx0aGlzLl9saW5rVjJFbGVtZW50Lm1vdW50KGAjJHtlfWApLHRoaXMuX2xpbmtWMkVsZW1lbnR9KX1faW5pdGlhbGl6ZUV2ZW50cyhlKXt0aGlzLl9saW5rVjJFbGVtZW50JiYodGhpcy5fc2hvdWxkUmVxdWlyZVNoaXBwaW5nQWRkcmVzcygpJiYodGhpcy5fbGlua1YyRWxlbWVudC5vbihqLlNISVBQSU5HX0FERFJFU1NfQ0hBTkdFLGU9Pl9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25TaGlwcGluZ0FkZHJlc3NDaGFuZ2UoZSl9KSksdGhpcy5fbGlua1YyRWxlbWVudC5vbihqLlNISVBQSU5HX1JBVEVfQ0hBTkdFLGU9Pl9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25TaGlwcGluZ1JhdGVDaGFuZ2UoZSl9KSkpLHRoaXMuX2xpbmtWMkVsZW1lbnQub24oai5DT05GSVJNLHQ9Pl9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm4gdGhpcy5fb25Db25maXJtKHQsZSl9KSksdGhpcy5fbGlua1YyRWxlbWVudC5vbihqLkNBTkNFTCx0aGlzLl9vbkNhbmNlbCkpfV9vblNoaXBwaW5nQWRkcmVzc0NoYW5nZShlKXtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKCEoXCJhZGRyZXNzXCJpbiBlKSlyZXR1cm47Y29uc3QgdD1lLmFkZHJlc3MsaT17Zmlyc3ROYW1lOlwiXCIsbGFzdE5hbWU6XCJcIixwaG9uZTpcIlwiLGNvbXBhbnk6XCJcIixhZGRyZXNzMTpcIlwiLGFkZHJlc3MyOlwiXCIsY2l0eToobnVsbD09dD92b2lkIDA6dC5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09dD92b2lkIDA6dC5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT10P3ZvaWQgMDp0LnBvc3RhbF9jb2RlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2U6KG51bGw9PXQ/dm9pZCAwOnQuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PXQ/dm9pZCAwOnQuc3RhdGUpfHxcIlwiLGN1c3RvbUZpZWxkczpbXX07eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZVNoaXBwaW5nQWRkcmVzcyhpKTtjb25zdCBuPXlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZVNoaXBwaW5nT3B0aW9ucygpO3lpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksKG51bGw9PW4/dm9pZCAwOm4ubGVuZ3RoKT9lLnJlc29sdmUoe3NoaXBwaW5nUmF0ZXM6bn0pOmUucmVqZWN0KCl9KX1fb25DYW5jZWwoKXt0aHJvdyBuZXcgX31fb25TaGlwcGluZ1JhdGVDaGFuZ2UoZSl7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcInNoaXBwaW5nUmF0ZVwiaW4gZSl7Y29uc3R7c2hpcHBpbmdSYXRlOnR9PWU7eWllbGQgdGhpcy5faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UobnVsbD09dD92b2lkIDA6dC5pZCkseWllbGQgdGhpcy5fdXBkYXRlRGlzcGxheWVkUHJpY2UoKSxlLnJlc29sdmUoe30pfX0pfV9vbkNvbmZpcm0oZSx0KXtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKFwiYmlsbGluZ0RldGFpbHNcImluIGUmJlwic2hpcHBpbmdBZGRyZXNzXCJpbiBlJiZ0aGlzLl9zdHJpcGVDbGllbnQmJnRoaXMuX3N0cmlwZUVsZW1lbnRzKXt5aWVsZCB0aGlzLl91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRPcmRlcigpO2NvbnN0IGk9dGhpcy5fZ2V0UGF5bWVudFBheWxvYWQodCk7dHJ5e3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KGkpfWNhdGNoKGUpe3lpZWxkIHRoaXMuX3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl9fXJldHVybiBQcm9taXNlLnJlc29sdmUoKX0pfV91cGRhdGVTaGlwcGluZ0FuZEJpbGxpbmdBZGRyZXNzKGUpe3ZhciB0LGksbixyLG8scyxhLGQ7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBsPXRoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSxjPShudWxsPT09KGk9bnVsbD09PSh0PWUuc2hpcHBpbmdBZGRyZXNzKXx8dm9pZCAwPT09dD92b2lkIDA6dC5uYW1lKXx8dm9pZCAwPT09aT92b2lkIDA6aS5zcGxpdChcIiBcIilbMF0pfHwobnVsbD09PShyPW51bGw9PT0obj1lLmJpbGxpbmdEZXRhaWxzKXx8dm9pZCAwPT09bj92b2lkIDA6bi5uYW1lKXx8dm9pZCAwPT09cj92b2lkIDA6ci5zcGxpdChcIiBcIilbMF0pfHxcIlwiLHU9KG51bGw9PT0ocz1udWxsPT09KG89ZS5zaGlwcGluZ0FkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLm5hbWUpfHx2b2lkIDA9PT1zP3ZvaWQgMDpzLnNwbGl0KFwiIFwiKVsxXSl8fChudWxsPT09KGQ9bnVsbD09PShhPWUuYmlsbGluZ0RldGFpbHMpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLm5hbWUpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnNwbGl0KFwiIFwiKVsxXSl8fFwiXCI7aWYobCl7Y29uc3QgdD10aGlzLl9tYXBTaGlwcGluZ0FkZHJlc3MoZS5zaGlwcGluZ0FkZHJlc3MsZS5iaWxsaW5nRGV0YWlscyxjLHUpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVTaGlwcGluZ0FkZHJlc3ModCl9Y29uc3QgaD10aGlzLl9tYXBCaWxsaW5nQWRkcmVzcyhlLnNoaXBwaW5nQWRkcmVzcyxlLmJpbGxpbmdEZXRhaWxzLGMsdSk7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnVwZGF0ZUJpbGxpbmdBZGRyZXNzKGgpfSl9X21hcFNoaXBwaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGwsYztyZXR1cm57Zmlyc3ROYW1lOmksbGFzdE5hbWU6bixwaG9uZToobnVsbD09dD92b2lkIDA6dC5waG9uZSl8fFwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOihudWxsPT09KHI9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cj92b2lkIDA6ci5saW5lMSl8fFwiXCIsYWRkcmVzczI6KG51bGw9PT0obz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmxpbmUyKXx8XCJcIixjaXR5OihudWxsPT09KHM9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09PShhPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWE/dm9pZCAwOmEuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09PShkPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWQ/dm9pZCAwOmQucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PT0oYz1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1jP3ZvaWQgMDpjLnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119fV9tYXBCaWxsaW5nQWRkcmVzcyhlLHQsaSxuKXt2YXIgcixvLHMsYSxkLGw7cmV0dXJue2VtYWlsOihudWxsPT10P3ZvaWQgMDp0LmVtYWlsKXx8XCJcIixmaXJzdE5hbWU6aSxsYXN0TmFtZTpuLHBob25lOihudWxsPT10P3ZvaWQgMDp0LnBob25lKXx8XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6KG51bGw9PT0ocj1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLmxpbmUxKXx8XCJcIixhZGRyZXNzMjpcIlwiLGNpdHk6KG51bGw9PT0obz1udWxsPT10P3ZvaWQgMDp0LmFkZHJlc3MpfHx2b2lkIDA9PT1vP3ZvaWQgMDpvLmNpdHkpfHxcIlwiLGNvdW50cnlDb2RlOihudWxsPT09KHM9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09cz92b2lkIDA6cy5jb3VudHJ5KXx8XCJcIixwb3N0YWxDb2RlOihudWxsPT09KGE9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT09KGQ9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5zdGF0ZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlQ29kZToobnVsbD09PShsPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PWw/dm9pZCAwOmwuc3RhdGUpfHxcIlwiLGN1c3RvbUZpZWxkczpbXX19X3Byb2Nlc3NBZGRpdGlvbmFsQWN0aW9uKGUsdCl7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighUyhlKXx8IXRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzQWRkaXRpb25hbEFjdGlvbkVycm9yKGUuYm9keS5lcnJvcnMpKXRocm93IGU7aWYoIXRoaXMuX3N0cmlwZUNsaWVudHx8IXRoaXMuX3N0cmlwZUVsZW1lbnRzKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdHtkYXRhOml9PWUuYm9keS5hZGRpdGlvbmFsX2FjdGlvbl9yZXF1aXJlZCx7dG9rZW46bn09aSx7cGF5bWVudEludGVudDpyfT15aWVsZCB0aGlzLl9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coaSx0KSxvPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQsKG51bGw9PXI/dm9pZCAwOnIuaWQpfHxuKTt0cnl7dGhpcy5fdG9nZ2xlTG9hZGluZ0luZGljYXRvcighMCkseWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLnN1Ym1pdFBheW1lbnQobykseWllbGQgdGhpcy5fY29tcGxldGVDaGVja291dEZsb3coKX1jYXRjaChlKXt0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1BheW1lbnRDb25maXJtYXRpb25Qcm9jZWVkTWVzc2FnZSgpfWZpbmFsbHl7dGhpcy5fdG9nZ2xlTG9hZGluZ0luZGljYXRvcighMSl9fSl9X2NvbmZpcm1TdHJpcGVQYXltZW50T3JUaHJvdyhlLHQpe3ZhciBpLG4scjtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0e3Rva2VuOm8scmVkaXJlY3RfdXJsOnN9PWUsYT10aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5tYXBTdHJpcGVQYXltZW50RGF0YSh0aGlzLl9zdHJpcGVFbGVtZW50cyxzKTtsZXQgZDt0cnl7Y29uc3QgZT0oeWllbGQgdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuaXNQYXltZW50Q29tcGxldGVkKHQsdGhpcy5fc3RyaXBlQ2xpZW50KSk/eWllbGQgbnVsbD09PShyPXRoaXMuX3N0cmlwZUNsaWVudCl8fHZvaWQgMD09PXI/dm9pZCAwOnIucmV0cmlldmVQYXltZW50SW50ZW50KG98fFwiXCIpOnlpZWxkIG51bGw9PT0oaT10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmNvbmZpcm1QYXltZW50KHtlbGVtZW50czphLmVsZW1lbnRzLGNsaWVudFNlY3JldDpvLHJlZGlyZWN0OkwuSUZfUkVRVUlSRUQsY29uZmlybVBhcmFtczp7cmV0dXJuX3VybDpudWxsPT09KG49YS5jb25maXJtUGFyYW1zKXx8dm9pZCAwPT09bj92b2lkIDA6bi5yZXR1cm5fdXJsfX0pO2lmKGQ9bnVsbD09ZT92b2lkIDA6ZS5lcnJvcixkfHwhKG51bGw9PWU/dm9pZCAwOmUucGF5bWVudEludGVudCkpdGhyb3cgbmV3IEg7cmV0dXJuIGV9Y2F0Y2goZSl7cmV0dXJuIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLnRocm93U3RyaXBlRXJyb3IoZCl9fSl9X2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtyZXR1cm5cImZ1bmN0aW9uXCI9PXR5cGVvZiB0aGlzLl9vbkNvbXBsZXRlP3RoaXMuX29uQ29tcGxldGUoKTood2luZG93LmxvY2F0aW9uLnJlcGxhY2UoXCIvb3JkZXItY29uZmlybWF0aW9uXCIpLFByb21pc2UucmVzb2x2ZSgpKX0pfV9nZXRQYXltZW50UGF5bG9hZChlLHQpe3ZhciBpO2NvbnN0IG49KG51bGw9PT0oaT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCkpfHx2b2lkIDA9PT1pP3ZvaWQgMDppLmlkKXx8XCJcIjtyZXR1cm57bWV0aG9kSWQ6ZSxwYXltZW50RGF0YTp7Zm9ybWF0dGVkUGF5bG9hZDpPYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oe2NhcnRfaWQ6bn0sdD97Y3JlZGl0X2NhcmRfdG9rZW46e3Rva2VuOnR9fTp7fSkse2NvbmZpcm06ITEsbWV0aG9kOnouTGlua30pfX19X3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKXtjb25zdHtnZXRDYXJ0T3JUaHJvdzplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7bGluZUl0ZW1zOnR9PWUoKTtyZXR1cm4hIXQucGh5c2ljYWxJdGVtcy5sZW5ndGh9X3VwZGF0ZURpc3BsYXllZFByaWNlKCl7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt0aGlzLl9zdHJpcGVFbGVtZW50cyYmdGhpcy5fc3RyaXBlRWxlbWVudHMudXBkYXRlKHtjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpLG1vZGU6XCJwYXltZW50XCIsYW1vdW50OnlpZWxkIHRoaXMuX2dldFRvdGFsUHJpY2UoKX0pfSl9X2dldEN1cnJlbmN5KCl7aWYoIXRoaXMuX2N1cnJlbmN5Q29kZSl7Y29uc3R7Y29kZTplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0T3JUaHJvdygpLmN1cnJlbmN5O3RoaXMuX2N1cnJlbmN5Q29kZT1lLnRvTG93ZXJDYXNlKCl9cmV0dXJuIHRoaXMuX2N1cnJlbmN5Q29kZX1fZ2V0VG90YWxQcmljZSgpe3JldHVybiBfZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRDaGVja291dCgpO2NvbnN0e2dldENoZWNrb3V0T3JUaHJvdzplLGdldENhcnRPclRocm93OnR9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtkZWNpbWFsUGxhY2VzOml9PXQoKS5jdXJyZW5jeSxuPXIoZSgpLm91dHN0YW5kaW5nQmFsYW5jZSxpKS50b0ZpeGVkKGkpO3JldHVybiB0aGlzLl90b0NlbnRzKCtuKX0pfV9nZXRBdmFpbGFibGVDb3VudHJpZXMoKXt2YXIgZTtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHQ9eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRTaGlwcGluZ0NvdW50cmllcygpO3JldHVybigobnVsbD09PShlPXQuZ2V0U2hpcHBpbmdDb3VudHJpZXMoKSl8fHZvaWQgMD09PWU/dm9pZCAwOmUubWFwKGU9PmUuY29kZSkpfHxbXSkuZmlsdGVyKGU9PlNlLmluY2x1ZGVzKGUpKX0pfV9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKXt2YXIgZSx0LGk7cmV0dXJuIF9lKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENvbnNpZ25tZW50cygpO2lmKCEobnVsbD09bj92b2lkIDA6blswXSkpcmV0dXJuO2NvbnN0IHI9blswXSxvPShyLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9uc3x8W10pLm1hcCh0aGlzLl9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbi5iaW5kKHRoaXMpKSxzPW51bGw9PT0oZT1yLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9ucyl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZmluZChlPT5lLmlzUmVjb21tZW5kZWQpLGE9bnVsbD09PSh0PXIuc2VsZWN0ZWRTaGlwcGluZ09wdGlvbil8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQsZD1udWxsPT1zP3ZvaWQgMDpzLmlkO3JldHVybiBhP28uc29ydChlPT5lLmlkPT09YT8tMTowKTpkPyhvLnNvcnQoZT0+ZS5pZD09PWQ/LTE6MCkseWllbGQgdGhpcy5faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UoZCkpOnlpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PT0oaT1vWzBdKXx8dm9pZCAwPT09aT92b2lkIDA6aS5pZCksb30pfV9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbih7aWQ6ZSxjb3N0OnQsZGVzY3JpcHRpb246aX0pe3JldHVybntpZDplLGRpc3BsYXlOYW1lOmksYW1vdW50OnRoaXMuX3RvQ2VudHModCl9fV9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShlKXtyZXR1cm4gX2UodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKGUmJlwic2hpcHBpbmdfb3B0aW9uX3Vuc2VsZWN0ZWRcIiE9PWUpcmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zZWxlY3RTaGlwcGluZ09wdGlvbihlKX0pfV9nZXRBbW91bnRUcmFuc2Zvcm1lcigpe2lmKHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyKXJldHVybiB0aGlzLl9hbW91bnRUcmFuc2Zvcm1lcjtjb25zdHtnZXRDYXJ0OmV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjdXJyZW5jeTp0fT1lKCl8fHt9O3JldHVybiB0P25ldyB2ZSh0LmRlY2ltYWxQbGFjZXMpOnZvaWQgMH1fdG9DZW50cyhlKXtjb25zdCB0PU1hdGgucm91bmQoMTAwKmUpLGk9dGhpcy5fZ2V0QW1vdW50VHJhbnNmb3JtZXIoKTtyZXR1cm4gaT9pLnRvSW50ZWdlcihlKTp0fV90b2dnbGVMb2FkaW5nSW5kaWNhdG9yKGUpe2UmJnRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI/dGhpcy5sb2FkaW5nSW5kaWNhdG9yLnNob3codGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcik6dGhpcy5sb2FkaW5nSW5kaWNhdG9yLmhpZGUoKX19Y29uc3QgQ2U9bCh0PT57Y29uc3QgaT1uZXcgRyhlKCkpLG49bmV3IGdlKHtjb250YWluZXJTdHlsZXM6bWV9KTtyZXR1cm4gbmV3IGZlKHQsaSxuZXcgVyh0LGkpLG4pfSxbe2lkOlwic3RyaXBlb2NzXCJ9XSk7dmFyIEVlPWZ1bmN0aW9uKGUsdCxpLG4pe3JldHVybiBuZXcoaXx8KGk9UHJvbWlzZSkpKGZ1bmN0aW9uKHIsbyl7ZnVuY3Rpb24gcyhlKXt0cnl7ZChuLm5leHQoZSkpfWNhdGNoKGUpe28oZSl9fWZ1bmN0aW9uIGEoZSl7dHJ5e2Qobi50aHJvdyhlKSl9Y2F0Y2goZSl7byhlKX19ZnVuY3Rpb24gZChlKXt2YXIgdDtlLmRvbmU/cihlLnZhbHVlKToodD1lLnZhbHVlLHQgaW5zdGFuY2VvZiBpP3Q6bmV3IGkoZnVuY3Rpb24oZSl7ZSh0KX0pKS50aGVuKHMsYSl9ZCgobj1uLmFwcGx5KGUsdHx8W10pKS5uZXh0KCkpfSl9O2NsYXNzIElle2NvbnN0cnVjdG9yKGUsdCxpLG4pe3RoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZT1lLHRoaXMuc2NyaXB0TG9hZGVyPXQsdGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2U9aSx0aGlzLmxvYWRpbmdJbmRpY2F0b3I9bn1pbml0aWFsaXplKGUpe3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3R7c3RyaXBlb2NzOnQsY29udGFpbmVySWQ6aX09ZXx8e307aWYoIXR8fCFpKXRocm93IG5ldyB2KGEuUGF5bWVudE5vdEluaXRpYWxpemVkKTtjb25zdHttZXRob2RJZDpuLGdhdGV3YXlJZDpyfT10O2lmKCFufHwhcil0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtjb25zdCBvPXlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5sb2FkUGF5bWVudE1ldGhvZChyLHtwYXJhbXM6e21ldGhvZDpufX0pLGQ9by5nZXRQYXltZW50TWV0aG9kT3JUaHJvdyhuLHIpLHtsb2FkaW5nQ29udGFpbmVySWQ6bCxidXR0b25IZWlnaHQ6YyxvbkNvbXBsZXRlOnV9PXQ7aWYodGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcj1sLHRoaXMuX29uQ29tcGxldGU9dSwhSihkKSl0aHJvdyBuZXcgeShzLk1pc3NpbmdQYXltZW50TWV0aG9kKTtjb25zdHtpbml0aWFsaXphdGlvbkRhdGE6aH09ZCx7Y2FwdHVyZU1ldGhvZDpwfT1oLG09dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RyaXBlSnNWZXJzaW9uKGgpO3RoaXMuX2NhcHR1cmVNZXRob2Q9cCx0aGlzLl9zdHJpcGVDbGllbnQ9eWllbGQgdGhpcy5zY3JpcHRMb2FkZXIuZ2V0U3RyaXBlQ2xpZW50KGgsby5nZXRDYXJ0TG9jYWxlKCksbSkseWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWREZWZhdWx0Q2hlY2tvdXQoKSx5aWVsZCB0aGlzLl9tb3VudEV4cHJlc3NDaGVja291dEVsZW1lbnQoaSx0aGlzLl9zdHJpcGVDbGllbnQsYyksdGhpcy5faW5pdGlhbGl6ZUV2ZW50cyhuKX0pfXNpZ25Jbigpe3JldHVybiBQcm9taXNlLnJlc29sdmUoKX1zaWduT3V0KCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfWV4ZWN1dGVQYXltZW50TWV0aG9kQ2hlY2tvdXQoKXtyZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9ZGVpbml0aWFsaXplKCl7cmV0dXJuIFByb21pc2UucmVzb2x2ZSgpfV9tb3VudEV4cHJlc3NDaGVja291dEVsZW1lbnQoZSx0LGk9NDApe3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3Qgbj10aGlzLl9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCkscj1PYmplY3QuYXNzaWduKE9iamVjdC5hc3NpZ24oT2JqZWN0LmFzc2lnbih7c2hpcHBpbmdBZGRyZXNzUmVxdWlyZWQ6bn0sbj97YWxsb3dlZFNoaXBwaW5nQ291bnRyaWVzOnlpZWxkIHRoaXMuX2dldEF2YWlsYWJsZUNvdW50cmllcygpfTp7fSksbj97c2hpcHBpbmdSYXRlczpbe2lkOlwiX1wiLGFtb3VudDowLGRpc3BsYXlOYW1lOlwiUGVuZGluZyByYXRlc1wifV19Ont9KSx7YmlsbGluZ0FkZHJlc3NSZXF1aXJlZDohMCxlbWFpbFJlcXVpcmVkOiEwLHBob25lTnVtYmVyUmVxdWlyZWQ6ITAscGF5bWVudE1ldGhvZHM6e2xpbms6TC5BVVRPLGFwcGxlUGF5OkwuTkVWRVIsZ29vZ2xlUGF5OkwuTkVWRVIsYW1hem9uUGF5OkwuTkVWRVIscGF5cGFsOkwuTkVWRVIsa2xhcm5hOkwuTkVWRVJ9LGJ1dHRvbkhlaWdodDppfSkse2NhcnRBbW91bnQ6bz0xfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKS5nZXRDYXJ0KCl8fHt9LHM9T2JqZWN0LmFzc2lnbih7bW9kZTpcInBheW1lbnRcIixhbW91bnQ6dGhpcy5fdG9DZW50cyhvKSxjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpfSx0aGlzLl9jYXB0dXJlTWV0aG9kP3tjYXB0dXJlTWV0aG9kOnRoaXMuX2NhcHR1cmVNZXRob2R9Ont9KTt0aGlzLl9zdHJpcGVFbGVtZW50cz10LmVsZW1lbnRzKHMpLHRoaXMuX2xpbmtWMkVsZW1lbnQ9dGhpcy5fc3RyaXBlRWxlbWVudHMuY3JlYXRlKFYuRVhQUkVTU19DSEVDS09VVCxyKSx0aGlzLl9saW5rVjJFbGVtZW50Lm1vdW50KGAjJHtlfWApfSl9X2luaXRpYWxpemVFdmVudHMoZSl7dGhpcy5fbGlua1YyRWxlbWVudCYmKHRoaXMuX3Nob3VsZFJlcXVpcmVTaGlwcGluZ0FkZHJlc3MoKSYmKHRoaXMuX2xpbmtWMkVsZW1lbnQub24oai5TSElQUElOR19BRERSRVNTX0NIQU5HRSxlPT5FZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uU2hpcHBpbmdBZGRyZXNzQ2hhbmdlKGUpfSkpLHRoaXMuX2xpbmtWMkVsZW1lbnQub24oai5TSElQUElOR19SQVRFX0NIQU5HRSxlPT5FZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uU2hpcHBpbmdSYXRlQ2hhbmdlKGUpfSkpKSx0aGlzLl9saW5rVjJFbGVtZW50Lm9uKGouQ09ORklSTSx0PT5FZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuIHRoaXMuX29uQ29uZmlybSh0LGUpfSkpLHRoaXMuX2xpbmtWMkVsZW1lbnQub24oai5DQU5DRUwsdGhpcy5fb25DYW5jZWwpKX1fb25TaGlwcGluZ0FkZHJlc3NDaGFuZ2UoZSl7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZighKFwiYWRkcmVzc1wiaW4gZSkpcmV0dXJuO2NvbnN0IHQ9ZS5hZGRyZXNzLGk9e2ZpcnN0TmFtZTpcIlwiLGxhc3ROYW1lOlwiXCIscGhvbmU6XCJcIixjb21wYW55OlwiXCIsYWRkcmVzczE6XCJcIixhZGRyZXNzMjpcIlwiLGNpdHk6KG51bGw9PXQ/dm9pZCAwOnQuY2l0eSl8fFwiXCIsY291bnRyeUNvZGU6KG51bGw9PXQ/dm9pZCAwOnQuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09dD92b2lkIDA6dC5wb3N0YWxfY29kZSl8fFwiXCIsc3RhdGVPclByb3ZpbmNlOihudWxsPT10P3ZvaWQgMDp0LnN0YXRlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2VDb2RlOihudWxsPT10P3ZvaWQgMDp0LnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119O3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVTaGlwcGluZ0FkZHJlc3MoaSk7Y29uc3Qgbj15aWVsZCB0aGlzLl9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKTt5aWVsZCB0aGlzLl91cGRhdGVEaXNwbGF5ZWRQcmljZSgpLChudWxsPT1uP3ZvaWQgMDpuLmxlbmd0aCk/ZS5yZXNvbHZlKHtzaGlwcGluZ1JhdGVzOm59KTplLnJlamVjdCgpfSl9X29uQ2FuY2VsKCl7dGhyb3cgbmV3IF99X29uU2hpcHBpbmdSYXRlQ2hhbmdlKGUpe3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoXCJzaGlwcGluZ1JhdGVcImluIGUpe2NvbnN0e3NoaXBwaW5nUmF0ZTp0fT1lO3lpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PXQ/dm9pZCAwOnQuaWQpLHlpZWxkIHRoaXMuX3VwZGF0ZURpc3BsYXllZFByaWNlKCksZS5yZXNvbHZlKHt9KX19KX1fb25Db25maXJtKGUsdCl7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtpZihcImJpbGxpbmdEZXRhaWxzXCJpbiBlJiZcInNoaXBwaW5nQWRkcmVzc1wiaW4gZSYmdGhpcy5fc3RyaXBlQ2xpZW50JiZ0aGlzLl9zdHJpcGVFbGVtZW50cyl7eWllbGQgdGhpcy5fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKSx5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0T3JkZXIoKTtjb25zdCBpPXRoaXMuX2dldFBheW1lbnRQYXlsb2FkKHQpO3RyeXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2Uuc3VibWl0UGF5bWVudChpKX1jYXRjaChlKXt5aWVsZCB0aGlzLl9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQpfX1yZXR1cm4gUHJvbWlzZS5yZXNvbHZlKCl9KX1fdXBkYXRlU2hpcHBpbmdBbmRCaWxsaW5nQWRkcmVzcyhlKXt2YXIgdCxpLG4scixvLHMsYSxkO3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7Y29uc3QgbD10aGlzLl9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCksYz0obnVsbD09PShpPW51bGw9PT0odD1lLnNoaXBwaW5nQWRkcmVzcyl8fHZvaWQgMD09PXQ/dm9pZCAwOnQubmFtZSl8fHZvaWQgMD09PWk/dm9pZCAwOmkuc3BsaXQoXCIgXCIpWzBdKXx8KG51bGw9PT0ocj1udWxsPT09KG49ZS5iaWxsaW5nRGV0YWlscyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ubmFtZSl8fHZvaWQgMD09PXI/dm9pZCAwOnIuc3BsaXQoXCIgXCIpWzBdKXx8XCJcIix1PShudWxsPT09KHM9bnVsbD09PShvPWUuc2hpcHBpbmdBZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5uYW1lKXx8dm9pZCAwPT09cz92b2lkIDA6cy5zcGxpdChcIiBcIilbMV0pfHwobnVsbD09PShkPW51bGw9PT0oYT1lLmJpbGxpbmdEZXRhaWxzKXx8dm9pZCAwPT09YT92b2lkIDA6YS5uYW1lKXx8dm9pZCAwPT09ZD92b2lkIDA6ZC5zcGxpdChcIiBcIilbMV0pfHxcIlwiO2lmKGwpe2NvbnN0IHQ9dGhpcy5fbWFwU2hpcHBpbmdBZGRyZXNzKGUuc2hpcHBpbmdBZGRyZXNzLGUuYmlsbGluZ0RldGFpbHMsYyx1KTt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UudXBkYXRlU2hpcHBpbmdBZGRyZXNzKHQpfWNvbnN0IGg9dGhpcy5fbWFwQmlsbGluZ0FkZHJlc3MoZS5zaGlwcGluZ0FkZHJlc3MsZS5iaWxsaW5nRGV0YWlscyxjLHUpO3lpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS51cGRhdGVCaWxsaW5nQWRkcmVzcyhoKX0pfV9tYXBTaGlwcGluZ0FkZHJlc3MoZSx0LGksbil7dmFyIHIsbyxzLGEsZCxsLGM7cmV0dXJue2ZpcnN0TmFtZTppLGxhc3ROYW1lOm4scGhvbmU6KG51bGw9PXQ/dm9pZCAwOnQucGhvbmUpfHxcIlwiLGNvbXBhbnk6XCJcIixhZGRyZXNzMToobnVsbD09PShyPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PXI/dm9pZCAwOnIubGluZTEpfHxcIlwiLGFkZHJlc3MyOihudWxsPT09KG89bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5saW5lMil8fFwiXCIsY2l0eToobnVsbD09PShzPW51bGw9PWU/dm9pZCAwOmUuYWRkcmVzcyl8fHZvaWQgMD09PXM/dm9pZCAwOnMuY2l0eSl8fFwiXCIsY291bnRyeUNvZGU6KG51bGw9PT0oYT1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1hP3ZvaWQgMDphLmNvdW50cnkpfHxcIlwiLHBvc3RhbENvZGU6KG51bGw9PT0oZD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1kP3ZvaWQgMDpkLnBvc3RhbF9jb2RlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2U6KG51bGw9PT0obD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1sP3ZvaWQgMDpsLnN0YXRlKXx8XCJcIixzdGF0ZU9yUHJvdmluY2VDb2RlOihudWxsPT09KGM9bnVsbD09ZT92b2lkIDA6ZS5hZGRyZXNzKXx8dm9pZCAwPT09Yz92b2lkIDA6Yy5zdGF0ZSl8fFwiXCIsY3VzdG9tRmllbGRzOltdfX1fbWFwQmlsbGluZ0FkZHJlc3MoZSx0LGksbil7dmFyIHIsbyxzLGEsZCxsO3JldHVybntlbWFpbDoobnVsbD09dD92b2lkIDA6dC5lbWFpbCl8fFwiXCIsZmlyc3ROYW1lOmksbGFzdE5hbWU6bixwaG9uZToobnVsbD09dD92b2lkIDA6dC5waG9uZSl8fFwiXCIsY29tcGFueTpcIlwiLGFkZHJlc3MxOihudWxsPT09KHI9bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09cj92b2lkIDA6ci5saW5lMSl8fFwiXCIsYWRkcmVzczI6XCJcIixjaXR5OihudWxsPT09KG89bnVsbD09dD92b2lkIDA6dC5hZGRyZXNzKXx8dm9pZCAwPT09bz92b2lkIDA6by5jaXR5KXx8XCJcIixjb3VudHJ5Q29kZToobnVsbD09PShzPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PXM/dm9pZCAwOnMuY291bnRyeSl8fFwiXCIscG9zdGFsQ29kZToobnVsbD09PShhPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PWE/dm9pZCAwOmEucG9zdGFsX2NvZGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZToobnVsbD09PShkPW51bGw9PXQ/dm9pZCAwOnQuYWRkcmVzcyl8fHZvaWQgMD09PWQ/dm9pZCAwOmQuc3RhdGUpfHxcIlwiLHN0YXRlT3JQcm92aW5jZUNvZGU6KG51bGw9PT0obD1udWxsPT1lP3ZvaWQgMDplLmFkZHJlc3MpfHx2b2lkIDA9PT1sP3ZvaWQgMDpsLnN0YXRlKXx8XCJcIixjdXN0b21GaWVsZHM6W119fV9wcm9jZXNzQWRkaXRpb25hbEFjdGlvbihlLHQpe3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7aWYoIVMoZSl8fCF0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS5pc0FkZGl0aW9uYWxBY3Rpb25FcnJvcihlLmJvZHkuZXJyb3JzKSl0aHJvdyBlO2lmKCF0aGlzLl9zdHJpcGVDbGllbnR8fCF0aGlzLl9zdHJpcGVFbGVtZW50cyl0aHJvdyBuZXcgdihhLlBheW1lbnROb3RJbml0aWFsaXplZCk7Y29uc3R7ZGF0YTppfT1lLmJvZHkuYWRkaXRpb25hbF9hY3Rpb25fcmVxdWlyZWQse3Rva2VuOm59PWkse3BheW1lbnRJbnRlbnQ6cn09eWllbGQgdGhpcy5fY29uZmlybVN0cmlwZVBheW1lbnRPclRocm93KGksdCksbz10aGlzLl9nZXRQYXltZW50UGF5bG9hZCh0LChudWxsPT1yP3ZvaWQgMDpyLmlkKXx8bik7dHJ5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITApLHlpZWxkIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zdWJtaXRQYXltZW50KG8pLHlpZWxkIHRoaXMuX2NvbXBsZXRlQ2hlY2tvdXRGbG93KCl9Y2F0Y2goZSl7dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UudGhyb3dQYXltZW50Q29uZmlybWF0aW9uUHJvY2VlZE1lc3NhZ2UoKX1maW5hbGx5e3RoaXMuX3RvZ2dsZUxvYWRpbmdJbmRpY2F0b3IoITEpfX0pfV9jb25maXJtU3RyaXBlUGF5bWVudE9yVGhyb3coZSx0KXt2YXIgaSxuLHI7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdHt0b2tlbjpvLHJlZGlyZWN0X3VybDpzfT1lLGE9dGhpcy5zdHJpcGVJbnRlZ3JhdGlvblNlcnZpY2UubWFwU3RyaXBlUGF5bWVudERhdGEodGhpcy5fc3RyaXBlRWxlbWVudHMscyk7bGV0IGQ7dHJ5e2NvbnN0IGU9KHlpZWxkIHRoaXMuc3RyaXBlSW50ZWdyYXRpb25TZXJ2aWNlLmlzUGF5bWVudENvbXBsZXRlZCh0LHRoaXMuX3N0cmlwZUNsaWVudCkpP3lpZWxkIG51bGw9PT0ocj10aGlzLl9zdHJpcGVDbGllbnQpfHx2b2lkIDA9PT1yP3ZvaWQgMDpyLnJldHJpZXZlUGF5bWVudEludGVudChvfHxcIlwiKTp5aWVsZCBudWxsPT09KGk9dGhpcy5fc3RyaXBlQ2xpZW50KXx8dm9pZCAwPT09aT92b2lkIDA6aS5jb25maXJtUGF5bWVudCh7ZWxlbWVudHM6YS5lbGVtZW50cyxjbGllbnRTZWNyZXQ6byxyZWRpcmVjdDpMLklGX1JFUVVJUkVELGNvbmZpcm1QYXJhbXM6e3JldHVybl91cmw6bnVsbD09PShuPWEuY29uZmlybVBhcmFtcyl8fHZvaWQgMD09PW4/dm9pZCAwOm4ucmV0dXJuX3VybH19KTtpZihkPW51bGw9PWU/dm9pZCAwOmUuZXJyb3IsZHx8IShudWxsPT1lP3ZvaWQgMDplLnBheW1lbnRJbnRlbnQpKXRocm93IG5ldyBIO3JldHVybiBlfWNhdGNoKGUpe3JldHVybiB0aGlzLnN0cmlwZUludGVncmF0aW9uU2VydmljZS50aHJvd1N0cmlwZUVycm9yKGQpfX0pfV9jb21wbGV0ZUNoZWNrb3V0Rmxvdygpe3JldHVybiBFZSh0aGlzLHZvaWQgMCx2b2lkIDAsZnVuY3Rpb24qKCl7cmV0dXJuXCJmdW5jdGlvblwiPT10eXBlb2YgdGhpcy5fb25Db21wbGV0ZT90aGlzLl9vbkNvbXBsZXRlKCk6KHdpbmRvdy5sb2NhdGlvbi5yZXBsYWNlKFwiL2NoZWNrb3V0L29yZGVyLWNvbmZpcm1hdGlvblwiKSxQcm9taXNlLnJlc29sdmUoKSl9KX1fZ2V0UGF5bWVudFBheWxvYWQoZSx0KXt2YXIgaTtjb25zdCBuPShudWxsPT09KGk9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09aT92b2lkIDA6aS5pZCl8fFwiXCI7cmV0dXJue21ldGhvZElkOmUscGF5bWVudERhdGE6e2Zvcm1hdHRlZFBheWxvYWQ6T2JqZWN0LmFzc2lnbihPYmplY3QuYXNzaWduKHtjYXJ0X2lkOm59LHQ/e2NyZWRpdF9jYXJkX3Rva2VuOnt0b2tlbjp0fX06e30pLHtjb25maXJtOiExLG1ldGhvZDp6Lkxpbmt9KX19fV9zaG91bGRSZXF1aXJlU2hpcHBpbmdBZGRyZXNzKCl7Y29uc3R7Z2V0Q2FydDplfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7bGluZUl0ZW1zOnR9PWUoKXx8e307cmV0dXJuISEobnVsbD09dD92b2lkIDA6dC5waHlzaWNhbEl0ZW1zLmxlbmd0aCl9X3VwZGF0ZURpc3BsYXllZFByaWNlKCl7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt0aGlzLl9zdHJpcGVFbGVtZW50cyYmdGhpcy5fc3RyaXBlRWxlbWVudHMudXBkYXRlKHtjdXJyZW5jeTp0aGlzLl9nZXRDdXJyZW5jeSgpLG1vZGU6XCJwYXltZW50XCIsYW1vdW50OnlpZWxkIHRoaXMuX2dldFRvdGFsUHJpY2UoKX0pfSl9X2dldEN1cnJlbmN5KCl7dmFyIGU7aWYoIXRoaXMuX2N1cnJlbmN5Q29kZSl7Y29uc3QgdD1udWxsPT09KGU9dGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmdldFN0YXRlKCkuZ2V0Q2FydCgpKXx8dm9pZCAwPT09ZT92b2lkIDA6ZS5jdXJyZW5jeTt0JiYodGhpcy5fY3VycmVuY3lDb2RlPXQuY29kZS50b0xvd2VyQ2FzZSgpKX1yZXR1cm4gdGhpcy5fY3VycmVuY3lDb2RlfV9nZXRUb3RhbFByaWNlKCl7dmFyIGU7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXt5aWVsZCB0aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UubG9hZENoZWNrb3V0KCk7Y29uc3R7Z2V0Q2hlY2tvdXRPclRocm93OnQsZ2V0Q2FydDppfT10aGlzLnBheW1lbnRJbnRlZ3JhdGlvblNlcnZpY2UuZ2V0U3RhdGUoKSx7ZGVjaW1hbFBsYWNlczpufT0obnVsbD09PShlPWkoKSl8fHZvaWQgMD09PWU/dm9pZCAwOmUuY3VycmVuY3kpfHx7fSxvPXIodCgpLm91dHN0YW5kaW5nQmFsYW5jZSxuKS50b0ZpeGVkKG4pO3JldHVybiB0aGlzLl90b0NlbnRzKCtvKX0pfV9nZXRBdmFpbGFibGVDb3VudHJpZXMoKXt2YXIgZTtyZXR1cm4gRWUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2NvbnN0IHQ9eWllbGQgdGhpcy5wYXltZW50SW50ZWdyYXRpb25TZXJ2aWNlLmxvYWRTaGlwcGluZ0NvdW50cmllcygpO3JldHVybigobnVsbD09PShlPXQuZ2V0U2hpcHBpbmdDb3VudHJpZXMoKSl8fHZvaWQgMD09PWU/dm9pZCAwOmUubWFwKGU9PmUuY29kZSkpfHxbXSkuZmlsdGVyKGU9PlNlLmluY2x1ZGVzKGUpKX0pfV9nZXRBdmFpbGFibGVTaGlwcGluZ09wdGlvbnMoKXt2YXIgZSx0LGk7cmV0dXJuIEVlKHRoaXMsdm9pZCAwLHZvaWQgMCxmdW5jdGlvbiooKXtjb25zdCBuPXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLmdldENvbnNpZ25tZW50cygpO2lmKCEobnVsbD09bj92b2lkIDA6blswXSkpcmV0dXJuO2NvbnN0IHI9blswXSxvPShyLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9uc3x8W10pLm1hcCh0aGlzLl9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbi5iaW5kKHRoaXMpKSxzPW51bGw9PT0oZT1yLmF2YWlsYWJsZVNoaXBwaW5nT3B0aW9ucyl8fHZvaWQgMD09PWU/dm9pZCAwOmUuZmluZChlPT5lLmlzUmVjb21tZW5kZWQpLGE9bnVsbD09PSh0PXIuc2VsZWN0ZWRTaGlwcGluZ09wdGlvbil8fHZvaWQgMD09PXQ/dm9pZCAwOnQuaWQsZD1udWxsPT1zP3ZvaWQgMDpzLmlkO3JldHVybiBhP28uc29ydChlPT5lLmlkPT09YT8tMTowKTpkPyhvLnNvcnQoZT0+ZS5pZD09PWQ/LTE6MCkseWllbGQgdGhpcy5faGFuZGxlU2hpcHBpbmdPcHRpb25DaGFuZ2UoZCkpOnlpZWxkIHRoaXMuX2hhbmRsZVNoaXBwaW5nT3B0aW9uQ2hhbmdlKG51bGw9PT0oaT1vWzBdKXx8dm9pZCAwPT09aT92b2lkIDA6aS5pZCksb30pfV9nZXRTdHJpcGVTaGlwcGluZ09wdGlvbih7aWQ6ZSxjb3N0OnQsZGVzY3JpcHRpb246aX0pe3JldHVybntpZDplLGRpc3BsYXlOYW1lOmksYW1vdW50OnRoaXMuX3RvQ2VudHModCl9fV9oYW5kbGVTaGlwcGluZ09wdGlvbkNoYW5nZShlKXtyZXR1cm4gRWUodGhpcyx2b2lkIDAsdm9pZCAwLGZ1bmN0aW9uKigpe2lmKGUmJlwic2hpcHBpbmdfb3B0aW9uX3Vuc2VsZWN0ZWRcIiE9PWUpcmV0dXJuIHRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5zZWxlY3RTaGlwcGluZ09wdGlvbihlKX0pfV9nZXRBbW91bnRUcmFuc2Zvcm1lcigpe2lmKHRoaXMuX2Ftb3VudFRyYW5zZm9ybWVyKXJldHVybiB0aGlzLl9hbW91bnRUcmFuc2Zvcm1lcjtjb25zdHtnZXRDYXJ0OmV9PXRoaXMucGF5bWVudEludGVncmF0aW9uU2VydmljZS5nZXRTdGF0ZSgpLHtjdXJyZW5jeTp0fT1lKCl8fHt9O3JldHVybiB0P25ldyB2ZSh0LmRlY2ltYWxQbGFjZXMpOnZvaWQgMH1fdG9DZW50cyhlKXtjb25zdCB0PU1hdGgucm91bmQoMTAwKmUpLGk9dGhpcy5fZ2V0QW1vdW50VHJhbnNmb3JtZXIoKTtyZXR1cm4gaT9pLnRvSW50ZWdlcihlKTp0fV90b2dnbGVMb2FkaW5nSW5kaWNhdG9yKGUpe2UmJnRoaXMuX2xvYWRpbmdJbmRpY2F0b3JDb250YWluZXI/dGhpcy5sb2FkaW5nSW5kaWNhdG9yLnNob3codGhpcy5fbG9hZGluZ0luZGljYXRvckNvbnRhaW5lcik6dGhpcy5sb2FkaW5nSW5kaWNhdG9yLmhpZGUoKX19Y29uc3QgUGU9bCh0PT57Y29uc3QgaT1uZXcgRyhlKCkpLG49bmV3IGdlKHtjb250YWluZXJTdHlsZXM6bWV9KTtyZXR1cm4gbmV3IEllKHQsaSxuZXcgVyh0LGkpLG4pfSxbe2lkOlwic3RyaXBlb2NzXCJ9XSk7ZXhwb3J0e1BlIGFzIGNyZWF0ZUxpbmtWMkJ1dHRvblN0cmF0ZWd5LGNlIGFzIGNyZWF0ZVN0cmlwZUNTUGF5bWVudFN0cmF0ZWd5LENlIGFzIGNyZWF0ZVN0cmlwZUxpbmtWMkN1c3RvbWVyU3RyYXRlZ3ksYWUgYXMgY3JlYXRlU3RyaXBlT0NTUGF5bWVudFN0cmF0ZWd5LGhlIGFzIGNyZWF0ZVN0cmlwZVVQRUN1c3RvbWVyU3RyYXRlZ3ksbmUgYXMgY3JlYXRlU3RyaXBlVVBFUGF5bWVudFN0cmF0ZWd5LFQgYXMgY3JlYXRlU3RyaXBlVjNQYXltZW50U3RyYXRlZ3l9O1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9c3RyaXBlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///../checkout-sdk-js/dist/esm/integrations/stripe.js\n\n}");

/***/ })

}]);